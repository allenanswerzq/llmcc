===============================================================================
cross-crate-traits
===============================================================================
Traits defined in one crate, implemented in another.

--- file: Cargo.toml ---
[workspace]
members = ["traits", "impl"]

--- file: traits/Cargo.toml ---
[package]
name = "traits"
version = "0.1.0"

--- file: traits/src/lib.rs ---
pub mod core;

--- file: traits/src/core.rs ---
pub struct Request {
    pub path: String,
}

pub struct Response {
    pub status: u16,
    pub body: String,
}

pub trait Handler {
    fn handle(&self, req: Request) -> Response;
}

pub trait Middleware {
    fn before(&self, req: Request) -> Request;
    fn after(&self, res: Response) -> Response;
}

--- file: impl/Cargo.toml ---
[package]
name = "impl"
version = "0.1.0"

[dependencies]
traits = { path = "../traits" }

--- file: impl/src/lib.rs ---
pub mod handlers;

--- file: impl/src/handlers.rs ---
use traits::core::{Request, Response, Handler, Middleware};

pub struct EchoHandler;

impl Handler for EchoHandler {
    fn handle(&self, req: Request) -> Response {
        Response { status: 200, body: req.path }
    }
}

pub struct LogMiddleware;

impl Middleware for LogMiddleware {
    fn before(&self, req: Request) -> Request {
        req
    }
    fn after(&self, res: Response) -> Response {
        res
    }
}

--- expect:block-graph ---
(root:1 lib ($TMP/traits/src/lib.rs)
  (module:2 core)
)

(root:3 core ($TMP/traits/src/core.rs)
  (class:4 Request
    (field:5 path @type String)
  )
  (class:6 Response
    (field:7 status @type u16)
    (field:8 body @type String)
  )
  (trait:9 Handler
    (method:10 handle
      (parameter:11 self @type:9 Handler)
      (parameter:12 req @type:4 Request)
      (return:13 @type:6 Response)
      (@tdep:6 Response)
    )
  )
  (trait:14 Middleware
    (method:15 before
      (parameter:16 self @type:14 Middleware)
      (parameter:17 req @type:4 Request)
      (return:18 @type:4 Request)
      (@tdep:4 Request)
    )
    (method:19 after
      (parameter:20 self @type:14 Middleware)
      (parameter:21 res @type:6 Response)
      (return:22 @type:6 Response)
      (@tdep:6 Response)
    )
  )
)

(root:23 lib ($TMP/impl/src/lib.rs)
  (module:24 handlers)
)

(root:25 handlers ($TMP/impl/src/handlers.rs)
  (class:26 EchoHandler)
  (impl:27 EchoHandler @type:26 @trait:9
    (method:28 handle
      (parameter:29 self @type:26 EchoHandler)
      (parameter:30 req @type:4 Request)
      (return:31 @type:6 Response)
      (@tdep:6 Response)
    )
  )
  (class:32 LogMiddleware)
  (impl:33 LogMiddleware @type:32 @trait:14
    (method:34 before
      (parameter:35 self @type:32 LogMiddleware)
      (parameter:36 req @type:4 Request)
      (return:37 @type:4 Request)
      (@tdep:4 Request)
    )
    (method:38 after
      (parameter:39 self @type:32 LogMiddleware)
      (parameter:40 res @type:6 Response)
      (return:41 @type:6 Response)
      (@tdep:6 Response)
    )
  )
)

--- expect:arch-graph ---
digraph architecture {
  // Layout settings
  rankdir=TB;
  ranksep=0.6;
  nodesep=0.3;
  splines=ortho;
  compound=true;

  node [shape=box, style=rounded];
  edge [arrowsize=0.7];

  subgraph cluster_impl {
    label="impl";
    style=rounded;
    color="#888888";
    bgcolor="#f0f0f0";

    subgraph cluster_handlers_rs {
      label="handlers.rs";
      style=rounded;
      color="#aaaaaa";
      bgcolor="#fafafa";

      n32[label="LogMiddleware", full_path="$TMP/impl/src/handlers.rs:11", sym_ty="Struct", shape=box];
      n26[label="EchoHandler", full_path="$TMP/impl/src/handlers.rs:3", sym_ty="Struct", shape=box];
    }

  }

  subgraph cluster_traits {
    label="traits";
    style=rounded;
    color="#888888";
    bgcolor="#f0f0f0";

    subgraph cluster_core_rs {
      label="core.rs";
      style=rounded;
      color="#aaaaaa";
      bgcolor="#fafafa";

      n9[label="Handler", full_path="$TMP/traits/src/core.rs:10", sym_ty="Trait", shape=box];
      n14[label="Middleware", full_path="$TMP/traits/src/core.rs:14", sym_ty="Trait", shape=box];
    }

  }


  n9 -> n26 [from="trait", to="impl"];
  n14 -> n32 [from="trait", to="impl"];
}
