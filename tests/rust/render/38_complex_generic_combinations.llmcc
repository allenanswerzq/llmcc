===============================================================================
complex-generic-combinations
===============================================================================
Tests for complex generic type combinations: Option<Result<T, E>>, Vec<HashMap<K, V>>, etc.

--- file: sample/Cargo.toml ---
[package]
name = "sample"

--- file: sample/src/lib.rs ---
mod types;
mod complex;

--- file: sample/src/types.rs ---
pub struct User {
    pub id: u64,
}

pub struct Error {
    pub message: String,
}

pub struct Session {
    pub token: String,
}

--- file: sample/src/complex.rs ---
use std::collections::HashMap;
use crate::types::{User, Error, Session};

// Option<Result<T, E>>
pub struct MaybeResult {
    pub value: Option<Result<User, Error>>,
}

// Vec<Option<T>>
pub struct OptionalUsers {
    pub users: Vec<Option<User>>,
}

// HashMap<K, Option<V>>
pub struct UserSessionMap {
    pub sessions: HashMap<User, Option<Session>>,
}

// Result<Vec<T>, E>
pub fn fetch_users() -> Result<Vec<User>, Error> {
    todo!()
}

// Option<Vec<HashMap<K, V>>>
pub struct ComplexNested {
    pub data: Option<Vec<HashMap<User, Session>>>,
}

// Function returning nested generics
pub fn get_user_sessions() -> Option<HashMap<User, Vec<Session>>> {
    todo!()
}

--- expect:block-graph ---
(root:1 lib ($TMP/sample/src/lib.rs)
  (module:2 types)
  (module:3 complex)
)

(root:4 types ($TMP/sample/src/types.rs)
  (class:5 User
    (field:6 id @type u64)
  )
  (class:7 Error
    (field:8 message @type String)
  )
  (class:9 Session
    (field:10 token @type String)
  )
)

(root:11 complex ($TMP/sample/src/complex.rs)
  (class:12 MaybeResult
    (field:13 value @type:5 User)
    (@tdep:5 User)
  )
  (class:14 OptionalUsers
    (field:15 users @type:5 User)
    (@tdep:5 User)
  )
  (class:16 UserSessionMap
    (field:17 sessions @type:5 User)
    (@tdep:5 User)
  )
  (func:18 fetch_users
    (return:19)
    (@tdep:5 User)
    (@tdep:7 Error)
  )
  (class:21 ComplexNested
    (field:22 data @type:5 User)
    (@tdep:5 User)
  )
  (func:23 get_user_sessions
    (return:24)
    (@tdep:5 User)
    (@tdep:9 Session)
  )
)

--- expect:arch-graph ---
digraph architecture {
  rankdir=TB;
  ranksep=0.6;
  nodesep=0.3;
  splines=ortho;
  compound=true;

  node [shape=box, style=rounded];
  edge [arrowsize=0.7];

  subgraph cluster_sample {
    label="sample";
    style=rounded;
        bgcolor="#f8f8f8";

    subgraph cluster_complex_rs {
      label="complex.rs";
      style=rounded;
            bgcolor="#fafafa";

      n14[label="OptionalUsers", path="$TMP/sample/src/complex.rs:10", sym_ty="Struct", shape=box];
      n16[label="UserSessionMap", path="$TMP/sample/src/complex.rs:15", sym_ty="Struct", shape=box];
      n18[label="fetch_users", path="$TMP/sample/src/complex.rs:20", sym_ty="Function", shape=ellipse];
      n21[label="ComplexNested", path="$TMP/sample/src/complex.rs:25", sym_ty="Struct", shape=box];
      n23[label="get_user_sessions", path="$TMP/sample/src/complex.rs:30", sym_ty="Function", shape=ellipse];
      n12[label="MaybeResult", path="$TMP/sample/src/complex.rs:5", sym_ty="Struct", shape=box];
    }

    subgraph cluster_types_rs {
      label="types.rs";
      style=rounded;
            bgcolor="#fafafa";

      n5[label="User", path="$TMP/sample/src/types.rs:1", sym_ty="Struct", shape=box];
      n7[label="Error", path="$TMP/sample/src/types.rs:5", sym_ty="Struct", shape=box];
      n9[label="Session", path="$TMP/sample/src/types.rs:9", sym_ty="Struct", shape=box];
    }

  }


  n5 -> n12 [from="type_dep", to="struct"];
  n5 -> n14 [from="type_dep", to="struct"];
  n5 -> n16 [from="type_dep", to="struct"];
  n5 -> n21 [from="type_dep", to="struct"];
  n7 -> n12 [from="type_dep", to="struct"];
  n9 -> n16 [from="type_dep", to="struct"];
  n9 -> n21 [from="type_dep", to="struct"];
  n18 -> n5 [from="func", to="type_dep"];
  n18 -> n7 [from="func", to="type_dep"];
  n23 -> n5 [from="func", to="type_dep"];
  n23 -> n9 [from="func", to="type_dep"];
}
