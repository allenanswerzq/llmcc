===============================================================================
mixed-service-layer
===============================================================================
Complex service layer pattern with traits, generics, impls, and cross-file deps.
Combines: traits, impl blocks, generics, cross-file references, multiple impls.

--- file: sample/Cargo.toml ---
[package]
name = "sample"

--- file: sample/src/lib.rs ---
mod repository;
mod service;
mod models;
mod impl_repos;

--- file: sample/src/models.rs ---
pub struct User {
    pub id: u64,
    pub name: String,
}

pub struct Order {
    pub id: u64,
    pub user_id: u64,
    pub total: f64,
}

--- file: sample/src/repository.rs ---
pub trait Repository<T> {
    fn find(&self, id: u64) -> Option<T>;
    fn save(&self, item: T) -> bool;
}

--- file: sample/src/impl_repos.rs ---
use crate::repository::Repository;
use crate::models::{User, Order};

pub struct UserRepo {
    pub connection: String,
}

pub struct OrderRepo {
    pub connection: String,
}

impl Repository<User> for UserRepo {
    fn find(&self, id: u64) -> Option<User> {
        None
    }
    fn save(&self, item: User) -> bool {
        true
    }
}

impl Repository<Order> for OrderRepo {
    fn find(&self, id: u64) -> Option<Order> {
        None
    }
    fn save(&self, item: Order) -> bool {
        true
    }
}

--- file: sample/src/service.rs ---
use crate::repository::Repository;
use crate::models::User;

pub struct UserService<R: Repository<User>> {
    pub repo: R,
}

impl<R: Repository<User>> UserService<R> {
    pub fn get_user(&self, id: u64) -> Option<User> {
        self.repo.find(id)
    }
}

--- expect:block-graph ---
(root:1 lib ($TMP/sample/src/lib.rs)
  (module:2 repository)
  (module:3 service)
  (module:4 models)
  (module:5 impl_repos)
)

(root:6 models ($TMP/sample/src/models.rs)
  (class:7 User
    (field:8 id @type u64)
    (field:9 name @type String)
  )
  (class:10 Order
    (field:11 id @type u64)
    (field:12 user_id @type u64)
    (field:13 total @type f64)
  )
)

(root:14 repository ($TMP/sample/src/repository.rs)
  (trait:15 Repository
    (method:16 find
      (parameter:17 self @type:15 Repository)
      (parameter:18 id @type u64)
      (return:19)
    )
    (method:20 save
      (parameter:21 self @type:15 Repository)
      (parameter:22 item @type T)
      (return:23 @type bool)
    )
  )
)

(root:24 impl_repos ($TMP/sample/src/impl_repos.rs)
  (class:25 UserRepo
    (field:26 connection @type String)
    (@tdep:7 User)
  )
  (class:27 OrderRepo
    (field:28 connection @type String)
    (@tdep:10 Order)
  )
  (impl:29 UserRepo @type:25 @trait:15
    (method:30 find
      (parameter:31 self @type:25 UserRepo)
      (parameter:32 id @type u64)
      (return:33)
      (@tdep:7 User)
    )
    (method:34 save
      (parameter:35 self @type:25 UserRepo)
      (parameter:36 item @type:7 User)
      (return:37 @type bool)
    )
  )
  (impl:38 OrderRepo @type:27 @trait:15
    (method:39 find
      (parameter:40 self @type:27 OrderRepo)
      (parameter:41 id @type u64)
      (return:42)
      (@tdep:10 Order)
    )
    (method:43 save
      (parameter:44 self @type:27 OrderRepo)
      (parameter:45 item @type:10 Order)
      (return:46 @type bool)
    )
  )
)

(root:47 service ($TMP/sample/src/service.rs)
  (class:48 UserService
    (field:49 repo @type:15 Repository)
    (@tdep:15 Repository)
  )
  (impl:50 UserService @type:48
    (method:51 get_user
      (parameter:52 self @type:48 UserService)
      (parameter:53 id @type u64)
      (return:54)
      (@tdep:7 User)
    )
  )
)

--- expect:arch-graph ---
digraph architecture {
  rankdir=TB;
  ranksep=0.6;
  nodesep=0.3;
  splines=ortho;
  compound=true;

  node [shape=box, style=rounded];
  edge [arrowsize=0.7];

  subgraph cluster_sample {
    label="sample";
    bgcolor="#f8f8f8";

    subgraph cluster_impl_repos_rs {
      label="impl_repos.rs";
      bgcolor="#fafafa";

      n25[label="UserRepo", full_path="$TMP/sample/src/impl_repos.rs:4", sym_ty="Struct", shape=box];
      n27[label="OrderRepo", full_path="$TMP/sample/src/impl_repos.rs:8", sym_ty="Struct", shape=box];
    }

    subgraph cluster_models_rs {
      label="models.rs";
      bgcolor="#fafafa";

      n7[label="User", full_path="$TMP/sample/src/models.rs:1", sym_ty="Struct", shape=box];
      n10[label="Order", full_path="$TMP/sample/src/models.rs:6", sym_ty="Struct", shape=box];
    }

    subgraph cluster_repository_rs {
      label="repository.rs";
      bgcolor="#fafafa";

      n15[label="Repository", full_path="$TMP/sample/src/repository.rs:1", sym_ty="Trait", shape=box];
    }

    subgraph cluster_service_rs {
      label="service.rs";
      bgcolor="#fafafa";

      n48[label="UserService", full_path="$TMP/sample/src/service.rs:4", sym_ty="Struct", shape=box];
    }

  }


  n7 -> n25 [from="type_arg", to="impl"];
  n10 -> n27 [from="type_arg", to="impl"];
  n15 -> n25 [from="trait", to="impl"];
  n15 -> n27 [from="trait", to="impl"];
  n15 -> n48 [from="field_type", to="struct"];
}
