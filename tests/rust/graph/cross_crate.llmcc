===============================================================================
workspace-crate-dependency
===============================================================================


--- file: crates/core/src/lib.rs ---
pub mod types;
pub mod traits;

pub use types::*;
pub use traits::*;

--- file: crates/core/src/types.rs ---
#[derive(Clone, Debug)]
pub struct Id(pub u64);

#[derive(Clone, Debug)]
pub struct Timestamp(pub u64);

#[derive(Clone, Debug)]
pub struct Money {
    pub cents: i64,
    pub currency: String,
}

impl Money {
    pub fn new(cents: i64, currency: &str) -> Self {
        Money { cents, currency: currency.to_string() }
    }

    pub fn usd(cents: i64) -> Self {
        Money::new(cents, "USD")
    }
}

--- file: crates/core/src/traits.rs ---
use super::types::Id;

pub trait Entity {
    fn id(&self) -> &Id;
}

pub trait Repository<T: Entity> {
    fn find(&self, id: &Id) -> Option<T>;
    fn save(&mut self, entity: T) -> Id;
}

--- file: crates/domain/src/lib.rs ---
// Depends on core crate
use core::{Id, Entity, Money};

pub mod user;
pub mod account;

pub use user::User;
pub use account::Account;

--- file: crates/domain/src/user.rs ---
use core::{Id, Entity};

pub struct User {
    id: Id,
    pub name: String,
    pub email: String,
}

impl User {
    pub fn new(id: u64, name: String, email: String) -> Self {
        User { id: Id(id), name, email }
    }
}

impl Entity for User {
    fn id(&self) -> &Id {
        &self.id
    }
}

--- file: crates/domain/src/account.rs ---
use core::{Id, Entity, Money};
use super::user::User;

pub struct Account {
    id: Id,
    pub user: User,
    pub balance: Money,
}

impl Account {
    pub fn new(id: u64, user: User) -> Self {
        Account {
            id: Id(id),
            user,
            balance: Money::usd(0),
        }
    }

    pub fn deposit(&mut self, amount: Money) {
        self.balance.cents += amount.cents;
    }

    pub fn withdraw(&mut self, amount: Money) -> bool {
        if self.balance.cents >= amount.cents {
            self.balance.cents -= amount.cents;
            true
        } else {
            false
        }
    }
}

impl Entity for Account {
    fn id(&self) -> &Id {
        &self.id
    }
}

--- file: crates/app/src/lib.rs ---
// Depends on both core and domain
use core::{Id, Repository};
use domain::{User, Account};

pub mod services;
pub mod repos;

--- file: crates/app/src/repos.rs ---
use core::{Id, Entity, Repository};
use domain::{User, Account};
use std::collections::HashMap;

pub struct UserRepo {
    users: HashMap<u64, User>,
    next_id: u64,
}

impl UserRepo {
    pub fn new() -> Self {
        UserRepo { users: HashMap::new(), next_id: 1 }
    }
}

impl Repository<User> for UserRepo {
    fn find(&self, id: &Id) -> Option<User> {
        self.users.get(&id.0).cloned()
    }

    fn save(&mut self, user: User) -> Id {
        let id = Id(self.next_id);
        self.next_id += 1;
        self.users.insert(id.0, user);
        id
    }
}

pub struct AccountRepo {
    accounts: HashMap<u64, Account>,
    next_id: u64,
}

impl AccountRepo {
    pub fn new() -> Self {
        AccountRepo { accounts: HashMap::new(), next_id: 1 }
    }
}

impl Repository<Account> for AccountRepo {
    fn find(&self, id: &Id) -> Option<Account> {
        self.accounts.get(&id.0).cloned()
    }

    fn save(&mut self, account: Account) -> Id {
        let id = Id(self.next_id);
        self.next_id += 1;
        self.accounts.insert(id.0, account);
        id
    }
}

--- file: crates/app/src/services.rs ---
use core::{Id, Money, Repository};
use domain::{User, Account};
use super::repos::{UserRepo, AccountRepo};

pub struct BankingService {
    users: UserRepo,
    accounts: AccountRepo,
}

impl BankingService {
    pub fn new() -> Self {
        BankingService {
            users: UserRepo::new(),
            accounts: AccountRepo::new(),
        }
    }

    pub fn create_user(&mut self, name: String, email: String) -> Id {
        let user = User::new(0, name, email);
        self.users.save(user)
    }

    pub fn open_account(&mut self, user_id: &Id) -> Option<Id> {
        let user = self.users.find(user_id)?;
        let account = Account::new(0, user);
        Some(self.accounts.save(account))
    }

    pub fn deposit(&mut self, account_id: &Id, amount: i64) -> bool {
        if let Some(mut account) = self.accounts.find(account_id) {
            account.deposit(Money::usd(amount));
            true
        } else {
            false
        }
    }
}

--- file: src/main.rs ---
// Binary crate depending on app
use app::services::BankingService;
use core::Money;

fn main() {
    let mut bank = BankingService::new();

    let user_id = bank.create_user("Alice".to_string(), "alice@bank.com".to_string());

    if let Some(account_id) = bank.open_account(&user_id) {
        bank.deposit(&account_id, 10000);  // $100.00
        println!("Account opened and funded!");
    }
}

--- expect:symbols ---
u0:1   | Primitive      | i32            | i32                                                     | [global]
u0:2   | Primitive      | i64            | i64                                                     | [global]
u0:3   | Primitive      | i16            | i16                                                     | [global]
u0:4   | Primitive      | i8             | i8                                                      | [global]
u0:5   | Primitive      | i128           | i128                                                    | [global]
u0:6   | Primitive      | isize          | isize                                                   | [global]
u0:7   | Primitive      | u32            | u32                                                     | [global]
u0:8   | Primitive      | u64            | u64                                                     | [global]
u0:9   | Primitive      | u16            | u16                                                     | [global]
u0:10  | Primitive      | u8             | u8                                                      | [global]
u0:11  | Primitive      | u128           | u128                                                    | [global]
u0:12  | Primitive      | usize          | usize                                                   | [global]
u0:13  | Primitive      | f32            | f32                                                     | [global]
u0:14  | Primitive      | f64            | f64                                                     | [global]
u0:15  | Primitive      | bool           | bool                                                    | [global]
u0:16  | Primitive      | char           | char                                                    | [global]
u0:17  | Primitive      | str            | str                                                     | [global]
u0:18  | Primitive      | String         | String                                                  | [global]
u0:19  | Crate          | _c             | _c                                                      | [global]
u0:20  | Crate          | crate          | _c::crate                                               |         
u0:21  | File           | lib            | _c::lib                                                 |         
u1:22  | Crate          | crate          | _c::crate                                               |         
u1:23  | Module         | _m             | _c::_m                                                  |         
u1:24  | File           | repos          | _c::_m::repos                                           |         
u1:25  | Struct         | UserRepo       | _c::_m::repos::UserRepo                                 | [global]
u1:26  | Field          | users          | _c::_m::repos::UserRepo::users                          |         
u1:27  | Field          | next_id        | _c::_m::repos::UserRepo::next_id                        |         
u1:28  | Function       | new            | _c::_m::repos::UserRepo::new                            | [global]
u1:29  | UnresolvedType | Repository     | _c::_m::repos::Repository                               |         
u1:30  | Function       | find           | _c::_m::repos::UserRepo::find                           |         
u1:31  | Variable       | id             | _c::_m::repos::UserRepo::find::id                       |         
u1:32  | Function       | save           | _c::_m::repos::UserRepo::save                           |         
u1:33  | Variable       | user           | _c::_m::repos::UserRepo::save::user                     |         
u1:34  | Variable       | id             | _c::_m::repos::UserRepo::save::id                       |         
u1:35  | Struct         | AccountRepo    | _c::_m::repos::AccountRepo                              | [global]
u1:36  | Field          | accounts       | _c::_m::repos::AccountRepo::accounts                    |         
u1:37  | Field          | next_id        | _c::_m::repos::AccountRepo::next_id                     |         
u1:38  | Variable       | account        | _c::_m::repos::UserRepo::save::account                  |         
u1:39  | Variable       | id             | _c::_m::repos::UserRepo::save::id                       |         
u2:40  | Crate          | crate          | _c::crate                                               |         
u2:41  | Module         | _m             | _c::_m                                                  |         
u2:42  | File           | services       | _c::_m::services                                        |         
u2:43  | Struct         | BankingService | _c::_m::services::BankingService                        | [global]
u2:44  | Field          | users          | _c::_m::services::BankingService::users                 |         
u2:45  | Field          | accounts       | _c::_m::services::BankingService::accounts              |         
u2:46  | Function       | new            | _c::_m::services::BankingService::new                   | [global]
u2:47  | Function       | create_user    | _c::_m::services::BankingService::create_user           | [global]
u2:48  | Variable       | name           | _c::_m::services::BankingService::create_user::name     |         
u2:49  | Variable       | email          | _c::_m::services::BankingService::create_user::email    |         
u2:50  | Variable       | user           | _c::_m::services::BankingService::create_user::user     |         
u2:51  | Function       | open_account   | _c::_m::services::BankingService::open_account          | [global]
u2:52  | Variable       | user_id        | _c::_m::services::BankingService::open_account::user_id |         
u2:53  | Variable       | user           | _c::_m::services::BankingService::open_account::user    |         
u2:54  | Variable       | account        | _c::_m::services::BankingService::open_account::account |         
u2:55  | Function       | deposit        | _c::_m::services::BankingService::deposit               | [global]
u2:56  | Variable       | account_id     | _c::_m::services::BankingService::deposit::account_id   |         
u2:57  | Variable       | amount         | _c::_m::services::BankingService::deposit::amount       |         
u3:58  | Crate          | crate          | _c::crate                                               |         
u3:59  | File           | lib            | _c::lib                                                 |         
u4:60  | Crate          | crate          | _c::crate                                               |         
u4:61  | Module         | _m             | _c::_m                                                  |         
u4:62  | File           | traits         | _c::_m::traits                                          |         
u4:63  | Trait          | Entity         | _c::_m::traits::Entity                                  | [global]
u4:64  | Function       | id             | _c::_m::traits::Entity::id                              |         
u4:65  | Trait          | Repository     | _c::_m::traits::Repository                              | [global]
u4:66  | TypeParameter  | T              | _c::_m::traits::Repository::T                           |         
u4:67  | Function       | find           | _c::_m::traits::Repository::find                        |         
u4:68  | Variable       | id             | _c::_m::traits::Repository::find::id                    |         
u4:69  | Function       | save           | _c::_m::traits::Repository::save                        |         
u4:70  | Variable       | entity         | _c::_m::traits::Repository::save::entity                |         
u5:71  | Crate          | crate          | _c::crate                                               |         
u5:72  | Module         | _m             | _c::_m                                                  |         
u5:73  | File           | types          | _c::_m::types                                           |         
u5:74  | Struct         | Id             | _c::_m::types::Id                                       | [global]
u5:75  | Struct         | Timestamp      | _c::_m::types::Timestamp                                | [global]
u5:76  | Struct         | Money          | _c::_m::types::Money                                    | [global]
u5:77  | Field          | cents          | _c::_m::types::Money::cents                             |         
u5:78  | Field          | currency       | _c::_m::types::Money::currency                          |         
u5:79  | Function       | new            | _c::_m::types::Money::new                               | [global]
u5:80  | Variable       | cents          | _c::_m::types::Money::new::cents                        |         
u5:81  | Variable       | currency       | _c::_m::types::Money::new::currency                     |         
u5:82  | Function       | usd            | _c::_m::types::Money::usd                               | [global]
u5:83  | Variable       | cents          | _c::_m::types::Money::usd::cents                        |         
u6:84  | Crate          | crate          | _c::crate                                               |         
u6:85  | Module         | _m             | _c::_m                                                  |         
u6:86  | File           | account        | _c::_m::account                                         |         
u6:87  | Struct         | Account        | _c::_m::account::Account                                | [global]
u6:88  | Field          | id             | _c::_m::account::Account::id                            |         
u6:89  | Field          | user           | _c::_m::account::Account::user                          |         
u6:90  | Field          | balance        | _c::_m::account::Account::balance                       |         
u6:91  | Function       | new            | _c::_m::account::Account::new                           | [global]
u6:92  | Variable       | id             | _c::_m::account::Account::new::id                       |         
u6:93  | Variable       | user           | _c::_m::account::Account::new::user                     |         
u6:94  | Function       | deposit        | _c::_m::account::Account::deposit                       | [global]
u6:95  | Variable       | amount         | _c::_m::account::Account::deposit::amount               |         
u6:96  | Function       | withdraw       | _c::_m::account::Account::withdraw                      | [global]
u6:97  | Variable       | amount         | _c::_m::account::Account::withdraw::amount              |         
u6:98  | UnresolvedType | Entity         | _c::_m::account::Entity                                 |         
u7:99  | Crate          | crate          | _c::crate                                               |         
u7:100 | File           | lib            | _c::lib                                                 |         
u8:101 | Crate          | crate          | _c::crate                                               |         
u8:102 | Module         | _m             | _c::_m                                                  |         
u8:103 | File           | user           | _c::_m::user                                            |         
u8:104 | Struct         | User           | _c::_m::user::User                                      | [global]
u8:105 | Field          | id             | _c::_m::user::User::id                                  |         
u8:106 | Field          | name           | _c::_m::user::User::name                                |         
u8:107 | Field          | email          | _c::_m::user::User::email                               |         
u8:108 | Function       | new            | _c::_m::user::User::new                                 | [global]
u8:109 | Variable       | id             | _c::_m::user::User::new::id                             |         
u8:110 | Variable       | name           | _c::_m::user::User::new::name                           |         
u8:111 | Variable       | email          | _c::_m::user::User::new::email                          |         
u8:112 | UnresolvedType | Entity         | _c::_m::user::Entity                                    |         
u9:113 | Crate          | crate          | _c::crate                                               |         
u9:114 | Module         | _m             | _c::_m                                                  |         
u9:115 | File           | main           | _c::_m::main                                            |         
u9:116 | Function       | main           | _c::_m::main::main                                      |         
u9:117 | Variable       | bank           | _c::_m::main::main::bank                                |         
u9:118 | Variable       | user_id        | _c::_m::main::main::user_id                             |         

--- expect:symbol-deps ---
u0:15 <- [u2:55, u6:96]
u0:17 <- [u5:79, u5:81]
u0:18 <- [u2:47, u2:48, u2:49, u5:76, u5:78, u8:104, u8:106, u8:107, u8:108, u8:110, u8:111]
u0:2 <- [u2:55, u2:57, u5:76, u5:77, u5:79, u5:80, u5:82, u5:83]
u0:8 <- [u1:25, u1:27, u1:35, u1:37, u5:74, u5:75, u6:91, u6:92, u8:108, u8:109]
u1:25 -> [u0:8, u1:30, u1:32, u8:104]
u1:25 <- [u1:28, u2:43, u2:44, u2:51, u2:53]
u1:26 -> [u8:104]
u1:27 -> [u0:8]
u1:28 -> [u1:25, u1:35]
u1:28 <- [u2:46]
u1:30 -> [u5:74]
u1:30 <- [u1:25, u1:35]
u1:31 -> [u5:74]
u1:32 -> [u5:74, u6:87, u8:104]
u1:32 <- [u1:25, u1:35]
u1:33 -> [u8:104]
u1:34 -> [u5:74]
u1:35 -> [u0:8, u1:30, u1:32, u6:87]
u1:35 <- [u1:28, u2:43, u2:45]
u1:36 -> [u6:87]
u1:37 -> [u0:8]
u1:38 -> [u6:87]
u1:39 -> [u5:74]
u2:43 -> [u1:25, u1:35, u2:47, u2:51, u2:55]
u2:43 <- [u2:46, u9:116, u9:117, u9:118]
u2:44 -> [u1:25]
u2:45 -> [u1:35]
u2:46 -> [u1:28, u2:43]
u2:46 <- [u9:116]
u2:47 -> [u0:18, u4:69, u8:108]
u2:47 <- [u2:43, u9:116]
u2:48 -> [u0:18]
u2:49 -> [u0:18]
u2:50 -> [u8:108]
u2:51 -> [u1:25, u4:67, u4:69, u5:74, u6:91]
u2:51 <- [u2:43, u9:116]
u2:52 -> [u5:74]
u2:53 -> [u1:25]
u2:54 -> [u6:91]
u2:55 -> [u0:15, u0:2, u4:67, u5:74, u5:82]
u2:55 <- [u2:43]
u2:56 -> [u5:74]
u2:57 -> [u0:2]
u4:63 -> [u4:64]
u4:63 <- [u4:65]
u4:64 <- [u4:63]
u4:65 -> [u4:63, u4:67, u4:69]
u4:67 -> [u5:74]
u4:67 <- [u2:51, u2:55, u4:65]
u4:68 -> [u5:74]
u4:69 <- [u2:47, u2:51, u4:65]
u5:74 -> [u0:8]
u5:74 <- [u1:30, u1:31, u1:32, u1:34, u1:39, u2:51, u2:52, u2:55, u2:56, u4:67, u4:68, u6:87, u6:88, u8:104, u8:105]
u5:75 -> [u0:8]
u5:76 -> [u0:18, u0:2, u5:82]
u5:76 <- [u5:79, u6:87, u6:90, u6:94, u6:95, u6:96, u6:97]
u5:77 -> [u0:2]
u5:78 -> [u0:18]
u5:79 -> [u0:17, u0:2, u5:76]
u5:79 <- [u5:82]
u5:80 -> [u0:2]
u5:81 -> [u0:17]
u5:82 -> [u0:2, u5:79]
u5:82 <- [u2:55, u5:76, u6:91]
u5:83 -> [u0:2]
u6:87 -> [u5:74, u5:76, u6:88, u6:94, u6:96, u8:104]
u6:87 <- [u1:32, u1:35, u1:36, u1:38, u6:91]
u6:88 -> [u5:74]
u6:88 <- [u6:87]
u6:89 -> [u8:104]
u6:90 -> [u5:76]
u6:91 -> [u0:8, u5:82, u6:87, u8:104]
u6:91 <- [u2:51, u2:54]
u6:92 -> [u0:8]
u6:93 -> [u8:104]
u6:94 -> [u5:76]
u6:94 <- [u6:87, u9:116]
u6:95 -> [u5:76]
u6:96 -> [u0:15, u5:76]
u6:96 <- [u6:87]
u6:97 -> [u5:76]
u8:104 -> [u0:18, u5:74, u8:105]
u8:104 <- [u1:25, u1:26, u1:32, u1:33, u6:87, u6:89, u6:91, u6:93, u8:108]
u8:105 -> [u5:74]
u8:105 <- [u8:104]
u8:106 -> [u0:18]
u8:107 -> [u0:18]
u8:108 -> [u0:18, u0:8, u8:104]
u8:108 <- [u2:47, u2:50]
u8:109 -> [u0:8]
u8:110 -> [u0:18]
u8:111 -> [u0:18]
u9:116 -> [u2:43, u2:46, u2:47, u2:51, u6:94]
u9:117 -> [u2:43]
u9:118 -> [u2:43]


===============================================================================
plugin-architecture
===============================================================================


--- file: src/lib.rs ---
pub mod plugin_api;
pub mod core;
pub mod plugins;

--- file: src/plugin_api/mod.rs ---
pub trait Plugin: Send + Sync {
    fn name(&self) -> &str;
    fn version(&self) -> &str;
    fn initialize(&mut self);
    fn shutdown(&mut self);
}

pub trait TextProcessor: Plugin {
    fn process(&self, input: &str) -> String;
}

pub trait Analyzer: Plugin {
    fn analyze(&self, input: &str) -> AnalysisResult;
}

pub struct AnalysisResult {
    pub word_count: usize,
    pub char_count: usize,
    pub line_count: usize,
}

--- file: src/core/mod.rs ---
use crate::plugin_api::{Plugin, TextProcessor, Analyzer};

pub struct PluginManager {
    processors: Vec<Box<dyn TextProcessor>>,
    analyzers: Vec<Box<dyn Analyzer>>,
}

impl PluginManager {
    pub fn new() -> Self {
        PluginManager {
            processors: Vec::new(),
            analyzers: Vec::new(),
        }
    }

    pub fn register_processor(&mut self, mut plugin: Box<dyn TextProcessor>) {
        plugin.initialize();
        println!("Registered processor: {} v{}", plugin.name(), plugin.version());
        self.processors.push(plugin);
    }

    pub fn register_analyzer(&mut self, mut plugin: Box<dyn Analyzer>) {
        plugin.initialize();
        println!("Registered analyzer: {} v{}", plugin.name(), plugin.version());
        self.analyzers.push(plugin);
    }

    pub fn process_text(&self, input: &str) -> String {
        let mut result = input.to_string();
        for processor in &self.processors {
            result = processor.process(&result);
        }
        result
    }

    pub fn shutdown(&mut self) {
        for processor in &mut self.processors {
            processor.shutdown();
        }
        for analyzer in &mut self.analyzers {
            analyzer.shutdown();
        }
    }
}

--- file: src/plugins/mod.rs ---
mod uppercase;
mod trimmer;
mod counter;

pub use uppercase::UppercasePlugin;
pub use trimmer::TrimmerPlugin;
pub use counter::CounterPlugin;

--- file: src/plugins/uppercase.rs ---
use crate::plugin_api::{Plugin, TextProcessor};

pub struct UppercasePlugin {
    initialized: bool,
}

impl UppercasePlugin {
    pub fn new() -> Self {
        UppercasePlugin { initialized: false }
    }
}

impl Plugin for UppercasePlugin {
    fn name(&self) -> &str { "Uppercase" }
    fn version(&self) -> &str { "1.0.0" }
    fn initialize(&mut self) { self.initialized = true; }
    fn shutdown(&mut self) { self.initialized = false; }
}

impl TextProcessor for UppercasePlugin {
    fn process(&self, input: &str) -> String {
        input.to_uppercase()
    }
}

--- file: src/plugins/trimmer.rs ---
use crate::plugin_api::{Plugin, TextProcessor};

pub struct TrimmerPlugin;

impl TrimmerPlugin {
    pub fn new() -> Self { TrimmerPlugin }
}

impl Plugin for TrimmerPlugin {
    fn name(&self) -> &str { "Trimmer" }
    fn version(&self) -> &str { "1.0.0" }
    fn initialize(&mut self) {}
    fn shutdown(&mut self) {}
}

impl TextProcessor for TrimmerPlugin {
    fn process(&self, input: &str) -> String {
        input.trim().to_string()
    }
}

--- file: src/plugins/counter.rs ---
use crate::plugin_api::{Plugin, Analyzer, AnalysisResult};

pub struct CounterPlugin;

impl CounterPlugin {
    pub fn new() -> Self { CounterPlugin }
}

impl Plugin for CounterPlugin {
    fn name(&self) -> &str { "Counter" }
    fn version(&self) -> &str { "1.0.0" }
    fn initialize(&mut self) {}
    fn shutdown(&mut self) {}
}

impl Analyzer for CounterPlugin {
    fn analyze(&self, input: &str) -> AnalysisResult {
        AnalysisResult {
            word_count: input.split_whitespace().count(),
            char_count: input.chars().count(),
            line_count: input.lines().count(),
        }
    }
}

--- file: src/main.rs ---
mod plugin_api;
mod core;
mod plugins;

use core::PluginManager;
use plugins::{UppercasePlugin, TrimmerPlugin, CounterPlugin};

fn main() {
    let mut manager = PluginManager::new();

    manager.register_processor(Box::new(TrimmerPlugin::new()));
    manager.register_processor(Box::new(UppercasePlugin::new()));
    manager.register_analyzer(Box::new(CounterPlugin::new()));

    let input = "  hello world  ";
    let processed = manager.process_text(input);
    println!("Processed: '{}'", processed);

    manager.shutdown();
}

--- expect:symbols ---
u0:1   | Primitive      | i32                | i32                                                      | [global]
u0:2   | Primitive      | i64                | i64                                                      | [global]
u0:3   | Primitive      | i16                | i16                                                      | [global]
u0:4   | Primitive      | i8                 | i8                                                       | [global]
u0:5   | Primitive      | i128               | i128                                                     | [global]
u0:6   | Primitive      | isize              | isize                                                    | [global]
u0:7   | Primitive      | u32                | u32                                                      | [global]
u0:8   | Primitive      | u64                | u64                                                      | [global]
u0:9   | Primitive      | u16                | u16                                                      | [global]
u0:10  | Primitive      | u8                 | u8                                                       | [global]
u0:11  | Primitive      | u128               | u128                                                     | [global]
u0:12  | Primitive      | usize              | usize                                                    | [global]
u0:13  | Primitive      | f32                | f32                                                      | [global]
u0:14  | Primitive      | f64                | f64                                                      | [global]
u0:15  | Primitive      | bool               | bool                                                     | [global]
u0:16  | Primitive      | char               | char                                                     | [global]
u0:17  | Primitive      | str                | str                                                      | [global]
u0:18  | Primitive      | String             | String                                                   | [global]
u0:19  | Crate          | _c                 | _c                                                       | [global]
u0:20  | Crate          | crate              | _c::crate                                                |         
u0:21  | Module         | core               | _c::core                                                 |         
u0:22  | File           | mod                | _c::core::mod                                            |         
u0:23  | Struct         | PluginManager      | _c::core::mod::PluginManager                             | [global]
u0:24  | Field          | processors         | _c::core::mod::PluginManager::processors                 |         
u0:25  | Field          | analyzers          | _c::core::mod::PluginManager::analyzers                  |         
u0:26  | Function       | new                | _c::core::mod::PluginManager::new                        | [global]
u0:27  | Function       | register_processor | _c::core::mod::PluginManager::register_processor         | [global]
u0:28  | Variable       | plugin             | _c::core::mod::PluginManager::register_processor::plugin |         
u0:29  | Function       | register_analyzer  | _c::core::mod::PluginManager::register_analyzer          | [global]
u0:30  | Variable       | plugin             | _c::core::mod::PluginManager::register_analyzer::plugin  |         
u0:31  | Function       | process_text       | _c::core::mod::PluginManager::process_text               | [global]
u0:32  | Variable       | input              | _c::core::mod::PluginManager::process_text::input        |         
u0:33  | Variable       | result             | _c::core::mod::PluginManager::process_text::result       |         
u0:34  | Function       | shutdown           | _c::core::mod::PluginManager::shutdown                   | [global]
u1:35  | Crate          | crate              | _c::crate                                                |         
u1:36  | File           | lib                | _c::lib                                                  |         
u2:37  | Crate          | crate              | _c::crate                                                |         
u2:38  | Module         | _m                 | _c::_m                                                   |         
u2:39  | File           | main               | _c::_m::main                                             |         
u2:40  | Function       | main               | _c::_m::main::main                                       |         
u2:41  | Variable       | manager            | _c::_m::main::main::manager                              |         
u2:42  | Variable       | input              | _c::_m::main::main::input                                |         
u2:43  | Variable       | processed          | _c::_m::main::main::processed                            |         
u3:44  | Crate          | crate              | _c::crate                                                |         
u3:45  | Module         | plugin_api         | _c::plugin_api                                           |         
u3:46  | File           | mod                | _c::plugin_api::mod                                      |         
u3:47  | Trait          | Plugin             | _c::plugin_api::mod::Plugin                              | [global]
u3:48  | Function       | name               | _c::plugin_api::mod::Plugin::name                        |         
u3:49  | Function       | version            | _c::plugin_api::mod::Plugin::version                     |         
u3:50  | Function       | initialize         | _c::plugin_api::mod::Plugin::initialize                  |         
u3:51  | Function       | shutdown           | _c::plugin_api::mod::Plugin::shutdown                    |         
u3:52  | Trait          | TextProcessor      | _c::plugin_api::mod::TextProcessor                       | [global]
u3:53  | Function       | process            | _c::plugin_api::mod::TextProcessor::process              |         
u3:54  | Variable       | input              | _c::plugin_api::mod::TextProcessor::process::input       |         
u3:55  | Trait          | Analyzer           | _c::plugin_api::mod::Analyzer                            | [global]
u3:56  | Function       | analyze            | _c::plugin_api::mod::Analyzer::analyze                   |         
u3:57  | Variable       | input              | _c::plugin_api::mod::Analyzer::analyze::input            |         
u3:58  | Struct         | AnalysisResult     | _c::plugin_api::mod::AnalysisResult                      | [global]
u3:59  | Field          | word_count         | _c::plugin_api::mod::AnalysisResult::word_count          |         
u3:60  | Field          | char_count         | _c::plugin_api::mod::AnalysisResult::char_count          |         
u3:61  | Field          | line_count         | _c::plugin_api::mod::AnalysisResult::line_count          |         
u4:62  | Crate          | crate              | _c::crate                                                |         
u4:63  | Module         | _m                 | _c::_m                                                   |         
u4:64  | File           | counter            | _c::_m::counter                                          |         
u4:65  | Struct         | CounterPlugin      | _c::_m::counter::CounterPlugin                           | [global]
u4:66  | Function       | new                | _c::_m::counter::CounterPlugin::new                      | [global]
u4:67  | UnresolvedType | Plugin             | _c::_m::counter::Plugin                                  |         
u4:68  | Function       | name               | _c::_m::counter::CounterPlugin::name                     |         
u4:69  | Function       | version            | _c::_m::counter::CounterPlugin::version                  |         
u4:70  | Function       | initialize         | _c::_m::counter::CounterPlugin::initialize               |         
u4:71  | Function       | shutdown           | _c::_m::counter::CounterPlugin::shutdown                 |         
u4:72  | UnresolvedType | Analyzer           | _c::_m::counter::Analyzer                                |         
u4:73  | Function       | analyze            | _c::_m::counter::CounterPlugin::analyze                  |         
u4:74  | Variable       | input              | _c::_m::counter::CounterPlugin::analyze::input           |         
u5:75  | Crate          | crate              | _c::crate                                                |         
u5:76  | Module         | plugins            | _c::plugins                                              |         
u5:77  | File           | mod                | _c::plugins::mod                                         |         
u6:78  | Crate          | crate              | _c::crate                                                |         
u6:79  | Module         | _m                 | _c::_m                                                   |         
u6:80  | File           | trimmer            | _c::_m::trimmer                                          |         
u6:81  | Struct         | TrimmerPlugin      | _c::_m::trimmer::TrimmerPlugin                           | [global]
u6:82  | Function       | new                | _c::_m::trimmer::TrimmerPlugin::new                      | [global]
u6:83  | UnresolvedType | Plugin             | _c::_m::trimmer::Plugin                                  |         
u6:84  | Function       | name               | _c::_m::trimmer::TrimmerPlugin::name                     |         
u6:85  | Function       | version            | _c::_m::trimmer::TrimmerPlugin::version                  |         
u6:86  | Function       | initialize         | _c::_m::trimmer::TrimmerPlugin::initialize               |         
u6:87  | Function       | shutdown           | _c::_m::trimmer::TrimmerPlugin::shutdown                 |         
u6:88  | UnresolvedType | TextProcessor      | _c::_m::trimmer::TextProcessor                           |         
u6:89  | Function       | process            | _c::_m::trimmer::TrimmerPlugin::process                  |         
u6:90  | Variable       | input              | _c::_m::trimmer::TrimmerPlugin::process::input           |         
u7:91  | Crate          | crate              | _c::crate                                                |         
u7:92  | Module         | _m                 | _c::_m                                                   |         
u7:93  | File           | uppercase          | _c::_m::uppercase                                        |         
u7:94  | Struct         | UppercasePlugin    | _c::_m::uppercase::UppercasePlugin                       | [global]
u7:95  | Field          | initialized        | _c::_m::uppercase::UppercasePlugin::initialized          |         
u7:96  | Function       | new                | _c::_m::uppercase::UppercasePlugin::new                  | [global]
u7:97  | UnresolvedType | Plugin             | _c::_m::uppercase::Plugin                                |         
u7:98  | Function       | name               | _c::_m::uppercase::UppercasePlugin::name                 |         
u7:99  | Function       | version            | _c::_m::uppercase::UppercasePlugin::version              |         
u7:100 | Function       | initialize         | _c::_m::uppercase::UppercasePlugin::initialize           |         
u7:101 | Function       | shutdown           | _c::_m::uppercase::UppercasePlugin::shutdown             |         
u7:102 | UnresolvedType | TextProcessor      | _c::_m::uppercase::TextProcessor                         |         
u7:103 | Function       | process            | _c::_m::uppercase::UppercasePlugin::process              |         
u7:104 | Variable       | input              | _c::_m::uppercase::UppercasePlugin::process::input       |         

--- expect:symbol-deps ---
u0:12 <- [u3:58, u3:59, u3:60, u3:61]
u0:15 <- [u7:94, u7:95]
u0:17 <- [u0:31, u0:32, u0:33, u2:40, u2:42, u3:48, u3:49, u3:53, u3:54, u3:56, u3:57, u4:68, u4:69, u4:73, u4:74, u6:84, u6:85, u6:89, u6:90, u7:103, u7:104, u7:98, u7:99]
u0:23 -> [u0:27, u0:29, u0:31, u0:34, u3:52, u3:55]
u0:23 <- [u0:26, u2:40, u2:41, u2:43]
u0:24 -> [u3:52]
u0:25 -> [u3:55]
u0:26 -> [u0:23]
u0:26 <- [u2:40]
u0:27 -> [u3:52, u6:82, u7:100, u7:96]
u0:27 <- [u0:23, u2:40]
u0:28 -> [u3:52]
u0:29 -> [u3:55, u4:66, u7:100]
u0:29 <- [u0:23, u2:40]
u0:30 -> [u3:55]
u0:31 -> [u0:17, u7:103]
u0:31 <- [u0:23, u2:40]
u0:32 -> [u0:17]
u0:33 -> [u0:17]
u0:34 <- [u0:23]
u2:40 -> [u0:17, u0:23, u0:26, u0:27, u0:29, u0:31, u4:66, u6:82, u7:101, u7:96]
u2:41 -> [u0:23]
u2:42 -> [u0:17]
u2:43 -> [u0:23]
u3:47 -> [u3:48, u3:49, u3:50, u3:51]
u3:47 <- [u3:52, u3:55]
u3:48 -> [u0:17]
u3:48 <- [u3:47]
u3:49 -> [u0:17]
u3:49 <- [u3:47]
u3:50 <- [u3:47]
u3:51 <- [u3:47]
u3:52 -> [u3:47, u3:53]
u3:52 <- [u0:23, u0:24, u0:27, u0:28]
u3:53 -> [u0:17]
u3:53 <- [u3:52]
u3:54 -> [u0:17]
u3:55 -> [u3:47, u3:56]
u3:55 <- [u0:23, u0:25, u0:29, u0:30]
u3:56 -> [u0:17]
u3:56 <- [u3:55]
u3:57 -> [u0:17]
u3:58 -> [u0:12]
u3:58 <- [u4:73]
u3:59 -> [u0:12]
u3:60 -> [u0:12]
u3:61 -> [u0:12]
u4:65 -> [u4:66, u4:68, u4:69, u4:70, u4:71, u4:73]
u4:66 <- [u0:29, u2:40, u4:65]
u4:68 -> [u0:17]
u4:68 <- [u4:65]
u4:69 -> [u0:17]
u4:69 <- [u4:65]
u4:70 <- [u4:65]
u4:71 <- [u4:65]
u4:73 -> [u0:17, u3:58]
u4:73 <- [u4:65]
u4:74 -> [u0:17]
u6:81 -> [u6:82, u6:84, u6:85, u6:86, u6:87, u6:89]
u6:82 <- [u0:27, u2:40, u6:81]
u6:84 -> [u0:17]
u6:84 <- [u6:81]
u6:85 -> [u0:17]
u6:85 <- [u6:81]
u6:86 <- [u6:81]
u6:87 <- [u6:81]
u6:89 -> [u0:17]
u6:89 <- [u6:81]
u6:90 -> [u0:17]
u7:100 <- [u0:27, u0:29, u7:94]
u7:101 <- [u2:40, u7:94]
u7:103 -> [u0:17]
u7:103 <- [u0:31, u7:94]
u7:104 -> [u0:17]
u7:94 -> [u0:15, u7:100, u7:101, u7:103, u7:98, u7:99]
u7:94 <- [u7:96]
u7:95 -> [u0:15]
u7:96 -> [u7:94]
u7:96 <- [u0:27, u2:40]
u7:98 -> [u0:17]
u7:98 <- [u7:94]
u7:99 -> [u0:17]
u7:99 <- [u7:94]


===============================================================================
feature-flag-architecture
===============================================================================


--- file: src/lib.rs ---
pub mod core;

#[cfg(feature = "json")]
pub mod json;

#[cfg(feature = "xml")]
pub mod xml;

#[cfg(feature = "yaml")]
pub mod yaml;

pub mod format {
    use super::core::Data;

    pub trait Formatter {
        fn format(&self, data: &Data) -> String;
        fn parse(&self, input: &str) -> Option<Data>;
    }

    #[cfg(feature = "json")]
    pub use super::json::JsonFormatter;

    #[cfg(feature = "xml")]
    pub use super::xml::XmlFormatter;

    #[cfg(feature = "yaml")]
    pub use super::yaml::YamlFormatter;
}

--- file: src/core.rs ---
#[derive(Clone, Debug)]
pub struct Data {
    pub fields: Vec<(String, Value)>,
}

#[derive(Clone, Debug)]
pub enum Value {
    Null,
    Bool(bool),
    Number(f64),
    String(String),
    Array(Vec<Value>),
}

impl Data {
    pub fn new() -> Self {
        Data { fields: Vec::new() }
    }

    pub fn set(&mut self, key: &str, value: Value) {
        self.fields.push((key.to_string(), value));
    }

    pub fn get(&self, key: &str) -> Option<&Value> {
        self.fields.iter().find(|(k, _)| k == key).map(|(_, v)| v)
    }
}

--- file: src/json.rs ---
use crate::core::{Data, Value};
use crate::format::Formatter;

pub struct JsonFormatter;

impl Formatter for JsonFormatter {
    fn format(&self, data: &Data) -> String {
        let fields: Vec<String> = data.fields.iter()
            .map(|(k, v)| format!("\"{}\": {}", k, format_value(v)))
            .collect();
        format!("{{{}}}", fields.join(", "))
    }

    fn parse(&self, _input: &str) -> Option<Data> {
        // Simplified - real impl would parse JSON
        Some(Data::new())
    }
}

fn format_value(v: &Value) -> String {
    match v {
        Value::Null => "null".to_string(),
        Value::Bool(b) => b.to_string(),
        Value::Number(n) => n.to_string(),
        Value::String(s) => format!("\"{}\"", s),
        Value::Array(arr) => {
            let items: Vec<String> = arr.iter().map(format_value).collect();
            format!("[{}]", items.join(", "))
        }
    }
}

--- file: src/xml.rs ---
use crate::core::{Data, Value};
use crate::format::Formatter;

pub struct XmlFormatter;

impl Formatter for XmlFormatter {
    fn format(&self, data: &Data) -> String {
        let fields: Vec<String> = data.fields.iter()
            .map(|(k, v)| format!("<{}>{}</{}>", k, format_value(v), k))
            .collect();
        format!("<data>{}</data>", fields.join(""))
    }

    fn parse(&self, _input: &str) -> Option<Data> {
        Some(Data::new())
    }
}

fn format_value(v: &Value) -> String {
    match v {
        Value::Null => "".to_string(),
        Value::Bool(b) => b.to_string(),
        Value::Number(n) => n.to_string(),
        Value::String(s) => s.clone(),
        Value::Array(arr) => {
            arr.iter().map(|v| format!("<item>{}</item>", format_value(v))).collect()
        }
    }
}

--- file: src/yaml.rs ---
use crate::core::{Data, Value};
use crate::format::Formatter;

pub struct YamlFormatter;

impl Formatter for YamlFormatter {
    fn format(&self, data: &Data) -> String {
        data.fields.iter()
            .map(|(k, v)| format!("{}: {}", k, format_value(v, 0)))
            .collect::<Vec<_>>()
            .join("\n")
    }

    fn parse(&self, _input: &str) -> Option<Data> {
        Some(Data::new())
    }
}

fn format_value(v: &Value, indent: usize) -> String {
    let prefix = "  ".repeat(indent);
    match v {
        Value::Null => "~".to_string(),
        Value::Bool(b) => b.to_string(),
        Value::Number(n) => n.to_string(),
        Value::String(s) => format!("\"{}\"", s),
        Value::Array(arr) => {
            let items: Vec<String> = arr.iter()
                .map(|v| format!("\n{}- {}", prefix, format_value(v, indent + 1)))
                .collect();
            items.join("")
        }
    }
}

--- file: src/main.rs ---
mod core;

#[cfg(feature = "json")]
mod json;

#[cfg(feature = "xml")]
mod xml;

#[cfg(feature = "yaml")]
mod yaml;

mod format;

use core::{Data, Value};
use format::Formatter;

fn main() {
    let mut data = Data::new();
    data.set("name", Value::String("Alice".to_string()));
    data.set("age", Value::Number(30.0));
    data.set("active", Value::Bool(true));

    #[cfg(feature = "json")]
    {
        let formatter = json::JsonFormatter;
        println!("JSON: {}", formatter.format(&data));
    }

    #[cfg(feature = "xml")]
    {
        let formatter = xml::XmlFormatter;
        println!("XML: {}", formatter.format(&data));
    }

    #[cfg(feature = "yaml")]
    {
        let formatter = yaml::YamlFormatter;
        println!("YAML:\n{}", formatter.format(&data));
    }
}

--- expect:symbols ---
u0:1   | Primitive      | i32           | i32                                         | [global]
u0:2   | Primitive      | i64           | i64                                         | [global]
u0:3   | Primitive      | i16           | i16                                         | [global]
u0:4   | Primitive      | i8            | i8                                          | [global]
u0:5   | Primitive      | i128          | i128                                        | [global]
u0:6   | Primitive      | isize         | isize                                       | [global]
u0:7   | Primitive      | u32           | u32                                         | [global]
u0:8   | Primitive      | u64           | u64                                         | [global]
u0:9   | Primitive      | u16           | u16                                         | [global]
u0:10  | Primitive      | u8            | u8                                          | [global]
u0:11  | Primitive      | u128          | u128                                        | [global]
u0:12  | Primitive      | usize         | usize                                       | [global]
u0:13  | Primitive      | f32           | f32                                         | [global]
u0:14  | Primitive      | f64           | f64                                         | [global]
u0:15  | Primitive      | bool          | bool                                        | [global]
u0:16  | Primitive      | char          | char                                        | [global]
u0:17  | Primitive      | str           | str                                         | [global]
u0:18  | Primitive      | String        | String                                      | [global]
u0:19  | Crate          | _c            | _c                                          | [global]
u0:20  | Crate          | crate         | _c::crate                                   |         
u0:21  | Module         | _m            | _c::_m                                      |         
u0:22  | File           | core          | _c::_m::core                                |         
u0:23  | Struct         | Data          | _c::_m::core::Data                          | [global]
u0:24  | Field          | fields        | _c::_m::core::Data::fields                  |         
u0:25  | Enum           | Value         | _c::_m::core::Value                         | [global]
u0:26  | EnumVariant    | Null          | _c::_m::core::Value::Null                   |         
u0:27  | EnumVariant    | Bool          | _c::_m::core::Value::Bool                   |         
u0:28  | EnumVariant    | Number        | _c::_m::core::Value::Number                 |         
u0:29  | EnumVariant    | String        | _c::_m::core::Value::String                 |         
u0:30  | EnumVariant    | Array         | _c::_m::core::Value::Array                  |         
u0:31  | Function       | new           | _c::_m::core::Data::new                     | [global]
u0:32  | Function       | set           | _c::_m::core::Data::set                     | [global]
u0:33  | Variable       | key           | _c::_m::core::Data::set::key                |         
u0:34  | Variable       | value         | _c::_m::core::Data::set::value              |         
u0:35  | Function       | get           | _c::_m::core::Data::get                     | [global]
u0:36  | Variable       | key           | _c::_m::core::Data::get::key                |         
u0:37  | Variable       | k             | _c::_m::core::Data::get::k                  |         
u0:38  | Variable       | v             | _c::_m::core::Data::get::v                  |         
u1:39  | Crate          | crate         | _c::crate                                   |         
u1:40  | Module         | _m            | _c::_m                                      |         
u1:41  | File           | json          | _c::_m::json                                |         
u1:42  | Struct         | JsonFormatter | _c::_m::json::JsonFormatter                 | [global]
u1:43  | UnresolvedType | Formatter     | _c::_m::json::Formatter                     |         
u1:44  | Function       | format        | _c::_m::json::JsonFormatter::format         |         
u1:45  | Variable       | data          | _c::_m::json::JsonFormatter::format::data   |         
u1:46  | Variable       | fields        | _c::_m::json::JsonFormatter::format::fields |         
u1:47  | Variable       | k             | _c::_m::json::JsonFormatter::format::k      |         
u1:48  | Variable       | v             | _c::_m::json::JsonFormatter::format::v      |         
u1:49  | Function       | parse         | _c::_m::json::JsonFormatter::parse          |         
u1:50  | Variable       | _input        | _c::_m::json::JsonFormatter::parse::_input  |         
u1:51  | Function       | format_value  | _c::_m::json::format_value                  |         
u1:52  | Variable       | v             | _c::_m::json::format_value::v               |         
u1:53  | Variable       | items         | _c::_m::json::format_value::items           |         
u2:54  | Crate          | crate         | _c::crate                                   |         
u2:55  | File           | lib           | _c::lib                                     |         
u2:56  | Namespace      | format        | _c::lib::format                             | [global]
u2:57  | Trait          | Formatter     | _c::lib::format::Formatter                  | [global]
u2:58  | Function       | format        | _c::lib::format::Formatter::format          |         
u2:59  | Variable       | data          | _c::lib::format::Formatter::format::data    |         
u2:60  | Function       | parse         | _c::lib::format::Formatter::parse           |         
u2:61  | Variable       | input         | _c::lib::format::Formatter::parse::input    |         
u3:62  | Crate          | crate         | _c::crate                                   |         
u3:63  | Module         | _m            | _c::_m                                      |         
u3:64  | File           | main          | _c::_m::main                                |         
u3:65  | Function       | main          | _c::_m::main::main                          |         
u3:66  | Variable       | data          | _c::_m::main::main::data                    |         
u3:67  | Variable       | formatter     | _c::_m::main::main::formatter               |         
u3:68  | Variable       | formatter     | _c::_m::main::main::formatter               |         
u3:69  | Variable       | formatter     | _c::_m::main::main::formatter               |         
u4:70  | Crate          | crate         | _c::crate                                   |         
u4:71  | Module         | _m            | _c::_m                                      |         
u4:72  | File           | xml           | _c::_m::xml                                 |         
u4:73  | Struct         | XmlFormatter  | _c::_m::xml::XmlFormatter                   | [global]
u4:74  | UnresolvedType | Formatter     | _c::_m::xml::Formatter                      |         
u4:75  | Function       | format        | _c::_m::xml::XmlFormatter::format           |         
u4:76  | Variable       | data          | _c::_m::xml::XmlFormatter::format::data     |         
u4:77  | Variable       | fields        | _c::_m::xml::XmlFormatter::format::fields   |         
u4:78  | Variable       | k             | _c::_m::xml::XmlFormatter::format::k        |         
u4:79  | Variable       | v             | _c::_m::xml::XmlFormatter::format::v        |         
u4:80  | Function       | parse         | _c::_m::xml::XmlFormatter::parse            |         
u4:81  | Variable       | _input        | _c::_m::xml::XmlFormatter::parse::_input    |         
u4:82  | Function       | format_value  | _c::_m::xml::format_value                   |         
u4:83  | Variable       | v             | _c::_m::xml::format_value::v                |         
u4:84  | Variable       | v             | _c::_m::xml::format_value::v                |         
u5:85  | Crate          | crate         | _c::crate                                   |         
u5:86  | Module         | _m            | _c::_m                                      |         
u5:87  | File           | yaml          | _c::_m::yaml                                |         
u5:88  | Struct         | YamlFormatter | _c::_m::yaml::YamlFormatter                 | [global]
u5:89  | UnresolvedType | Formatter     | _c::_m::yaml::Formatter                     |         
u5:90  | Function       | format        | _c::_m::yaml::YamlFormatter::format         |         
u5:91  | Variable       | data          | _c::_m::yaml::YamlFormatter::format::data   |         
u5:92  | Variable       | k             | _c::_m::yaml::YamlFormatter::format::k      |         
u5:93  | Variable       | v             | _c::_m::yaml::YamlFormatter::format::v      |         
u5:94  | Function       | parse         | _c::_m::yaml::YamlFormatter::parse          |         
u5:95  | Variable       | _input        | _c::_m::yaml::YamlFormatter::parse::_input  |         
u5:96  | Function       | format_value  | _c::_m::yaml::format_value                  |         
u5:97  | Variable       | v             | _c::_m::yaml::format_value::v               |         
u5:98  | Variable       | indent        | _c::_m::yaml::format_value::indent          |         
u5:99  | Variable       | prefix        | _c::_m::yaml::format_value::prefix          |         
u5:100 | Variable       | items         | _c::_m::yaml::format_value::items           |         
u5:101 | Variable       | v             | _c::_m::yaml::format_value::v               |         

--- expect:symbol-deps ---
u0:12 <- [u5:96, u5:98]
u0:14 <- [u0:25]
u0:15 <- [u0:25]
u0:17 <- [u0:32, u0:33, u0:35, u0:36, u1:49, u1:50, u2:60, u2:61, u4:80, u4:81, u5:94, u5:95, u5:96, u5:99]
u0:18 <- [u0:23, u0:24, u0:25, u1:44, u1:46, u1:51, u1:53, u4:75, u4:77, u5:100, u5:96]
u0:23 -> [u0:18, u0:25, u0:32, u0:35]
u0:23 <- [u0:31, u1:44, u1:45, u2:58, u2:59, u4:75, u4:76, u5:90, u5:91]
u0:24 -> [u0:18, u0:25]
u0:25 -> [u0:14, u0:15, u0:18, u0:26, u0:27, u0:28, u0:29, u0:30]
u0:25 <- [u0:23, u0:24, u0:32, u0:34, u1:51, u1:52, u3:65, u4:82, u4:83, u5:96, u5:97]
u0:26 <- [u0:25, u1:51, u4:82, u5:96]
u0:27 <- [u0:25, u0:32, u1:51, u3:65, u4:82, u5:96]
u0:28 <- [u0:25, u0:32, u1:51, u3:65, u4:82, u5:96]
u0:29 <- [u0:25, u0:32, u1:51, u3:65, u4:82, u5:96]
u0:30 <- [u0:25, u1:51, u4:82, u5:96]
u0:31 -> [u0:23]
u0:31 <- [u1:49, u3:65, u3:66, u4:80, u5:94]
u0:32 -> [u0:17, u0:25, u0:27, u0:28, u0:29]
u0:32 <- [u0:23, u3:65]
u0:33 -> [u0:17]
u0:34 -> [u0:25]
u0:35 -> [u0:17]
u0:35 <- [u0:23]
u0:36 -> [u0:17]
u1:42 -> [u1:44, u1:49]
u1:44 -> [u0:18, u0:23]
u1:44 <- [u1:42]
u1:45 -> [u0:23]
u1:46 -> [u0:18]
u1:49 -> [u0:17, u0:31]
u1:49 <- [u1:42]
u1:50 -> [u0:17]
u1:51 -> [u0:18, u0:25, u0:26, u0:27, u0:28, u0:29, u0:30, u5:90]
u1:52 -> [u0:25]
u1:53 -> [u0:18]
u2:56 -> [u2:57]
u2:57 -> [u2:58, u2:60]
u2:57 <- [u2:56]
u2:58 -> [u0:23]
u2:58 <- [u2:57]
u2:59 -> [u0:23]
u2:60 -> [u0:17]
u2:60 <- [u2:57]
u2:61 -> [u0:17]
u3:65 -> [u0:25, u0:27, u0:28, u0:29, u0:31, u0:32, u5:88]
u3:66 -> [u0:31]
u3:69 -> [u5:88]
u4:73 -> [u4:75, u4:80]
u4:75 -> [u0:18, u0:23]
u4:75 <- [u4:73]
u4:76 -> [u0:23]
u4:77 -> [u0:18]
u4:80 -> [u0:17, u0:31]
u4:80 <- [u4:73]
u4:81 -> [u0:17]
u4:82 -> [u0:25, u0:26, u0:27, u0:28, u0:29, u0:30, u5:90]
u4:83 -> [u0:25]
u5:100 -> [u0:18]
u5:88 -> [u5:90, u5:94]
u5:88 <- [u3:65, u3:69]
u5:90 -> [u0:23]
u5:90 <- [u1:51, u4:82, u5:88, u5:96]
u5:91 -> [u0:23]
u5:94 -> [u0:17, u0:31]
u5:94 <- [u5:88]
u5:95 -> [u0:17]
u5:96 -> [u0:12, u0:17, u0:18, u0:25, u0:26, u0:27, u0:28, u0:29, u0:30, u5:90]
u5:97 -> [u0:25]
u5:98 -> [u0:12]
u5:99 -> [u0:17]


===============================================================================
shared-state-across-files
===============================================================================


--- file: src/lib.rs ---
pub mod config;
pub mod cache;
pub mod service;

--- file: src/config.rs ---
use std::sync::OnceLock;

static CONFIG: OnceLock<AppConfig> = OnceLock::new();

pub struct AppConfig {
    pub database_url: String,
    pub max_connections: u32,
    pub log_level: String,
}

impl AppConfig {
    pub fn init(database_url: String, max_connections: u32, log_level: String) {
        CONFIG.get_or_init(|| AppConfig {
            database_url,
            max_connections,
            log_level,
        });
    }

    pub fn get() -> &'static AppConfig {
        CONFIG.get().expect("Config not initialized")
    }
}

--- file: src/cache.rs ---
use std::collections::HashMap;
use std::sync::RwLock;

static CACHE: RwLock<Option<Cache>> = RwLock::new(None);

pub struct Cache {
    data: HashMap<String, String>,
}

impl Cache {
    pub fn init() {
        let mut lock = CACHE.write().unwrap();
        *lock = Some(Cache { data: HashMap::new() });
    }

    pub fn get(key: &str) -> Option<String> {
        let lock = CACHE.read().unwrap();
        lock.as_ref()?.data.get(key).cloned()
    }

    pub fn set(key: String, value: String) {
        let mut lock = CACHE.write().unwrap();
        if let Some(cache) = lock.as_mut() {
            cache.data.insert(key, value);
        }
    }

    pub fn clear() {
        let mut lock = CACHE.write().unwrap();
        if let Some(cache) = lock.as_mut() {
            cache.data.clear();
        }
    }
}

--- file: src/service.rs ---
use crate::config::AppConfig;
use crate::cache::Cache;

pub struct DataService;

impl DataService {
    pub fn new() -> Self {
        DataService
    }

    pub fn fetch(&self, key: &str) -> String {
        // Check cache first
        if let Some(cached) = Cache::get(key) {
            println!("Cache hit for: {}", key);
            return cached;
        }

        // Fetch from "database"
        let config = AppConfig::get();
        println!("Fetching from database: {} (url: {})", key, config.database_url);

        let value = format!("value_for_{}", key);

        // Store in cache
        Cache::set(key.to_string(), value.clone());

        value
    }
}

--- file: src/main.rs ---
mod config;
mod cache;
mod service;

use config::AppConfig;
use cache::Cache;
use service::DataService;

fn main() {
    // Initialize global state
    AppConfig::init(
        "postgres://localhost/mydb".to_string(),
        10,
        "info".to_string(),
    );
    Cache::init();

    // Use service
    let svc = DataService::new();

    println!("First fetch:");
    println!("  Result: {}", svc.fetch("user_1"));

    println!("\nSecond fetch (should hit cache):");
    println!("  Result: {}", svc.fetch("user_1"));

    println!("\nConfig: log_level = {}", AppConfig::get().log_level);
}

--- expect:symbols ---
u0:1  | Primitive | i32             | i32                                              | [global]
u0:2  | Primitive | i64             | i64                                              | [global]
u0:3  | Primitive | i16             | i16                                              | [global]
u0:4  | Primitive | i8              | i8                                               | [global]
u0:5  | Primitive | i128            | i128                                             | [global]
u0:6  | Primitive | isize           | isize                                            | [global]
u0:7  | Primitive | u32             | u32                                              | [global]
u0:8  | Primitive | u64             | u64                                              | [global]
u0:9  | Primitive | u16             | u16                                              | [global]
u0:10 | Primitive | u8              | u8                                               | [global]
u0:11 | Primitive | u128            | u128                                             | [global]
u0:12 | Primitive | usize           | usize                                            | [global]
u0:13 | Primitive | f32             | f32                                              | [global]
u0:14 | Primitive | f64             | f64                                              | [global]
u0:15 | Primitive | bool            | bool                                             | [global]
u0:16 | Primitive | char            | char                                             | [global]
u0:17 | Primitive | str             | str                                              | [global]
u0:18 | Primitive | String          | String                                           | [global]
u0:19 | Crate     | _c              | _c                                               | [global]
u0:20 | Crate     | crate           | _c::crate                                        |         
u0:21 | Module    | _m              | _c::_m                                           |         
u0:22 | File      | cache           | _c::_m::cache                                    |         
u0:23 | Static    | CACHE           | _c::_m::cache::CACHE                             |         
u0:24 | Struct    | Cache           | _c::_m::cache::Cache                             | [global]
u0:25 | Field     | data            | _c::_m::cache::Cache::data                       |         
u0:26 | Function  | init            | _c::_m::cache::Cache::init                       | [global]
u0:27 | Variable  | lock            | _c::_m::cache::Cache::init::lock                 |         
u0:28 | Function  | get             | _c::_m::cache::Cache::get                        | [global]
u0:29 | Variable  | key             | _c::_m::cache::Cache::get::key                   |         
u0:30 | Variable  | lock            | _c::_m::cache::Cache::get::lock                  |         
u0:31 | Function  | set             | _c::_m::cache::Cache::set                        | [global]
u0:32 | Variable  | key             | _c::_m::cache::Cache::set::key                   |         
u0:33 | Variable  | value           | _c::_m::cache::Cache::set::value                 |         
u0:34 | Variable  | lock            | _c::_m::cache::Cache::set::lock                  |         
u0:35 | Function  | clear           | _c::_m::cache::Cache::clear                      | [global]
u0:36 | Variable  | lock            | _c::_m::cache::Cache::clear::lock                |         
u1:37 | Crate     | crate           | _c::crate                                        |         
u1:38 | Module    | _m              | _c::_m                                           |         
u1:39 | File      | config          | _c::_m::config                                   |         
u1:40 | Static    | CONFIG          | _c::_m::config::CONFIG                           |         
u1:41 | Struct    | AppConfig       | _c::_m::config::AppConfig                        | [global]
u1:42 | Field     | database_url    | _c::_m::config::AppConfig::database_url          |         
u1:43 | Field     | max_connections | _c::_m::config::AppConfig::max_connections       |         
u1:44 | Field     | log_level       | _c::_m::config::AppConfig::log_level             |         
u1:45 | Function  | init            | _c::_m::config::AppConfig::init                  | [global]
u1:46 | Variable  | database_url    | _c::_m::config::AppConfig::init::database_url    |         
u1:47 | Variable  | max_connections | _c::_m::config::AppConfig::init::max_connections |         
u1:48 | Variable  | log_level       | _c::_m::config::AppConfig::init::log_level       |         
u1:49 | Function  | get             | _c::_m::config::AppConfig::get                   | [global]
u2:50 | Crate     | crate           | _c::crate                                        |         
u2:51 | File      | lib             | _c::lib                                          |         
u3:52 | Crate     | crate           | _c::crate                                        |         
u3:53 | Module    | _m              | _c::_m                                           |         
u3:54 | File      | main            | _c::_m::main                                     |         
u3:55 | Function  | main            | _c::_m::main::main                               |         
u3:56 | Variable  | svc             | _c::_m::main::main::svc                          |         
u4:57 | Crate     | crate           | _c::crate                                        |         
u4:58 | Module    | _m              | _c::_m                                           |         
u4:59 | File      | service         | _c::_m::service                                  |         
u4:60 | Struct    | DataService     | _c::_m::service::DataService                     | [global]
u4:61 | Function  | new             | _c::_m::service::DataService::new                | [global]
u4:62 | Function  | fetch           | _c::_m::service::DataService::fetch              | [global]
u4:63 | Variable  | key             | _c::_m::service::DataService::fetch::key         |         
u4:64 | Variable  | config          | _c::_m::service::DataService::fetch::config      |         
u4:65 | Variable  | value           | _c::_m::service::DataService::fetch::value       |         

--- expect:symbol-deps ---
u0:17 <- [u0:28, u0:29, u4:62, u4:63, u4:65]
u0:18 <- [u0:24, u0:25, u0:31, u0:32, u0:33, u1:41, u1:42, u1:44, u1:45, u1:46, u1:48]
u0:24 -> [u0:18, u0:28, u0:31, u0:35]
u0:24 <- [u0:26]
u0:25 -> [u0:18]
u0:26 -> [u0:24]
u0:26 <- [u3:55]
u0:28 -> [u0:17]
u0:28 <- [u0:24, u4:62]
u0:29 -> [u0:17]
u0:31 -> [u0:18]
u0:31 <- [u0:24, u4:62]
u0:32 -> [u0:18]
u0:33 -> [u0:18]
u0:35 <- [u0:24]
u0:7 <- [u1:41, u1:43, u1:45, u1:47]
u1:41 -> [u0:18, u0:7, u1:49]
u1:41 <- [u1:45]
u1:42 -> [u0:18]
u1:43 -> [u0:7]
u1:44 -> [u0:18]
u1:45 -> [u0:18, u0:7, u1:41]
u1:45 <- [u3:55]
u1:46 -> [u0:18]
u1:47 -> [u0:7]
u1:48 -> [u0:18]
u1:49 <- [u1:41, u4:62, u4:64]
u3:55 -> [u0:26, u1:45, u4:60, u4:61]
u3:56 -> [u4:60]
u4:60 -> [u4:61, u4:62]
u4:60 <- [u3:55, u3:56]
u4:61 <- [u3:55, u4:60]
u4:62 -> [u0:17, u0:28, u0:31, u1:49]
u4:62 <- [u4:60]
u4:63 -> [u0:17]
u4:64 -> [u1:49]
u4:65 -> [u0:17]
