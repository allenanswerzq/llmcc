===============================================================================
workspace-crate-dependency
===============================================================================
Tests cross-crate dependencies: core defines types/traits, domain uses core, app orchestrates both.

--- file: crates/core/src/lib.rs ---
pub mod types;
pub mod traits;

pub use types::*;
pub use traits::*;

--- file: crates/core/src/types.rs ---
#[derive(Clone, Debug)]
pub struct Id(pub u64);

#[derive(Clone, Debug)]
pub struct Timestamp(pub u64);

#[derive(Clone, Debug)]
pub struct Money {
    pub cents: i64,
    pub currency: String,
}

impl Money {
    pub fn new(cents: i64, currency: &str) -> Self {
        Money { cents, currency: currency.to_string() }
    }

    pub fn usd(cents: i64) -> Self {
        Money::new(cents, "USD")
    }
}

--- file: crates/core/src/traits.rs ---
use super::types::Id;

pub trait Entity {
    fn id(&self) -> &Id;
}

pub trait Repository<T: Entity> {
    fn find(&self, id: &Id) -> Option<T>;
    fn save(&mut self, entity: T) -> Id;
}

--- file: crates/domain/src/lib.rs ---
// Depends on core crate
use core::{Id, Entity, Money};

pub mod user;
pub mod account;

pub use user::User;
pub use account::Account;

--- file: crates/domain/src/user.rs ---
use core::{Id, Entity};

pub struct User {
    id: Id,
    pub name: String,
    pub email: String,
}

impl User {
    pub fn new(id: u64, name: String, email: String) -> Self {
        User { id: Id(id), name, email }
    }
}

impl Entity for User {
    fn id(&self) -> &Id {
        &self.id
    }
}

--- file: crates/domain/src/account.rs ---
use core::{Id, Entity, Money};
use super::user::User;

pub struct Account {
    id: Id,
    pub user: User,
    pub balance: Money,
}

impl Account {
    pub fn new(id: u64, user: User) -> Self {
        Account {
            id: Id(id),
            user,
            balance: Money::usd(0),
        }
    }

    pub fn deposit(&mut self, amount: Money) {
        self.balance.cents += amount.cents;
    }

    pub fn withdraw(&mut self, amount: Money) -> bool {
        if self.balance.cents >= amount.cents {
            self.balance.cents -= amount.cents;
            true
        } else {
            false
        }
    }
}

impl Entity for Account {
    fn id(&self) -> &Id {
        &self.id
    }
}

--- file: crates/app/src/lib.rs ---
// Depends on both core and domain
use core::{Id, Repository};
use domain::{User, Account};

pub mod services;
pub mod repos;

--- file: crates/app/src/repos.rs ---
use core::{Id, Entity, Repository};
use domain::{User, Account};
use std::collections::HashMap;

pub struct UserRepo {
    users: HashMap<u64, User>,
    next_id: u64,
}

impl UserRepo {
    pub fn new() -> Self {
        UserRepo { users: HashMap::new(), next_id: 1 }
    }
}

impl Repository<User> for UserRepo {
    fn find(&self, id: &Id) -> Option<User> {
        self.users.get(&id.0).cloned()
    }

    fn save(&mut self, user: User) -> Id {
        let id = Id(self.next_id);
        self.next_id += 1;
        self.users.insert(id.0, user);
        id
    }
}

pub struct AccountRepo {
    accounts: HashMap<u64, Account>,
    next_id: u64,
}

impl AccountRepo {
    pub fn new() -> Self {
        AccountRepo { accounts: HashMap::new(), next_id: 1 }
    }
}

impl Repository<Account> for AccountRepo {
    fn find(&self, id: &Id) -> Option<Account> {
        self.accounts.get(&id.0).cloned()
    }

    fn save(&mut self, account: Account) -> Id {
        let id = Id(self.next_id);
        self.next_id += 1;
        self.accounts.insert(id.0, account);
        id
    }
}

--- file: crates/app/src/services.rs ---
use core::{Id, Money, Repository};
use domain::{User, Account};
use super::repos::{UserRepo, AccountRepo};

pub struct BankingService {
    users: UserRepo,
    accounts: AccountRepo,
}

impl BankingService {
    pub fn new() -> Self {
        BankingService {
            users: UserRepo::new(),
            accounts: AccountRepo::new(),
        }
    }

    pub fn create_user(&mut self, name: String, email: String) -> Id {
        let user = User::new(0, name, email);
        self.users.save(user)
    }

    pub fn open_account(&mut self, user_id: &Id) -> Option<Id> {
        let user = self.users.find(user_id)?;
        let account = Account::new(0, user);
        Some(self.accounts.save(account))
    }

    pub fn deposit(&mut self, account_id: &Id, amount: i64) -> bool {
        if let Some(mut account) = self.accounts.find(account_id) {
            account.deposit(Money::usd(amount));
            true
        } else {
            false
        }
    }
}

--- file: src/main.rs ---
// Binary crate depending on app
use app::services::BankingService;
use core::Money;

fn main() {
    let mut bank = BankingService::new();

    let user_id = bank.create_user("Alice".to_string(), "alice@bank.com".to_string());

    if let Some(account_id) = bank.open_account(&user_id) {
        bank.deposit(&account_id, 10000);  // $100.00
        println!("Account opened and funded!");
    }
}

--- expect:symbols ---
u0:1   | Primitive      | i32            | i32                                                 | [global]
u0:2   | Primitive      | i64            | i64                                                 | [global]
u0:3   | Primitive      | i16            | i16                                                 | [global]
u0:4   | Primitive      | i8             | i8                                                  | [global]
u0:5   | Primitive      | i128           | i128                                                | [global]
u0:6   | Primitive      | isize          | isize                                               | [global]
u0:7   | Primitive      | u32            | u32                                                 | [global]
u0:8   | Primitive      | u64            | u64                                                 | [global]
u0:9   | Primitive      | u16            | u16                                                 | [global]
u0:10  | Primitive      | u8             | u8                                                  | [global]
u0:11  | Primitive      | u128           | u128                                                | [global]
u0:12  | Primitive      | usize          | usize                                               | [global]
u0:13  | Primitive      | f32            | f32                                                 | [global]
u0:14  | Primitive      | f64            | f64                                                 | [global]
u0:15  | Primitive      | bool           | bool                                                | [global]
u0:16  | Primitive      | char           | char                                                | [global]
u0:17  | Primitive      | str            | str                                                 | [global]
u0:18  | Primitive      | String         | String                                              | [global]
u0:19  | Crate          | _c             | _c                                                  | [global]
u0:20  | Crate          | crate          | _c::crate                                           |         
u0:21  | File           | lib            | _c::lib                                             |         
u1:22  | Crate          | crate          | _c::crate                                           |         
u1:23  | File           | types          | _c::types                                           |         
u1:24  | Struct         | Id             | _c::types::Id                                       | [global]
u1:25  | Struct         | Timestamp      | _c::types::Timestamp                                | [global]
u1:26  | Struct         | Money          | _c::types::Money                                    | [global]
u1:27  | Field          | cents          | _c::types::Money::cents                             |         
u1:28  | Field          | currency       | _c::types::Money::currency                          |         
u1:29  | Function       | new            | _c::types::Money::new                               | [global]
u1:30  | Variable       | cents          | _c::types::Money::new::cents                        |         
u1:31  | Variable       | currency       | _c::types::Money::new::currency                     |         
u1:32  | Function       | usd            | _c::types::Money::usd                               | [global]
u1:33  | Variable       | cents          | _c::types::Money::usd::cents                        |         
u2:34  | Crate          | crate          | _c::crate                                           |         
u2:35  | File           | traits         | _c::traits                                          |         
u2:36  | Trait          | Entity         | _c::traits::Entity                                  | [global]
u2:37  | Function       | id             | _c::traits::Entity::id                              |         
u2:38  | Trait          | Repository     | _c::traits::Repository                              | [global]
u2:39  | TypeParameter  | T              | _c::traits::Repository::T                           |         
u2:40  | Function       | find           | _c::traits::Repository::find                        |         
u2:41  | Variable       | id             | _c::traits::Repository::find::id                    |         
u2:42  | Function       | save           | _c::traits::Repository::save                        |         
u2:43  | Variable       | entity         | _c::traits::Repository::save::entity                |         
u3:44  | Crate          | crate          | _c::crate                                           |         
u3:45  | File           | lib            | _c::lib                                             |         
u4:46  | Crate          | crate          | _c::crate                                           |         
u4:47  | File           | user           | _c::user                                            |         
u4:48  | Struct         | User           | _c::user::User                                      | [global]
u4:49  | Field          | id             | _c::user::User::id                                  |         
u4:50  | Field          | name           | _c::user::User::name                                |         
u4:51  | Field          | email          | _c::user::User::email                               |         
u4:52  | Function       | new            | _c::user::User::new                                 | [global]
u4:53  | Variable       | id             | _c::user::User::new::id                             |         
u4:54  | Variable       | name           | _c::user::User::new::name                           |         
u4:55  | Variable       | email          | _c::user::User::new::email                          |         
u4:56  | UnresolvedType | Entity         | _c::user::Entity                                    |         
u5:57  | Crate          | crate          | _c::crate                                           |         
u5:58  | File           | account        | _c::account                                         |         
u5:59  | Struct         | Account        | _c::account::Account                                | [global]
u5:60  | Field          | id             | _c::account::Account::id                            |         
u5:61  | Field          | user           | _c::account::Account::user                          |         
u5:62  | Field          | balance        | _c::account::Account::balance                       |         
u5:63  | Function       | new            | _c::account::Account::new                           | [global]
u5:64  | Variable       | id             | _c::account::Account::new::id                       |         
u5:65  | Variable       | user           | _c::account::Account::new::user                     |         
u5:66  | Function       | deposit        | _c::account::Account::deposit                       | [global]
u5:67  | Variable       | amount         | _c::account::Account::deposit::amount               |         
u5:68  | Function       | withdraw       | _c::account::Account::withdraw                      | [global]
u5:69  | Variable       | amount         | _c::account::Account::withdraw::amount              |         
u5:70  | UnresolvedType | Entity         | _c::account::Entity                                 |         
u6:71  | Crate          | crate          | _c::crate                                           |         
u6:72  | File           | lib            | _c::lib                                             |         
u7:73  | Crate          | crate          | _c::crate                                           |         
u7:74  | File           | repos          | _c::repos                                           |         
u7:75  | Struct         | UserRepo       | _c::repos::UserRepo                                 | [global]
u7:76  | Field          | users          | _c::repos::UserRepo::users                          |         
u7:77  | Field          | next_id        | _c::repos::UserRepo::next_id                        |         
u7:78  | Function       | new            | _c::repos::UserRepo::new                            | [global]
u7:79  | UnresolvedType | Repository     | _c::repos::Repository                               |         
u7:80  | Function       | find           | _c::repos::UserRepo::find                           |         
u7:81  | Variable       | id             | _c::repos::UserRepo::find::id                       |         
u7:82  | Function       | save           | _c::repos::UserRepo::save                           |         
u7:83  | Variable       | user           | _c::repos::UserRepo::save::user                     |         
u7:84  | Variable       | id             | _c::repos::UserRepo::save::id                       |         
u7:85  | Struct         | AccountRepo    | _c::repos::AccountRepo                              | [global]
u7:86  | Field          | accounts       | _c::repos::AccountRepo::accounts                    |         
u7:87  | Field          | next_id        | _c::repos::AccountRepo::next_id                     |         
u7:88  | Variable       | account        | _c::repos::UserRepo::save::account                  |         
u7:89  | Variable       | id             | _c::repos::UserRepo::save::id                       |         
u8:90  | Crate          | crate          | _c::crate                                           |         
u8:91  | File           | services       | _c::services                                        |         
u8:92  | Struct         | BankingService | _c::services::BankingService                        | [global]
u8:93  | Field          | users          | _c::services::BankingService::users                 |         
u8:94  | Field          | accounts       | _c::services::BankingService::accounts              |         
u8:95  | Function       | new            | _c::services::BankingService::new                   | [global]
u8:96  | Function       | create_user    | _c::services::BankingService::create_user           | [global]
u8:97  | Variable       | name           | _c::services::BankingService::create_user::name     |         
u8:98  | Variable       | email          | _c::services::BankingService::create_user::email    |         
u8:99  | Variable       | user           | _c::services::BankingService::create_user::user     |         
u8:100 | Function       | open_account   | _c::services::BankingService::open_account          | [global]
u8:101 | Variable       | user_id        | _c::services::BankingService::open_account::user_id |         
u8:102 | Variable       | user           | _c::services::BankingService::open_account::user    |         
u8:103 | Variable       | account        | _c::services::BankingService::open_account::account |         
u8:104 | Function       | deposit        | _c::services::BankingService::deposit               | [global]
u8:105 | Variable       | account_id     | _c::services::BankingService::deposit::account_id   |         
u8:106 | Variable       | amount         | _c::services::BankingService::deposit::amount       |         
u9:107 | Crate          | crate          | _c::crate                                           |         
u9:108 | File           | main           | _c::main                                            |         
u9:109 | Function       | main           | _c::main::main                                      |         
u9:110 | Variable       | bank           | _c::main::main::bank                                |         
u9:111 | Variable       | user_id        | _c::main::main::user_id                             |         

--- expect:symbol-deps ---
u0:15 <- [u5:68, u8:104]
u0:17 <- [u1:29, u1:31]
u0:18 <- [u1:26, u1:28, u4:48, u4:50, u4:51, u4:52, u4:54, u4:55, u8:96, u8:97, u8:98]
u0:2 <- [u1:26, u1:27, u1:29, u1:30, u1:32, u1:33, u8:104, u8:106]
u0:8 <- [u1:24, u1:25, u4:52, u4:53, u5:63, u5:64, u7:75, u7:77, u7:85, u7:87]
u1:24 -> [u0:8]
u1:24 <- [u2:40, u2:41, u4:48, u4:49, u5:59, u5:60, u7:80, u7:81, u7:82, u7:84, u7:89, u8:100, u8:101, u8:104, u8:105]
u1:25 -> [u0:8]
u1:26 -> [u0:18, u0:2, u1:32]
u1:26 <- [u1:29, u5:59, u5:62, u5:66, u5:67, u5:68, u5:69]
u1:27 -> [u0:2]
u1:28 -> [u0:18]
u1:29 -> [u0:17, u0:2, u1:26]
u1:29 <- [u1:32]
u1:30 -> [u0:2]
u1:31 -> [u0:17]
u1:32 -> [u0:2, u1:29]
u1:32 <- [u1:26, u5:63, u8:104]
u1:33 -> [u0:2]
u2:36 -> [u2:37]
u2:36 <- [u2:38]
u2:37 <- [u2:36]
u2:38 -> [u2:36, u2:40, u2:42]
u2:40 -> [u1:24]
u2:40 <- [u2:38]
u2:41 -> [u1:24]
u2:42 <- [u2:38]
u4:48 -> [u0:18, u1:24, u4:49]
u4:48 <- [u4:52, u5:59, u5:61, u5:63, u5:65, u7:75, u7:76, u7:82, u7:83, u8:96, u8:99]
u4:49 -> [u1:24]
u4:49 <- [u4:48]
u4:50 -> [u0:18]
u4:51 -> [u0:18]
u4:52 -> [u0:18, u0:8, u4:48]
u4:52 <- [u8:96]
u4:53 -> [u0:8]
u4:54 -> [u0:18]
u4:55 -> [u0:18]
u5:59 -> [u1:24, u1:26, u4:48, u5:60, u5:66, u5:68]
u5:59 <- [u5:63, u7:82, u7:85, u7:86, u7:88, u8:100, u8:103]
u5:60 -> [u1:24]
u5:60 <- [u5:59]
u5:61 -> [u4:48]
u5:62 -> [u1:26]
u5:63 -> [u0:8, u1:32, u4:48, u5:59]
u5:63 <- [u8:100]
u5:64 -> [u0:8]
u5:65 -> [u4:48]
u5:66 -> [u1:26]
u5:66 <- [u5:59]
u5:67 -> [u1:26]
u5:68 -> [u0:15, u1:26]
u5:68 <- [u5:59]
u5:69 -> [u1:26]
u7:75 -> [u0:8, u4:48, u7:80, u7:82]
u7:75 <- [u7:78, u8:100, u8:102, u8:92, u8:93]
u7:76 -> [u4:48]
u7:77 -> [u0:8]
u7:78 -> [u7:75, u7:85]
u7:78 <- [u8:95]
u7:80 -> [u1:24]
u7:80 <- [u7:75, u7:85, u8:100, u8:104]
u7:81 -> [u1:24]
u7:82 -> [u1:24, u4:48, u5:59]
u7:82 <- [u7:75, u7:85, u8:100, u8:96]
u7:83 -> [u4:48]
u7:84 -> [u1:24]
u7:85 -> [u0:8, u5:59, u7:80, u7:82]
u7:85 <- [u7:78, u8:92, u8:94]
u7:86 -> [u5:59]
u7:87 -> [u0:8]
u7:88 -> [u5:59]
u7:89 -> [u1:24]
u8:100 -> [u1:24, u5:59, u5:63, u7:75, u7:80, u7:82]
u8:100 <- [u8:92, u9:109]
u8:101 -> [u1:24]
u8:102 -> [u7:75]
u8:103 -> [u5:59]
u8:104 -> [u0:15, u0:2, u1:24, u1:32, u7:80]
u8:104 <- [u8:92, u9:109]
u8:105 -> [u1:24]
u8:106 -> [u0:2]
u8:92 -> [u7:75, u7:85, u8:100, u8:104, u8:96]
u8:92 <- [u8:95, u9:109, u9:110, u9:111]
u8:93 -> [u7:75]
u8:94 -> [u7:85]
u8:95 -> [u7:78, u8:92]
u8:95 <- [u9:109]
u8:96 -> [u0:18, u4:48, u4:52, u7:82]
u8:96 <- [u8:92, u9:109]
u8:97 -> [u0:18]
u8:98 -> [u0:18]
u8:99 -> [u4:48]
u9:109 -> [u8:100, u8:104, u8:92, u8:95, u8:96]
u9:110 -> [u8:92]
u9:111 -> [u8:92]


===============================================================================
plugin-architecture
===============================================================================
Tests plugin architecture: Plugin trait API, core registry, multiple plugin implementations.

--- file: src/lib.rs ---
pub mod plugin_api;
pub mod core;
pub mod plugins;

--- file: src/plugin_api/mod.rs ---
pub trait Plugin: Send + Sync {
    fn name(&self) -> &str;
    fn version(&self) -> &str;
    fn initialize(&mut self);
    fn shutdown(&mut self);
}

pub trait TextProcessor: Plugin {
    fn process(&self, input: &str) -> String;
}

pub trait Analyzer: Plugin {
    fn analyze(&self, input: &str) -> AnalysisResult;
}

pub struct AnalysisResult {
    pub word_count: usize,
    pub char_count: usize,
    pub line_count: usize,
}

--- file: src/core/mod.rs ---
use crate::plugin_api::{Plugin, TextProcessor, Analyzer};

pub struct PluginManager {
    processors: Vec<Box<dyn TextProcessor>>,
    analyzers: Vec<Box<dyn Analyzer>>,
}

impl PluginManager {
    pub fn new() -> Self {
        PluginManager {
            processors: Vec::new(),
            analyzers: Vec::new(),
        }
    }

    pub fn register_processor(&mut self, mut plugin: Box<dyn TextProcessor>) {
        plugin.initialize();
        println!("Registered processor: {} v{}", plugin.name(), plugin.version());
        self.processors.push(plugin);
    }

    pub fn register_analyzer(&mut self, mut plugin: Box<dyn Analyzer>) {
        plugin.initialize();
        println!("Registered analyzer: {} v{}", plugin.name(), plugin.version());
        self.analyzers.push(plugin);
    }

    pub fn process_text(&self, input: &str) -> String {
        let mut result = input.to_string();
        for processor in &self.processors {
            result = processor.process(&result);
        }
        result
    }

    pub fn shutdown(&mut self) {
        for processor in &mut self.processors {
            processor.shutdown();
        }
        for analyzer in &mut self.analyzers {
            analyzer.shutdown();
        }
    }
}

--- file: src/plugins/mod.rs ---
mod uppercase;
mod trimmer;
mod counter;

pub use uppercase::UppercasePlugin;
pub use trimmer::TrimmerPlugin;
pub use counter::CounterPlugin;

--- file: src/plugins/uppercase.rs ---
use crate::plugin_api::{Plugin, TextProcessor};

pub struct UppercasePlugin {
    initialized: bool,
}

impl UppercasePlugin {
    pub fn new() -> Self {
        UppercasePlugin { initialized: false }
    }
}

impl Plugin for UppercasePlugin {
    fn name(&self) -> &str { "Uppercase" }
    fn version(&self) -> &str { "1.0.0" }
    fn initialize(&mut self) { self.initialized = true; }
    fn shutdown(&mut self) { self.initialized = false; }
}

impl TextProcessor for UppercasePlugin {
    fn process(&self, input: &str) -> String {
        input.to_uppercase()
    }
}

--- file: src/plugins/trimmer.rs ---
use crate::plugin_api::{Plugin, TextProcessor};

pub struct TrimmerPlugin;

impl TrimmerPlugin {
    pub fn new() -> Self { TrimmerPlugin }
}

impl Plugin for TrimmerPlugin {
    fn name(&self) -> &str { "Trimmer" }
    fn version(&self) -> &str { "1.0.0" }
    fn initialize(&mut self) {}
    fn shutdown(&mut self) {}
}

impl TextProcessor for TrimmerPlugin {
    fn process(&self, input: &str) -> String {
        input.trim().to_string()
    }
}

--- file: src/plugins/counter.rs ---
use crate::plugin_api::{Plugin, Analyzer, AnalysisResult};

pub struct CounterPlugin;

impl CounterPlugin {
    pub fn new() -> Self { CounterPlugin }
}

impl Plugin for CounterPlugin {
    fn name(&self) -> &str { "Counter" }
    fn version(&self) -> &str { "1.0.0" }
    fn initialize(&mut self) {}
    fn shutdown(&mut self) {}
}

impl Analyzer for CounterPlugin {
    fn analyze(&self, input: &str) -> AnalysisResult {
        AnalysisResult {
            word_count: input.split_whitespace().count(),
            char_count: input.chars().count(),
            line_count: input.lines().count(),
        }
    }
}

--- file: src/main.rs ---
mod plugin_api;
mod core;
mod plugins;

use core::PluginManager;
use plugins::{UppercasePlugin, TrimmerPlugin, CounterPlugin};

fn main() {
    let mut manager = PluginManager::new();

    manager.register_processor(Box::new(TrimmerPlugin::new()));
    manager.register_processor(Box::new(UppercasePlugin::new()));
    manager.register_analyzer(Box::new(CounterPlugin::new()));

    let input = "  hello world  ";
    let processed = manager.process_text(input);
    println!("Processed: '{}'", processed);

    manager.shutdown();
}

--- expect:symbols ---
u0:1   | Primitive      | i32                | i32                                                      | [global]
u0:2   | Primitive      | i64                | i64                                                      | [global]
u0:3   | Primitive      | i16                | i16                                                      | [global]
u0:4   | Primitive      | i8                 | i8                                                       | [global]
u0:5   | Primitive      | i128               | i128                                                     | [global]
u0:6   | Primitive      | isize              | isize                                                    | [global]
u0:7   | Primitive      | u32                | u32                                                      | [global]
u0:8   | Primitive      | u64                | u64                                                      | [global]
u0:9   | Primitive      | u16                | u16                                                      | [global]
u0:10  | Primitive      | u8                 | u8                                                       | [global]
u0:11  | Primitive      | u128               | u128                                                     | [global]
u0:12  | Primitive      | usize              | usize                                                    | [global]
u0:13  | Primitive      | f32                | f32                                                      | [global]
u0:14  | Primitive      | f64                | f64                                                      | [global]
u0:15  | Primitive      | bool               | bool                                                     | [global]
u0:16  | Primitive      | char               | char                                                     | [global]
u0:17  | Primitive      | str                | str                                                      | [global]
u0:18  | Primitive      | String             | String                                                   | [global]
u0:19  | Crate          | _c                 | _c                                                       | [global]
u0:20  | Crate          | crate              | _c::crate                                                |         
u0:21  | File           | lib                | _c::lib                                                  |         
u1:22  | Crate          | crate              | _c::crate                                                |         
u1:23  | Module         | plugin_api         | _c::plugin_api                                           |         
u1:24  | File           | mod                | _c::plugin_api::mod                                      |         
u1:25  | Trait          | Plugin             | _c::plugin_api::mod::Plugin                              | [global]
u1:26  | Function       | name               | _c::plugin_api::mod::Plugin::name                        |         
u1:27  | Function       | version            | _c::plugin_api::mod::Plugin::version                     |         
u1:28  | Function       | initialize         | _c::plugin_api::mod::Plugin::initialize                  |         
u1:29  | Function       | shutdown           | _c::plugin_api::mod::Plugin::shutdown                    |         
u1:30  | Trait          | TextProcessor      | _c::plugin_api::mod::TextProcessor                       | [global]
u1:31  | Function       | process            | _c::plugin_api::mod::TextProcessor::process              |         
u1:32  | Variable       | input              | _c::plugin_api::mod::TextProcessor::process::input       |         
u1:33  | Trait          | Analyzer           | _c::plugin_api::mod::Analyzer                            | [global]
u1:34  | Function       | analyze            | _c::plugin_api::mod::Analyzer::analyze                   |         
u1:35  | Variable       | input              | _c::plugin_api::mod::Analyzer::analyze::input            |         
u1:36  | Struct         | AnalysisResult     | _c::plugin_api::mod::AnalysisResult                      | [global]
u1:37  | Field          | word_count         | _c::plugin_api::mod::AnalysisResult::word_count          |         
u1:38  | Field          | char_count         | _c::plugin_api::mod::AnalysisResult::char_count          |         
u1:39  | Field          | line_count         | _c::plugin_api::mod::AnalysisResult::line_count          |         
u2:40  | Crate          | crate              | _c::crate                                                |         
u2:41  | Module         | core               | _c::core                                                 |         
u2:42  | File           | mod                | _c::core::mod                                            |         
u2:43  | Struct         | PluginManager      | _c::core::mod::PluginManager                             | [global]
u2:44  | Field          | processors         | _c::core::mod::PluginManager::processors                 |         
u2:45  | Field          | analyzers          | _c::core::mod::PluginManager::analyzers                  |         
u2:46  | Function       | new                | _c::core::mod::PluginManager::new                        | [global]
u2:47  | Function       | register_processor | _c::core::mod::PluginManager::register_processor         | [global]
u2:48  | Variable       | plugin             | _c::core::mod::PluginManager::register_processor::plugin |         
u2:49  | Function       | register_analyzer  | _c::core::mod::PluginManager::register_analyzer          | [global]
u2:50  | Variable       | plugin             | _c::core::mod::PluginManager::register_analyzer::plugin  |         
u2:51  | Function       | process_text       | _c::core::mod::PluginManager::process_text               | [global]
u2:52  | Variable       | input              | _c::core::mod::PluginManager::process_text::input        |         
u2:53  | Variable       | result             | _c::core::mod::PluginManager::process_text::result       |         
u2:54  | Function       | shutdown           | _c::core::mod::PluginManager::shutdown                   | [global]
u3:55  | Crate          | crate              | _c::crate                                                |         
u3:56  | Module         | plugins            | _c::plugins                                              |         
u3:57  | File           | mod                | _c::plugins::mod                                         |         
u4:58  | Crate          | crate              | _c::crate                                                |         
u4:59  | Module         | plugins            | _c::plugins                                              |         
u4:60  | File           | uppercase          | _c::plugins::uppercase                                   |         
u4:61  | Struct         | UppercasePlugin    | _c::plugins::uppercase::UppercasePlugin                  | [global]
u4:62  | Field          | initialized        | _c::plugins::uppercase::UppercasePlugin::initialized     |         
u4:63  | Function       | new                | _c::plugins::uppercase::UppercasePlugin::new             | [global]
u4:64  | UnresolvedType | Plugin             | _c::plugins::uppercase::Plugin                           |         
u4:65  | Function       | name               | _c::plugins::uppercase::UppercasePlugin::name            |         
u4:66  | Function       | version            | _c::plugins::uppercase::UppercasePlugin::version         |         
u4:67  | Function       | initialize         | _c::plugins::uppercase::UppercasePlugin::initialize      |         
u4:68  | Function       | shutdown           | _c::plugins::uppercase::UppercasePlugin::shutdown        |         
u4:69  | UnresolvedType | TextProcessor      | _c::plugins::uppercase::TextProcessor                    |         
u4:70  | Function       | process            | _c::plugins::uppercase::UppercasePlugin::process         |         
u4:71  | Variable       | input              | _c::plugins::uppercase::UppercasePlugin::process::input  |         
u5:72  | Crate          | crate              | _c::crate                                                |         
u5:73  | Module         | plugins            | _c::plugins                                              |         
u5:74  | File           | trimmer            | _c::plugins::trimmer                                     |         
u5:75  | Struct         | TrimmerPlugin      | _c::plugins::trimmer::TrimmerPlugin                      | [global]
u5:76  | Function       | new                | _c::plugins::trimmer::TrimmerPlugin::new                 | [global]
u5:77  | UnresolvedType | Plugin             | _c::plugins::trimmer::Plugin                             |         
u5:78  | Function       | name               | _c::plugins::trimmer::TrimmerPlugin::name                |         
u5:79  | Function       | version            | _c::plugins::trimmer::TrimmerPlugin::version             |         
u5:80  | Function       | initialize         | _c::plugins::trimmer::TrimmerPlugin::initialize          |         
u5:81  | Function       | shutdown           | _c::plugins::trimmer::TrimmerPlugin::shutdown            |         
u5:82  | UnresolvedType | TextProcessor      | _c::plugins::trimmer::TextProcessor                      |         
u5:83  | Function       | process            | _c::plugins::trimmer::TrimmerPlugin::process             |         
u5:84  | Variable       | input              | _c::plugins::trimmer::TrimmerPlugin::process::input      |         
u6:85  | Crate          | crate              | _c::crate                                                |         
u6:86  | Module         | plugins            | _c::plugins                                              |         
u6:87  | File           | counter            | _c::plugins::counter                                     |         
u6:88  | Struct         | CounterPlugin      | _c::plugins::counter::CounterPlugin                      | [global]
u6:89  | Function       | new                | _c::plugins::counter::CounterPlugin::new                 | [global]
u6:90  | UnresolvedType | Plugin             | _c::plugins::counter::Plugin                             |         
u6:91  | Function       | name               | _c::plugins::counter::CounterPlugin::name                |         
u6:92  | Function       | version            | _c::plugins::counter::CounterPlugin::version             |         
u6:93  | Function       | initialize         | _c::plugins::counter::CounterPlugin::initialize          |         
u6:94  | Function       | shutdown           | _c::plugins::counter::CounterPlugin::shutdown            |         
u6:95  | UnresolvedType | Analyzer           | _c::plugins::counter::Analyzer                           |         
u6:96  | Function       | analyze            | _c::plugins::counter::CounterPlugin::analyze             |         
u6:97  | Variable       | input              | _c::plugins::counter::CounterPlugin::analyze::input      |         
u7:98  | Crate          | crate              | _c::crate                                                |         
u7:99  | File           | main               | _c::main                                                 |         
u7:100 | Function       | main               | _c::main::main                                           |         
u7:101 | Variable       | manager            | _c::main::main::manager                                  |         
u7:102 | Variable       | input              | _c::main::main::input                                    |         
u7:103 | Variable       | processed          | _c::main::main::processed                                |         

--- expect:symbol-deps ---
u0:12 <- [u1:36, u1:37, u1:38, u1:39]
u0:15 <- [u4:61, u4:62]
u0:17 <- [u1:26, u1:27, u1:31, u1:32, u1:34, u1:35, u2:51, u2:52, u2:53, u4:65, u4:66, u4:70, u4:71, u5:78, u5:79, u5:83, u5:84, u6:91, u6:92, u6:96, u6:97, u7:100, u7:102]
u1:25 -> [u1:26, u1:27, u1:28, u1:29]
u1:25 <- [u1:30, u1:33]
u1:26 -> [u0:17]
u1:26 <- [u1:25]
u1:27 -> [u0:17]
u1:27 <- [u1:25]
u1:28 <- [u1:25]
u1:29 <- [u1:25]
u1:30 -> [u1:25, u1:31]
u1:30 <- [u2:43, u2:44, u2:47, u2:48]
u1:31 -> [u0:17]
u1:31 <- [u1:30]
u1:32 -> [u0:17]
u1:33 -> [u1:25, u1:34]
u1:33 <- [u2:43, u2:45, u2:49, u2:50]
u1:34 -> [u0:17]
u1:34 <- [u1:33]
u1:35 -> [u0:17]
u1:36 -> [u0:12]
u1:36 <- [u6:96]
u1:37 -> [u0:12]
u1:38 -> [u0:12]
u1:39 -> [u0:12]
u2:43 -> [u1:30, u1:33, u2:47, u2:49, u2:51, u2:54]
u2:43 <- [u2:46, u7:100, u7:101, u7:103]
u2:44 -> [u1:30]
u2:45 -> [u1:33]
u2:46 -> [u2:43]
u2:46 <- [u7:100]
u2:47 -> [u1:30, u4:63, u5:76, u6:93]
u2:47 <- [u2:43, u7:100]
u2:48 -> [u1:30]
u2:49 -> [u1:33, u6:89, u6:93]
u2:49 <- [u2:43, u7:100]
u2:50 -> [u1:33]
u2:51 -> [u0:17, u5:83]
u2:51 <- [u2:43, u7:100]
u2:52 -> [u0:17]
u2:53 -> [u0:17]
u2:54 <- [u2:43]
u4:61 -> [u0:15, u4:65, u4:66, u4:67, u4:68, u4:70]
u4:61 <- [u4:63]
u4:62 -> [u0:15]
u4:63 -> [u4:61]
u4:63 <- [u2:47, u7:100]
u4:65 -> [u0:17]
u4:65 <- [u4:61]
u4:66 -> [u0:17]
u4:66 <- [u4:61]
u4:67 <- [u4:61]
u4:68 <- [u4:61]
u4:70 -> [u0:17]
u4:70 <- [u4:61]
u4:71 -> [u0:17]
u5:75 -> [u5:76, u5:78, u5:79, u5:80, u5:81, u5:83]
u5:76 <- [u2:47, u5:75, u7:100]
u5:78 -> [u0:17]
u5:78 <- [u5:75]
u5:79 -> [u0:17]
u5:79 <- [u5:75]
u5:80 <- [u5:75]
u5:81 <- [u5:75]
u5:83 -> [u0:17]
u5:83 <- [u2:51, u5:75]
u5:84 -> [u0:17]
u6:88 -> [u6:89, u6:91, u6:92, u6:93, u6:94, u6:96]
u6:89 <- [u2:49, u6:88, u7:100]
u6:91 -> [u0:17]
u6:91 <- [u6:88]
u6:92 -> [u0:17]
u6:92 <- [u6:88]
u6:93 <- [u2:47, u2:49, u6:88]
u6:94 <- [u6:88, u7:100]
u6:96 -> [u0:17, u1:36]
u6:96 <- [u6:88]
u6:97 -> [u0:17]
u7:100 -> [u0:17, u2:43, u2:46, u2:47, u2:49, u2:51, u4:63, u5:76, u6:89, u6:94]
u7:101 -> [u2:43]
u7:102 -> [u0:17]
u7:103 -> [u2:43]


===============================================================================
feature-flag-architecture
===============================================================================
Tests conditional compilation: cfg(feature) modules for json/xml/yaml serialization.

--- file: src/lib.rs ---
pub mod core;

#[cfg(feature = "json")]
pub mod json;

#[cfg(feature = "xml")]
pub mod xml;

#[cfg(feature = "yaml")]
pub mod yaml;

pub mod format {
    use super::core::Data;

    pub trait Formatter {
        fn format(&self, data: &Data) -> String;
        fn parse(&self, input: &str) -> Option<Data>;
    }

    #[cfg(feature = "json")]
    pub use super::json::JsonFormatter;

    #[cfg(feature = "xml")]
    pub use super::xml::XmlFormatter;

    #[cfg(feature = "yaml")]
    pub use super::yaml::YamlFormatter;
}

--- file: src/core.rs ---
#[derive(Clone, Debug)]
pub struct Data {
    pub fields: Vec<(String, Value)>,
}

#[derive(Clone, Debug)]
pub enum Value {
    Null,
    Bool(bool),
    Number(f64),
    String(String),
    Array(Vec<Value>),
}

impl Data {
    pub fn new() -> Self {
        Data { fields: Vec::new() }
    }

    pub fn set(&mut self, key: &str, value: Value) {
        self.fields.push((key.to_string(), value));
    }

    pub fn get(&self, key: &str) -> Option<&Value> {
        self.fields.iter().find(|(k, _)| k == key).map(|(_, v)| v)
    }
}

--- file: src/json.rs ---
use crate::core::{Data, Value};
use crate::format::Formatter;

pub struct JsonFormatter;

impl Formatter for JsonFormatter {
    fn format(&self, data: &Data) -> String {
        let fields: Vec<String> = data.fields.iter()
            .map(|(k, v)| format!("\"{}\": {}", k, format_value(v)))
            .collect();
        format!("{{{}}}", fields.join(", "))
    }

    fn parse(&self, _input: &str) -> Option<Data> {
        // Simplified - real impl would parse JSON
        Some(Data::new())
    }
}

fn format_value(v: &Value) -> String {
    match v {
        Value::Null => "null".to_string(),
        Value::Bool(b) => b.to_string(),
        Value::Number(n) => n.to_string(),
        Value::String(s) => format!("\"{}\"", s),
        Value::Array(arr) => {
            let items: Vec<String> = arr.iter().map(format_value).collect();
            format!("[{}]", items.join(", "))
        }
    }
}

--- file: src/xml.rs ---
use crate::core::{Data, Value};
use crate::format::Formatter;

pub struct XmlFormatter;

impl Formatter for XmlFormatter {
    fn format(&self, data: &Data) -> String {
        let fields: Vec<String> = data.fields.iter()
            .map(|(k, v)| format!("<{}>{}</{}>", k, format_value(v), k))
            .collect();
        format!("<data>{}</data>", fields.join(""))
    }

    fn parse(&self, _input: &str) -> Option<Data> {
        Some(Data::new())
    }
}

fn format_value(v: &Value) -> String {
    match v {
        Value::Null => "".to_string(),
        Value::Bool(b) => b.to_string(),
        Value::Number(n) => n.to_string(),
        Value::String(s) => s.clone(),
        Value::Array(arr) => {
            arr.iter().map(|v| format!("<item>{}</item>", format_value(v))).collect()
        }
    }
}

--- file: src/yaml.rs ---
use crate::core::{Data, Value};
use crate::format::Formatter;

pub struct YamlFormatter;

impl Formatter for YamlFormatter {
    fn format(&self, data: &Data) -> String {
        data.fields.iter()
            .map(|(k, v)| format!("{}: {}", k, format_value(v, 0)))
            .collect::<Vec<_>>()
            .join("\n")
    }

    fn parse(&self, _input: &str) -> Option<Data> {
        Some(Data::new())
    }
}

fn format_value(v: &Value, indent: usize) -> String {
    let prefix = "  ".repeat(indent);
    match v {
        Value::Null => "~".to_string(),
        Value::Bool(b) => b.to_string(),
        Value::Number(n) => n.to_string(),
        Value::String(s) => format!("\"{}\"", s),
        Value::Array(arr) => {
            let items: Vec<String> = arr.iter()
                .map(|v| format!("\n{}- {}", prefix, format_value(v, indent + 1)))
                .collect();
            items.join("")
        }
    }
}

--- file: src/main.rs ---
mod core;

#[cfg(feature = "json")]
mod json;

#[cfg(feature = "xml")]
mod xml;

#[cfg(feature = "yaml")]
mod yaml;

mod format;

use core::{Data, Value};
use format::Formatter;

fn main() {
    let mut data = Data::new();
    data.set("name", Value::String("Alice".to_string()));
    data.set("age", Value::Number(30.0));
    data.set("active", Value::Bool(true));

    #[cfg(feature = "json")]
    {
        let formatter = json::JsonFormatter;
        println!("JSON: {}", formatter.format(&data));
    }

    #[cfg(feature = "xml")]
    {
        let formatter = xml::XmlFormatter;
        println!("XML: {}", formatter.format(&data));
    }

    #[cfg(feature = "yaml")]
    {
        let formatter = yaml::YamlFormatter;
        println!("YAML:\n{}", formatter.format(&data));
    }
}

--- expect:symbols ---
u0:1  | Primitive      | i32           | i32                                      | [global]
u0:2  | Primitive      | i64           | i64                                      | [global]
u0:3  | Primitive      | i16           | i16                                      | [global]
u0:4  | Primitive      | i8            | i8                                       | [global]
u0:5  | Primitive      | i128          | i128                                     | [global]
u0:6  | Primitive      | isize         | isize                                    | [global]
u0:7  | Primitive      | u32           | u32                                      | [global]
u0:8  | Primitive      | u64           | u64                                      | [global]
u0:9  | Primitive      | u16           | u16                                      | [global]
u0:10 | Primitive      | u8            | u8                                       | [global]
u0:11 | Primitive      | u128          | u128                                     | [global]
u0:12 | Primitive      | usize         | usize                                    | [global]
u0:13 | Primitive      | f32           | f32                                      | [global]
u0:14 | Primitive      | f64           | f64                                      | [global]
u0:15 | Primitive      | bool          | bool                                     | [global]
u0:16 | Primitive      | char          | char                                     | [global]
u0:17 | Primitive      | str           | str                                      | [global]
u0:18 | Primitive      | String        | String                                   | [global]
u0:19 | Crate          | _c            | _c                                       | [global]
u0:20 | Crate          | crate         | _c::crate                                |         
u0:21 | File           | lib           | _c::lib                                  |         
u0:22 | Namespace      | format        | _c::lib::format                          | [global]
u0:23 | Trait          | Formatter     | _c::lib::format::Formatter               | [global]
u0:24 | Function       | format        | _c::lib::format::Formatter::format       |         
u0:25 | Variable       | data          | _c::lib::format::Formatter::format::data |         
u0:26 | Function       | parse         | _c::lib::format::Formatter::parse        |         
u0:27 | Variable       | input         | _c::lib::format::Formatter::parse::input |         
u1:28 | Crate          | crate         | _c::crate                                |         
u1:29 | File           | core          | _c::core                                 |         
u1:30 | Struct         | Data          | _c::core::Data                           | [global]
u1:31 | Field          | fields        | _c::core::Data::fields                   |         
u1:32 | Enum           | Value         | _c::core::Value                          | [global]
u1:33 | EnumVariant    | Null          | _c::core::Value::Null                    |         
u1:34 | EnumVariant    | Bool          | _c::core::Value::Bool                    |         
u1:35 | EnumVariant    | Number        | _c::core::Value::Number                  |         
u1:36 | EnumVariant    | String        | _c::core::Value::String                  |         
u1:37 | EnumVariant    | Array         | _c::core::Value::Array                   |         
u1:38 | Function       | new           | _c::core::Data::new                      | [global]
u1:39 | Function       | set           | _c::core::Data::set                      | [global]
u1:40 | Variable       | key           | _c::core::Data::set::key                 |         
u1:41 | Variable       | value         | _c::core::Data::set::value               |         
u1:42 | Function       | get           | _c::core::Data::get                      | [global]
u1:43 | Variable       | key           | _c::core::Data::get::key                 |         
u1:44 | Variable       | k             | _c::core::Data::get::k                   |         
u1:45 | Variable       | v             | _c::core::Data::get::v                   |         
u2:46 | Crate          | crate         | _c::crate                                |         
u2:47 | File           | json          | _c::json                                 |         
u2:48 | Struct         | JsonFormatter | _c::json::JsonFormatter                  | [global]
u2:49 | UnresolvedType | Formatter     | _c::json::Formatter                      |         
u2:50 | Function       | format        | _c::json::JsonFormatter::format          |         
u2:51 | Variable       | data          | _c::json::JsonFormatter::format::data    |         
u2:52 | Variable       | fields        | _c::json::JsonFormatter::format::fields  |         
u2:53 | Variable       | k             | _c::json::JsonFormatter::format::k       |         
u2:54 | Variable       | v             | _c::json::JsonFormatter::format::v       |         
u2:55 | Function       | parse         | _c::json::JsonFormatter::parse           |         
u2:56 | Variable       | _input        | _c::json::JsonFormatter::parse::_input   |         
u2:57 | Function       | format_value  | _c::json::format_value                   |         
u2:58 | Variable       | v             | _c::json::format_value::v                |         
u2:59 | Variable       | items         | _c::json::format_value::items            |         
u3:60 | Crate          | crate         | _c::crate                                |         
u3:61 | File           | xml           | _c::xml                                  |         
u3:62 | Struct         | XmlFormatter  | _c::xml::XmlFormatter                    | [global]
u3:63 | UnresolvedType | Formatter     | _c::xml::Formatter                       |         
u3:64 | Function       | format        | _c::xml::XmlFormatter::format            |         
u3:65 | Variable       | data          | _c::xml::XmlFormatter::format::data      |         
u3:66 | Variable       | fields        | _c::xml::XmlFormatter::format::fields    |         
u3:67 | Variable       | k             | _c::xml::XmlFormatter::format::k         |         
u3:68 | Variable       | v             | _c::xml::XmlFormatter::format::v         |         
u3:69 | Function       | parse         | _c::xml::XmlFormatter::parse             |         
u3:70 | Variable       | _input        | _c::xml::XmlFormatter::parse::_input     |         
u3:71 | Function       | format_value  | _c::xml::format_value                    |         
u3:72 | Variable       | v             | _c::xml::format_value::v                 |         
u3:73 | Variable       | v             | _c::xml::format_value::v                 |         
u4:74 | Crate          | crate         | _c::crate                                |         
u4:75 | File           | yaml          | _c::yaml                                 |         
u4:76 | Struct         | YamlFormatter | _c::yaml::YamlFormatter                  | [global]
u4:77 | UnresolvedType | Formatter     | _c::yaml::Formatter                      |         
u4:78 | Function       | format        | _c::yaml::YamlFormatter::format          |         
u4:79 | Variable       | data          | _c::yaml::YamlFormatter::format::data    |         
u4:80 | Variable       | k             | _c::yaml::YamlFormatter::format::k       |         
u4:81 | Variable       | v             | _c::yaml::YamlFormatter::format::v       |         
u4:82 | Function       | parse         | _c::yaml::YamlFormatter::parse           |         
u4:83 | Variable       | _input        | _c::yaml::YamlFormatter::parse::_input   |         
u4:84 | Function       | format_value  | _c::yaml::format_value                   |         
u4:85 | Variable       | v             | _c::yaml::format_value::v                |         
u4:86 | Variable       | indent        | _c::yaml::format_value::indent           |         
u4:87 | Variable       | prefix        | _c::yaml::format_value::prefix           |         
u4:88 | Variable       | items         | _c::yaml::format_value::items            |         
u4:89 | Variable       | v             | _c::yaml::format_value::v                |         
u5:90 | Crate          | crate         | _c::crate                                |         
u5:91 | File           | main          | _c::main                                 |         
u5:92 | Function       | main          | _c::main::main                           |         
u5:93 | Variable       | data          | _c::main::main::data                     |         
u5:94 | Variable       | formatter     | _c::main::main::formatter                |         
u5:95 | Variable       | formatter     | _c::main::main::formatter                |         
u5:96 | Variable       | formatter     | _c::main::main::formatter                |         

--- expect:symbol-deps ---
u0:12 <- [u4:84, u4:86]
u0:14 <- [u1:32]
u0:15 <- [u1:32]
u0:17 <- [u0:26, u0:27, u1:39, u1:40, u1:42, u1:43, u2:55, u2:56, u3:69, u3:70, u4:82, u4:83, u4:84, u4:87]
u0:18 <- [u1:30, u1:31, u1:32, u2:50, u2:52, u2:57, u2:59, u3:64, u3:66, u4:84, u4:88]
u0:22 -> [u0:23]
u0:23 -> [u0:24, u0:26]
u0:23 <- [u0:22]
u0:24 -> [u1:30]
u0:24 <- [u0:23]
u0:25 -> [u1:30]
u0:26 -> [u0:17]
u0:26 <- [u0:23]
u0:27 -> [u0:17]
u1:30 -> [u0:18, u1:32, u1:39, u1:42]
u1:30 <- [u0:24, u0:25, u1:38, u2:50, u2:51, u3:64, u3:65, u4:78, u4:79, u5:92, u5:93]
u1:31 -> [u0:18, u1:32]
u1:32 -> [u0:14, u0:15, u0:18, u1:33, u1:34, u1:35, u1:36, u1:37]
u1:32 <- [u1:30, u1:31, u1:39, u1:41, u2:57, u2:58, u3:71, u3:72, u4:84, u4:85, u5:92]
u1:33 <- [u1:32, u2:57, u3:71, u4:84]
u1:34 <- [u1:32, u1:39, u2:57, u3:71, u4:84, u5:92]
u1:35 <- [u1:32, u1:39, u2:57, u3:71, u4:84, u5:92]
u1:36 <- [u1:32, u1:39, u2:57, u3:71, u4:84, u5:92]
u1:37 <- [u1:32, u2:57, u3:71, u4:84]
u1:38 -> [u1:30]
u1:38 <- [u2:55, u3:69, u4:82, u5:92]
u1:39 -> [u0:17, u1:32, u1:34, u1:35, u1:36]
u1:39 <- [u1:30, u5:92]
u1:40 -> [u0:17]
u1:41 -> [u1:32]
u1:42 -> [u0:17]
u1:42 <- [u1:30]
u1:43 -> [u0:17]
u2:48 -> [u2:50, u2:55]
u2:50 -> [u0:18, u1:30]
u2:50 <- [u2:48]
u2:51 -> [u1:30]
u2:52 -> [u0:18]
u2:55 -> [u0:17, u1:38]
u2:55 <- [u2:48]
u2:56 -> [u0:17]
u2:57 -> [u0:18, u1:32, u1:33, u1:34, u1:35, u1:36, u1:37, u4:78]
u2:58 -> [u1:32]
u2:59 -> [u0:18]
u3:62 -> [u3:64, u3:69]
u3:64 -> [u0:18, u1:30]
u3:64 <- [u3:62]
u3:65 -> [u1:30]
u3:66 -> [u0:18]
u3:69 -> [u0:17, u1:38]
u3:69 <- [u3:62]
u3:70 -> [u0:17]
u3:71 -> [u1:32, u1:33, u1:34, u1:35, u1:36, u1:37, u4:78]
u3:72 -> [u1:32]
u4:76 -> [u4:78, u4:82]
u4:78 -> [u1:30]
u4:78 <- [u2:57, u3:71, u4:76, u4:84]
u4:79 -> [u1:30]
u4:82 -> [u0:17, u1:38]
u4:82 <- [u4:76]
u4:83 -> [u0:17]
u4:84 -> [u0:12, u0:17, u0:18, u1:32, u1:33, u1:34, u1:35, u1:36, u1:37, u4:78]
u4:85 -> [u1:32]
u4:86 -> [u0:12]
u4:87 -> [u0:17]
u4:88 -> [u0:18]
u5:92 -> [u1:30, u1:32, u1:34, u1:35, u1:36, u1:38, u1:39]
u5:93 -> [u1:30]


===============================================================================
shared-state-across-files
===============================================================================
Tests global shared state: OnceLock config accessed from cache and service modules.

--- file: src/lib.rs ---
pub mod config;
pub mod cache;
pub mod service;

--- file: src/config.rs ---
use std::sync::OnceLock;

static CONFIG: OnceLock<AppConfig> = OnceLock::new();

pub struct AppConfig {
    pub database_url: String,
    pub max_connections: u32,
    pub log_level: String,
}

impl AppConfig {
    pub fn init(database_url: String, max_connections: u32, log_level: String) {
        CONFIG.get_or_init(|| AppConfig {
            database_url,
            max_connections,
            log_level,
        });
    }

    pub fn get() -> &'static AppConfig {
        CONFIG.get().expect("Config not initialized")
    }
}

--- file: src/cache.rs ---
use std::collections::HashMap;
use std::sync::RwLock;

static CACHE: RwLock<Option<Cache>> = RwLock::new(None);

pub struct Cache {
    data: HashMap<String, String>,
}

impl Cache {
    pub fn init() {
        let mut lock = CACHE.write().unwrap();
        *lock = Some(Cache { data: HashMap::new() });
    }

    pub fn get(key: &str) -> Option<String> {
        let lock = CACHE.read().unwrap();
        lock.as_ref()?.data.get(key).cloned()
    }

    pub fn set(key: String, value: String) {
        let mut lock = CACHE.write().unwrap();
        if let Some(cache) = lock.as_mut() {
            cache.data.insert(key, value);
        }
    }

    pub fn clear() {
        let mut lock = CACHE.write().unwrap();
        if let Some(cache) = lock.as_mut() {
            cache.data.clear();
        }
    }
}

--- file: src/service.rs ---
use crate::config::AppConfig;
use crate::cache::Cache;

pub struct DataService;

impl DataService {
    pub fn new() -> Self {
        DataService
    }

    pub fn fetch(&self, key: &str) -> String {
        // Check cache first
        if let Some(cached) = Cache::get(key) {
            println!("Cache hit for: {}", key);
            return cached;
        }

        // Fetch from "database"
        let config = AppConfig::get();
        println!("Fetching from database: {} (url: {})", key, config.database_url);

        let value = format!("value_for_{}", key);

        // Store in cache
        Cache::set(key.to_string(), value.clone());

        value
    }
}

--- file: src/main.rs ---
mod config;
mod cache;
mod service;

use config::AppConfig;
use cache::Cache;
use service::DataService;

fn main() {
    // Initialize global state
    AppConfig::init(
        "postgres://localhost/mydb".to_string(),
        10,
        "info".to_string(),
    );
    Cache::init();

    // Use service
    let svc = DataService::new();

    println!("First fetch:");
    println!("  Result: {}", svc.fetch("user_1"));

    println!("\nSecond fetch (should hit cache):");
    println!("  Result: {}", svc.fetch("user_1"));

    println!("\nConfig: log_level = {}", AppConfig::get().log_level);
}

--- expect:symbols ---
u0:1  | Primitive | i32             | i32                                          | [global]
u0:2  | Primitive | i64             | i64                                          | [global]
u0:3  | Primitive | i16             | i16                                          | [global]
u0:4  | Primitive | i8              | i8                                           | [global]
u0:5  | Primitive | i128            | i128                                         | [global]
u0:6  | Primitive | isize           | isize                                        | [global]
u0:7  | Primitive | u32             | u32                                          | [global]
u0:8  | Primitive | u64             | u64                                          | [global]
u0:9  | Primitive | u16             | u16                                          | [global]
u0:10 | Primitive | u8              | u8                                           | [global]
u0:11 | Primitive | u128            | u128                                         | [global]
u0:12 | Primitive | usize           | usize                                        | [global]
u0:13 | Primitive | f32             | f32                                          | [global]
u0:14 | Primitive | f64             | f64                                          | [global]
u0:15 | Primitive | bool            | bool                                         | [global]
u0:16 | Primitive | char            | char                                         | [global]
u0:17 | Primitive | str             | str                                          | [global]
u0:18 | Primitive | String          | String                                       | [global]
u0:19 | Crate     | _c              | _c                                           | [global]
u0:20 | Crate     | crate           | _c::crate                                    |         
u0:21 | File      | lib             | _c::lib                                      |         
u1:22 | Crate     | crate           | _c::crate                                    |         
u1:23 | File      | config          | _c::config                                   |         
u1:24 | Static    | CONFIG          | _c::config::CONFIG                           |         
u1:25 | Struct    | AppConfig       | _c::config::AppConfig                        | [global]
u1:26 | Field     | database_url    | _c::config::AppConfig::database_url          |         
u1:27 | Field     | max_connections | _c::config::AppConfig::max_connections       |         
u1:28 | Field     | log_level       | _c::config::AppConfig::log_level             |         
u1:29 | Function  | init            | _c::config::AppConfig::init                  | [global]
u1:30 | Variable  | database_url    | _c::config::AppConfig::init::database_url    |         
u1:31 | Variable  | max_connections | _c::config::AppConfig::init::max_connections |         
u1:32 | Variable  | log_level       | _c::config::AppConfig::init::log_level       |         
u1:33 | Function  | get             | _c::config::AppConfig::get                   | [global]
u2:34 | Crate     | crate           | _c::crate                                    |         
u2:35 | File      | cache           | _c::cache                                    |         
u2:36 | Static    | CACHE           | _c::cache::CACHE                             |         
u2:37 | Struct    | Cache           | _c::cache::Cache                             | [global]
u2:38 | Field     | data            | _c::cache::Cache::data                       |         
u2:39 | Function  | init            | _c::cache::Cache::init                       | [global]
u2:40 | Variable  | lock            | _c::cache::Cache::init::lock                 |         
u2:41 | Function  | get             | _c::cache::Cache::get                        | [global]
u2:42 | Variable  | key             | _c::cache::Cache::get::key                   |         
u2:43 | Variable  | lock            | _c::cache::Cache::get::lock                  |         
u2:44 | Function  | set             | _c::cache::Cache::set                        | [global]
u2:45 | Variable  | key             | _c::cache::Cache::set::key                   |         
u2:46 | Variable  | value           | _c::cache::Cache::set::value                 |         
u2:47 | Variable  | lock            | _c::cache::Cache::set::lock                  |         
u2:48 | Function  | clear           | _c::cache::Cache::clear                      | [global]
u2:49 | Variable  | lock            | _c::cache::Cache::clear::lock                |         
u3:50 | Crate     | crate           | _c::crate                                    |         
u3:51 | File      | service         | _c::service                                  |         
u3:52 | Struct    | DataService     | _c::service::DataService                     | [global]
u3:53 | Function  | new             | _c::service::DataService::new                | [global]
u3:54 | Function  | fetch           | _c::service::DataService::fetch              | [global]
u3:55 | Variable  | key             | _c::service::DataService::fetch::key         |         
u3:56 | Variable  | config          | _c::service::DataService::fetch::config      |         
u3:57 | Variable  | value           | _c::service::DataService::fetch::value       |         
u4:58 | Crate     | crate           | _c::crate                                    |         
u4:59 | File      | main            | _c::main                                     |         
u4:60 | Function  | main            | _c::main::main                               |         
u4:61 | Variable  | svc             | _c::main::main::svc                          |         

--- expect:symbol-deps ---
u0:17 <- [u2:41, u2:42, u3:54, u3:55, u3:57]
u0:18 <- [u1:25, u1:26, u1:28, u1:29, u1:30, u1:32, u2:37, u2:38, u2:44, u2:45, u2:46]
u0:7 <- [u1:25, u1:27, u1:29, u1:31]
u1:25 -> [u0:18, u0:7, u1:33]
u1:25 <- [u1:29]
u1:26 -> [u0:18]
u1:27 -> [u0:7]
u1:28 -> [u0:18]
u1:29 -> [u0:18, u0:7, u1:25]
u1:29 <- [u4:60]
u1:30 -> [u0:18]
u1:31 -> [u0:7]
u1:32 -> [u0:18]
u1:33 <- [u1:25, u3:54]
u2:37 -> [u0:18, u2:41, u2:44, u2:48]
u2:37 <- [u2:39]
u2:38 -> [u0:18]
u2:39 -> [u2:37]
u2:39 <- [u4:60]
u2:41 -> [u0:17]
u2:41 <- [u2:37, u3:54]
u2:42 -> [u0:17]
u2:44 -> [u0:18]
u2:44 <- [u2:37, u3:54]
u2:45 -> [u0:18]
u2:46 -> [u0:18]
u2:48 <- [u2:37]
u3:52 -> [u3:53, u3:54]
u3:52 <- [u4:60, u4:61]
u3:53 <- [u3:52, u4:60]
u3:54 -> [u0:17, u1:33, u2:41, u2:44]
u3:54 <- [u3:52]
u3:55 -> [u0:17]
u3:57 -> [u0:17]
u4:60 -> [u1:29, u2:39, u3:52, u3:53]
u4:61 -> [u3:52]
