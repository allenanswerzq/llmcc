===============================================================================
call-target-callkind-function-one
===============================================================================


--- file: app/src/main.rs ---
mod helpers {
    pub fn compute() {}
}

fn function_demo() {
    helpers::compute();
}

--- expect:symbols ---
u0:1 | Module   | helpers       | helpers          |
u0:2 | Function | compute       | helpers::compute | [global]
u0:3 | Function | function_demo | function_demo    |

--- expect:symbol-deps ---
u0:1 -> [u0:2]
u0:2 <- [u0:1, u0:3]
u0:3 -> [u0:2]

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="app";
    style=filled;
    color=lightgrey;
    n2 [label="compute", full_path="$TMP/app/src/main.rs:2"];
    n3 [label="function_demo", full_path="$TMP/app/src/main.rs:5"];
  }
  n3 -> n2;
}



===============================================================================
call-target-callkind-function-two
===============================================================================


--- file: app/src/main.rs ---
struct Foo;
struct Baz;
struct SessionBuilder;

impl SessionBuilder {
    fn new() -> Self {
        SessionBuilder
    }
    
    fn static_func() -> Foo {}
}

fn qualified_call(baz: &Baz) {
    SessionBuilder::new();
    let x = SessionBuilder::static_func();
}

--- expect:symbols ---
u0:1 | Struct   | Foo            | Foo                         |
u0:2 | Struct   | Baz            | Baz                         |
u0:3 | Struct   | SessionBuilder | SessionBuilder              |
u0:4 | Function | new            | SessionBuilder::new         |
u0:5 | Function | static_func    | SessionBuilder::static_func |
u0:6 | Function | qualified_call | qualified_call              |
u0:7 | Variable | baz            | qualified_call::baz         |
u0:8 | Variable | x              | qualified_call::x           |

--- expect:symbol-deps ---
u0:1 <- [u0:3, u0:5]
u0:2 -> [u0:6]
u0:3 -> [u0:1, u0:4, u0:5]
u0:3 <- [u0:6]
u0:4 <- [u0:3, u0:6]
u0:5 -> [u0:1]
u0:5 <- [u0:3, u0:6]
u0:6 -> [u0:3, u0:4, u0:5]
u0:6 <- [u0:2]

--- expect:blocks ---
u0:1  | root   | block#1
u0:2  | class  | Foo
u0:3  | class  | Baz
u0:4  | class  | SessionBuilder
u0:5  | impl   | block#5
u0:6  | method | new
u0:7  | method | static_func
u0:8  | func   | qualified_call
u0:9  | call   | block#9
u0:10 | call   | block#10


--- expect:block-deps ---
u0:2 <- [u0:4, u0:7]
u0:3 -> [u0:8]
u0:4 -> [u0:2, u0:6, u0:7]
u0:4 <- [u0:8]
u0:6 <- [u0:4, u0:8]
u0:7 -> [u0:2]
u0:7 <- [u0:4, u0:8]
u0:8 -> [u0:4, u0:6, u0:7]
u0:8 <- [u0:3]


--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="app";
    style=filled;
    color=lightgrey;
    n2 [label="Foo", full_path="$TMP/app/src/main.rs:1"];
    n8 [label="qualified_call", full_path="$TMP/app/src/main.rs:13"];
    n3 [label="Baz", full_path="$TMP/app/src/main.rs:2"];
    n4 [label="SessionBuilder", full_path="$TMP/app/src/main.rs:3"];
  }
  n8 -> n4;
  n3 -> n8;
  n4 -> n2;
}



===============================================================================
call-target-callkind-macro
===============================================================================


--- file: src/main.rs ---
macro_rules! log_value {
    ($value:expr) => {{
        let _captured = $value;
    }};
}

fn macro_demo() {
    log_value!("hi");
}

--- expect:symbols ---
u0:1 | Macro    | log_value  | log_value  | [global]
u0:2 | Function | macro_demo | macro_demo |         

--- expect:symbol-deps ---
u0:1 <- [u0:2]
u0:2 -> [u0:1]




===============================================================================
call-target-callkind-chain-method-callchainroot-invocation
===============================================================================


--- file: app/src/main.rs ---
struct Builder;

impl Builder {
    fn new() -> Self {
        Builder
    }

    fn step(self) -> Self {
        self
    }

    fn finish(self) {}
}

fn chain_invocation_demo() {
    Builder::new().step().finish();
}

--- expect:symbols ---
u0:1 | Struct   | Builder               | Builder               |
u0:2 | Function | new                   | Builder::new          |
u0:3 | Function | step                  | Builder::step         |
u0:4 | Variable | self                  | Builder::step::self   |
u0:5 | Function | finish                | Builder::finish       |
u0:6 | Variable | self                  | Builder::finish::self |
u0:7 | Function | chain_invocation_demo | chain_invocation_demo |

--- expect:symbol-deps ---
u0:1 -> [u0:2, u0:3, u0:5]
u0:1 <- [u0:7]
u0:2 <- [u0:1, u0:7]
u0:3 <- [u0:1, u0:7]
u0:5 <- [u0:1, u0:7]
u0:7 -> [u0:1, u0:2, u0:3, u0:5]


--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="app";
    style=filled;
    color=lightgrey;
    n2 [label="Builder", full_path="$TMP/app/src/main.rs:1"];
    n7 [label="chain_invocation_demo", full_path="$TMP/app/src/main.rs:15"];
  }
  n7 -> n2;
}



===============================================================================
call-target-callkind-chain-method-callchainroot-expr
===============================================================================


--- file: src/main.rs ---
struct Data;
struct Iter;

impl Data {
    fn iter(&self) -> Iter {
        Iter
    }
}

impl Iter {
    fn map(&self) -> Iter {
        Iter
    }

    fn count(&self) -> usize {
        0
    }
}

fn expr_chain() {
    let data = Data::new();
    data.iter().map().count();
}

--- expect:symbols ---
u0:1  | Struct   | Data       | Data              | 
u0:2  | Struct   | Iter       | Iter              | 
u0:3  | Function | iter       | Data::iter        | 
u0:4  | Variable | self       | Data::iter::self  | 
u0:5  | Function | map        | Iter::map         | 
u0:6  | Variable | self       | Iter::map::self   | 
u0:7  | Function | count      | Iter::count       | 
u0:8  | Variable | self       | Iter::count::self | 
u0:9  | Function | expr_chain | expr_chain        | 
u0:10 | Variable | data       | expr_chain::data  | 

--- expect:symbol-deps ---
u0:1 -> [u0:2, u0:3]
u0:1 <- [u0:9]
u0:2 -> [u0:5, u0:7]
u0:2 <- [u0:1, u0:3]
u0:3 -> [u0:2]
u0:3 <- [u0:1]
u0:5 <- [u0:2]
u0:7 <- [u0:2]
u0:9 -> [u0:1, u0:3, u0:5, u0:7]
