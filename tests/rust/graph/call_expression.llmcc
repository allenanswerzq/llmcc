===============================================================================
call-target-callkind-function-one
===============================================================================


--- file: app/src/main.rs ---
mod helpers {
    pub fn compute() {}
}

fn function_demo() {
    helpers::compute();
}

--- expect:symbols ---
u0:1 | Module    | main          | main                         | [global]
u0:2 | File      | main          | main::main                   |         
u0:3 | Namespace | helpers       | main::main::helpers          |         
u0:4 | Function  | compute       | main::main::helpers::compute |         
u0:5 | Function  | function_demo | main::main::function_demo    |         

--- expect:symbol-deps ---
u0:4 <- [u0:5]
u0:5 -> [u0:4]

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="compute", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpdXyRAN/app/src/main.rs:2"];
    n3 [label="function_demo", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpdXyRAN/app/src/main.rs:5"];
  }
  n3 -> n2;
}


===============================================================================
call-target-callkind-function-two
===============================================================================


--- file: app/src/main.rs ---
struct Foo;
struct Baz;
struct SessionBuilder;

impl SessionBuilder {
    fn new() -> Self {
        SessionBuilder
    }

    fn static_func() -> Foo {}
}

fn qualified_call(baz: &Baz) {
    SessionBuilder::new();
    let x = SessionBuilder::static_func();
}

--- expect:symbols ---
u0:1  | Module   | main           | main                                    | [global]
u0:2  | File     | main           | main::main                              |         
u0:3  | Struct   | Foo            | main::main::Foo                         |         
u0:4  | Struct   | Baz            | main::main::Baz                         |         
u0:5  | Impl     | SessionBuilder | main::main::SessionBuilder              |         
u0:6  | Function | new            | main::main::SessionBuilder::new         |         
u0:7  | Function | static_func    | main::main::SessionBuilder::static_func |         
u0:8  | Function | qualified_call | main::main::qualified_call              |         
u0:9  | Variable | baz            | main::main::qualified_call::baz         |         
u0:10 | Variable | x              | main::main::qualified_call::x           |         

--- expect:symbol-deps ---
u0:3 <- [u0:7]
u0:4 <- [u0:8, u0:9]
u0:6 <- [u0:8]
u0:7 -> [u0:3]
u0:7 <- [u0:8]
u0:8 -> [u0:4, u0:6, u0:7]
u0:9 -> [u0:4]

--- expect:blocks ---
u0:1  | root   | main          
u0:2  | class  | Foo           
u0:3  | class  | Baz           
u0:4  | class  | SessionBuilder
u0:5  | impl   | SessionBuilder
u0:6  | method | new           
u0:7  | method | static_func   
u0:8  | func   | qualified_call
u0:9  | call   | block#9       
u0:10 | call   | block#10      

--- expect:block-deps ---
u0:2 <- [u0:7]
u0:3 <- [u0:8]
u0:6 <- [u0:8]
u0:7 -> [u0:2]
u0:7 <- [u0:8]
u0:8 -> [u0:3, u0:6, u0:7]

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n8 [label="qualified_call", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpCyp9T7/app/src/main.rs:13"];
    n3 [label="Baz", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpCyp9T7/app/src/main.rs:2"];
  }
  n8 -> n3;
}


===============================================================================
call-target-callkind-macro
===============================================================================


--- file: src/main.rs ---
macro_rules! log_value {
    ($value:expr) => {{
        let _captured = $value;
    }};
}

fn macro_demo() {
    log_value!("hi");
}

--- expect:symbols ---
u0:1 | Module   | main       | main                   | [global]
u0:2 | File     | main       | main::main             |         
u0:3 | Macro    | log_value  | main::main::log_value  |         
u0:4 | Function | macro_demo | main::main::macro_demo |         

--- expect:symbol-deps ---
u0:3 <- [u0:4]
u0:4 -> [u0:3]


===============================================================================
call-target-callkind-chain-method-callchainroot-invocation
===============================================================================


--- file: app/src/main.rs ---
struct Builder;

impl Builder {
    fn new() -> Self {
        Builder
    }

    fn step(self) -> Self {
        self
    }

    fn finish(self) {}
}

fn chain_invocation_demo() {
    Builder::new().step().finish();
}

--- expect:symbols ---
u0:1 | Module   | main                  | main                              | [global]
u0:2 | File     | main                  | main::main                        |         
u0:3 | Impl     | Builder               | main::main::Builder               |         
u0:4 | Function | new                   | main::main::Builder::new          |         
u0:5 | Function | step                  | main::main::Builder::step         |         
u0:6 | Function | finish                | main::main::Builder::finish       |         
u0:7 | Function | chain_invocation_demo | main::main::chain_invocation_demo |         

--- expect:symbol-deps ---
u0:4 <- [u0:7]
u0:5 <- [u0:7]
u0:6 <- [u0:7]
u0:7 -> [u0:4, u0:5, u0:6]

--- expect:graph ---
digraph project {
}


===============================================================================
call-target-callkind-chain-method-callchainroot-expr
===============================================================================


--- file: app/src/main.rs ---
struct Data;
struct Iter;

impl Data {
    fn iter(&self) -> Iter {
        Iter
    }
}

impl Iter {
    fn map(&self) -> Iter {
        Iter
    }

    fn count(&self) -> usize {
        0
    }
}

fn expr_chain() {
    let data = Data::new();
    data.iter().map().count();
}

--- expect:symbols ---
u0:1 | Module   | main       | main                         | [global]
u0:2 | File     | main       | main::main                   |         
u0:3 | Impl     | Data       | main::main::Data             |         
u0:4 | Impl     | Iter       | main::main::Iter             |         
u0:5 | Function | iter       | main::main::Data::iter       |         
u0:6 | Function | map        | main::main::Iter::map        |         
u0:7 | Function | count      | main::main::Iter::count      |         
u0:8 | Function | expr_chain | main::main::expr_chain       |         
u0:9 | Variable | data       | main::main::expr_chain::data |         

--- expect:symbol-deps ---
u0:4 <- [u0:5, u0:6]
u0:5 -> [u0:4]
u0:5 <- [u0:8]
u0:6 -> [u0:4]
u0:6 <- [u0:8]
u0:7 <- [u0:8]
u0:8 -> [u0:5, u0:6, u0:7]

--- expect:blocks ---
u0:1  | root   | main      
u0:2  | class  | Data      
u0:3  | class  | Iter      
u0:4  | impl   | Data      
u0:5  | method | iter      
u0:6  | impl   | Iter      
u0:7  | method | map       
u0:8  | method | count     
u0:9  | func   | expr_chain
u0:10 | call   | block#10  
u0:11 | call   | block#11  

--- expect:graph ---
digraph project {
}


===============================================================================
call-target-callkind-chain-variable
===============================================================================


--- file: app/src/main.rs ---
struct Stream;

impl Stream {
    fn advance(&mut self) -> &mut Self {
        self
    }

    fn flush(&self) {}
}

fn chain_variable_demo(mut stream: Stream) {
    let cursor = stream.advance();
    cursor.flush();
}

--- expect:symbols ---
u0:1 | Module   | main                | main                                    | [global]
u0:2 | File     | main                | main::main                              |         
u0:3 | Impl     | Stream              | main::main::Stream                      |         
u0:4 | Function | advance             | main::main::Stream::advance             |         
u0:5 | Function | flush               | main::main::Stream::flush               |         
u0:6 | Function | chain_variable_demo | main::main::chain_variable_demo         |         
u0:7 | Variable | stream              | main::main::chain_variable_demo::stream |         
u0:8 | Variable | cursor              | main::main::chain_variable_demo::cursor |         

--- expect:symbol-deps ---
u0:3 <- [u0:6, u0:7]
u0:4 <- [u0:6]
u0:5 <- [u0:6]
u0:6 -> [u0:3, u0:4, u0:5]
u0:7 -> [u0:3]

--- expect:blocks ---
u0:1 | root   | main               
u0:2 | class  | Stream             
u0:3 | impl   | Stream             
u0:4 | method | advance            
u0:5 | method | flush              
u0:6 | func   | chain_variable_demo
u0:7 | call   | block#7            
u0:8 | call   | block#8            

--- expect:block-deps ---
u0:2 <- [u0:6]
u0:4 <- [u0:6]
u0:5 <- [u0:6]
u0:6 -> [u0:2, u0:4, u0:5]

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Stream", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpJiw0jU/app/src/main.rs:1"];
    n6 [label="chain_variable_demo", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpJiw0jU/app/src/main.rs:11"];
  }
  n6 -> n2;
}
