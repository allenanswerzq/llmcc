===============================================================================
layered-architecture-basic
===============================================================================
Tests 3-layer architecture: data layer (entities/repository), service layer (business logic), api layer (handlers).

--- file: src/lib.rs ---
pub mod data;
pub mod service;
pub mod api;

--- file: src/data/mod.rs ---
mod entity;
mod repository;

pub use entity::User;
pub use repository::UserRepository;

--- file: src/data/entity.rs ---
#[derive(Clone, Debug)]
pub struct User {
    pub id: u64,
    pub email: String,
    pub password_hash: String,
}

--- file: src/data/repository.rs ---
use super::entity::User;
use std::collections::HashMap;

pub struct UserRepository {
    storage: HashMap<u64, User>,
    next_id: u64,
}

impl UserRepository {
    pub fn new() -> Self {
        UserRepository { storage: HashMap::new(), next_id: 1 }
    }

    pub fn find_by_id(&self, id: u64) -> Option<User> {
        self.storage.get(&id).cloned()
    }

    pub fn find_by_email(&self, email: &str) -> Option<User> {
        self.storage.values().find(|u| u.email == email).cloned()
    }

    pub fn insert(&mut self, email: String, password_hash: String) -> User {
        let user = User { id: self.next_id, email, password_hash };
        self.next_id += 1;
        self.storage.insert(user.id, user.clone());
        user
    }
}

--- file: src/service/mod.rs ---
mod user_service;
mod auth_service;

pub use user_service::UserService;
pub use auth_service::AuthService;

--- file: src/service/user_service.rs ---
use crate::data::{User, UserRepository};

pub struct UserService {
    repo: UserRepository,
}

impl UserService {
    pub fn new(repo: UserRepository) -> Self {
        UserService { repo }
    }

    pub fn get_user(&self, id: u64) -> Option<User> {
        self.repo.find_by_id(id)
    }

    pub fn create_user(&mut self, email: String, password: String) -> User {
        let hash = format!("hashed:{}", password);  // Simplified
        self.repo.insert(email, hash)
    }
}

--- file: src/service/auth_service.rs ---
use crate::data::{User, UserRepository};

pub struct AuthService {
    repo: UserRepository,
}

impl AuthService {
    pub fn new(repo: UserRepository) -> Self {
        AuthService { repo }
    }

    pub fn authenticate(&self, email: &str, password: &str) -> Option<User> {
        let user = self.repo.find_by_email(email)?;
        let expected_hash = format!("hashed:{}", password);
        if user.password_hash == expected_hash {
            Some(user)
        } else {
            None
        }
    }
}

--- file: src/api/mod.rs ---
mod handlers;
mod dto;

pub use handlers::*;
pub use dto::*;

--- file: src/api/dto.rs ---
use crate::data::User;

pub struct UserDto {
    pub id: u64,
    pub email: String,
}

impl From<User> for UserDto {
    fn from(user: User) -> Self {
        UserDto { id: user.id, email: user.email }
    }
}

pub struct CreateUserRequest {
    pub email: String,
    pub password: String,
}

pub struct LoginRequest {
    pub email: String,
    pub password: String,
}

--- file: src/api/handlers.rs ---
use crate::service::{UserService, AuthService};
use super::dto::{UserDto, CreateUserRequest, LoginRequest};

pub fn handle_get_user(service: &UserService, id: u64) -> Option<UserDto> {
    service.get_user(id).map(UserDto::from)
}

pub fn handle_create_user(service: &mut UserService, req: CreateUserRequest) -> UserDto {
    let user = service.create_user(req.email, req.password);
    UserDto::from(user)
}

pub fn handle_login(service: &AuthService, req: LoginRequest) -> Option<UserDto> {
    service.authenticate(&req.email, &req.password).map(UserDto::from)
}

--- file: src/main.rs ---
mod data;
mod service;
mod api;

use data::UserRepository;
use service::{UserService, AuthService};
use api::{handle_create_user, handle_get_user, CreateUserRequest};

fn main() {
    let repo = UserRepository::new();
    let mut user_service = UserService::new(repo);

    let req = CreateUserRequest {
        email: "alice@example.com".to_string(),
        password: "secret".to_string(),
    };

    let created = handle_create_user(&mut user_service, req);
    println!("Created user: {} (id={})", created.email, created.id);

    if let Some(found) = handle_get_user(&user_service, created.id) {
        println!("Found user: {}", found.email);
    }
}

--- expect:symbols ---
u0:1 | Primitive | i32 | i32 | [global]
u0:2 | Primitive | i64 | i64 | [global]
u0:3 | Primitive | i16 | i16 | [global]
u0:4 | Primitive | i8 | i8 | [global]
u0:5 | Primitive | i128 | i128 | [global]
u0:6 | Primitive | isize | isize | [global]
u0:7 | Primitive | u32 | u32 | [global]
u0:8 | Primitive | u64 | u64 | [global]
u0:9 | Primitive | u16 | u16 | [global]
u0:10 | Primitive | u8 | u8 | [global]
u0:11 | Primitive | u128 | u128 | [global]
u0:12 | Primitive | usize | usize | [global]
u0:13 | Primitive | f32 | f32 | [global]
u0:14 | Primitive | f64 | f64 | [global]
u0:15 | Primitive | bool | bool | [global]
u0:16 | Primitive | char | char | [global]
u0:17 | Primitive | str | str | [global]
u0:18 | Primitive | String | String | [global]
u0:19 | Crate | _c | _c | [global]
u0:20 | Crate | crate | _c::crate |
u0:21 | File | lib | _c::lib |
u1:22 | Crate | crate | _c::crate |
u1:23 | File | main | _c::main |
u1:24 | Function | main | _c::main::main |
u1:25 | Variable | repo | _c::main::main::repo |
u1:26 | Variable | user_service | _c::main::main::user_service |
u1:27 | Variable | req | _c::main::main::req |
u1:28 | Variable | created | _c::main::main::created |
u2:29 | Crate | crate | _c::crate |
u2:30 | Module | api | _c::api |
u2:31 | File | mod | _c::api::mod |
u3:32 | Crate | crate | _c::crate |
u3:33 | Module | api | _c::api |
u3:34 | File | dto | _c::api::dto |
u3:35 | Struct | UserDto | _c::api::dto::UserDto | [global]
u3:36 | Field | id | _c::api::dto::UserDto::id |
u3:37 | Field | email | _c::api::dto::UserDto::email |
u3:38 | UnresolvedType | From | _c::api::dto::From |
u3:39 | Function | from | _c::api::dto::UserDto::from |
u3:40 | Variable | user | _c::api::dto::UserDto::from::user |
u3:41 | Struct | CreateUserRequest | _c::api::dto::CreateUserRequest | [global]
u3:42 | Field | email | _c::api::dto::CreateUserRequest::email |
u3:43 | Field | password | _c::api::dto::CreateUserRequest::password |
u3:44 | Struct | LoginRequest | _c::api::dto::LoginRequest | [global]
u3:45 | Field | email | _c::api::dto::LoginRequest::email |
u3:46 | Field | password | _c::api::dto::LoginRequest::password |
u4:47 | Crate | crate | _c::crate |
u4:48 | Module | api | _c::api |
u4:49 | File | handlers | _c::api::handlers |
u4:50 | Function | handle_get_user | _c::api::handlers::handle_get_user | [global]
u4:51 | Variable | service | _c::api::handlers::handle_get_user::service |
u4:52 | Variable | id | _c::api::handlers::handle_get_user::id |
u4:53 | Function | handle_create_user | _c::api::handlers::handle_create_user | [global]
u4:54 | Variable | service | _c::api::handlers::handle_create_user::service |
u4:55 | Variable | req | _c::api::handlers::handle_create_user::req |
u4:56 | Variable | user | _c::api::handlers::handle_create_user::user |
u4:57 | Function | handle_login | _c::api::handlers::handle_login | [global]
u4:58 | Variable | service | _c::api::handlers::handle_login::service |
u4:59 | Variable | req | _c::api::handlers::handle_login::req |
u5:60 | Crate | crate | _c::crate |
u5:61 | Module | data | _c::data |
u5:62 | File | mod | _c::data::mod |
u6:63 | Crate | crate | _c::crate |
u6:64 | Module | data | _c::data |
u6:65 | File | entity | _c::data::entity |
u6:66 | Struct | User | _c::data::entity::User | [global]
u6:67 | Field | id | _c::data::entity::User::id |
u6:68 | Field | email | _c::data::entity::User::email |
u6:69 | Field | password_hash | _c::data::entity::User::password_hash |
u7:70 | Crate | crate | _c::crate |
u7:71 | Module | data | _c::data |
u7:72 | File | repository | _c::data::repository |
u7:73 | Struct | UserRepository | _c::data::repository::UserRepository | [global]
u7:74 | Field | storage | _c::data::repository::UserRepository::storage |
u7:75 | Field | next_id | _c::data::repository::UserRepository::next_id |
u7:76 | Function | new | _c::data::repository::UserRepository::new | [global]
u7:77 | Function | find_by_id | _c::data::repository::UserRepository::find_by_id | [global]
u7:78 | Variable | id | _c::data::repository::UserRepository::find_by_id::id |
u7:79 | Function | find_by_email | _c::data::repository::UserRepository::find_by_email | [global]
u7:80 | Variable | email | _c::data::repository::UserRepository::find_by_email::email |
u7:81 | Variable | u | _c::data::repository::UserRepository::find_by_email::u |
u7:82 | Function | insert | _c::data::repository::UserRepository::insert | [global]
u7:83 | Variable | email | _c::data::repository::UserRepository::insert::email |
u7:84 | Variable | password_hash | _c::data::repository::UserRepository::insert::password_hash |
u7:85 | Variable | user | _c::data::repository::UserRepository::insert::user |
u8:86 | Crate | crate | _c::crate |
u8:87 | Module | service | _c::service |
u8:88 | File | mod | _c::service::mod |
u9:89 | Crate | crate | _c::crate |
u9:90 | Module | service | _c::service |
u9:91 | File | user_service | _c::service::user_service |
u9:92 | Struct | UserService | _c::service::user_service::UserService | [global]
u9:93 | Field | repo | _c::service::user_service::UserService::repo |
u9:94 | Function | new | _c::service::user_service::UserService::new | [global]
u9:95 | Variable | repo | _c::service::user_service::UserService::new::repo |
u9:96 | Function | get_user | _c::service::user_service::UserService::get_user | [global]
u9:97 | Variable | id | _c::service::user_service::UserService::get_user::id |
u9:98 | Function | create_user | _c::service::user_service::UserService::create_user | [global]
u9:99 | Variable | email | _c::service::user_service::UserService::create_user::email |
u9:100 | Variable | password | _c::service::user_service::UserService::create_user::password |
u9:101 | Variable | hash | _c::service::user_service::UserService::create_user::hash |
u10:102 | Crate | crate | _c::crate |
u10:103 | Module | service | _c::service |
u10:104 | File | auth_service | _c::service::auth_service |
u10:105 | Struct | AuthService | _c::service::auth_service::AuthService | [global]
u10:106 | Field | repo | _c::service::auth_service::AuthService::repo |
u10:107 | Function | new | _c::service::auth_service::AuthService::new | [global]
u10:108 | Variable | repo | _c::service::auth_service::AuthService::new::repo |
u10:109 | Function | authenticate | _c::service::auth_service::AuthService::authenticate | [global]
u10:110 | Variable | email | _c::service::auth_service::AuthService::authenticate::email |
u10:111 | Variable | password | _c::service::auth_service::AuthService::authenticate::password |
u10:112 | Variable | user | _c::service::auth_service::AuthService::authenticate::user |
u10:113 | Variable | expected_hash | _c::service::auth_service::AuthService::authenticate::expected_hash |

--- expect:symbol-deps ---
u0:17 <- [u10:109, u10:109, u10:110, u10:111, u10:113, u7:79, u7:79, u7:80, u9:101, u9:98]
u0:18 <- [u3:35, u3:37, u3:41, u3:42, u3:43, u3:44, u3:45, u3:46, u6:66, u6:68, u6:69, u7:82, u7:83, u7:84, u9:100, u9:98, u9:99]
u0:8 <- [u3:35, u3:35, u3:36, u4:50, u4:50, u4:52, u6:66, u6:66, u6:67, u7:73, u7:73, u7:75, u7:77, u7:77, u7:78, u9:96, u9:96, u9:97]
u10:105 -> [u10:109, u7:73]
u10:105 <- [u10:107, u10:107, u4:57, u4:58]
u10:106 -> [u7:73]
u10:107 -> [u10:105, u10:105, u7:73]
u10:108 -> [u7:73]
u10:109 -> [u0:17, u0:17, u7:73, u7:79]
u10:109 <- [u10:105, u4:57]
u10:110 -> [u0:17]
u10:111 -> [u0:17]
u10:112 -> [u7:73]
u10:113 -> [u0:17]
u1:24 -> [u3:41, u4:50, u4:53, u4:53, u7:73, u7:76, u9:92, u9:94]
u1:27 -> [u3:41]
u1:28 -> [u4:53]
u3:35 -> [u0:18, u0:8, u0:8]
u3:35 <- [u3:39, u3:39, u4:53]
u3:36 -> [u0:8]
u3:37 -> [u0:18]
u3:39 -> [u3:35, u3:35, u6:66]
u3:39 <- [u4:53]
u3:40 -> [u6:66]
u3:41 -> [u0:18]
u3:41 <- [u1:24, u1:27, u4:53, u4:55]
u3:42 -> [u0:18]
u3:43 -> [u0:18]
u3:44 -> [u0:18]
u3:44 <- [u4:57, u4:59]
u3:45 -> [u0:18]
u3:46 -> [u0:18]
u4:50 -> [u0:8, u0:8, u9:92, u9:96]
u4:50 <- [u1:24]
u4:51 -> [u9:92]
u4:52 -> [u0:8]
u4:53 -> [u3:35, u3:39, u3:41, u9:92, u9:92, u9:98]
u4:53 <- [u1:24, u1:24, u1:28]
u4:54 -> [u9:92]
u4:55 -> [u3:41]
u4:56 -> [u9:92]
u4:57 -> [u10:105, u10:109, u3:44]
u4:58 -> [u10:105]
u4:59 -> [u3:44]
u6:66 -> [u0:18, u0:8, u0:8]
u6:66 <- [u3:39, u3:40, u7:73, u7:74, u7:82, u7:85]
u6:67 -> [u0:8]
u6:68 -> [u0:18]
u6:69 -> [u0:18]
u7:73 -> [u0:8, u0:8, u6:66, u7:77, u7:79, u7:82]
u7:73 <- [u10:105, u10:106, u10:107, u10:108, u10:109, u10:112, u1:24, u7:76, u7:76, u9:92, u9:93, u9:94, u9:95]
u7:74 -> [u6:66]
u7:75 -> [u0:8]
u7:76 -> [u7:73, u7:73]
u7:76 <- [u1:24]
u7:77 -> [u0:8, u0:8]
u7:77 <- [u7:73, u9:96]
u7:78 -> [u0:8]
u7:79 -> [u0:17, u0:17]
u7:79 <- [u10:109, u7:73]
u7:80 -> [u0:17]
u7:82 -> [u0:18, u6:66]
u7:82 <- [u7:73, u9:98]
u7:83 -> [u0:18]
u7:84 -> [u0:18]
u7:85 -> [u6:66]
u9:100 -> [u0:18]
u9:101 -> [u0:17]
u9:92 -> [u7:73, u9:96, u9:98]
u9:92 <- [u1:24, u4:50, u4:51, u4:53, u4:53, u4:54, u4:56, u9:94, u9:94]
u9:93 -> [u7:73]
u9:94 -> [u7:73, u9:92, u9:92]
u9:94 <- [u1:24]
u9:95 -> [u7:73]
u9:96 -> [u0:8, u0:8, u7:77]
u9:96 <- [u4:50, u9:92]
u9:97 -> [u0:8]
u9:98 -> [u0:17, u0:18, u7:82]
u9:98 <- [u4:53, u9:92]
u9:99 -> [u0:18]

--- expect:dep-graph ---
digraph project {
  graph [fontname="Helvetica Bold", fontsize=12];

  subgraph cluster_0 {
    label="_c";
    subgraph cluster_1 {
      label="api";
      style="filled";
      fillcolor="#EEEEEE";
      color="#616161";
      n9[label="CreateUserRequest", full_path="$TMP/src/api/dto.rs:14"];
      n10[label="LoginRequest", full_path="$TMP/src/api/dto.rs:19"];
      n6[label="UserDto", full_path="$TMP/src/api/dto.rs:3"];
      n14[label="handle_login", full_path="$TMP/src/api/handlers.rs:13"];
      n12[label="handle_get_user", full_path="$TMP/src/api/handlers.rs:4"];
      n13[label="handle_create_user", full_path="$TMP/src/api/handlers.rs:8"];
    }
    subgraph cluster_2 {
      label="data";
      style="filled";
      fillcolor="#EEEEEE";
      color="#616161";
      n17[label="User", full_path="$TMP/src/data/entity.rs:2"];
      n19[label="UserRepository", full_path="$TMP/src/data/repository.rs:4"];
    }
    subgraph cluster_3 {
      label="main";
      style="filled";
      fillcolor="#EEEEEE";
      color="#616161";
      n3[label="main", full_path="$TMP/src/main.rs:9"];
    }
    subgraph cluster_4 {
      label="service";
      style="filled";
      fillcolor="#EEEEEE";
      color="#616161";
      n33[label="AuthService", full_path="$TMP/src/service/auth_service.rs:3"];
      n27[label="UserService", full_path="$TMP/src/service/user_service.rs:3"];
    }
  }

  // Edges
  n3 -> n12;
  n3 -> n13;
  n14 -> n10;
  n14 -> n33;
  n12 -> n27;
  n13 -> n9;
  n13 -> n6;
  n13 -> n27;
  n19 -> n17;
  n27 -> n19;
  n33 -> n19;
}


===============================================================================
hexagonal-architecture
===============================================================================
Tests hexagonal (ports & adapters) architecture: domain core, ports (traits), adapters (implementations).

--- file: src/lib.rs ---
pub mod domain;
pub mod ports;
pub mod adapters;
pub mod application;

--- file: src/domain/mod.rs ---
mod order;
mod product;

pub use order::{Order, OrderStatus};
pub use product::Product;

--- file: src/domain/product.rs ---
#[derive(Clone)]
pub struct Product {
    pub id: u64,
    pub name: String,
    pub price: f64,
    pub stock: u32,
}

--- file: src/domain/order.rs ---
use super::product::Product;

#[derive(Clone, PartialEq)]
pub enum OrderStatus {
    Pending,
    Confirmed,
    Shipped,
    Delivered,
}

#[derive(Clone)]
pub struct Order {
    pub id: u64,
    pub products: Vec<(Product, u32)>,  // (product, quantity)
    pub status: OrderStatus,
}

impl Order {
    pub fn new(id: u64) -> Self {
        Order { id, products: Vec::new(), status: OrderStatus::Pending }
    }

    pub fn add_product(&mut self, product: Product, quantity: u32) {
        self.products.push((product, quantity));
    }

    pub fn total(&self) -> f64 {
        self.products.iter().map(|(p, q)| p.price * *q as f64).sum()
    }

    pub fn confirm(&mut self) {
        self.status = OrderStatus::Confirmed;
    }
}

--- file: src/ports/mod.rs ---
mod inbound;
mod outbound;

pub use inbound::*;
pub use outbound::*;

--- file: src/ports/inbound.rs ---
use crate::domain::{Order, Product};

// Inbound port - what the application offers
pub trait OrderUseCase {
    fn create_order(&mut self) -> Order;
    fn add_to_order(&mut self, order_id: u64, product_id: u64, quantity: u32) -> bool;
    fn confirm_order(&mut self, order_id: u64) -> bool;
    fn get_order(&self, order_id: u64) -> Option<Order>;
}

pub trait ProductUseCase {
    fn get_product(&self, id: u64) -> Option<Product>;
    fn list_products(&self) -> Vec<Product>;
}

--- file: src/ports/outbound.rs ---
use crate::domain::{Order, Product};

// Outbound port - what the application needs
pub trait OrderRepository {
    fn save(&mut self, order: Order) -> u64;
    fn find_by_id(&self, id: u64) -> Option<Order>;
    fn update(&mut self, order: Order) -> bool;
}

pub trait ProductRepository {
    fn find_by_id(&self, id: u64) -> Option<Product>;
    fn find_all(&self) -> Vec<Product>;
}

pub trait NotificationService {
    fn notify_order_confirmed(&self, order: &Order);
}

--- file: src/adapters/mod.rs ---
mod memory_order_repo;
mod memory_product_repo;
mod email_notification;

pub use memory_order_repo::InMemoryOrderRepo;
pub use memory_product_repo::InMemoryProductRepo;
pub use email_notification::EmailNotification;

--- file: src/adapters/memory_order_repo.rs ---
use crate::domain::Order;
use crate::ports::OrderRepository;
use std::collections::HashMap;

pub struct InMemoryOrderRepo {
    orders: HashMap<u64, Order>,
    next_id: u64,
}

impl InMemoryOrderRepo {
    pub fn new() -> Self {
        InMemoryOrderRepo { orders: HashMap::new(), next_id: 1 }
    }
}

impl OrderRepository for InMemoryOrderRepo {
    fn save(&mut self, mut order: Order) -> u64 {
        order.id = self.next_id;
        self.next_id += 1;
        let id = order.id;
        self.orders.insert(id, order);
        id
    }

    fn find_by_id(&self, id: u64) -> Option<Order> {
        self.orders.get(&id).cloned()
    }

    fn update(&mut self, order: Order) -> bool {
        if self.orders.contains_key(&order.id) {
            self.orders.insert(order.id, order);
            true
        } else {
            false
        }
    }
}

--- file: src/adapters/memory_product_repo.rs ---
use crate::domain::Product;
use crate::ports::ProductRepository;
use std::collections::HashMap;

pub struct InMemoryProductRepo {
    products: HashMap<u64, Product>,
}

impl InMemoryProductRepo {
    pub fn new() -> Self {
        let mut products = HashMap::new();
        products.insert(1, Product { id: 1, name: "Widget".to_string(), price: 9.99, stock: 100 });
        products.insert(2, Product { id: 2, name: "Gadget".to_string(), price: 19.99, stock: 50 });
        InMemoryProductRepo { products }
    }
}

impl ProductRepository for InMemoryProductRepo {
    fn find_by_id(&self, id: u64) -> Option<Product> {
        self.products.get(&id).cloned()
    }

    fn find_all(&self) -> Vec<Product> {
        self.products.values().cloned().collect()
    }
}

--- file: src/adapters/email_notification.rs ---
use crate::domain::Order;
use crate::ports::NotificationService;

pub struct EmailNotification;

impl NotificationService for EmailNotification {
    fn notify_order_confirmed(&self, order: &Order) {
        println!("Email: Order {} confirmed, total: ${:.2}", order.id, order.total());
    }
}

--- file: src/application/mod.rs ---
mod order_service;

pub use order_service::OrderService;

--- file: src/application/order_service.rs ---
use crate::domain::Order;
use crate::ports::{OrderUseCase, OrderRepository, ProductRepository, NotificationService};

pub struct OrderService<O: OrderRepository, P: ProductRepository, N: NotificationService> {
    order_repo: O,
    product_repo: P,
    notification: N,
}

impl<O: OrderRepository, P: ProductRepository, N: NotificationService> OrderService<O, P, N> {
    pub fn new(order_repo: O, product_repo: P, notification: N) -> Self {
        OrderService { order_repo, product_repo, notification }
    }
}

impl<O: OrderRepository, P: ProductRepository, N: NotificationService> OrderUseCase for OrderService<O, P, N> {
    fn create_order(&mut self) -> Order {
        let order = Order::new(0);
        let id = self.order_repo.save(order);
        self.order_repo.find_by_id(id).unwrap()
    }

    fn add_to_order(&mut self, order_id: u64, product_id: u64, quantity: u32) -> bool {
        let product = match self.product_repo.find_by_id(product_id) {
            Some(p) => p,
            None => return false,
        };

        let mut order = match self.order_repo.find_by_id(order_id) {
            Some(o) => o,
            None => return false,
        };

        order.add_product(product, quantity);
        self.order_repo.update(order)
    }

    fn confirm_order(&mut self, order_id: u64) -> bool {
        let mut order = match self.order_repo.find_by_id(order_id) {
            Some(o) => o,
            None => return false,
        };

        order.confirm();
        self.notification.notify_order_confirmed(&order);
        self.order_repo.update(order)
    }

    fn get_order(&self, order_id: u64) -> Option<Order> {
        self.order_repo.find_by_id(order_id)
    }
}

--- file: src/main.rs ---
mod domain;
mod ports;
mod adapters;
mod application;

use adapters::{InMemoryOrderRepo, InMemoryProductRepo, EmailNotification};
use application::OrderService;
use ports::OrderUseCase;

fn main() {
    let order_repo = InMemoryOrderRepo::new();
    let product_repo = InMemoryProductRepo::new();
    let notification = EmailNotification;

    let mut service = OrderService::new(order_repo, product_repo, notification);

    let order = service.create_order();
    service.add_to_order(order.id, 1, 2);  // 2 Widgets
    service.add_to_order(order.id, 2, 1);  // 1 Gadget
    service.confirm_order(order.id);

    if let Some(confirmed) = service.get_order(order.id) {
        println!("Order {} confirmed, total: ${:.2}", confirmed.id, confirmed.total());
    }
}

--- expect:symbols ---
u0:1 | Primitive | i32 | i32 | [global]
u0:2 | Primitive | i64 | i64 | [global]
u0:3 | Primitive | i16 | i16 | [global]
u0:4 | Primitive | i8 | i8 | [global]
u0:5 | Primitive | i128 | i128 | [global]
u0:6 | Primitive | isize | isize | [global]
u0:7 | Primitive | u32 | u32 | [global]
u0:8 | Primitive | u64 | u64 | [global]
u0:9 | Primitive | u16 | u16 | [global]
u0:10 | Primitive | u8 | u8 | [global]
u0:11 | Primitive | u128 | u128 | [global]
u0:12 | Primitive | usize | usize | [global]
u0:13 | Primitive | f32 | f32 | [global]
u0:14 | Primitive | f64 | f64 | [global]
u0:15 | Primitive | bool | bool | [global]
u0:16 | Primitive | char | char | [global]
u0:17 | Primitive | str | str | [global]
u0:18 | Primitive | String | String | [global]
u0:19 | Crate | _c | _c | [global]
u0:20 | Crate | crate | _c::crate |
u0:21 | File | lib | _c::lib |
u1:22 | Crate | crate | _c::crate |
u1:23 | File | main | _c::main |
u1:24 | Function | main | _c::main::main |
u1:25 | Variable | order_repo | _c::main::main::order_repo |
u1:26 | Variable | product_repo | _c::main::main::product_repo |
u1:27 | Variable | notification | _c::main::main::notification |
u1:28 | Variable | service | _c::main::main::service |
u1:29 | Variable | order | _c::main::main::order |
u2:30 | Crate | crate | _c::crate |
u2:31 | Module | adapters | _c::adapters |
u2:32 | File | mod | _c::adapters::mod |
u3:33 | Crate | crate | _c::crate |
u3:34 | Module | adapters | _c::adapters |
u3:35 | File | memory_order_repo | _c::adapters::memory_order_repo |
u3:36 | Struct | InMemoryOrderRepo | _c::adapters::memory_order_repo::InMemoryOrderRepo | [global]
u3:37 | Field | orders | _c::adapters::memory_order_repo::InMemoryOrderRepo::orders |
u3:38 | Field | next_id | _c::adapters::memory_order_repo::InMemoryOrderRepo::next_id |
u3:39 | Function | new | _c::adapters::memory_order_repo::InMemoryOrderRepo::new | [global]
u3:40 | UnresolvedType | OrderRepository | _c::adapters::memory_order_repo::OrderRepository |
u3:41 | Function | save | _c::adapters::memory_order_repo::InMemoryOrderRepo::save |
u3:42 | Variable | order | _c::adapters::memory_order_repo::InMemoryOrderRepo::save::order |
u3:43 | Variable | id | _c::adapters::memory_order_repo::InMemoryOrderRepo::save::id |
u3:44 | Function | find_by_id | _c::adapters::memory_order_repo::InMemoryOrderRepo::find_by_id |
u3:45 | Variable | id | _c::adapters::memory_order_repo::InMemoryOrderRepo::find_by_id::id |
u3:46 | Function | update | _c::adapters::memory_order_repo::InMemoryOrderRepo::update |
u3:47 | Variable | order | _c::adapters::memory_order_repo::InMemoryOrderRepo::update::order |
u4:48 | Crate | crate | _c::crate |
u4:49 | Module | adapters | _c::adapters |
u4:50 | File | memory_product_repo | _c::adapters::memory_product_repo |
u4:51 | Struct | InMemoryProductRepo | _c::adapters::memory_product_repo::InMemoryProductRepo | [global]
u4:52 | Field | products | _c::adapters::memory_product_repo::InMemoryProductRepo::products |
u4:53 | Function | new | _c::adapters::memory_product_repo::InMemoryProductRepo::new | [global]
u4:54 | Variable | products | _c::adapters::memory_product_repo::InMemoryProductRepo::new::products |
u4:55 | UnresolvedType | ProductRepository | _c::adapters::memory_product_repo::ProductRepository |
u4:56 | Function | find_by_id | _c::adapters::memory_product_repo::InMemoryProductRepo::find_by_id |
u4:57 | Variable | id | _c::adapters::memory_product_repo::InMemoryProductRepo::find_by_id::id |
u4:58 | Function | find_all | _c::adapters::memory_product_repo::InMemoryProductRepo::find_all |
u5:59 | Crate | crate | _c::crate |
u5:60 | Module | adapters | _c::adapters |
u5:61 | File | email_notification | _c::adapters::email_notification |
u5:62 | Struct | EmailNotification | _c::adapters::email_notification::EmailNotification | [global]
u5:63 | UnresolvedType | NotificationService | _c::adapters::email_notification::NotificationService |
u5:64 | Function | notify_order_confirmed | _c::adapters::email_notification::EmailNotification::notify_order_confirmed |
u5:65 | Variable | order | _c::adapters::email_notification::EmailNotification::notify_order_confirmed::order |
u6:66 | Crate | crate | _c::crate |
u6:67 | Module | application | _c::application |
u6:68 | File | mod | _c::application::mod |
u7:69 | Crate | crate | _c::crate |
u7:70 | Module | application | _c::application |
u7:71 | File | order_service | _c::application::order_service |
u7:72 | Struct | OrderService | _c::application::order_service::OrderService | [global]
u7:73 | TypeParameter | O | _c::application::order_service::OrderService::O |
u7:74 | TypeParameter | P | _c::application::order_service::OrderService::P |
u7:75 | TypeParameter | N | _c::application::order_service::OrderService::N |
u7:76 | Field | order_repo | _c::application::order_service::OrderService::order_repo |
u7:77 | Field | product_repo | _c::application::order_service::OrderService::product_repo |
u7:78 | Field | notification | _c::application::order_service::OrderService::notification |
u7:79 | Function | new | _c::application::order_service::OrderService::new | [global]
u7:80 | Variable | order_repo | _c::application::order_service::OrderService::new::order_repo |
u7:81 | Variable | product_repo | _c::application::order_service::OrderService::new::product_repo |
u7:82 | Variable | notification | _c::application::order_service::OrderService::new::notification |
u7:83 | UnresolvedType | OrderUseCase | _c::application::order_service::OrderUseCase |
u7:84 | Function | create_order | _c::application::order_service::OrderService::create_order |
u7:85 | Variable | order | _c::application::order_service::OrderService::create_order::order |
u7:86 | Variable | id | _c::application::order_service::OrderService::create_order::id |
u7:87 | Function | add_to_order | _c::application::order_service::OrderService::add_to_order |
u7:88 | Variable | order_id | _c::application::order_service::OrderService::add_to_order::order_id |
u7:89 | Variable | product_id | _c::application::order_service::OrderService::add_to_order::product_id |
u7:90 | Variable | quantity | _c::application::order_service::OrderService::add_to_order::quantity |
u7:91 | Variable | product | _c::application::order_service::OrderService::add_to_order::product |
u7:92 | Variable | order | _c::application::order_service::OrderService::add_to_order::order |
u7:93 | Function | confirm_order | _c::application::order_service::OrderService::confirm_order |
u7:94 | Variable | order_id | _c::application::order_service::OrderService::confirm_order::order_id |
u7:95 | Variable | order | _c::application::order_service::OrderService::confirm_order::order |
u7:96 | Function | get_order | _c::application::order_service::OrderService::get_order |
u7:97 | Variable | order_id | _c::application::order_service::OrderService::get_order::order_id |
u8:98 | Crate | crate | _c::crate |
u8:99 | Module | domain | _c::domain |
u8:100 | File | mod | _c::domain::mod |
u9:101 | Crate | crate | _c::crate |
u9:102 | Module | domain | _c::domain |
u9:103 | File | product | _c::domain::product |
u9:104 | Struct | Product | _c::domain::product::Product | [global]
u9:105 | Field | id | _c::domain::product::Product::id |
u9:106 | Field | name | _c::domain::product::Product::name |
u9:107 | Field | price | _c::domain::product::Product::price |
u9:108 | Field | stock | _c::domain::product::Product::stock |
u10:109 | Crate | crate | _c::crate |
u10:110 | Module | domain | _c::domain |
u10:111 | File | order | _c::domain::order |
u10:112 | Enum | OrderStatus | _c::domain::order::OrderStatus | [global]
u10:113 | EnumVariant | Pending | _c::domain::order::OrderStatus::Pending |
u10:114 | EnumVariant | Confirmed | _c::domain::order::OrderStatus::Confirmed |
u10:115 | EnumVariant | Shipped | _c::domain::order::OrderStatus::Shipped |
u10:116 | EnumVariant | Delivered | _c::domain::order::OrderStatus::Delivered |
u10:117 | Struct | Order | _c::domain::order::Order | [global]
u10:118 | Field | id | _c::domain::order::Order::id |
u10:119 | Field | products | _c::domain::order::Order::products |
u10:120 | Field | status | _c::domain::order::Order::status |
u10:121 | Function | new | _c::domain::order::Order::new | [global]
u10:122 | Variable | id | _c::domain::order::Order::new::id |
u10:123 | Function | add_product | _c::domain::order::Order::add_product | [global]
u10:124 | Variable | product | _c::domain::order::Order::add_product::product |
u10:125 | Variable | quantity | _c::domain::order::Order::add_product::quantity |
u10:126 | Function | total | _c::domain::order::Order::total | [global]
u10:127 | Variable | p | _c::domain::order::Order::total::p |
u10:128 | Variable | q | _c::domain::order::Order::total::q |
u10:129 | Function | confirm | _c::domain::order::Order::confirm | [global]
u11:130 | Crate | crate | _c::crate |
u11:131 | Module | ports | _c::ports |
u11:132 | File | mod | _c::ports::mod |
u12:133 | Crate | crate | _c::crate |
u12:134 | Module | ports | _c::ports |
u12:135 | File | inbound | _c::ports::inbound |
u12:136 | Trait | OrderUseCase | _c::ports::inbound::OrderUseCase | [global]
u12:137 | Function | create_order | _c::ports::inbound::OrderUseCase::create_order |
u12:138 | Function | add_to_order | _c::ports::inbound::OrderUseCase::add_to_order |
u12:139 | Variable | order_id | _c::ports::inbound::OrderUseCase::add_to_order::order_id |
u12:140 | Variable | product_id | _c::ports::inbound::OrderUseCase::add_to_order::product_id |
u12:141 | Variable | quantity | _c::ports::inbound::OrderUseCase::add_to_order::quantity |
u12:142 | Function | confirm_order | _c::ports::inbound::OrderUseCase::confirm_order |
u12:143 | Variable | order_id | _c::ports::inbound::OrderUseCase::confirm_order::order_id |
u12:144 | Function | get_order | _c::ports::inbound::OrderUseCase::get_order |
u12:145 | Variable | order_id | _c::ports::inbound::OrderUseCase::get_order::order_id |
u12:146 | Trait | ProductUseCase | _c::ports::inbound::ProductUseCase | [global]
u12:147 | Function | get_product | _c::ports::inbound::ProductUseCase::get_product |
u12:148 | Variable | id | _c::ports::inbound::ProductUseCase::get_product::id |
u12:149 | Function | list_products | _c::ports::inbound::ProductUseCase::list_products |
u13:150 | Crate | crate | _c::crate |
u13:151 | Module | ports | _c::ports |
u13:152 | File | outbound | _c::ports::outbound |
u13:153 | Trait | OrderRepository | _c::ports::outbound::OrderRepository | [global]
u13:154 | Function | save | _c::ports::outbound::OrderRepository::save |
u13:155 | Variable | order | _c::ports::outbound::OrderRepository::save::order |
u13:156 | Function | find_by_id | _c::ports::outbound::OrderRepository::find_by_id |
u13:157 | Variable | id | _c::ports::outbound::OrderRepository::find_by_id::id |
u13:158 | Function | update | _c::ports::outbound::OrderRepository::update |
u13:159 | Variable | order | _c::ports::outbound::OrderRepository::update::order |
u13:160 | Trait | ProductRepository | _c::ports::outbound::ProductRepository | [global]
u13:161 | Function | find_by_id | _c::ports::outbound::ProductRepository::find_by_id |
u13:162 | Variable | id | _c::ports::outbound::ProductRepository::find_by_id::id |
u13:163 | Function | find_all | _c::ports::outbound::ProductRepository::find_all |
u13:164 | Trait | NotificationService | _c::ports::outbound::NotificationService | [global]
u13:165 | Function | notify_order_confirmed | _c::ports::outbound::NotificationService::notify_order_confirmed |
u13:166 | Variable | order | _c::ports::outbound::NotificationService::notify_order_confirmed::order |

--- expect:symbol-deps ---
u0:1 <- [u7:84, u7:85]
u0:14 <- [u10:126, u9:104, u9:104, u9:107]
u0:15 <- [u12:138, u12:142, u13:158, u3:46, u7:87, u7:93]
u0:18 <- [u9:104, u9:106]
u0:7 <- [u10:117, u10:123, u10:123, u10:125, u12:138, u12:138, u12:141, u7:87, u7:87, u7:90, u9:104, u9:104, u9:108]
u0:8 <- [u10:117, u10:117, u10:118, u10:121, u10:121, u10:122, u12:138, u12:138, u12:139, u12:140, u12:142, u12:142, u12:143, u12:144, u12:144, u12:145, u12:147, u12:147, u12:148, u13:154, u13:156, u13:156, u13:157, u13:161, u13:161, u13:162, u3:36, u3:36, u3:38, u3:41, u3:44, u3:44, u3:45, u4:51, u4:56, u4:56, u4:57, u7:87, u7:87, u7:88, u7:89, u7:93, u7:93, u7:94, u7:96, u7:96, u7:97, u9:104, u9:104, u9:105]
u10:112 -> [u10:113, u10:114, u10:115, u10:116]
u10:112 <- [u10:117, u10:120, u10:121, u10:129]
u10:113 <- [u10:112, u10:121]
u10:114 <- [u10:112, u10:129]
u10:115 <- [u10:112]
u10:116 <- [u10:112]
u10:117 -> [u0:7, u0:8, u0:8, u10:112, u10:123, u10:126, u10:129, u9:104, u9:104]
u10:117 <- [u10:121, u10:121, u13:154, u13:155, u13:158, u13:159, u13:165, u13:166, u3:36, u3:37, u3:41, u3:41, u3:42, u3:43, u3:46, u3:47, u5:64, u5:65, u7:84]
u10:118 -> [u0:8]
u10:119 -> [u9:104]
u10:120 -> [u10:112]
u10:121 -> [u0:8, u0:8, u10:112, u10:113, u10:117, u10:117]
u10:121 <- [u7:84]
u10:122 -> [u0:8]
u10:123 -> [u0:7, u0:7, u9:104]
u10:123 <- [u10:117, u7:87]
u10:124 -> [u9:104]
u10:125 -> [u0:7]
u10:126 -> [u0:14]
u10:126 <- [u10:117]
u10:129 -> [u10:112, u10:114]
u10:129 <- [u10:117, u7:93]
u12:136 -> [u12:137, u12:138, u12:142, u12:144]
u12:137 <- [u12:136, u1:24]
u12:138 -> [u0:15, u0:7, u0:7, u0:8, u0:8]
u12:138 <- [u12:136, u1:24]
u12:139 -> [u0:8]
u12:140 -> [u0:8]
u12:141 -> [u0:7]
u12:142 -> [u0:15, u0:8, u0:8]
u12:142 <- [u12:136, u1:24]
u12:143 -> [u0:8]
u12:144 -> [u0:8, u0:8]
u12:144 <- [u12:136, u1:24]
u12:145 -> [u0:8]
u12:146 -> [u12:147, u12:149]
u12:147 -> [u0:8, u0:8]
u12:147 <- [u12:146]
u12:148 -> [u0:8]
u12:149 <- [u12:146]
u13:153 -> [u13:154, u13:156, u13:158]
u13:153 <- [u7:72]
u13:154 -> [u0:8, u10:117]
u13:154 <- [u13:153, u7:84]
u13:155 -> [u10:117]
u13:156 -> [u0:8, u0:8]
u13:156 <- [u13:153]
u13:157 -> [u0:8]
u13:158 -> [u0:15, u10:117]
u13:158 <- [u13:153, u7:87, u7:93]
u13:159 -> [u10:117]
u13:160 -> [u13:161, u13:163]
u13:160 <- [u7:72]
u13:161 -> [u0:8, u0:8]
u13:161 <- [u13:160, u7:84, u7:87, u7:93, u7:96]
u13:162 -> [u0:8]
u13:163 <- [u13:160]
u13:164 -> [u13:165]
u13:164 <- [u7:72]
u13:165 -> [u10:117]
u13:165 <- [u13:164, u7:93]
u13:166 -> [u10:117]
u1:24 -> [u12:137, u12:138, u12:142, u12:144, u3:36, u3:39, u4:51, u4:53, u5:62, u7:72, u7:79]
u1:27 -> [u5:62]
u3:36 -> [u0:8, u0:8, u10:117, u3:41, u3:44, u3:46]
u3:36 <- [u1:24, u3:39, u3:39]
u3:37 -> [u10:117]
u3:38 -> [u0:8]
u3:39 -> [u3:36, u3:36]
u3:39 <- [u1:24]
u3:41 -> [u0:8, u10:117, u10:117]
u3:41 <- [u3:36]
u3:42 -> [u10:117]
u3:43 -> [u10:117]
u3:44 -> [u0:8, u0:8]
u3:44 <- [u3:36]
u3:45 -> [u0:8]
u3:46 -> [u0:15, u10:117]
u3:46 <- [u3:36]
u3:47 -> [u10:117]
u4:51 -> [u0:8, u4:56, u4:58, u9:104]
u4:51 <- [u1:24, u4:53, u4:53]
u4:52 -> [u9:104]
u4:53 -> [u4:51, u4:51, u9:104]
u4:53 <- [u1:24]
u4:56 -> [u0:8, u0:8]
u4:56 <- [u4:51]
u4:57 -> [u0:8]
u4:58 <- [u4:51]
u5:62 -> [u5:64]
u5:62 <- [u1:24, u1:27]
u5:64 -> [u10:117]
u5:64 <- [u5:62]
u5:65 -> [u10:117]
u7:72 -> [u13:153, u13:160, u13:164, u7:84, u7:87, u7:93, u7:96]
u7:72 <- [u1:24, u7:79, u7:79]
u7:79 -> [u7:72, u7:72]
u7:79 <- [u1:24]
u7:84 -> [u0:1, u10:117, u10:121, u13:154, u13:161]
u7:84 <- [u7:72]
u7:85 -> [u0:1]
u7:87 -> [u0:15, u0:7, u0:7, u0:8, u0:8, u10:123, u13:158, u13:161]
u7:87 <- [u7:72]
u7:88 -> [u0:8]
u7:89 -> [u0:8]
u7:90 -> [u0:7]
u7:93 -> [u0:15, u0:8, u0:8, u10:129, u13:158, u13:161, u13:165]
u7:93 <- [u7:72]
u7:94 -> [u0:8]
u7:96 -> [u0:8, u0:8, u13:161]
u7:96 <- [u7:72]
u7:97 -> [u0:8]
u9:104 -> [u0:14, u0:14, u0:18, u0:7, u0:7, u0:8, u0:8]
u9:104 <- [u10:117, u10:117, u10:119, u10:123, u10:124, u4:51, u4:52, u4:53]
u9:105 -> [u0:8]
u9:106 -> [u0:18]
u9:107 -> [u0:14]
u9:108 -> [u0:7]


===============================================================================
clean-architecture
===============================================================================
Tests clean architecture: entities (core), use_cases (app logic), interface_adapters, frameworks (external).

--- file: src/lib.rs ---
pub mod entities;
pub mod use_cases;
pub mod interface_adapters;
pub mod frameworks;

--- file: src/entities/mod.rs ---
mod task;

pub use task::{Task, TaskStatus, Priority};

--- file: src/entities/task.rs ---
#[derive(Clone, PartialEq)]
pub enum TaskStatus {
    Todo,
    InProgress,
    Done,
}

#[derive(Clone, PartialEq, PartialOrd)]
pub enum Priority {
    Low,
    Medium,
    High,
}

#[derive(Clone)]
pub struct Task {
    pub id: u64,
    pub title: String,
    pub description: Option<String>,
    pub status: TaskStatus,
    pub priority: Priority,
}

impl Task {
    pub fn new(id: u64, title: String, priority: Priority) -> Self {
        Task {
            id,
            title,
            description: None,
            status: TaskStatus::Todo,
            priority,
        }
    }

    pub fn start(&mut self) {
        self.status = TaskStatus::InProgress;
    }

    pub fn complete(&mut self) {
        self.status = TaskStatus::Done;
    }

    pub fn is_done(&self) -> bool {
        self.status == TaskStatus::Done
    }
}

--- file: src/use_cases/mod.rs ---
mod task_use_cases;
mod ports;

pub use task_use_cases::*;
pub use ports::*;

--- file: src/use_cases/ports.rs ---
use crate::entities::Task;

// Output port - use case boundary
pub trait TaskGateway {
    fn save(&mut self, task: Task) -> u64;
    fn find_by_id(&self, id: u64) -> Option<Task>;
    fn find_all(&self) -> Vec<Task>;
    fn update(&mut self, task: Task) -> bool;
    fn delete(&mut self, id: u64) -> bool;
}

pub trait TaskPresenter {
    fn present_task(&self, task: &Task);
    fn present_task_list(&self, tasks: &[Task]);
    fn present_error(&self, message: &str);
}

--- file: src/use_cases/task_use_cases.rs ---
use crate::entities::{Task, Priority};
use super::ports::{TaskGateway, TaskPresenter};

pub struct CreateTaskUseCase<'a, G: TaskGateway, P: TaskPresenter> {
    gateway: &'a mut G,
    presenter: &'a P,
}

impl<'a, G: TaskGateway, P: TaskPresenter> CreateTaskUseCase<'a, G, P> {
    pub fn new(gateway: &'a mut G, presenter: &'a P) -> Self {
        CreateTaskUseCase { gateway, presenter }
    }

    pub fn execute(&mut self, title: String, priority: Priority) {
        let task = Task::new(0, title, priority);
        let id = self.gateway.save(task);
        if let Some(created) = self.gateway.find_by_id(id) {
            self.presenter.present_task(&created);
        }
    }
}

pub struct CompleteTaskUseCase<'a, G: TaskGateway, P: TaskPresenter> {
    gateway: &'a mut G,
    presenter: &'a P,
}

impl<'a, G: TaskGateway, P: TaskPresenter> CompleteTaskUseCase<'a, G, P> {
    pub fn new(gateway: &'a mut G, presenter: &'a P) -> Self {
        CompleteTaskUseCase { gateway, presenter }
    }

    pub fn execute(&mut self, task_id: u64) {
        match self.gateway.find_by_id(task_id) {
            Some(mut task) => {
                task.complete();
                self.gateway.update(task.clone());
                self.presenter.present_task(&task);
            }
            None => {
                self.presenter.present_error("Task not found");
            }
        }
    }
}

pub struct ListTasksUseCase<'a, G: TaskGateway, P: TaskPresenter> {
    gateway: &'a G,
    presenter: &'a P,
}

impl<'a, G: TaskGateway, P: TaskPresenter> ListTasksUseCase<'a, G, P> {
    pub fn new(gateway: &'a G, presenter: &'a P) -> Self {
        ListTasksUseCase { gateway, presenter }
    }

    pub fn execute(&self) {
        let tasks = self.gateway.find_all();
        self.presenter.present_task_list(&tasks);
    }
}

--- file: src/interface_adapters/mod.rs ---
mod memory_gateway;
mod console_presenter;

pub use memory_gateway::InMemoryTaskGateway;
pub use console_presenter::ConsolePresenter;

--- file: src/interface_adapters/memory_gateway.rs ---
use crate::entities::Task;
use crate::use_cases::TaskGateway;
use std::collections::HashMap;

pub struct InMemoryTaskGateway {
    tasks: HashMap<u64, Task>,
    next_id: u64,
}

impl InMemoryTaskGateway {
    pub fn new() -> Self {
        InMemoryTaskGateway { tasks: HashMap::new(), next_id: 1 }
    }
}

impl TaskGateway for InMemoryTaskGateway {
    fn save(&mut self, mut task: Task) -> u64 {
        task.id = self.next_id;
        self.next_id += 1;
        let id = task.id;
        self.tasks.insert(id, task);
        id
    }

    fn find_by_id(&self, id: u64) -> Option<Task> {
        self.tasks.get(&id).cloned()
    }

    fn find_all(&self) -> Vec<Task> {
        self.tasks.values().cloned().collect()
    }

    fn update(&mut self, task: Task) -> bool {
        if self.tasks.contains_key(&task.id) {
            self.tasks.insert(task.id, task);
            true
        } else {
            false
        }
    }

    fn delete(&mut self, id: u64) -> bool {
        self.tasks.remove(&id).is_some()
    }
}

--- file: src/interface_adapters/console_presenter.rs ---
use crate::entities::Task;
use crate::use_cases::TaskPresenter;

pub struct ConsolePresenter;

impl TaskPresenter for ConsolePresenter {
    fn present_task(&self, task: &Task) {
        println!("Task #{}: {} [{:?}]", task.id, task.title, task.status);
    }

    fn present_task_list(&self, tasks: &[Task]) {
        println!("=== Tasks ({}) ===", tasks.len());
        for task in tasks {
            self.present_task(task);
        }
    }

    fn present_error(&self, message: &str) {
        eprintln!("Error: {}", message);
    }
}

--- file: src/main.rs ---
mod entities;
mod use_cases;
mod interface_adapters;

use entities::Priority;
use use_cases::{CreateTaskUseCase, CompleteTaskUseCase, ListTasksUseCase};
use interface_adapters::{InMemoryTaskGateway, ConsolePresenter};

fn main() {
    let mut gateway = InMemoryTaskGateway::new();
    let presenter = ConsolePresenter;

    // Create tasks
    {
        let mut create = CreateTaskUseCase::new(&mut gateway, &presenter);
        create.execute("Learn Rust".to_string(), Priority::High);
        create.execute("Write tests".to_string(), Priority::Medium);
        create.execute("Deploy app".to_string(), Priority::Low);
    }

    // Complete first task
    {
        let mut complete = CompleteTaskUseCase::new(&mut gateway, &presenter);
        complete.execute(1);
    }

    // List all tasks
    {
        let list = ListTasksUseCase::new(&gateway, &presenter);
        list.execute();
    }
}

--- expect:symbols ---
u0:1 | Primitive | i32 | i32 | [global]
u0:2 | Primitive | i64 | i64 | [global]
u0:3 | Primitive | i16 | i16 | [global]
u0:4 | Primitive | i8 | i8 | [global]
u0:5 | Primitive | i128 | i128 | [global]
u0:6 | Primitive | isize | isize | [global]
u0:7 | Primitive | u32 | u32 | [global]
u0:8 | Primitive | u64 | u64 | [global]
u0:9 | Primitive | u16 | u16 | [global]
u0:10 | Primitive | u8 | u8 | [global]
u0:11 | Primitive | u128 | u128 | [global]
u0:12 | Primitive | usize | usize | [global]
u0:13 | Primitive | f32 | f32 | [global]
u0:14 | Primitive | f64 | f64 | [global]
u0:15 | Primitive | bool | bool | [global]
u0:16 | Primitive | char | char | [global]
u0:17 | Primitive | str | str | [global]
u0:18 | Primitive | String | String | [global]
u0:19 | Crate | _c | _c | [global]
u0:20 | Crate | crate | _c::crate |
u0:21 | File | lib | _c::lib |
u1:22 | Crate | crate | _c::crate |
u1:23 | File | main | _c::main |
u1:24 | Function | main | _c::main::main |
u1:25 | Variable | gateway | _c::main::main::gateway |
u1:26 | Variable | presenter | _c::main::main::presenter |
u1:27 | Variable | create | _c::main::main::create |
u1:28 | Variable | complete | _c::main::main::complete |
u1:29 | Variable | list | _c::main::main::list |
u2:30 | Crate | crate | _c::crate |
u2:31 | Module | entities | _c::entities |
u2:32 | File | mod | _c::entities::mod |
u3:33 | Crate | crate | _c::crate |
u3:34 | Module | entities | _c::entities |
u3:35 | File | task | _c::entities::task |
u3:36 | Enum | TaskStatus | _c::entities::task::TaskStatus | [global]
u3:37 | EnumVariant | Todo | _c::entities::task::TaskStatus::Todo |
u3:38 | EnumVariant | InProgress | _c::entities::task::TaskStatus::InProgress |
u3:39 | EnumVariant | Done | _c::entities::task::TaskStatus::Done |
u3:40 | Enum | Priority | _c::entities::task::Priority | [global]
u3:41 | EnumVariant | Low | _c::entities::task::Priority::Low |
u3:42 | EnumVariant | Medium | _c::entities::task::Priority::Medium |
u3:43 | EnumVariant | High | _c::entities::task::Priority::High |
u3:44 | Struct | Task | _c::entities::task::Task | [global]
u3:45 | Field | id | _c::entities::task::Task::id |
u3:46 | Field | title | _c::entities::task::Task::title |
u3:47 | Field | description | _c::entities::task::Task::description |
u3:48 | Field | status | _c::entities::task::Task::status |
u3:49 | Field | priority | _c::entities::task::Task::priority |
u3:50 | Function | new | _c::entities::task::Task::new | [global]
u3:51 | Variable | id | _c::entities::task::Task::new::id |
u3:52 | Variable | title | _c::entities::task::Task::new::title |
u3:53 | Variable | priority | _c::entities::task::Task::new::priority |
u3:54 | Function | start | _c::entities::task::Task::start | [global]
u3:55 | Function | complete | _c::entities::task::Task::complete | [global]
u3:56 | Function | is_done | _c::entities::task::Task::is_done | [global]
u4:57 | Crate | crate | _c::crate |
u4:58 | Module | interface_adapters | _c::interface_adapters |
u4:59 | File | mod | _c::interface_adapters::mod |
u5:60 | Crate | crate | _c::crate |
u5:61 | Module | interface_adapters | _c::interface_adapters |
u5:62 | File | memory_gateway | _c::interface_adapters::memory_gateway |
u5:63 | Struct | InMemoryTaskGateway | _c::interface_adapters::memory_gateway::InMemoryTaskGateway | [global]
u5:64 | Field | tasks | _c::interface_adapters::memory_gateway::InMemoryTaskGateway::tasks |
u5:65 | Field | next_id | _c::interface_adapters::memory_gateway::InMemoryTaskGateway::next_id |
u5:66 | Function | new | _c::interface_adapters::memory_gateway::InMemoryTaskGateway::new | [global]
u5:67 | UnresolvedType | TaskGateway | _c::interface_adapters::memory_gateway::TaskGateway |
u5:68 | Function | save | _c::interface_adapters::memory_gateway::InMemoryTaskGateway::save |
u5:69 | Variable | task | _c::interface_adapters::memory_gateway::InMemoryTaskGateway::save::task |
u5:70 | Variable | id | _c::interface_adapters::memory_gateway::InMemoryTaskGateway::save::id |
u5:71 | Function | find_by_id | _c::interface_adapters::memory_gateway::InMemoryTaskGateway::find_by_id |
u5:72 | Variable | id | _c::interface_adapters::memory_gateway::InMemoryTaskGateway::find_by_id::id |
u5:73 | Function | find_all | _c::interface_adapters::memory_gateway::InMemoryTaskGateway::find_all |
u5:74 | Function | update | _c::interface_adapters::memory_gateway::InMemoryTaskGateway::update |
u5:75 | Variable | task | _c::interface_adapters::memory_gateway::InMemoryTaskGateway::update::task |
u5:76 | Function | delete | _c::interface_adapters::memory_gateway::InMemoryTaskGateway::delete |
u5:77 | Variable | id | _c::interface_adapters::memory_gateway::InMemoryTaskGateway::delete::id |
u6:78 | Crate | crate | _c::crate |
u6:79 | Module | interface_adapters | _c::interface_adapters |
u6:80 | File | console_presenter | _c::interface_adapters::console_presenter |
u6:81 | Struct | ConsolePresenter | _c::interface_adapters::console_presenter::ConsolePresenter | [global]
u6:82 | UnresolvedType | TaskPresenter | _c::interface_adapters::console_presenter::TaskPresenter |
u6:83 | Function | present_task | _c::interface_adapters::console_presenter::ConsolePresenter::present_task |
u6:84 | Variable | task | _c::interface_adapters::console_presenter::ConsolePresenter::present_task::task |
u6:85 | Function | present_task_list | _c::interface_adapters::console_presenter::ConsolePresenter::present_task_list |
u6:86 | Variable | tasks | _c::interface_adapters::console_presenter::ConsolePresenter::present_task_list::tasks |
u6:87 | Function | present_error | _c::interface_adapters::console_presenter::ConsolePresenter::present_error |
u6:88 | Variable | message | _c::interface_adapters::console_presenter::ConsolePresenter::present_error::message |
u7:89 | Crate | crate | _c::crate |
u7:90 | Module | use_cases | _c::use_cases |
u7:91 | File | mod | _c::use_cases::mod |
u8:92 | Crate | crate | _c::crate |
u8:93 | Module | use_cases | _c::use_cases |
u8:94 | File | ports | _c::use_cases::ports |
u8:95 | Trait | TaskGateway | _c::use_cases::ports::TaskGateway | [global]
u8:96 | Function | save | _c::use_cases::ports::TaskGateway::save |
u8:97 | Variable | task | _c::use_cases::ports::TaskGateway::save::task |
u8:98 | Function | find_by_id | _c::use_cases::ports::TaskGateway::find_by_id |
u8:99 | Variable | id | _c::use_cases::ports::TaskGateway::find_by_id::id |
u8:100 | Function | find_all | _c::use_cases::ports::TaskGateway::find_all |
u8:101 | Function | update | _c::use_cases::ports::TaskGateway::update |
u8:102 | Variable | task | _c::use_cases::ports::TaskGateway::update::task |
u8:103 | Function | delete | _c::use_cases::ports::TaskGateway::delete |
u8:104 | Variable | id | _c::use_cases::ports::TaskGateway::delete::id |
u8:105 | Trait | TaskPresenter | _c::use_cases::ports::TaskPresenter | [global]
u8:106 | Function | present_task | _c::use_cases::ports::TaskPresenter::present_task |
u8:107 | Variable | task | _c::use_cases::ports::TaskPresenter::present_task::task |
u8:108 | Function | present_task_list | _c::use_cases::ports::TaskPresenter::present_task_list |
u8:109 | Variable | tasks | _c::use_cases::ports::TaskPresenter::present_task_list::tasks |
u8:110 | Function | present_error | _c::use_cases::ports::TaskPresenter::present_error |
u8:111 | Variable | message | _c::use_cases::ports::TaskPresenter::present_error::message |
u9:112 | Crate | crate | _c::crate |
u9:113 | Module | use_cases | _c::use_cases |
u9:114 | File | task_use_cases | _c::use_cases::task_use_cases |
u9:115 | Struct | CreateTaskUseCase | _c::use_cases::task_use_cases::CreateTaskUseCase | [global]
u9:116 | TypeParameter | G | _c::use_cases::task_use_cases::CreateTaskUseCase::G |
u9:117 | TypeParameter | P | _c::use_cases::task_use_cases::CreateTaskUseCase::P |
u9:118 | Field | gateway | _c::use_cases::task_use_cases::CreateTaskUseCase::gateway |
u9:119 | Field | presenter | _c::use_cases::task_use_cases::CreateTaskUseCase::presenter |
u9:120 | Function | new | _c::use_cases::task_use_cases::CreateTaskUseCase::new | [global]
u9:121 | Variable | gateway | _c::use_cases::task_use_cases::CreateTaskUseCase::new::gateway |
u9:122 | Variable | presenter | _c::use_cases::task_use_cases::CreateTaskUseCase::new::presenter |
u9:123 | Function | execute | _c::use_cases::task_use_cases::CreateTaskUseCase::execute | [global]
u9:124 | Variable | title | _c::use_cases::task_use_cases::CreateTaskUseCase::execute::title |
u9:125 | Variable | priority | _c::use_cases::task_use_cases::CreateTaskUseCase::execute::priority |
u9:126 | Variable | task | _c::use_cases::task_use_cases::CreateTaskUseCase::execute::task |
u9:127 | Variable | id | _c::use_cases::task_use_cases::CreateTaskUseCase::execute::id |
u9:128 | Struct | CompleteTaskUseCase | _c::use_cases::task_use_cases::CompleteTaskUseCase | [global]
u9:129 | TypeParameter | G | _c::use_cases::task_use_cases::CompleteTaskUseCase::G |
u9:130 | TypeParameter | P | _c::use_cases::task_use_cases::CompleteTaskUseCase::P |
u9:131 | Field | gateway | _c::use_cases::task_use_cases::CompleteTaskUseCase::gateway |
u9:132 | Field | presenter | _c::use_cases::task_use_cases::CompleteTaskUseCase::presenter |
u9:133 | Function | new | _c::use_cases::task_use_cases::CompleteTaskUseCase::new | [global]
u9:134 | Variable | gateway | _c::use_cases::task_use_cases::CompleteTaskUseCase::new::gateway |
u9:135 | Variable | presenter | _c::use_cases::task_use_cases::CompleteTaskUseCase::new::presenter |
u9:136 | Function | execute | _c::use_cases::task_use_cases::CompleteTaskUseCase::execute | [global]
u9:137 | Variable | task_id | _c::use_cases::task_use_cases::CompleteTaskUseCase::execute::task_id |
u9:138 | Struct | ListTasksUseCase | _c::use_cases::task_use_cases::ListTasksUseCase | [global]
u9:139 | TypeParameter | G | _c::use_cases::task_use_cases::ListTasksUseCase::G |
u9:140 | TypeParameter | P | _c::use_cases::task_use_cases::ListTasksUseCase::P |
u9:141 | Field | gateway | _c::use_cases::task_use_cases::ListTasksUseCase::gateway |
u9:142 | Field | presenter | _c::use_cases::task_use_cases::ListTasksUseCase::presenter |
u9:143 | Function | new | _c::use_cases::task_use_cases::ListTasksUseCase::new | [global]
u9:144 | Variable | gateway | _c::use_cases::task_use_cases::ListTasksUseCase::new::gateway |
u9:145 | Variable | presenter | _c::use_cases::task_use_cases::ListTasksUseCase::new::presenter |
u9:146 | Function | execute | _c::use_cases::task_use_cases::ListTasksUseCase::execute | [global]
u9:147 | Variable | tasks | _c::use_cases::task_use_cases::ListTasksUseCase::execute::tasks |

--- expect:symbol-deps ---
u0:15 <- [u3:56, u5:74, u5:76, u8:101, u8:103]
u0:17 <- [u6:87, u6:87, u6:88, u8:110, u8:110, u8:111]
u0:18 <- [u3:44, u3:46, u3:47, u3:50, u3:52, u9:123, u9:124]
u0:8 <- [u3:44, u3:44, u3:45, u3:50, u3:50, u3:51, u5:63, u5:63, u5:65, u5:68, u5:70, u5:71, u5:71, u5:72, u5:76, u5:76, u5:77, u8:103, u8:103, u8:104, u8:96, u8:98, u8:98, u8:99, u9:136, u9:136, u9:137]
u1:24 -> [u3:40, u3:41, u3:42, u3:43, u5:63, u5:66, u6:81, u9:115, u9:120, u9:128, u9:133, u9:138, u9:143, u9:146]
u1:26 -> [u6:81]
u3:36 -> [u3:37, u3:38, u3:39]
u3:36 <- [u3:44, u3:48, u3:50, u3:54, u3:55, u3:56]
u3:37 <- [u3:36, u3:50]
u3:38 <- [u3:36, u3:54]
u3:39 <- [u3:36, u3:55, u3:56]
u3:40 -> [u3:41, u3:42, u3:43]
u3:40 <- [u1:24, u3:44, u3:49, u3:50, u3:53, u9:123, u9:125]
u3:41 <- [u1:24, u3:40]
u3:42 <- [u1:24, u3:40]
u3:43 <- [u1:24, u3:40]
u3:44 -> [u0:18, u0:8, u0:8, u3:36, u3:40, u3:54, u3:55, u3:56]
u3:44 <- [u3:50, u3:50, u5:63, u5:64, u5:68, u5:69, u5:74, u5:75, u6:83, u6:84, u6:85, u6:85, u6:86, u8:101, u8:102, u8:106, u8:107, u8:108, u8:108, u8:109, u8:96, u8:97, u9:123, u9:126]
u3:45 -> [u0:8]
u3:46 -> [u0:18]
u3:47 -> [u0:18]
u3:48 -> [u3:36]
u3:49 -> [u3:40]
u3:50 -> [u0:18, u0:8, u0:8, u3:36, u3:37, u3:40, u3:44, u3:44]
u3:50 <- [u9:123]
u3:51 -> [u0:8]
u3:52 -> [u0:18]
u3:53 -> [u3:40]
u3:54 -> [u3:36, u3:38]
u3:54 <- [u3:44]
u3:55 -> [u3:36, u3:39]
u3:55 <- [u3:44, u9:136]
u3:56 -> [u0:15, u3:36, u3:39]
u3:56 <- [u3:44]
u5:63 -> [u0:8, u0:8, u3:44, u5:68, u5:71, u5:73, u5:74, u5:76]
u5:63 <- [u1:24, u5:66, u5:66]
u5:64 -> [u3:44]
u5:65 -> [u0:8]
u5:66 -> [u5:63, u5:63]
u5:66 <- [u1:24]
u5:68 -> [u0:8, u3:44]
u5:68 <- [u5:63]
u5:69 -> [u3:44]
u5:70 -> [u0:8]
u5:71 -> [u0:8, u0:8]
u5:71 <- [u5:63]
u5:72 -> [u0:8]
u5:73 <- [u5:63]
u5:74 -> [u0:15, u3:44]
u5:74 <- [u5:63]
u5:75 -> [u3:44]
u5:76 -> [u0:15, u0:8, u0:8]
u5:76 <- [u5:63]
u5:77 -> [u0:8]
u6:81 -> [u6:83, u6:85, u6:87]
u6:81 <- [u1:24, u1:26]
u6:83 -> [u3:44]
u6:83 <- [u6:81, u6:85]
u6:84 -> [u3:44]
u6:85 -> [u3:44, u3:44, u6:83]
u6:85 <- [u6:81]
u6:86 -> [u3:44]
u6:87 -> [u0:17, u0:17]
u6:87 <- [u6:81]
u6:88 -> [u0:17]
u8:100 <- [u8:95, u9:146]
u8:101 -> [u0:15, u3:44]
u8:101 <- [u8:95, u9:136]
u8:102 -> [u3:44]
u8:103 -> [u0:15, u0:8, u0:8]
u8:103 <- [u8:95]
u8:104 -> [u0:8]
u8:105 -> [u8:106, u8:108, u8:110]
u8:105 <- [u9:115, u9:128, u9:138]
u8:106 -> [u3:44]
u8:106 <- [u8:105, u9:123, u9:136]
u8:107 -> [u3:44]
u8:108 -> [u3:44, u3:44]
u8:108 <- [u8:105, u9:146]
u8:109 -> [u3:44]
u8:110 -> [u0:17, u0:17]
u8:110 <- [u8:105, u9:136]
u8:111 -> [u0:17]
u8:95 -> [u8:100, u8:101, u8:103, u8:96, u8:98]
u8:95 <- [u9:115, u9:128, u9:138]
u8:96 -> [u0:8, u3:44]
u8:96 <- [u8:95, u9:123]
u8:97 -> [u3:44]
u8:98 -> [u0:8, u0:8]
u8:98 <- [u8:95, u9:123, u9:136]
u8:99 -> [u0:8]
u9:115 -> [u8:105, u8:95, u9:123]
u9:115 <- [u1:24, u9:120, u9:120]
u9:118 <- [u9:123, u9:127]
u9:120 -> [u9:115, u9:115]
u9:120 <- [u1:24]
u9:123 -> [u0:18, u3:40, u3:44, u3:50, u8:106, u8:96, u8:98, u9:118]
u9:123 <- [u9:115]
u9:124 -> [u0:18]
u9:125 -> [u3:40]
u9:126 -> [u3:44]
u9:127 -> [u9:118]
u9:128 -> [u8:105, u8:95, u9:136]
u9:128 <- [u1:24, u9:133, u9:133]
u9:133 -> [u9:128, u9:128]
u9:133 <- [u1:24]
u9:136 -> [u0:8, u0:8, u3:55, u8:101, u8:106, u8:110, u8:98]
u9:136 <- [u9:128]
u9:137 -> [u0:8]
u9:138 -> [u8:105, u8:95, u9:146]
u9:138 <- [u1:24, u9:143, u9:143]
u9:141 <- [u9:146, u9:147]
u9:143 -> [u9:138, u9:138]
u9:143 <- [u1:24]
u9:146 -> [u8:100, u8:108, u9:141]
u9:146 <- [u1:24, u9:138]
u9:147 -> [u9:141]

--- expect:dep-graph ---
digraph project {
  graph [fontname="Helvetica Bold", fontsize=12];

  subgraph cluster_0 {
    label="_c";
    subgraph cluster_1 {
      label="entities";
      style="filled";
      fillcolor="#EEEEEE";
      color="#616161";
      n8[label="Task", full_path="$TMP/src/entities/task.rs:16"];
      n6[label="TaskStatus", full_path="$TMP/src/entities/task.rs:2"];
      n7[label="Priority", full_path="$TMP/src/entities/task.rs:9"];
    }
    subgraph cluster_2 {
      label="interface_adapters";
      style="filled";
      fillcolor="#EEEEEE";
      color="#616161";
      n26[label="ConsolePresenter", full_path="$TMP/src/interface_adapters/console_presenter.rs:4"];
      n16[label="InMemoryTaskGateway", full_path="$TMP/src/interface_adapters/memory_gateway.rs:5"];
    }
    subgraph cluster_3 {
      label="main";
      style="filled";
      fillcolor="#EEEEEE";
      color="#616161";
      n3[label="main", full_path="$TMP/src/main.rs:9"];
    }
    subgraph cluster_4 {
      label="use_cases";
      style="filled";
      fillcolor="#EEEEEE";
      color="#616161";
      n39[label="TaskPresenter", full_path="$TMP/src/use_cases/ports.rs:12"];
      n33[label="TaskGateway", full_path="$TMP/src/use_cases/ports.rs:4"];
      n48[label="CompleteTaskUseCase", full_path="$TMP/src/use_cases/task_use_cases.rs:23"];
      n44[label="CreateTaskUseCase", full_path="$TMP/src/use_cases/task_use_cases.rs:4"];
      n52[label="ListTasksUseCase", full_path="$TMP/src/use_cases/task_use_cases.rs:47"];
    }
  }

  // Edges
  n3 -> n16;
  n3 -> n26;
  n3 -> n48;
  n3 -> n44;
  n3 -> n52;
  n8 -> n6;
  n8 -> n7;
  n16 -> n8;
  n48 -> n39;
  n48 -> n33;
  n44 -> n39;
  n44 -> n33;
  n52 -> n39;
  n52 -> n33;
}
