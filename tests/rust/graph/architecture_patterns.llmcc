===============================================================================
layered-architecture-basic
===============================================================================
Tests 3-layer architecture: data layer (entities/repository), service layer (business logic), api layer (handlers).

--- file: src/lib.rs ---
pub mod data;
pub mod service;
pub mod api;

--- file: src/data/mod.rs ---
mod entity;
mod repository;

pub use entity::User;
pub use repository::UserRepository;

--- file: src/data/entity.rs ---
#[derive(Clone, Debug)]
pub struct User {
    pub id: u64,
    pub email: String,
    pub password_hash: String,
}

--- file: src/data/repository.rs ---
use super::entity::User;
use std::collections::HashMap;

pub struct UserRepository {
    storage: HashMap<u64, User>,
    next_id: u64,
}

impl UserRepository {
    pub fn new() -> Self {
        UserRepository { storage: HashMap::new(), next_id: 1 }
    }

    pub fn find_by_id(&self, id: u64) -> Option<User> {
        self.storage.get(&id).cloned()
    }

    pub fn find_by_email(&self, email: &str) -> Option<User> {
        self.storage.values().find(|u| u.email == email).cloned()
    }

    pub fn insert(&mut self, email: String, password_hash: String) -> User {
        let user = User { id: self.next_id, email, password_hash };
        self.next_id += 1;
        self.storage.insert(user.id, user.clone());
        user
    }
}

--- file: src/service/mod.rs ---
mod user_service;
mod auth_service;

pub use user_service::UserService;
pub use auth_service::AuthService;

--- file: src/service/user_service.rs ---
use crate::data::{User, UserRepository};

pub struct UserService {
    repo: UserRepository,
}

impl UserService {
    pub fn new(repo: UserRepository) -> Self {
        UserService { repo }
    }

    pub fn get_user(&self, id: u64) -> Option<User> {
        self.repo.find_by_id(id)
    }

    pub fn create_user(&mut self, email: String, password: String) -> User {
        let hash = format!("hashed:{}", password);  // Simplified
        self.repo.insert(email, hash)
    }
}

--- file: src/service/auth_service.rs ---
use crate::data::{User, UserRepository};

pub struct AuthService {
    repo: UserRepository,
}

impl AuthService {
    pub fn new(repo: UserRepository) -> Self {
        AuthService { repo }
    }

    pub fn authenticate(&self, email: &str, password: &str) -> Option<User> {
        let user = self.repo.find_by_email(email)?;
        let expected_hash = format!("hashed:{}", password);
        if user.password_hash == expected_hash {
            Some(user)
        } else {
            None
        }
    }
}

--- file: src/api/mod.rs ---
mod handlers;
mod dto;

pub use handlers::*;
pub use dto::*;

--- file: src/api/dto.rs ---
use crate::data::User;

pub struct UserDto {
    pub id: u64,
    pub email: String,
}

impl From<User> for UserDto {
    fn from(user: User) -> Self {
        UserDto { id: user.id, email: user.email }
    }
}

pub struct CreateUserRequest {
    pub email: String,
    pub password: String,
}

pub struct LoginRequest {
    pub email: String,
    pub password: String,
}

--- file: src/api/handlers.rs ---
use crate::service::{UserService, AuthService};
use super::dto::{UserDto, CreateUserRequest, LoginRequest};

pub fn handle_get_user(service: &UserService, id: u64) -> Option<UserDto> {
    service.get_user(id).map(UserDto::from)
}

pub fn handle_create_user(service: &mut UserService, req: CreateUserRequest) -> UserDto {
    let user = service.create_user(req.email, req.password);
    UserDto::from(user)
}

pub fn handle_login(service: &AuthService, req: LoginRequest) -> Option<UserDto> {
    service.authenticate(&req.email, &req.password).map(UserDto::from)
}

--- file: src/main.rs ---
mod data;
mod service;
mod api;

use data::UserRepository;
use service::{UserService, AuthService};
use api::{handle_create_user, handle_get_user, CreateUserRequest};

fn main() {
    let repo = UserRepository::new();
    let mut user_service = UserService::new(repo);

    let req = CreateUserRequest {
        email: "alice@example.com".to_string(),
        password: "secret".to_string(),
    };

    let created = handle_create_user(&mut user_service, req);
    println!("Created user: {} (id={})", created.email, created.id);

    if let Some(found) = handle_get_user(&user_service, created.id) {
        println!("Found user: {}", found.email);
    }
}

--- expect:symbols ---
u0:1    | Primitive      | i32                | i32                                                            | [global]
u0:2    | Primitive      | i64                | i64                                                            | [global]
u0:3    | Primitive      | i16                | i16                                                            | [global]
u0:4    | Primitive      | i8                 | i8                                                             | [global]
u0:5    | Primitive      | i128               | i128                                                           | [global]
u0:6    | Primitive      | isize              | isize                                                          | [global]
u0:7    | Primitive      | u32                | u32                                                            | [global]
u0:8    | Primitive      | u64                | u64                                                            | [global]
u0:9    | Primitive      | u16                | u16                                                            | [global]
u0:10   | Primitive      | u8                 | u8                                                             | [global]
u0:11   | Primitive      | u128               | u128                                                           | [global]
u0:12   | Primitive      | usize              | usize                                                          | [global]
u0:13   | Primitive      | f32                | f32                                                            | [global]
u0:14   | Primitive      | f64                | f64                                                            | [global]
u0:15   | Primitive      | bool               | bool                                                           | [global]
u0:16   | Primitive      | char               | char                                                           | [global]
u0:17   | Primitive      | str                | str                                                            | [global]
u0:18   | Primitive      | String             | String                                                         | [global]
u0:19   | Crate          | _c                 | _c                                                             | [global]
u0:20   | Crate          | crate              | _c::crate                                                      |         
u0:21   | Module         | _m                 | _c::_m                                                         |         
u0:22   | File           | dto                | _c::_m::dto                                                    |         
u0:23   | Struct         | UserDto            | _c::_m::dto::UserDto                                           | [global]
u0:24   | Field          | id                 | _c::_m::dto::UserDto::id                                       |         
u0:25   | Field          | email              | _c::_m::dto::UserDto::email                                    |         
u0:26   | UnresolvedType | From               | _c::_m::dto::From                                              |         
u0:27   | Function       | from               | _c::_m::dto::UserDto::from                                     |         
u0:28   | Variable       | user               | _c::_m::dto::UserDto::from::user                               |         
u0:29   | Struct         | CreateUserRequest  | _c::_m::dto::CreateUserRequest                                 | [global]
u0:30   | Field          | email              | _c::_m::dto::CreateUserRequest::email                          |         
u0:31   | Field          | password           | _c::_m::dto::CreateUserRequest::password                       |         
u0:32   | Struct         | LoginRequest       | _c::_m::dto::LoginRequest                                      | [global]
u0:33   | Field          | email              | _c::_m::dto::LoginRequest::email                               |         
u0:34   | Field          | password           | _c::_m::dto::LoginRequest::password                            |         
u1:35   | Crate          | crate              | _c::crate                                                      |         
u1:36   | Module         | _m                 | _c::_m                                                         |         
u1:37   | File           | handlers           | _c::_m::handlers                                               |         
u1:38   | Function       | handle_get_user    | _c::_m::handlers::handle_get_user                              | [global]
u1:39   | Variable       | service            | _c::_m::handlers::handle_get_user::service                     |         
u1:40   | Variable       | id                 | _c::_m::handlers::handle_get_user::id                          |         
u1:41   | Function       | handle_create_user | _c::_m::handlers::handle_create_user                           | [global]
u1:42   | Variable       | service            | _c::_m::handlers::handle_create_user::service                  |         
u1:43   | Variable       | req                | _c::_m::handlers::handle_create_user::req                      |         
u1:44   | Variable       | user               | _c::_m::handlers::handle_create_user::user                     |         
u1:45   | Function       | handle_login       | _c::_m::handlers::handle_login                                 | [global]
u1:46   | Variable       | service            | _c::_m::handlers::handle_login::service                        |         
u1:47   | Variable       | req                | _c::_m::handlers::handle_login::req                            |         
u2:48   | Crate          | crate              | _c::crate                                                      |         
u2:49   | Module         | api                | _c::api                                                        |         
u2:50   | File           | mod                | _c::api::mod                                                   |         
u3:51   | Crate          | crate              | _c::crate                                                      |         
u3:52   | Module         | _m                 | _c::_m                                                         |         
u3:53   | File           | entity             | _c::_m::entity                                                 |         
u3:54   | Struct         | User               | _c::_m::entity::User                                           | [global]
u3:55   | Field          | id                 | _c::_m::entity::User::id                                       |         
u3:56   | Field          | email              | _c::_m::entity::User::email                                    |         
u3:57   | Field          | password_hash      | _c::_m::entity::User::password_hash                            |         
u4:58   | Crate          | crate              | _c::crate                                                      |         
u4:59   | Module         | data               | _c::data                                                       |         
u4:60   | File           | mod                | _c::data::mod                                                  |         
u5:61   | Crate          | crate              | _c::crate                                                      |         
u5:62   | Module         | _m                 | _c::_m                                                         |         
u5:63   | File           | repository         | _c::_m::repository                                             |         
u5:64   | Struct         | UserRepository     | _c::_m::repository::UserRepository                             | [global]
u5:65   | Field          | storage            | _c::_m::repository::UserRepository::storage                    |         
u5:66   | Field          | next_id            | _c::_m::repository::UserRepository::next_id                    |         
u5:67   | Function       | new                | _c::_m::repository::UserRepository::new                        | [global]
u5:68   | Function       | find_by_id         | _c::_m::repository::UserRepository::find_by_id                 | [global]
u5:69   | Variable       | id                 | _c::_m::repository::UserRepository::find_by_id::id             |         
u5:70   | Function       | find_by_email      | _c::_m::repository::UserRepository::find_by_email              | [global]
u5:71   | Variable       | email              | _c::_m::repository::UserRepository::find_by_email::email       |         
u5:72   | Variable       | u                  | _c::_m::repository::UserRepository::find_by_email::u           |         
u5:73   | Function       | insert             | _c::_m::repository::UserRepository::insert                     | [global]
u5:74   | Variable       | email              | _c::_m::repository::UserRepository::insert::email              |         
u5:75   | Variable       | password_hash      | _c::_m::repository::UserRepository::insert::password_hash      |         
u5:76   | Variable       | user               | _c::_m::repository::UserRepository::insert::user               |         
u6:77   | Crate          | crate              | _c::crate                                                      |         
u6:78   | File           | lib                | _c::lib                                                        |         
u7:79   | Crate          | crate              | _c::crate                                                      |         
u7:80   | Module         | _m                 | _c::_m                                                         |         
u7:81   | File           | main               | _c::_m::main                                                   |         
u7:82   | Function       | main               | _c::_m::main::main                                             |         
u7:83   | Variable       | repo               | _c::_m::main::main::repo                                       |         
u7:84   | Variable       | user_service       | _c::_m::main::main::user_service                               |         
u7:85   | Variable       | req                | _c::_m::main::main::req                                        |         
u7:86   | Variable       | created            | _c::_m::main::main::created                                    |         
u8:87   | Crate          | crate              | _c::crate                                                      |         
u8:88   | Module         | _m                 | _c::_m                                                         |         
u8:89   | File           | auth_service       | _c::_m::auth_service                                           |         
u8:90   | Struct         | AuthService        | _c::_m::auth_service::AuthService                              | [global]
u8:91   | Field          | repo               | _c::_m::auth_service::AuthService::repo                        |         
u8:92   | Function       | new                | _c::_m::auth_service::AuthService::new                         | [global]
u8:93   | Variable       | repo               | _c::_m::auth_service::AuthService::new::repo                   |         
u8:94   | Function       | authenticate       | _c::_m::auth_service::AuthService::authenticate                | [global]
u8:95   | Variable       | email              | _c::_m::auth_service::AuthService::authenticate::email         |         
u8:96   | Variable       | password           | _c::_m::auth_service::AuthService::authenticate::password      |         
u8:97   | Variable       | user               | _c::_m::auth_service::AuthService::authenticate::user          |         
u8:98   | Variable       | expected_hash      | _c::_m::auth_service::AuthService::authenticate::expected_hash |         
u9:99   | Crate          | crate              | _c::crate                                                      |         
u9:100  | Module         | service            | _c::service                                                    |         
u9:101  | File           | mod                | _c::service::mod                                               |         
u10:102 | Crate          | crate              | _c::crate                                                      |         
u10:103 | Module         | _m                 | _c::_m                                                         |         
u10:104 | File           | user_service       | _c::_m::user_service                                           |         
u10:105 | Struct         | UserService        | _c::_m::user_service::UserService                              | [global]
u10:106 | Field          | repo               | _c::_m::user_service::UserService::repo                        |         
u10:107 | Function       | new                | _c::_m::user_service::UserService::new                         | [global]
u10:108 | Variable       | repo               | _c::_m::user_service::UserService::new::repo                   |         
u10:109 | Function       | get_user           | _c::_m::user_service::UserService::get_user                    | [global]
u10:110 | Variable       | id                 | _c::_m::user_service::UserService::get_user::id                |         
u10:111 | Function       | create_user        | _c::_m::user_service::UserService::create_user                 | [global]
u10:112 | Variable       | email              | _c::_m::user_service::UserService::create_user::email          |         
u10:113 | Variable       | password           | _c::_m::user_service::UserService::create_user::password       |         
u10:114 | Variable       | hash               | _c::_m::user_service::UserService::create_user::hash           |         

--- expect:symbol-deps ---
u0:17 <- [u10:111, u10:114, u5:70, u5:71, u8:94, u8:95, u8:96, u8:98]
u0:18 <- [u0:23, u0:25, u0:29, u0:30, u0:31, u0:32, u0:33, u0:34, u10:111, u10:112, u10:113, u3:54, u3:56, u3:57, u5:73, u5:74, u5:75]
u0:23 -> [u0:18, u0:8]
u0:23 <- [u0:27]
u0:24 -> [u0:8]
u0:25 -> [u0:18]
u0:27 -> [u0:23, u3:54]
u0:27 <- [u1:41]
u0:28 -> [u3:54]
u0:29 -> [u0:18]
u0:29 <- [u1:41, u1:43, u7:82, u7:85]
u0:30 -> [u0:18]
u0:31 -> [u0:18]
u0:32 -> [u0:18]
u0:32 <- [u1:45, u1:47]
u0:33 -> [u0:18]
u0:34 -> [u0:18]
u0:8 <- [u0:23, u0:24, u10:109, u10:110, u1:38, u1:40, u3:54, u3:55, u5:64, u5:66, u5:68, u5:69]
u10:105 -> [u10:109, u10:111, u5:64]
u10:105 <- [u10:107, u1:38, u1:39, u1:41, u1:42, u1:44]
u10:106 -> [u5:64]
u10:107 -> [u10:105, u5:64]
u10:107 <- [u7:82, u7:84]
u10:108 -> [u5:64]
u10:109 -> [u0:8, u5:68]
u10:109 <- [u10:105, u1:38]
u10:110 -> [u0:8]
u10:111 -> [u0:17, u0:18, u5:73]
u10:111 <- [u10:105, u1:41]
u10:112 -> [u0:18]
u10:113 -> [u0:18]
u10:114 -> [u0:17]
u1:38 -> [u0:8, u10:105, u10:109]
u1:38 <- [u7:82]
u1:39 -> [u10:105]
u1:40 -> [u0:8]
u1:41 -> [u0:27, u0:29, u10:105, u10:111]
u1:41 <- [u7:82, u7:86]
u1:42 -> [u10:105]
u1:43 -> [u0:29]
u1:44 -> [u10:105]
u1:45 -> [u0:32, u8:90, u8:94]
u1:46 -> [u8:90]
u1:47 -> [u0:32]
u3:54 -> [u0:18, u0:8]
u3:54 <- [u0:27, u0:28, u5:64, u5:65, u5:73, u5:76]
u3:55 -> [u0:8]
u3:56 -> [u0:18]
u3:57 -> [u0:18]
u5:64 -> [u0:8, u3:54, u5:68, u5:70, u5:73]
u5:64 <- [u10:105, u10:106, u10:107, u10:108, u5:67, u7:82, u7:83, u8:90, u8:91, u8:92, u8:93, u8:94, u8:97]
u5:65 -> [u3:54]
u5:66 -> [u0:8]
u5:67 -> [u5:64]
u5:67 <- [u7:82]
u5:68 -> [u0:8]
u5:68 <- [u10:109, u5:64]
u5:69 -> [u0:8]
u5:70 -> [u0:17]
u5:70 <- [u5:64, u8:94]
u5:71 -> [u0:17]
u5:73 -> [u0:18, u3:54]
u5:73 <- [u10:111, u5:64]
u5:74 -> [u0:18]
u5:75 -> [u0:18]
u5:76 -> [u3:54]
u7:82 -> [u0:29, u10:107, u1:38, u1:41, u5:64, u5:67]
u7:83 -> [u5:64]
u7:84 -> [u10:107]
u7:85 -> [u0:29]
u7:86 -> [u1:41]
u8:90 -> [u5:64, u8:94]
u8:90 <- [u1:45, u1:46, u8:92]
u8:91 -> [u5:64]
u8:92 -> [u5:64, u8:90]
u8:93 -> [u5:64]
u8:94 -> [u0:17, u5:64, u5:70]
u8:94 <- [u1:45, u8:90]
u8:95 -> [u0:17]
u8:96 -> [u0:17]
u8:97 -> [u5:64]
u8:98 -> [u0:17]


===============================================================================
hexagonal-architecture
===============================================================================
Tests hexagonal (ports & adapters) architecture: domain core, ports (traits), adapters (implementations).

--- file: src/lib.rs ---
pub mod domain;
pub mod ports;
pub mod adapters;
pub mod application;

--- file: src/domain/mod.rs ---
mod order;
mod product;

pub use order::{Order, OrderStatus};
pub use product::Product;

--- file: src/domain/product.rs ---
#[derive(Clone)]
pub struct Product {
    pub id: u64,
    pub name: String,
    pub price: f64,
    pub stock: u32,
}

--- file: src/domain/order.rs ---
use super::product::Product;

#[derive(Clone, PartialEq)]
pub enum OrderStatus {
    Pending,
    Confirmed,
    Shipped,
    Delivered,
}

#[derive(Clone)]
pub struct Order {
    pub id: u64,
    pub products: Vec<(Product, u32)>,  // (product, quantity)
    pub status: OrderStatus,
}

impl Order {
    pub fn new(id: u64) -> Self {
        Order { id, products: Vec::new(), status: OrderStatus::Pending }
    }

    pub fn add_product(&mut self, product: Product, quantity: u32) {
        self.products.push((product, quantity));
    }

    pub fn total(&self) -> f64 {
        self.products.iter().map(|(p, q)| p.price * *q as f64).sum()
    }

    pub fn confirm(&mut self) {
        self.status = OrderStatus::Confirmed;
    }
}

--- file: src/ports/mod.rs ---
mod inbound;
mod outbound;

pub use inbound::*;
pub use outbound::*;

--- file: src/ports/inbound.rs ---
use crate::domain::{Order, Product};

// Inbound port - what the application offers
pub trait OrderUseCase {
    fn create_order(&mut self) -> Order;
    fn add_to_order(&mut self, order_id: u64, product_id: u64, quantity: u32) -> bool;
    fn confirm_order(&mut self, order_id: u64) -> bool;
    fn get_order(&self, order_id: u64) -> Option<Order>;
}

pub trait ProductUseCase {
    fn get_product(&self, id: u64) -> Option<Product>;
    fn list_products(&self) -> Vec<Product>;
}

--- file: src/ports/outbound.rs ---
use crate::domain::{Order, Product};

// Outbound port - what the application needs
pub trait OrderRepository {
    fn save(&mut self, order: Order) -> u64;
    fn find_by_id(&self, id: u64) -> Option<Order>;
    fn update(&mut self, order: Order) -> bool;
}

pub trait ProductRepository {
    fn find_by_id(&self, id: u64) -> Option<Product>;
    fn find_all(&self) -> Vec<Product>;
}

pub trait NotificationService {
    fn notify_order_confirmed(&self, order: &Order);
}

--- file: src/adapters/mod.rs ---
mod memory_order_repo;
mod memory_product_repo;
mod email_notification;

pub use memory_order_repo::InMemoryOrderRepo;
pub use memory_product_repo::InMemoryProductRepo;
pub use email_notification::EmailNotification;

--- file: src/adapters/memory_order_repo.rs ---
use crate::domain::Order;
use crate::ports::OrderRepository;
use std::collections::HashMap;

pub struct InMemoryOrderRepo {
    orders: HashMap<u64, Order>,
    next_id: u64,
}

impl InMemoryOrderRepo {
    pub fn new() -> Self {
        InMemoryOrderRepo { orders: HashMap::new(), next_id: 1 }
    }
}

impl OrderRepository for InMemoryOrderRepo {
    fn save(&mut self, mut order: Order) -> u64 {
        order.id = self.next_id;
        self.next_id += 1;
        let id = order.id;
        self.orders.insert(id, order);
        id
    }

    fn find_by_id(&self, id: u64) -> Option<Order> {
        self.orders.get(&id).cloned()
    }

    fn update(&mut self, order: Order) -> bool {
        if self.orders.contains_key(&order.id) {
            self.orders.insert(order.id, order);
            true
        } else {
            false
        }
    }
}

--- file: src/adapters/memory_product_repo.rs ---
use crate::domain::Product;
use crate::ports::ProductRepository;
use std::collections::HashMap;

pub struct InMemoryProductRepo {
    products: HashMap<u64, Product>,
}

impl InMemoryProductRepo {
    pub fn new() -> Self {
        let mut products = HashMap::new();
        products.insert(1, Product { id: 1, name: "Widget".to_string(), price: 9.99, stock: 100 });
        products.insert(2, Product { id: 2, name: "Gadget".to_string(), price: 19.99, stock: 50 });
        InMemoryProductRepo { products }
    }
}

impl ProductRepository for InMemoryProductRepo {
    fn find_by_id(&self, id: u64) -> Option<Product> {
        self.products.get(&id).cloned()
    }

    fn find_all(&self) -> Vec<Product> {
        self.products.values().cloned().collect()
    }
}

--- file: src/adapters/email_notification.rs ---
use crate::domain::Order;
use crate::ports::NotificationService;

pub struct EmailNotification;

impl NotificationService for EmailNotification {
    fn notify_order_confirmed(&self, order: &Order) {
        println!("Email: Order {} confirmed, total: ${:.2}", order.id, order.total());
    }
}

--- file: src/application/mod.rs ---
mod order_service;

pub use order_service::OrderService;

--- file: src/application/order_service.rs ---
use crate::domain::Order;
use crate::ports::{OrderUseCase, OrderRepository, ProductRepository, NotificationService};

pub struct OrderService<O: OrderRepository, P: ProductRepository, N: NotificationService> {
    order_repo: O,
    product_repo: P,
    notification: N,
}

impl<O: OrderRepository, P: ProductRepository, N: NotificationService> OrderService<O, P, N> {
    pub fn new(order_repo: O, product_repo: P, notification: N) -> Self {
        OrderService { order_repo, product_repo, notification }
    }
}

impl<O: OrderRepository, P: ProductRepository, N: NotificationService> OrderUseCase for OrderService<O, P, N> {
    fn create_order(&mut self) -> Order {
        let order = Order::new(0);
        let id = self.order_repo.save(order);
        self.order_repo.find_by_id(id).unwrap()
    }

    fn add_to_order(&mut self, order_id: u64, product_id: u64, quantity: u32) -> bool {
        let product = match self.product_repo.find_by_id(product_id) {
            Some(p) => p,
            None => return false,
        };

        let mut order = match self.order_repo.find_by_id(order_id) {
            Some(o) => o,
            None => return false,
        };

        order.add_product(product, quantity);
        self.order_repo.update(order)
    }

    fn confirm_order(&mut self, order_id: u64) -> bool {
        let mut order = match self.order_repo.find_by_id(order_id) {
            Some(o) => o,
            None => return false,
        };

        order.confirm();
        self.notification.notify_order_confirmed(&order);
        self.order_repo.update(order)
    }

    fn get_order(&self, order_id: u64) -> Option<Order> {
        self.order_repo.find_by_id(order_id)
    }
}

--- file: src/main.rs ---
mod domain;
mod ports;
mod adapters;
mod application;

use adapters::{InMemoryOrderRepo, InMemoryProductRepo, EmailNotification};
use application::OrderService;
use ports::OrderUseCase;

fn main() {
    let order_repo = InMemoryOrderRepo::new();
    let product_repo = InMemoryProductRepo::new();
    let notification = EmailNotification;

    let mut service = OrderService::new(order_repo, product_repo, notification);

    let order = service.create_order();
    service.add_to_order(order.id, 1, 2);  // 2 Widgets
    service.add_to_order(order.id, 2, 1);  // 1 Gadget
    service.confirm_order(order.id);

    if let Some(confirmed) = service.get_order(order.id) {
        println!("Order {} confirmed, total: ${:.2}", confirmed.id, confirmed.total());
    }
}

--- expect:symbols ---
u0:1    | Primitive      | i32                    | i32                                                                          | [global]
u0:2    | Primitive      | i64                    | i64                                                                          | [global]
u0:3    | Primitive      | i16                    | i16                                                                          | [global]
u0:4    | Primitive      | i8                     | i8                                                                           | [global]
u0:5    | Primitive      | i128                   | i128                                                                         | [global]
u0:6    | Primitive      | isize                  | isize                                                                        | [global]
u0:7    | Primitive      | u32                    | u32                                                                          | [global]
u0:8    | Primitive      | u64                    | u64                                                                          | [global]
u0:9    | Primitive      | u16                    | u16                                                                          | [global]
u0:10   | Primitive      | u8                     | u8                                                                           | [global]
u0:11   | Primitive      | u128                   | u128                                                                         | [global]
u0:12   | Primitive      | usize                  | usize                                                                        | [global]
u0:13   | Primitive      | f32                    | f32                                                                          | [global]
u0:14   | Primitive      | f64                    | f64                                                                          | [global]
u0:15   | Primitive      | bool                   | bool                                                                         | [global]
u0:16   | Primitive      | char                   | char                                                                         | [global]
u0:17   | Primitive      | str                    | str                                                                          | [global]
u0:18   | Primitive      | String                 | String                                                                       | [global]
u0:19   | Crate          | _c                     | _c                                                                           | [global]
u0:20   | Crate          | crate                  | _c::crate                                                                    |         
u0:21   | Module         | _m                     | _c::_m                                                                       |         
u0:22   | File           | email_notification     | _c::_m::email_notification                                                   |         
u0:23   | Struct         | EmailNotification      | _c::_m::email_notification::EmailNotification                                | [global]
u0:24   | UnresolvedType | NotificationService    | _c::_m::email_notification::NotificationService                              |         
u0:25   | Function       | notify_order_confirmed | _c::_m::email_notification::EmailNotification::notify_order_confirmed        |         
u0:26   | Variable       | order                  | _c::_m::email_notification::EmailNotification::notify_order_confirmed::order |         
u1:27   | Crate          | crate                  | _c::crate                                                                    |         
u1:28   | Module         | _m                     | _c::_m                                                                       |         
u1:29   | File           | memory_order_repo      | _c::_m::memory_order_repo                                                    |         
u1:30   | Struct         | InMemoryOrderRepo      | _c::_m::memory_order_repo::InMemoryOrderRepo                                 | [global]
u1:31   | Field          | orders                 | _c::_m::memory_order_repo::InMemoryOrderRepo::orders                         |         
u1:32   | Field          | next_id                | _c::_m::memory_order_repo::InMemoryOrderRepo::next_id                        |         
u1:33   | Function       | new                    | _c::_m::memory_order_repo::InMemoryOrderRepo::new                            | [global]
u1:34   | UnresolvedType | OrderRepository        | _c::_m::memory_order_repo::OrderRepository                                   |         
u1:35   | Function       | save                   | _c::_m::memory_order_repo::InMemoryOrderRepo::save                           |         
u1:36   | Variable       | order                  | _c::_m::memory_order_repo::InMemoryOrderRepo::save::order                    |         
u1:37   | Variable       | id                     | _c::_m::memory_order_repo::InMemoryOrderRepo::save::id                       |         
u1:38   | Function       | find_by_id             | _c::_m::memory_order_repo::InMemoryOrderRepo::find_by_id                     |         
u1:39   | Variable       | id                     | _c::_m::memory_order_repo::InMemoryOrderRepo::find_by_id::id                 |         
u1:40   | Function       | update                 | _c::_m::memory_order_repo::InMemoryOrderRepo::update                         |         
u1:41   | Variable       | order                  | _c::_m::memory_order_repo::InMemoryOrderRepo::update::order                  |         
u2:42   | Crate          | crate                  | _c::crate                                                                    |         
u2:43   | Module         | _m                     | _c::_m                                                                       |         
u2:44   | File           | memory_product_repo    | _c::_m::memory_product_repo                                                  |         
u2:45   | Struct         | InMemoryProductRepo    | _c::_m::memory_product_repo::InMemoryProductRepo                             | [global]
u2:46   | Field          | products               | _c::_m::memory_product_repo::InMemoryProductRepo::products                   |         
u2:47   | Function       | new                    | _c::_m::memory_product_repo::InMemoryProductRepo::new                        | [global]
u2:48   | Variable       | products               | _c::_m::memory_product_repo::InMemoryProductRepo::new::products              |         
u2:49   | UnresolvedType | ProductRepository      | _c::_m::memory_product_repo::ProductRepository                               |         
u2:50   | Function       | find_by_id             | _c::_m::memory_product_repo::InMemoryProductRepo::find_by_id                 |         
u2:51   | Variable       | id                     | _c::_m::memory_product_repo::InMemoryProductRepo::find_by_id::id             |         
u2:52   | Function       | find_all               | _c::_m::memory_product_repo::InMemoryProductRepo::find_all                   |         
u3:53   | Crate          | crate                  | _c::crate                                                                    |         
u3:54   | Module         | adapters               | _c::adapters                                                                 |         
u3:55   | File           | mod                    | _c::adapters::mod                                                            |         
u4:56   | Crate          | crate                  | _c::crate                                                                    |         
u4:57   | Module         | application            | _c::application                                                              |         
u4:58   | File           | mod                    | _c::application::mod                                                         |         
u5:59   | Crate          | crate                  | _c::crate                                                                    |         
u5:60   | Module         | _m                     | _c::_m                                                                       |         
u5:61   | File           | order_service          | _c::_m::order_service                                                        |         
u5:62   | Struct         | OrderService           | _c::_m::order_service::OrderService                                          | [global]
u5:63   | TypeParameter  | O                      | _c::_m::order_service::OrderService::O                                       |         
u5:64   | TypeParameter  | P                      | _c::_m::order_service::OrderService::P                                       |         
u5:65   | TypeParameter  | N                      | _c::_m::order_service::OrderService::N                                       |         
u5:66   | Field          | order_repo             | _c::_m::order_service::OrderService::order_repo                              |         
u5:67   | Field          | product_repo           | _c::_m::order_service::OrderService::product_repo                            |         
u5:68   | Field          | notification           | _c::_m::order_service::OrderService::notification                            |         
u5:69   | Function       | new                    | _c::_m::order_service::OrderService::new                                     | [global]
u5:70   | Variable       | order_repo             | _c::_m::order_service::OrderService::new::order_repo                         |         
u5:71   | Variable       | product_repo           | _c::_m::order_service::OrderService::new::product_repo                       |         
u5:72   | Variable       | notification           | _c::_m::order_service::OrderService::new::notification                       |         
u5:73   | UnresolvedType | OrderUseCase           | _c::_m::order_service::OrderUseCase                                          |         
u5:74   | Function       | create_order           | _c::_m::order_service::OrderService::create_order                            |         
u5:75   | Variable       | order                  | _c::_m::order_service::OrderService::create_order::order                     |         
u5:76   | Variable       | id                     | _c::_m::order_service::OrderService::create_order::id                        |         
u5:77   | Function       | add_to_order           | _c::_m::order_service::OrderService::add_to_order                            |         
u5:78   | Variable       | order_id               | _c::_m::order_service::OrderService::add_to_order::order_id                  |         
u5:79   | Variable       | product_id             | _c::_m::order_service::OrderService::add_to_order::product_id                |         
u5:80   | Variable       | quantity               | _c::_m::order_service::OrderService::add_to_order::quantity                  |         
u5:81   | Variable       | product                | _c::_m::order_service::OrderService::add_to_order::product                   |         
u5:82   | Variable       | order                  | _c::_m::order_service::OrderService::add_to_order::order                     |         
u5:83   | Function       | confirm_order          | _c::_m::order_service::OrderService::confirm_order                           |         
u5:84   | Variable       | order_id               | _c::_m::order_service::OrderService::confirm_order::order_id                 |         
u5:85   | Variable       | order                  | _c::_m::order_service::OrderService::confirm_order::order                    |         
u5:86   | Function       | get_order              | _c::_m::order_service::OrderService::get_order                               |         
u5:87   | Variable       | order_id               | _c::_m::order_service::OrderService::get_order::order_id                     |         
u6:88   | Crate          | crate                  | _c::crate                                                                    |         
u6:89   | Module         | domain                 | _c::domain                                                                   |         
u6:90   | File           | mod                    | _c::domain::mod                                                              |         
u7:91   | Crate          | crate                  | _c::crate                                                                    |         
u7:92   | Module         | _m                     | _c::_m                                                                       |         
u7:93   | File           | order                  | _c::_m::order                                                                |         
u7:94   | Enum           | OrderStatus            | _c::_m::order::OrderStatus                                                   | [global]
u7:95   | EnumVariant    | Pending                | _c::_m::order::OrderStatus::Pending                                          |         
u7:96   | EnumVariant    | Confirmed              | _c::_m::order::OrderStatus::Confirmed                                        |         
u7:97   | EnumVariant    | Shipped                | _c::_m::order::OrderStatus::Shipped                                          |         
u7:98   | EnumVariant    | Delivered              | _c::_m::order::OrderStatus::Delivered                                        |         
u7:99   | Struct         | Order                  | _c::_m::order::Order                                                         | [global]
u7:100  | Field          | id                     | _c::_m::order::Order::id                                                     |         
u7:101  | Field          | products               | _c::_m::order::Order::products                                               |         
u7:102  | Field          | status                 | _c::_m::order::Order::status                                                 |         
u7:103  | Function       | new                    | _c::_m::order::Order::new                                                    | [global]
u7:104  | Variable       | id                     | _c::_m::order::Order::new::id                                                |         
u7:105  | Function       | add_product            | _c::_m::order::Order::add_product                                            | [global]
u7:106  | Variable       | product                | _c::_m::order::Order::add_product::product                                   |         
u7:107  | Variable       | quantity               | _c::_m::order::Order::add_product::quantity                                  |         
u7:108  | Function       | total                  | _c::_m::order::Order::total                                                  | [global]
u7:109  | Variable       | p                      | _c::_m::order::Order::total::p                                               |         
u7:110  | Variable       | q                      | _c::_m::order::Order::total::q                                               |         
u7:111  | Function       | confirm                | _c::_m::order::Order::confirm                                                | [global]
u8:112  | Crate          | crate                  | _c::crate                                                                    |         
u8:113  | Module         | _m                     | _c::_m                                                                       |         
u8:114  | File           | product                | _c::_m::product                                                              |         
u8:115  | Struct         | Product                | _c::_m::product::Product                                                     | [global]
u8:116  | Field          | id                     | _c::_m::product::Product::id                                                 |         
u8:117  | Field          | name                   | _c::_m::product::Product::name                                               |         
u8:118  | Field          | price                  | _c::_m::product::Product::price                                              |         
u8:119  | Field          | stock                  | _c::_m::product::Product::stock                                              |         
u9:120  | Crate          | crate                  | _c::crate                                                                    |         
u9:121  | File           | lib                    | _c::lib                                                                      |         
u10:122 | Crate          | crate                  | _c::crate                                                                    |         
u10:123 | Module         | _m                     | _c::_m                                                                       |         
u10:124 | File           | main                   | _c::_m::main                                                                 |         
u10:125 | Function       | main                   | _c::_m::main::main                                                           |         
u10:126 | Variable       | order_repo             | _c::_m::main::main::order_repo                                               |         
u10:127 | Variable       | product_repo           | _c::_m::main::main::product_repo                                             |         
u10:128 | Variable       | notification           | _c::_m::main::main::notification                                             |         
u10:129 | Variable       | service                | _c::_m::main::main::service                                                  |         
u10:130 | Variable       | order                  | _c::_m::main::main::order                                                    |         
u11:131 | Crate          | crate                  | _c::crate                                                                    |         
u11:132 | Module         | _m                     | _c::_m                                                                       |         
u11:133 | File           | inbound                | _c::_m::inbound                                                              |         
u11:134 | Trait          | OrderUseCase           | _c::_m::inbound::OrderUseCase                                                | [global]
u11:135 | Function       | create_order           | _c::_m::inbound::OrderUseCase::create_order                                  |         
u11:136 | Function       | add_to_order           | _c::_m::inbound::OrderUseCase::add_to_order                                  |         
u11:137 | Variable       | order_id               | _c::_m::inbound::OrderUseCase::add_to_order::order_id                        |         
u11:138 | Variable       | product_id             | _c::_m::inbound::OrderUseCase::add_to_order::product_id                      |         
u11:139 | Variable       | quantity               | _c::_m::inbound::OrderUseCase::add_to_order::quantity                        |         
u11:140 | Function       | confirm_order          | _c::_m::inbound::OrderUseCase::confirm_order                                 |         
u11:141 | Variable       | order_id               | _c::_m::inbound::OrderUseCase::confirm_order::order_id                       |         
u11:142 | Function       | get_order              | _c::_m::inbound::OrderUseCase::get_order                                     |         
u11:143 | Variable       | order_id               | _c::_m::inbound::OrderUseCase::get_order::order_id                           |         
u11:144 | Trait          | ProductUseCase         | _c::_m::inbound::ProductUseCase                                              | [global]
u11:145 | Function       | get_product            | _c::_m::inbound::ProductUseCase::get_product                                 |         
u11:146 | Variable       | id                     | _c::_m::inbound::ProductUseCase::get_product::id                             |         
u11:147 | Function       | list_products          | _c::_m::inbound::ProductUseCase::list_products                               |         
u12:148 | Crate          | crate                  | _c::crate                                                                    |         
u12:149 | Module         | ports                  | _c::ports                                                                    |         
u12:150 | File           | mod                    | _c::ports::mod                                                               |         
u13:151 | Crate          | crate                  | _c::crate                                                                    |         
u13:152 | Module         | _m                     | _c::_m                                                                       |         
u13:153 | File           | outbound               | _c::_m::outbound                                                             |         
u13:154 | Trait          | OrderRepository        | _c::_m::outbound::OrderRepository                                            | [global]
u13:155 | Function       | save                   | _c::_m::outbound::OrderRepository::save                                      |         
u13:156 | Variable       | order                  | _c::_m::outbound::OrderRepository::save::order                               |         
u13:157 | Function       | find_by_id             | _c::_m::outbound::OrderRepository::find_by_id                                |         
u13:158 | Variable       | id                     | _c::_m::outbound::OrderRepository::find_by_id::id                            |         
u13:159 | Function       | update                 | _c::_m::outbound::OrderRepository::update                                    |         
u13:160 | Variable       | order                  | _c::_m::outbound::OrderRepository::update::order                             |         
u13:161 | Trait          | ProductRepository      | _c::_m::outbound::ProductRepository                                          | [global]
u13:162 | Function       | find_all               | _c::_m::outbound::ProductRepository::find_all                                |         
u13:163 | Trait          | NotificationService    | _c::_m::outbound::NotificationService                                        | [global]
u13:164 | Function       | notify_order_confirmed | _c::_m::outbound::NotificationService::notify_order_confirmed                |         
u13:165 | Variable       | order                  | _c::_m::outbound::NotificationService::notify_order_confirmed::order         |         

--- expect:symbol-deps ---
u0:14 <- [u7:108, u8:115, u8:118]
u0:15 <- [u11:136, u11:140, u13:159, u1:40, u5:77, u5:83]
u0:18 <- [u8:115, u8:117]
u0:23 -> [u0:25]
u0:23 <- [u10:125, u10:128]
u0:25 -> [u7:99]
u0:25 <- [u0:23]
u0:26 -> [u7:99]
u0:7 <- [u11:136, u11:139, u5:77, u5:80, u7:105, u7:107, u7:99, u8:115, u8:119]
u0:8 <- [u11:136, u11:137, u11:138, u11:140, u11:141, u11:142, u11:143, u11:145, u11:146, u13:155, u13:157, u13:158, u1:30, u1:32, u1:35, u1:38, u1:39, u2:45, u2:50, u2:51, u5:77, u5:78, u5:79, u5:83, u5:84, u5:86, u5:87, u7:100, u7:103, u7:104, u7:99, u8:115, u8:116]
u10:125 -> [u0:23, u11:135, u11:136, u11:140, u11:142, u1:30, u1:33, u2:45, u2:47, u5:69]
u10:126 -> [u1:30]
u10:127 -> [u2:45]
u10:128 -> [u0:23]
u10:129 -> [u5:69]
u10:130 -> [u5:69]
u11:134 -> [u11:135, u11:136, u11:140, u11:142]
u11:135 <- [u10:125, u11:134]
u11:136 -> [u0:15, u0:7, u0:8]
u11:136 <- [u10:125, u11:134]
u11:137 -> [u0:8]
u11:138 -> [u0:8]
u11:139 -> [u0:7]
u11:140 -> [u0:15, u0:8]
u11:140 <- [u10:125, u11:134]
u11:141 -> [u0:8]
u11:142 -> [u0:8]
u11:142 <- [u10:125, u11:134]
u11:143 -> [u0:8]
u11:144 -> [u11:145, u11:147]
u11:145 -> [u0:8]
u11:145 <- [u11:144]
u11:146 -> [u0:8]
u11:147 <- [u11:144]
u13:154 -> [u13:155, u13:157, u13:159]
u13:154 <- [u5:62]
u13:155 -> [u0:8, u7:99]
u13:155 <- [u13:154, u5:74]
u13:156 -> [u7:99]
u13:157 -> [u0:8]
u13:157 <- [u13:154, u13:161, u5:74, u5:77, u5:83, u5:86]
u13:158 -> [u0:8]
u13:159 -> [u0:15, u7:99]
u13:159 <- [u13:154, u5:77, u5:83]
u13:160 -> [u7:99]
u13:161 -> [u13:157, u13:162]
u13:161 <- [u5:62]
u13:162 <- [u13:161]
u13:163 -> [u13:164]
u13:163 <- [u5:62]
u13:164 -> [u7:99]
u13:164 <- [u13:163, u5:83]
u13:165 -> [u7:99]
u1:30 -> [u0:8, u1:35, u1:38, u1:40, u7:99]
u1:30 <- [u10:125, u10:126, u1:33]
u1:31 -> [u7:99]
u1:32 -> [u0:8]
u1:33 -> [u1:30]
u1:33 <- [u10:125]
u1:35 -> [u0:8, u7:99]
u1:35 <- [u1:30]
u1:36 -> [u7:99]
u1:37 -> [u7:99]
u1:38 -> [u0:8]
u1:38 <- [u1:30]
u1:39 -> [u0:8]
u1:40 -> [u0:15, u7:99]
u1:40 <- [u1:30]
u1:41 -> [u7:99]
u2:45 -> [u0:8, u2:50, u2:52, u8:115]
u2:45 <- [u10:125, u10:127, u2:47]
u2:46 -> [u8:115]
u2:47 -> [u2:45, u8:115]
u2:47 <- [u10:125]
u2:50 -> [u0:8]
u2:50 <- [u2:45]
u2:51 -> [u0:8]
u2:52 <- [u2:45]
u5:62 -> [u13:154, u13:161, u13:163, u5:74, u5:77, u5:83, u5:86]
u5:62 <- [u5:69]
u5:69 -> [u5:62]
u5:69 <- [u10:125, u10:129, u10:130]
u5:74 -> [u13:155, u13:157, u7:103, u7:99]
u5:74 <- [u5:62]
u5:75 -> [u7:99]
u5:77 -> [u0:15, u0:7, u0:8, u13:157, u13:159, u7:105]
u5:77 <- [u5:62]
u5:78 -> [u0:8]
u5:79 -> [u0:8]
u5:80 -> [u0:7]
u5:83 -> [u0:15, u0:8, u13:157, u13:159, u13:164, u7:111]
u5:83 <- [u5:62]
u5:84 -> [u0:8]
u5:86 -> [u0:8, u13:157]
u5:86 <- [u5:62]
u5:87 -> [u0:8]
u7:100 -> [u0:8]
u7:101 -> [u8:115]
u7:102 -> [u7:94]
u7:103 -> [u0:8, u7:94, u7:95, u7:99]
u7:103 <- [u5:74]
u7:104 -> [u0:8]
u7:105 -> [u0:7, u8:115]
u7:105 <- [u5:77, u7:99]
u7:106 -> [u8:115]
u7:107 -> [u0:7]
u7:108 -> [u0:14]
u7:108 <- [u7:99]
u7:111 -> [u7:94, u7:96]
u7:111 <- [u5:83, u7:99]
u7:94 -> [u7:95, u7:96, u7:97, u7:98]
u7:94 <- [u7:102, u7:103, u7:111, u7:99]
u7:95 <- [u7:103, u7:94]
u7:96 <- [u7:111, u7:94]
u7:97 <- [u7:94]
u7:98 <- [u7:94]
u7:99 -> [u0:7, u0:8, u7:105, u7:108, u7:111, u7:94, u8:115]
u7:99 <- [u0:25, u0:26, u13:155, u13:156, u13:159, u13:160, u13:164, u13:165, u1:30, u1:31, u1:35, u1:36, u1:37, u1:40, u1:41, u5:74, u5:75, u7:103]
u8:115 -> [u0:14, u0:18, u0:7, u0:8]
u8:115 <- [u2:45, u2:46, u2:47, u7:101, u7:105, u7:106, u7:99]
u8:116 -> [u0:8]
u8:117 -> [u0:18]
u8:118 -> [u0:14]
u8:119 -> [u0:7]


===============================================================================
clean-architecture
===============================================================================
Tests clean architecture: entities (core), use_cases (app logic), interface_adapters, frameworks (external).

--- file: src/lib.rs ---
pub mod entities;
pub mod use_cases;
pub mod interface_adapters;
pub mod frameworks;

--- file: src/entities/mod.rs ---
mod task;

pub use task::{Task, TaskStatus, Priority};

--- file: src/entities/task.rs ---
#[derive(Clone, PartialEq)]
pub enum TaskStatus {
    Todo,
    InProgress,
    Done,
}

#[derive(Clone, PartialEq, PartialOrd)]
pub enum Priority {
    Low,
    Medium,
    High,
}

#[derive(Clone)]
pub struct Task {
    pub id: u64,
    pub title: String,
    pub description: Option<String>,
    pub status: TaskStatus,
    pub priority: Priority,
}

impl Task {
    pub fn new(id: u64, title: String, priority: Priority) -> Self {
        Task {
            id,
            title,
            description: None,
            status: TaskStatus::Todo,
            priority,
        }
    }

    pub fn start(&mut self) {
        self.status = TaskStatus::InProgress;
    }

    pub fn complete(&mut self) {
        self.status = TaskStatus::Done;
    }

    pub fn is_done(&self) -> bool {
        self.status == TaskStatus::Done
    }
}

--- file: src/use_cases/mod.rs ---
mod task_use_cases;
mod ports;

pub use task_use_cases::*;
pub use ports::*;

--- file: src/use_cases/ports.rs ---
use crate::entities::Task;

// Output port - use case boundary
pub trait TaskGateway {
    fn save(&mut self, task: Task) -> u64;
    fn find_by_id(&self, id: u64) -> Option<Task>;
    fn find_all(&self) -> Vec<Task>;
    fn update(&mut self, task: Task) -> bool;
    fn delete(&mut self, id: u64) -> bool;
}

pub trait TaskPresenter {
    fn present_task(&self, task: &Task);
    fn present_task_list(&self, tasks: &[Task]);
    fn present_error(&self, message: &str);
}

--- file: src/use_cases/task_use_cases.rs ---
use crate::entities::{Task, Priority};
use super::ports::{TaskGateway, TaskPresenter};

pub struct CreateTaskUseCase<'a, G: TaskGateway, P: TaskPresenter> {
    gateway: &'a mut G,
    presenter: &'a P,
}

impl<'a, G: TaskGateway, P: TaskPresenter> CreateTaskUseCase<'a, G, P> {
    pub fn new(gateway: &'a mut G, presenter: &'a P) -> Self {
        CreateTaskUseCase { gateway, presenter }
    }

    pub fn execute(&mut self, title: String, priority: Priority) {
        let task = Task::new(0, title, priority);
        let id = self.gateway.save(task);
        if let Some(created) = self.gateway.find_by_id(id) {
            self.presenter.present_task(&created);
        }
    }
}

pub struct CompleteTaskUseCase<'a, G: TaskGateway, P: TaskPresenter> {
    gateway: &'a mut G,
    presenter: &'a P,
}

impl<'a, G: TaskGateway, P: TaskPresenter> CompleteTaskUseCase<'a, G, P> {
    pub fn new(gateway: &'a mut G, presenter: &'a P) -> Self {
        CompleteTaskUseCase { gateway, presenter }
    }

    pub fn execute(&mut self, task_id: u64) {
        match self.gateway.find_by_id(task_id) {
            Some(mut task) => {
                task.complete();
                self.gateway.update(task.clone());
                self.presenter.present_task(&task);
            }
            None => {
                self.presenter.present_error("Task not found");
            }
        }
    }
}

pub struct ListTasksUseCase<'a, G: TaskGateway, P: TaskPresenter> {
    gateway: &'a G,
    presenter: &'a P,
}

impl<'a, G: TaskGateway, P: TaskPresenter> ListTasksUseCase<'a, G, P> {
    pub fn new(gateway: &'a G, presenter: &'a P) -> Self {
        ListTasksUseCase { gateway, presenter }
    }

    pub fn execute(&self) {
        let tasks = self.gateway.find_all();
        self.presenter.present_task_list(&tasks);
    }
}

--- file: src/interface_adapters/mod.rs ---
mod memory_gateway;
mod console_presenter;

pub use memory_gateway::InMemoryTaskGateway;
pub use console_presenter::ConsolePresenter;

--- file: src/interface_adapters/memory_gateway.rs ---
use crate::entities::Task;
use crate::use_cases::TaskGateway;
use std::collections::HashMap;

pub struct InMemoryTaskGateway {
    tasks: HashMap<u64, Task>,
    next_id: u64,
}

impl InMemoryTaskGateway {
    pub fn new() -> Self {
        InMemoryTaskGateway { tasks: HashMap::new(), next_id: 1 }
    }
}

impl TaskGateway for InMemoryTaskGateway {
    fn save(&mut self, mut task: Task) -> u64 {
        task.id = self.next_id;
        self.next_id += 1;
        let id = task.id;
        self.tasks.insert(id, task);
        id
    }

    fn find_by_id(&self, id: u64) -> Option<Task> {
        self.tasks.get(&id).cloned()
    }

    fn find_all(&self) -> Vec<Task> {
        self.tasks.values().cloned().collect()
    }

    fn update(&mut self, task: Task) -> bool {
        if self.tasks.contains_key(&task.id) {
            self.tasks.insert(task.id, task);
            true
        } else {
            false
        }
    }

    fn delete(&mut self, id: u64) -> bool {
        self.tasks.remove(&id).is_some()
    }
}

--- file: src/interface_adapters/console_presenter.rs ---
use crate::entities::Task;
use crate::use_cases::TaskPresenter;

pub struct ConsolePresenter;

impl TaskPresenter for ConsolePresenter {
    fn present_task(&self, task: &Task) {
        println!("Task #{}: {} [{:?}]", task.id, task.title, task.status);
    }

    fn present_task_list(&self, tasks: &[Task]) {
        println!("=== Tasks ({}) ===", tasks.len());
        for task in tasks {
            self.present_task(task);
        }
    }

    fn present_error(&self, message: &str) {
        eprintln!("Error: {}", message);
    }
}

--- file: src/main.rs ---
mod entities;
mod use_cases;
mod interface_adapters;

use entities::Priority;
use use_cases::{CreateTaskUseCase, CompleteTaskUseCase, ListTasksUseCase};
use interface_adapters::{InMemoryTaskGateway, ConsolePresenter};

fn main() {
    let mut gateway = InMemoryTaskGateway::new();
    let presenter = ConsolePresenter;

    // Create tasks
    {
        let mut create = CreateTaskUseCase::new(&mut gateway, &presenter);
        create.execute("Learn Rust".to_string(), Priority::High);
        create.execute("Write tests".to_string(), Priority::Medium);
        create.execute("Deploy app".to_string(), Priority::Low);
    }

    // Complete first task
    {
        let mut complete = CompleteTaskUseCase::new(&mut gateway, &presenter);
        complete.execute(1);
    }

    // List all tasks
    {
        let list = ListTasksUseCase::new(&gateway, &presenter);
        list.execute();
    }
}

--- expect:symbols ---
u0:1   | Primitive      | i32                 | i32                                                                   | [global]
u0:2   | Primitive      | i64                 | i64                                                                   | [global]
u0:3   | Primitive      | i16                 | i16                                                                   | [global]
u0:4   | Primitive      | i8                  | i8                                                                    | [global]
u0:5   | Primitive      | i128                | i128                                                                  | [global]
u0:6   | Primitive      | isize               | isize                                                                 | [global]
u0:7   | Primitive      | u32                 | u32                                                                   | [global]
u0:8   | Primitive      | u64                 | u64                                                                   | [global]
u0:9   | Primitive      | u16                 | u16                                                                   | [global]
u0:10  | Primitive      | u8                  | u8                                                                    | [global]
u0:11  | Primitive      | u128                | u128                                                                  | [global]
u0:12  | Primitive      | usize               | usize                                                                 | [global]
u0:13  | Primitive      | f32                 | f32                                                                   | [global]
u0:14  | Primitive      | f64                 | f64                                                                   | [global]
u0:15  | Primitive      | bool                | bool                                                                  | [global]
u0:16  | Primitive      | char                | char                                                                  | [global]
u0:17  | Primitive      | str                 | str                                                                   | [global]
u0:18  | Primitive      | String              | String                                                                | [global]
u0:19  | Crate          | _c                  | _c                                                                    | [global]
u0:20  | Crate          | crate               | _c::crate                                                             |         
u0:21  | Module         | entities            | _c::entities                                                          |         
u0:22  | File           | mod                 | _c::entities::mod                                                     |         
u1:23  | Crate          | crate               | _c::crate                                                             |         
u1:24  | Module         | _m                  | _c::_m                                                                |         
u1:25  | File           | task                | _c::_m::task                                                          |         
u1:26  | Enum           | TaskStatus          | _c::_m::task::TaskStatus                                              | [global]
u1:27  | EnumVariant    | Todo                | _c::_m::task::TaskStatus::Todo                                        |         
u1:28  | EnumVariant    | InProgress          | _c::_m::task::TaskStatus::InProgress                                  |         
u1:29  | EnumVariant    | Done                | _c::_m::task::TaskStatus::Done                                        |         
u1:30  | Enum           | Priority            | _c::_m::task::Priority                                                | [global]
u1:31  | EnumVariant    | Low                 | _c::_m::task::Priority::Low                                           |         
u1:32  | EnumVariant    | Medium              | _c::_m::task::Priority::Medium                                        |         
u1:33  | EnumVariant    | High                | _c::_m::task::Priority::High                                          |         
u1:34  | Struct         | Task                | _c::_m::task::Task                                                    | [global]
u1:35  | Field          | id                  | _c::_m::task::Task::id                                                |         
u1:36  | Field          | title               | _c::_m::task::Task::title                                             |         
u1:37  | Field          | description         | _c::_m::task::Task::description                                       |         
u1:38  | Field          | status              | _c::_m::task::Task::status                                            |         
u1:39  | Field          | priority            | _c::_m::task::Task::priority                                          |         
u1:40  | Function       | new                 | _c::_m::task::Task::new                                               | [global]
u1:41  | Variable       | id                  | _c::_m::task::Task::new::id                                           |         
u1:42  | Variable       | title               | _c::_m::task::Task::new::title                                        |         
u1:43  | Variable       | priority            | _c::_m::task::Task::new::priority                                     |         
u1:44  | Function       | start               | _c::_m::task::Task::start                                             | [global]
u1:45  | Function       | complete            | _c::_m::task::Task::complete                                          | [global]
u1:46  | Function       | is_done             | _c::_m::task::Task::is_done                                           | [global]
u2:47  | Crate          | crate               | _c::crate                                                             |         
u2:48  | Module         | _m                  | _c::_m                                                                |         
u2:49  | File           | console_presenter   | _c::_m::console_presenter                                             |         
u2:50  | Struct         | ConsolePresenter    | _c::_m::console_presenter::ConsolePresenter                           | [global]
u2:51  | UnresolvedType | TaskPresenter       | _c::_m::console_presenter::TaskPresenter                              |         
u2:52  | Function       | present_task        | _c::_m::console_presenter::ConsolePresenter::present_task             |         
u2:53  | Variable       | task                | _c::_m::console_presenter::ConsolePresenter::present_task::task       |         
u2:54  | Function       | present_task_list   | _c::_m::console_presenter::ConsolePresenter::present_task_list        |         
u2:55  | Variable       | tasks               | _c::_m::console_presenter::ConsolePresenter::present_task_list::tasks |         
u2:56  | Function       | present_error       | _c::_m::console_presenter::ConsolePresenter::present_error            |         
u2:57  | Variable       | message             | _c::_m::console_presenter::ConsolePresenter::present_error::message   |         
u3:58  | Crate          | crate               | _c::crate                                                             |         
u3:59  | Module         | _m                  | _c::_m                                                                |         
u3:60  | File           | memory_gateway      | _c::_m::memory_gateway                                                |         
u3:61  | Struct         | InMemoryTaskGateway | _c::_m::memory_gateway::InMemoryTaskGateway                           | [global]
u3:62  | Field          | tasks               | _c::_m::memory_gateway::InMemoryTaskGateway::tasks                    |         
u3:63  | Field          | next_id             | _c::_m::memory_gateway::InMemoryTaskGateway::next_id                  |         
u3:64  | Function       | new                 | _c::_m::memory_gateway::InMemoryTaskGateway::new                      | [global]
u3:65  | UnresolvedType | TaskGateway         | _c::_m::memory_gateway::TaskGateway                                   |         
u3:66  | Function       | save                | _c::_m::memory_gateway::InMemoryTaskGateway::save                     |         
u3:67  | Variable       | task                | _c::_m::memory_gateway::InMemoryTaskGateway::save::task               |         
u3:68  | Variable       | id                  | _c::_m::memory_gateway::InMemoryTaskGateway::save::id                 |         
u3:69  | Function       | find_by_id          | _c::_m::memory_gateway::InMemoryTaskGateway::find_by_id               |         
u3:70  | Variable       | id                  | _c::_m::memory_gateway::InMemoryTaskGateway::find_by_id::id           |         
u3:71  | Function       | find_all            | _c::_m::memory_gateway::InMemoryTaskGateway::find_all                 |         
u3:72  | Function       | update              | _c::_m::memory_gateway::InMemoryTaskGateway::update                   |         
u3:73  | Variable       | task                | _c::_m::memory_gateway::InMemoryTaskGateway::update::task             |         
u3:74  | Function       | delete              | _c::_m::memory_gateway::InMemoryTaskGateway::delete                   |         
u3:75  | Variable       | id                  | _c::_m::memory_gateway::InMemoryTaskGateway::delete::id               |         
u4:76  | Crate          | crate               | _c::crate                                                             |         
u4:77  | Module         | interface_adapters  | _c::interface_adapters                                                |         
u4:78  | File           | mod                 | _c::interface_adapters::mod                                           |         
u5:79  | Crate          | crate               | _c::crate                                                             |         
u5:80  | File           | lib                 | _c::lib                                                               |         
u6:81  | Crate          | crate               | _c::crate                                                             |         
u6:82  | Module         | _m                  | _c::_m                                                                |         
u6:83  | File           | main                | _c::_m::main                                                          |         
u6:84  | Function       | main                | _c::_m::main::main                                                    |         
u6:85  | Variable       | gateway             | _c::_m::main::main::gateway                                           |         
u6:86  | Variable       | presenter           | _c::_m::main::main::presenter                                         |         
u6:87  | Variable       | create              | _c::_m::main::main::create                                            |         
u6:88  | Variable       | complete            | _c::_m::main::main::complete                                          |         
u6:89  | Variable       | list                | _c::_m::main::main::list                                              |         
u7:90  | Crate          | crate               | _c::crate                                                             |         
u7:91  | Module         | use_cases           | _c::use_cases                                                         |         
u7:92  | File           | mod                 | _c::use_cases::mod                                                    |         
u8:93  | Crate          | crate               | _c::crate                                                             |         
u8:94  | Module         | _m                  | _c::_m                                                                |         
u8:95  | File           | ports               | _c::_m::ports                                                         |         
u8:96  | Trait          | TaskGateway         | _c::_m::ports::TaskGateway                                            | [global]
u8:97  | Function       | save                | _c::_m::ports::TaskGateway::save                                      |         
u8:98  | Variable       | task                | _c::_m::ports::TaskGateway::save::task                                |         
u8:99  | Function       | find_by_id          | _c::_m::ports::TaskGateway::find_by_id                                |         
u8:100 | Variable       | id                  | _c::_m::ports::TaskGateway::find_by_id::id                            |         
u8:101 | Function       | find_all            | _c::_m::ports::TaskGateway::find_all                                  |         
u8:102 | Function       | update              | _c::_m::ports::TaskGateway::update                                    |         
u8:103 | Variable       | task                | _c::_m::ports::TaskGateway::update::task                              |         
u8:104 | Function       | delete              | _c::_m::ports::TaskGateway::delete                                    |         
u8:105 | Variable       | id                  | _c::_m::ports::TaskGateway::delete::id                                |         
u8:106 | Trait          | TaskPresenter       | _c::_m::ports::TaskPresenter                                          | [global]
u8:107 | Function       | present_task        | _c::_m::ports::TaskPresenter::present_task                            |         
u8:108 | Variable       | task                | _c::_m::ports::TaskPresenter::present_task::task                      |         
u8:109 | Function       | present_task_list   | _c::_m::ports::TaskPresenter::present_task_list                       |         
u8:110 | Variable       | tasks               | _c::_m::ports::TaskPresenter::present_task_list::tasks                |         
u8:111 | Function       | present_error       | _c::_m::ports::TaskPresenter::present_error                           |         
u8:112 | Variable       | message             | _c::_m::ports::TaskPresenter::present_error::message                  |         
u9:113 | Crate          | crate               | _c::crate                                                             |         
u9:114 | Module         | _m                  | _c::_m                                                                |         
u9:115 | File           | task_use_cases      | _c::_m::task_use_cases                                                |         
u9:116 | Struct         | CreateTaskUseCase   | _c::_m::task_use_cases::CreateTaskUseCase                             | [global]
u9:117 | TypeParameter  | G                   | _c::_m::task_use_cases::CreateTaskUseCase::G                          |         
u9:118 | TypeParameter  | P                   | _c::_m::task_use_cases::CreateTaskUseCase::P                          |         
u9:119 | Field          | gateway             | _c::_m::task_use_cases::CreateTaskUseCase::gateway                    |         
u9:120 | Field          | presenter           | _c::_m::task_use_cases::CreateTaskUseCase::presenter                  |         
u9:121 | Function       | new                 | _c::_m::task_use_cases::CreateTaskUseCase::new                        | [global]
u9:122 | Variable       | gateway             | _c::_m::task_use_cases::CreateTaskUseCase::new::gateway               |         
u9:123 | Variable       | presenter           | _c::_m::task_use_cases::CreateTaskUseCase::new::presenter             |         
u9:124 | Function       | execute             | _c::_m::task_use_cases::CreateTaskUseCase::execute                    | [global]
u9:125 | Variable       | title               | _c::_m::task_use_cases::CreateTaskUseCase::execute::title             |         
u9:126 | Variable       | priority            | _c::_m::task_use_cases::CreateTaskUseCase::execute::priority          |         
u9:127 | Variable       | task                | _c::_m::task_use_cases::CreateTaskUseCase::execute::task              |         
u9:128 | Variable       | id                  | _c::_m::task_use_cases::CreateTaskUseCase::execute::id                |         
u9:129 | Struct         | CompleteTaskUseCase | _c::_m::task_use_cases::CompleteTaskUseCase                           | [global]
u9:130 | TypeParameter  | G                   | _c::_m::task_use_cases::CompleteTaskUseCase::G                        |         
u9:131 | TypeParameter  | P                   | _c::_m::task_use_cases::CompleteTaskUseCase::P                        |         
u9:132 | Field          | gateway             | _c::_m::task_use_cases::CompleteTaskUseCase::gateway                  |         
u9:133 | Field          | presenter           | _c::_m::task_use_cases::CompleteTaskUseCase::presenter                |         
u9:134 | Variable       | task_id             | _c::_m::task_use_cases::CreateTaskUseCase::execute::task_id           |         
u9:135 | Struct         | ListTasksUseCase    | _c::_m::task_use_cases::ListTasksUseCase                              | [global]
u9:136 | TypeParameter  | G                   | _c::_m::task_use_cases::ListTasksUseCase::G                           |         
u9:137 | TypeParameter  | P                   | _c::_m::task_use_cases::ListTasksUseCase::P                           |         
u9:138 | Field          | gateway             | _c::_m::task_use_cases::ListTasksUseCase::gateway                     |         
u9:139 | Field          | presenter           | _c::_m::task_use_cases::ListTasksUseCase::presenter                   |         
u9:140 | Variable       | tasks               | _c::_m::task_use_cases::CreateTaskUseCase::execute::tasks             |         

--- expect:symbol-deps ---
u0:15 <- [u1:46, u3:72, u3:74, u8:102, u8:104]
u0:17 <- [u2:56, u2:57, u8:111, u8:112]
u0:18 <- [u1:34, u1:36, u1:37, u1:40, u1:42, u9:124, u9:125]
u0:8 <- [u1:34, u1:35, u1:40, u1:41, u3:61, u3:63, u3:66, u3:68, u3:69, u3:70, u3:74, u3:75, u8:100, u8:104, u8:105, u8:97, u8:99, u9:124, u9:134]
u1:26 -> [u1:27, u1:28, u1:29]
u1:26 <- [u1:34, u1:38, u1:40, u1:44, u1:45, u1:46]
u1:27 <- [u1:26, u1:40]
u1:28 <- [u1:26, u1:44]
u1:29 <- [u1:26, u1:45, u1:46]
u1:30 -> [u1:31, u1:32, u1:33]
u1:30 <- [u1:34, u1:39, u1:40, u1:43, u6:84, u9:124, u9:126]
u1:31 <- [u1:30, u6:84]
u1:32 <- [u1:30, u6:84]
u1:33 <- [u1:30, u6:84]
u1:34 -> [u0:18, u0:8, u1:26, u1:30, u1:44, u1:45, u1:46]
u1:34 <- [u1:40, u2:52, u2:53, u2:54, u2:55, u3:61, u3:62, u3:66, u3:67, u3:72, u3:73, u8:102, u8:103, u8:107, u8:108, u8:109, u8:110, u8:97, u8:98, u9:124, u9:127]
u1:35 -> [u0:8]
u1:36 -> [u0:18]
u1:37 -> [u0:18]
u1:38 -> [u1:26]
u1:39 -> [u1:30]
u1:40 -> [u0:18, u0:8, u1:26, u1:27, u1:30, u1:34]
u1:40 <- [u9:124]
u1:41 -> [u0:8]
u1:42 -> [u0:18]
u1:43 -> [u1:30]
u1:44 -> [u1:26, u1:28]
u1:44 <- [u1:34]
u1:45 -> [u1:26, u1:29]
u1:45 <- [u1:34, u9:124]
u1:46 -> [u0:15, u1:26, u1:29]
u1:46 <- [u1:34]
u2:50 -> [u2:52, u2:54, u2:56]
u2:50 <- [u6:84, u6:86]
u2:52 -> [u1:34]
u2:52 <- [u2:50, u2:54]
u2:53 -> [u1:34]
u2:54 -> [u1:34, u2:52]
u2:54 <- [u2:50]
u2:55 -> [u1:34]
u2:56 -> [u0:17]
u2:56 <- [u2:50]
u2:57 -> [u0:17]
u3:61 -> [u0:8, u1:34, u3:66, u3:69, u3:71, u3:72, u3:74]
u3:61 <- [u3:64, u6:84, u6:85, u6:88, u6:89]
u3:62 -> [u1:34]
u3:63 -> [u0:8]
u3:64 -> [u3:61]
u3:64 <- [u6:84]
u3:66 -> [u0:8, u1:34]
u3:66 <- [u3:61]
u3:67 -> [u1:34]
u3:68 -> [u0:8]
u3:69 -> [u0:8]
u3:69 <- [u3:61]
u3:70 -> [u0:8]
u3:71 <- [u3:61]
u3:72 -> [u0:15, u1:34]
u3:72 <- [u3:61]
u3:73 -> [u1:34]
u3:74 -> [u0:15, u0:8]
u3:74 <- [u3:61]
u3:75 -> [u0:8]
u6:84 -> [u1:30, u1:31, u1:32, u1:33, u2:50, u3:61, u3:64, u9:121, u9:124]
u6:85 -> [u3:61]
u6:86 -> [u2:50]
u6:87 -> [u9:121]
u6:88 -> [u3:61]
u6:89 -> [u3:61]
u8:100 -> [u0:8]
u8:101 <- [u8:96, u9:124, u9:140]
u8:102 -> [u0:15, u1:34]
u8:102 <- [u8:96, u9:124]
u8:103 -> [u1:34]
u8:104 -> [u0:15, u0:8]
u8:104 <- [u8:96]
u8:105 -> [u0:8]
u8:106 -> [u8:107, u8:109, u8:111]
u8:106 <- [u9:116, u9:129, u9:135]
u8:107 -> [u1:34]
u8:107 <- [u8:106, u9:124]
u8:108 -> [u1:34]
u8:109 -> [u1:34]
u8:109 <- [u8:106, u9:124]
u8:110 -> [u1:34]
u8:111 -> [u0:17]
u8:111 <- [u8:106, u9:124]
u8:112 -> [u0:17]
u8:96 -> [u8:101, u8:102, u8:104, u8:97, u8:99]
u8:96 <- [u9:116, u9:129, u9:135]
u8:97 -> [u0:8, u1:34]
u8:97 <- [u8:96, u9:124, u9:128]
u8:98 -> [u1:34]
u8:99 -> [u0:8]
u8:99 <- [u8:96, u9:124]
u9:116 -> [u8:106, u8:96, u9:124]
u9:116 <- [u9:121]
u9:121 -> [u9:116, u9:129, u9:135]
u9:121 <- [u6:84, u6:87]
u9:124 -> [u0:18, u0:8, u1:30, u1:34, u1:40, u1:45, u8:101, u8:102, u8:107, u8:109, u8:111, u8:97, u8:99]
u9:124 <- [u6:84, u9:116, u9:129, u9:135]
u9:125 -> [u0:18]
u9:126 -> [u1:30]
u9:127 -> [u1:34]
u9:128 -> [u8:97]
u9:129 -> [u8:106, u8:96, u9:124]
u9:129 <- [u9:121]
u9:134 -> [u0:8]
u9:135 -> [u8:106, u8:96, u9:124]
u9:135 <- [u9:121]
u9:140 -> [u8:101]
