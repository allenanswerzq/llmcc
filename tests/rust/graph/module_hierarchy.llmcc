===============================================================================
module-hierarchy-basic
===============================================================================
Tests basic module organization: lib.rs -> models/services/utils with mod.rs intermediates.

--- file: src/lib.rs ---
pub mod models;
pub mod services;
pub mod utils;

pub use models::User;
pub use services::UserService;

--- file: src/models/mod.rs ---
mod user;
mod profile;

pub use user::User;
pub use profile::Profile;

--- file: src/models/user.rs ---
use super::profile::Profile;

pub struct User {
    pub id: u64,
    pub name: String,
    pub profile: Option<Profile>,
}

impl User {
    pub fn new(id: u64, name: String) -> Self {
        User { id, name, profile: None }
    }

    pub fn with_profile(mut self, profile: Profile) -> Self {
        self.profile = Some(profile);
        self
    }
}

--- file: src/models/profile.rs ---
pub struct Profile {
    pub bio: String,
    pub avatar_url: Option<String>,
}

impl Profile {
    pub fn new(bio: String) -> Self {
        Profile { bio, avatar_url: None }
    }
}

--- file: src/services/mod.rs ---
mod user_service;

pub use user_service::UserService;

--- file: src/services/user_service.rs ---
use crate::models::{User, Profile};

pub struct UserService {
    users: Vec<User>,
}

impl UserService {
    pub fn new() -> Self {
        UserService { users: Vec::new() }
    }

    pub fn create_user(&mut self, name: String) -> &User {
        let id = self.users.len() as u64 + 1;
        let user = User::new(id, name);
        self.users.push(user);
        self.users.last().unwrap()
    }

    pub fn add_profile(&mut self, user_id: u64, bio: String) -> bool {
        if let Some(user) = self.users.iter_mut().find(|u| u.id == user_id) {
            user.profile = Some(Profile::new(bio));
            true
        } else {
            false
        }
    }
}

--- file: src/utils/mod.rs ---
mod validation;

pub use validation::*;

--- file: src/utils/validation.rs ---
use crate::models::User;

pub fn validate_user(user: &User) -> bool {
    !user.name.is_empty()
}

pub fn validate_name(name: &str) -> bool {
    name.len() >= 2 && name.len() <= 100
}

--- file: src/main.rs ---
mod models;
mod services;
mod utils;

use services::UserService;
use utils::validate_user;

fn main() {
    let mut service = UserService::new();
    let user = service.create_user("Alice".to_string());

    if validate_user(user) {
        println!("User {} is valid", user.name);
    }
}

--- expect:symbols ---
u0:1  | Primitive | i32           | i32                                                           | [global]
u0:2  | Primitive | i64           | i64                                                           | [global]
u0:3  | Primitive | i16           | i16                                                           | [global]
u0:4  | Primitive | i8            | i8                                                            | [global]
u0:5  | Primitive | i128          | i128                                                          | [global]
u0:6  | Primitive | isize         | isize                                                         | [global]
u0:7  | Primitive | u32           | u32                                                           | [global]
u0:8  | Primitive | u64           | u64                                                           | [global]
u0:9  | Primitive | u16           | u16                                                           | [global]
u0:10 | Primitive | u8            | u8                                                            | [global]
u0:11 | Primitive | u128          | u128                                                          | [global]
u0:12 | Primitive | usize         | usize                                                         | [global]
u0:13 | Primitive | f32           | f32                                                           | [global]
u0:14 | Primitive | f64           | f64                                                           | [global]
u0:15 | Primitive | bool          | bool                                                          | [global]
u0:16 | Primitive | char          | char                                                          | [global]
u0:17 | Primitive | str           | str                                                           | [global]
u0:18 | Primitive | String        | String                                                        | [global]
u0:19 | Crate     | _c            | _c                                                            | [global]
u0:20 | Crate     | crate         | _c::crate                                                     |         
u0:21 | File      | lib           | _c::lib                                                       |         
u1:22 | Crate     | crate         | _c::crate                                                     |         
u1:23 | Module    | models        | _c::models                                                    |         
u1:24 | File      | mod           | _c::models::mod                                               |         
u2:25 | Crate     | crate         | _c::crate                                                     |         
u2:26 | Module    | models        | _c::models                                                    |         
u2:27 | File      | user          | _c::models::user                                              |         
u2:28 | Struct    | User          | _c::models::user::User                                        | [global]
u2:29 | Field     | id            | _c::models::user::User::id                                    |         
u2:30 | Field     | name          | _c::models::user::User::name                                  |         
u2:31 | Field     | profile       | _c::models::user::User::profile                               |         
u2:32 | Function  | new           | _c::models::user::User::new                                   | [global]
u2:33 | Variable  | id            | _c::models::user::User::new::id                               |         
u2:34 | Variable  | name          | _c::models::user::User::new::name                             |         
u2:35 | Function  | with_profile  | _c::models::user::User::with_profile                          | [global]
u2:36 | Variable  | profile       | _c::models::user::User::with_profile::profile                 |         
u3:37 | Crate     | crate         | _c::crate                                                     |         
u3:38 | Module    | models        | _c::models                                                    |         
u3:39 | File      | profile       | _c::models::profile                                           |         
u3:40 | Struct    | Profile       | _c::models::profile::Profile                                  | [global]
u3:41 | Field     | bio           | _c::models::profile::Profile::bio                             |         
u3:42 | Field     | avatar_url    | _c::models::profile::Profile::avatar_url                      |         
u3:43 | Function  | new           | _c::models::profile::Profile::new                             | [global]
u3:44 | Variable  | bio           | _c::models::profile::Profile::new::bio                        |         
u4:45 | Crate     | crate         | _c::crate                                                     |         
u4:46 | Module    | services      | _c::services                                                  |         
u4:47 | File      | mod           | _c::services::mod                                             |         
u5:48 | Crate     | crate         | _c::crate                                                     |         
u5:49 | Module    | services      | _c::services                                                  |         
u5:50 | File      | user_service  | _c::services::user_service                                    |         
u5:51 | Struct    | UserService   | _c::services::user_service::UserService                       | [global]
u5:52 | Field     | users         | _c::services::user_service::UserService::users                |         
u5:53 | Function  | new           | _c::services::user_service::UserService::new                  | [global]
u5:54 | Function  | create_user   | _c::services::user_service::UserService::create_user          | [global]
u5:55 | Variable  | name          | _c::services::user_service::UserService::create_user::name    |         
u5:56 | Variable  | id            | _c::services::user_service::UserService::create_user::id      |         
u5:57 | Variable  | user          | _c::services::user_service::UserService::create_user::user    |         
u5:58 | Function  | add_profile   | _c::services::user_service::UserService::add_profile          | [global]
u5:59 | Variable  | user_id       | _c::services::user_service::UserService::add_profile::user_id |         
u5:60 | Variable  | bio           | _c::services::user_service::UserService::add_profile::bio     |         
u5:61 | Variable  | u             | _c::services::user_service::UserService::add_profile::u       |         
u6:62 | Crate     | crate         | _c::crate                                                     |         
u6:63 | Module    | utils         | _c::utils                                                     |         
u6:64 | File      | mod           | _c::utils::mod                                                |         
u7:65 | Crate     | crate         | _c::crate                                                     |         
u7:66 | Module    | utils         | _c::utils                                                     |         
u7:67 | File      | validation    | _c::utils::validation                                         |         
u7:68 | Function  | validate_user | _c::utils::validation::validate_user                          | [global]
u7:69 | Variable  | user          | _c::utils::validation::validate_user::user                    |         
u7:70 | Function  | validate_name | _c::utils::validation::validate_name                          | [global]
u7:71 | Variable  | name          | _c::utils::validation::validate_name::name                    |         
u8:72 | Crate     | crate         | _c::crate                                                     |         
u8:73 | File      | main          | _c::main                                                      |         
u8:74 | Function  | main          | _c::main::main                                                |         
u8:75 | Variable  | service       | _c::main::main::service                                       |         
u8:76 | Variable  | user          | _c::main::main::user                                          |         

--- expect:symbol-deps ---
u0:15 <- [u5:58, u7:68, u7:70]
u0:17 <- [u7:70, u7:71]
u0:18 <- [u2:28, u2:30, u2:32, u2:34, u3:40, u3:41, u3:42, u3:43, u3:44, u5:54, u5:55, u5:58, u5:60]
u0:8 <- [u2:28, u2:29, u2:32, u2:33, u5:54, u5:58, u5:59]
u2:28 -> [u0:18, u0:8, u2:35, u3:40]
u2:28 <- [u2:32, u5:51, u5:52, u5:54, u5:57, u7:68, u7:69]
u2:29 -> [u0:8]
u2:30 -> [u0:18]
u2:31 -> [u3:40]
u2:32 -> [u0:18, u0:8, u2:28]
u2:32 <- [u5:54]
u2:33 -> [u0:8]
u2:34 -> [u0:18]
u2:35 -> [u3:40]
u2:35 <- [u2:28]
u2:36 -> [u3:40]
u3:40 -> [u0:18]
u3:40 <- [u2:28, u2:31, u2:35, u2:36, u3:43]
u3:41 -> [u0:18]
u3:42 -> [u0:18]
u3:43 -> [u0:18, u3:40]
u3:43 <- [u5:58]
u3:44 -> [u0:18]
u5:51 -> [u2:28, u5:54, u5:58]
u5:51 <- [u5:53, u8:74, u8:75, u8:76]
u5:52 -> [u2:28]
u5:52 <- [u5:54, u5:56]
u5:53 -> [u5:51]
u5:53 <- [u8:74]
u5:54 -> [u0:18, u0:8, u2:28, u2:32, u5:52]
u5:54 <- [u5:51, u8:74]
u5:55 -> [u0:18]
u5:56 -> [u5:52]
u5:57 -> [u2:28]
u5:58 -> [u0:15, u0:18, u0:8, u3:43]
u5:58 <- [u5:51]
u5:59 -> [u0:8]
u5:60 -> [u0:18]
u7:68 -> [u0:15, u2:28]
u7:68 <- [u8:74]
u7:69 -> [u2:28]
u7:70 -> [u0:15, u0:17]
u7:71 -> [u0:17]
u8:74 -> [u5:51, u5:53, u5:54, u7:68]
u8:75 -> [u5:51]
u8:76 -> [u5:51]


===============================================================================
module-hierarchy-deep-nesting
===============================================================================
Tests deeply nested modules: domain/user/repository, domain/order/item with cross-module imports.

--- file: src/lib.rs ---
pub mod domain;

--- file: src/domain/mod.rs ---
pub mod user;
pub mod order;

--- file: src/domain/user/mod.rs ---
pub mod entity;
pub mod value_object;
pub mod repository;

pub use entity::User;
pub use value_object::Email;

--- file: src/domain/user/entity.rs ---
use super::value_object::Email;

pub struct User {
    pub id: u64,
    pub email: Email,
    pub name: String,
}

impl User {
    pub fn new(id: u64, email: Email, name: String) -> Self {
        User { id, email, name }
    }
}

--- file: src/domain/user/value_object.rs ---
pub struct Email(String);

impl Email {
    pub fn new(email: String) -> Option<Self> {
        if email.contains('@') {
            Some(Email(email))
        } else {
            None
        }
    }

    pub fn as_str(&self) -> &str {
        &self.0
    }
}

--- file: src/domain/user/repository.rs ---
use super::entity::User;

pub trait UserRepository {
    fn find_by_id(&self, id: u64) -> Option<User>;
    fn save(&mut self, user: User) -> u64;
}

--- file: src/domain/order/mod.rs ---
pub mod entity;
pub mod line_item;

pub use entity::Order;
pub use line_item::LineItem;

--- file: src/domain/order/entity.rs ---
use super::line_item::LineItem;
use crate::domain::user::User;

pub struct Order {
    pub id: u64,
    pub user: User,
    pub items: Vec<LineItem>,
}

impl Order {
    pub fn new(id: u64, user: User) -> Self {
        Order { id, user, items: Vec::new() }
    }

    pub fn add_item(&mut self, item: LineItem) {
        self.items.push(item);
    }

    pub fn total(&self) -> f64 {
        self.items.iter().map(|i| i.subtotal()).sum()
    }
}

--- file: src/domain/order/line_item.rs ---
pub struct LineItem {
    pub product_name: String,
    pub quantity: u32,
    pub unit_price: f64,
}

impl LineItem {
    pub fn new(product_name: String, quantity: u32, unit_price: f64) -> Self {
        LineItem { product_name, quantity, unit_price }
    }

    pub fn subtotal(&self) -> f64 {
        self.quantity as f64 * self.unit_price
    }
}

--- file: src/main.rs ---
mod domain;

use domain::user::{User, Email};
use domain::order::{Order, LineItem};

fn main() {
    let email = Email::new("alice@example.com".to_string()).unwrap();
    let user = User::new(1, email, "Alice".to_string());

    let mut order = Order::new(100, user);
    order.add_item(LineItem::new("Widget".to_string(), 2, 19.99));
    order.add_item(LineItem::new("Gadget".to_string(), 1, 49.99));

    println!("Order total: ${:.2}", order.total());
}

--- expect:symbols ---
u0:1  | Primitive | i32            | i32                                                  | [global]
u0:2  | Primitive | i64            | i64                                                  | [global]
u0:3  | Primitive | i16            | i16                                                  | [global]
u0:4  | Primitive | i8             | i8                                                   | [global]
u0:5  | Primitive | i128           | i128                                                 | [global]
u0:6  | Primitive | isize          | isize                                                | [global]
u0:7  | Primitive | u32            | u32                                                  | [global]
u0:8  | Primitive | u64            | u64                                                  | [global]
u0:9  | Primitive | u16            | u16                                                  | [global]
u0:10 | Primitive | u8             | u8                                                   | [global]
u0:11 | Primitive | u128           | u128                                                 | [global]
u0:12 | Primitive | usize          | usize                                                | [global]
u0:13 | Primitive | f32            | f32                                                  | [global]
u0:14 | Primitive | f64            | f64                                                  | [global]
u0:15 | Primitive | bool           | bool                                                 | [global]
u0:16 | Primitive | char           | char                                                 | [global]
u0:17 | Primitive | str            | str                                                  | [global]
u0:18 | Primitive | String         | String                                               | [global]
u0:19 | Crate     | _c             | _c                                                   | [global]
u0:20 | Crate     | crate          | _c::crate                                            |         
u0:21 | File      | lib            | _c::lib                                              |         
u1:22 | Crate     | crate          | _c::crate                                            |         
u1:23 | Module    | domain         | _c::domain                                           |         
u1:24 | File      | mod            | _c::domain::mod                                      |         
u2:25 | Crate     | crate          | _c::crate                                            |         
u2:26 | Module    | user           | _c::user                                             |         
u2:27 | File      | mod            | _c::user::mod                                        |         
u3:28 | Crate     | crate          | _c::crate                                            |         
u3:29 | Module    | user           | _c::user                                             |         
u3:30 | File      | entity         | _c::user::entity                                     |         
u3:31 | Struct    | User           | _c::user::entity::User                               | [global]
u3:32 | Field     | id             | _c::user::entity::User::id                           |         
u3:33 | Field     | email          | _c::user::entity::User::email                        |         
u3:34 | Field     | name           | _c::user::entity::User::name                         |         
u3:35 | Function  | new            | _c::user::entity::User::new                          | [global]
u3:36 | Variable  | id             | _c::user::entity::User::new::id                      |         
u3:37 | Variable  | email          | _c::user::entity::User::new::email                   |         
u3:38 | Variable  | name           | _c::user::entity::User::new::name                    |         
u4:39 | Crate     | crate          | _c::crate                                            |         
u4:40 | Module    | user           | _c::user                                             |         
u4:41 | File      | value_object   | _c::user::value_object                               |         
u4:42 | Struct    | Email          | _c::user::value_object::Email                        | [global]
u4:43 | Function  | new            | _c::user::value_object::Email::new                   | [global]
u4:44 | Variable  | email          | _c::user::value_object::Email::new::email            |         
u4:45 | Function  | as_str         | _c::user::value_object::Email::as_str                | [global]
u5:46 | Crate     | crate          | _c::crate                                            |         
u5:47 | Module    | user           | _c::user                                             |         
u5:48 | File      | repository     | _c::user::repository                                 |         
u5:49 | Trait     | UserRepository | _c::user::repository::UserRepository                 | [global]
u5:50 | Function  | find_by_id     | _c::user::repository::UserRepository::find_by_id     |         
u5:51 | Variable  | id             | _c::user::repository::UserRepository::find_by_id::id |         
u5:52 | Function  | save           | _c::user::repository::UserRepository::save           |         
u5:53 | Variable  | user           | _c::user::repository::UserRepository::save::user     |         
u6:54 | Crate     | crate          | _c::crate                                            |         
u6:55 | Module    | order          | _c::order                                            |         
u6:56 | File      | mod            | _c::order::mod                                       |         
u7:57 | Crate     | crate          | _c::crate                                            |         
u7:58 | Module    | order          | _c::order                                            |         
u7:59 | File      | entity         | _c::order::entity                                    |         
u7:60 | Struct    | Order          | _c::order::entity::Order                             | [global]
u7:61 | Field     | id             | _c::order::entity::Order::id                         |         
u7:62 | Field     | user           | _c::order::entity::Order::user                       |         
u7:63 | Field     | items          | _c::order::entity::Order::items                      |         
u7:64 | Function  | new            | _c::order::entity::Order::new                        | [global]
u7:65 | Variable  | id             | _c::order::entity::Order::new::id                    |         
u7:66 | Variable  | user           | _c::order::entity::Order::new::user                  |         
u7:67 | Function  | add_item       | _c::order::entity::Order::add_item                   | [global]
u7:68 | Variable  | item           | _c::order::entity::Order::add_item::item             |         
u7:69 | Function  | total          | _c::order::entity::Order::total                      | [global]
u7:70 | Variable  | i              | _c::order::entity::Order::total::i                   |         
u8:71 | Crate     | crate          | _c::crate                                            |         
u8:72 | Module    | order          | _c::order                                            |         
u8:73 | File      | line_item      | _c::order::line_item                                 |         
u8:74 | Struct    | LineItem       | _c::order::line_item::LineItem                       | [global]
u8:75 | Field     | product_name   | _c::order::line_item::LineItem::product_name         |         
u8:76 | Field     | quantity       | _c::order::line_item::LineItem::quantity             |         
u8:77 | Field     | unit_price     | _c::order::line_item::LineItem::unit_price           |         
u8:78 | Function  | new            | _c::order::line_item::LineItem::new                  | [global]
u8:79 | Variable  | product_name   | _c::order::line_item::LineItem::new::product_name    |         
u8:80 | Variable  | quantity       | _c::order::line_item::LineItem::new::quantity        |         
u8:81 | Variable  | unit_price     | _c::order::line_item::LineItem::new::unit_price      |         
u8:82 | Function  | subtotal       | _c::order::line_item::LineItem::subtotal             | [global]
u9:83 | Crate     | crate          | _c::crate                                            |         
u9:84 | File      | main           | _c::main                                             |         
u9:85 | Function  | main           | _c::main::main                                       |         
u9:86 | Variable  | email          | _c::main::main::email                                |         
u9:87 | Variable  | user           | _c::main::main::user                                 |         
u9:88 | Variable  | order          | _c::main::main::order                                |         

--- expect:symbol-deps ---
u0:14 <- [u7:69, u8:74, u8:77, u8:78, u8:81, u8:82]
u0:17 <- [u4:45, u9:85, u9:86]
u0:18 <- [u3:31, u3:34, u3:35, u3:38, u4:43, u4:44, u8:74, u8:75, u8:78, u8:79]
u0:7 <- [u8:74, u8:76, u8:78, u8:80]
u0:8 <- [u3:31, u3:32, u3:35, u3:36, u5:50, u5:51, u5:52, u7:60, u7:61, u7:64, u7:65]
u3:31 -> [u0:18, u0:8, u4:42]
u3:31 <- [u3:35, u5:52, u5:53, u7:60, u7:62, u7:64, u7:66, u9:85, u9:87]
u3:32 -> [u0:8]
u3:33 -> [u4:42]
u3:34 -> [u0:18]
u3:35 -> [u0:18, u0:8, u3:31, u4:42]
u3:35 <- [u9:85]
u3:36 -> [u0:8]
u3:37 -> [u4:42]
u3:38 -> [u0:18]
u4:42 -> [u4:43, u4:45]
u4:42 <- [u3:31, u3:33, u3:35, u3:37]
u4:43 -> [u0:18]
u4:43 <- [u4:42, u9:85]
u4:44 -> [u0:18]
u4:45 -> [u0:17]
u4:45 <- [u4:42]
u5:49 -> [u5:50, u5:52]
u5:50 -> [u0:8]
u5:50 <- [u5:49]
u5:51 -> [u0:8]
u5:52 -> [u0:8, u3:31]
u5:52 <- [u5:49]
u5:53 -> [u3:31]
u7:60 -> [u0:8, u3:31, u7:67, u7:69, u8:74]
u7:60 <- [u7:64, u9:85, u9:88]
u7:61 -> [u0:8]
u7:62 -> [u3:31]
u7:63 -> [u8:74]
u7:64 -> [u0:8, u3:31, u7:60]
u7:64 <- [u9:85]
u7:65 -> [u0:8]
u7:66 -> [u3:31]
u7:67 -> [u8:74, u8:78]
u7:67 <- [u7:60, u9:85]
u7:68 -> [u8:74]
u7:69 -> [u0:14, u8:82]
u7:69 <- [u7:60]
u8:74 -> [u0:14, u0:18, u0:7, u8:82]
u8:74 <- [u7:60, u7:63, u7:67, u7:68, u8:78]
u8:75 -> [u0:18]
u8:76 -> [u0:7]
u8:77 -> [u0:14]
u8:78 -> [u0:14, u0:18, u0:7, u8:74]
u8:78 <- [u7:67, u9:85]
u8:79 -> [u0:18]
u8:80 -> [u0:7]
u8:81 -> [u0:14]
u8:82 -> [u0:14]
u8:82 <- [u7:69, u8:74]
u9:85 -> [u0:17, u3:31, u3:35, u4:43, u7:60, u7:64, u7:67, u8:78]
u9:86 -> [u0:17]
u9:87 -> [u3:31]
u9:88 -> [u7:60]


===============================================================================
module-reexports
===============================================================================
Tests pub use re-exports: internal types exposed through prelude module at crate root.

--- file: src/lib.rs ---
mod internal;
pub mod prelude;

// Re-export main types at crate root
pub use prelude::*;

--- file: src/internal/mod.rs ---
pub mod core_types;
pub mod helpers;

--- file: src/internal/core_types.rs ---
pub struct Config {
    pub name: String,
    pub debug: bool,
}

pub struct Context {
    pub config: Config,
    pub id: u64,
}

pub struct Engine {
    pub context: Context,
}

impl Engine {
    pub fn new(config: Config) -> Self {
        Engine {
            context: Context { config, id: 1 },
        }
    }

    pub fn run(&self) {
        println!("Running engine: {}", self.context.config.name);
    }
}

--- file: src/internal/helpers.rs ---
use super::core_types::Config;

pub fn default_config() -> Config {
    Config {
        name: "default".to_string(),
        debug: false,
    }
}

pub fn debug_config(name: &str) -> Config {
    Config {
        name: name.to_string(),
        debug: true,
    }
}

--- file: src/prelude.rs ---
// Public facade - re-exports only what users need
pub use crate::internal::core_types::{Config, Engine};
pub use crate::internal::helpers::{default_config, debug_config};

--- file: src/main.rs ---
mod internal;
mod prelude;

// Users just import from prelude
use prelude::{Engine, debug_config};

fn main() {
    let config = debug_config("my_app");
    let engine = Engine::new(config);
    engine.run();
}

--- expect:symbols ---
u0:1  | Primitive | i32            | i32                                           | [global]
u0:2  | Primitive | i64            | i64                                           | [global]
u0:3  | Primitive | i16            | i16                                           | [global]
u0:4  | Primitive | i8             | i8                                            | [global]
u0:5  | Primitive | i128           | i128                                          | [global]
u0:6  | Primitive | isize          | isize                                         | [global]
u0:7  | Primitive | u32            | u32                                           | [global]
u0:8  | Primitive | u64            | u64                                           | [global]
u0:9  | Primitive | u16            | u16                                           | [global]
u0:10 | Primitive | u8             | u8                                            | [global]
u0:11 | Primitive | u128           | u128                                          | [global]
u0:12 | Primitive | usize          | usize                                         | [global]
u0:13 | Primitive | f32            | f32                                           | [global]
u0:14 | Primitive | f64            | f64                                           | [global]
u0:15 | Primitive | bool           | bool                                          | [global]
u0:16 | Primitive | char           | char                                          | [global]
u0:17 | Primitive | str            | str                                           | [global]
u0:18 | Primitive | String         | String                                        | [global]
u0:19 | Crate     | _c             | _c                                            | [global]
u0:20 | Crate     | crate          | _c::crate                                     |         
u0:21 | File      | lib            | _c::lib                                       |         
u1:22 | Crate     | crate          | _c::crate                                     |         
u1:23 | Module    | internal       | _c::internal                                  |         
u1:24 | File      | mod            | _c::internal::mod                             |         
u2:25 | Crate     | crate          | _c::crate                                     |         
u2:26 | Module    | internal       | _c::internal                                  |         
u2:27 | File      | core_types     | _c::internal::core_types                      |         
u2:28 | Struct    | Config         | _c::internal::core_types::Config              | [global]
u2:29 | Field     | name           | _c::internal::core_types::Config::name        |         
u2:30 | Field     | debug          | _c::internal::core_types::Config::debug       |         
u2:31 | Struct    | Context        | _c::internal::core_types::Context             | [global]
u2:32 | Field     | config         | _c::internal::core_types::Context::config     |         
u2:33 | Field     | id             | _c::internal::core_types::Context::id         |         
u2:34 | Struct    | Engine         | _c::internal::core_types::Engine              | [global]
u2:35 | Field     | context        | _c::internal::core_types::Engine::context     |         
u2:36 | Function  | new            | _c::internal::core_types::Engine::new         | [global]
u2:37 | Variable  | config         | _c::internal::core_types::Engine::new::config |         
u2:38 | Function  | run            | _c::internal::core_types::Engine::run         | [global]
u3:39 | Crate     | crate          | _c::crate                                     |         
u3:40 | Module    | internal       | _c::internal                                  |         
u3:41 | File      | helpers        | _c::internal::helpers                         |         
u3:42 | Function  | default_config | _c::internal::helpers::default_config         | [global]
u3:43 | Function  | debug_config   | _c::internal::helpers::debug_config           | [global]
u3:44 | Variable  | name           | _c::internal::helpers::debug_config::name     |         
u4:45 | Crate     | crate          | _c::crate                                     |         
u4:46 | File      | prelude        | _c::prelude                                   |         
u5:47 | Crate     | crate          | _c::crate                                     |         
u5:48 | File      | main           | _c::main                                      |         
u5:49 | Function  | main           | _c::main::main                                |         
u5:50 | Variable  | config         | _c::main::main::config                        |         
u5:51 | Variable  | engine         | _c::main::main::engine                        |         

--- expect:symbol-deps ---
u0:15 <- [u2:28, u2:30]
u0:17 <- [u3:43, u3:44]
u0:18 <- [u2:28, u2:29]
u0:8 <- [u2:31, u2:33]
u2:28 -> [u0:15, u0:18]
u2:28 <- [u2:31, u2:32, u2:36, u2:37, u3:42, u3:43]
u2:29 -> [u0:18]
u2:30 -> [u0:15]
u2:31 -> [u0:8, u2:28]
u2:31 <- [u2:34, u2:35, u2:36]
u2:32 -> [u2:28]
u2:33 -> [u0:8]
u2:34 -> [u2:31, u2:38]
u2:34 <- [u2:36, u5:49, u5:51]
u2:35 -> [u2:31]
u2:36 -> [u2:28, u2:31, u2:34]
u2:36 <- [u5:49]
u2:37 -> [u2:28]
u2:38 <- [u2:34, u5:49]
u3:42 -> [u2:28]
u3:43 -> [u0:17, u2:28]
u3:43 <- [u5:49, u5:50]
u3:44 -> [u0:17]
u5:49 -> [u2:34, u2:36, u2:38, u3:43]
u5:50 -> [u3:43]
u5:51 -> [u2:34]


===============================================================================
module-circular-reference
===============================================================================
Tests mutual module dependencies: Node references Graph, Graph contains Nodes.

--- file: src/lib.rs ---
pub mod node;
pub mod graph;

--- file: src/node.rs ---
use crate::graph::Graph;

pub struct Node {
    pub id: u64,
    pub value: String,
}

impl Node {
    pub fn new(id: u64, value: String) -> Self {
        Node { id, value }
    }

    pub fn neighbors<'a>(&self, graph: &'a Graph) -> Vec<&'a Node> {
        graph.get_neighbors(self.id)
    }
}

--- file: src/graph.rs ---
use crate::node::Node;
use std::collections::HashMap;

pub struct Graph {
    nodes: HashMap<u64, Node>,
    edges: Vec<(u64, u64)>,
}

impl Graph {
    pub fn new() -> Self {
        Graph { nodes: HashMap::new(), edges: Vec::new() }
    }

    pub fn add_node(&mut self, node: Node) {
        self.nodes.insert(node.id, node);
    }

    pub fn add_edge(&mut self, from: u64, to: u64) {
        self.edges.push((from, to));
    }

    pub fn get_node(&self, id: u64) -> Option<&Node> {
        self.nodes.get(&id)
    }

    pub fn get_neighbors(&self, node_id: u64) -> Vec<&Node> {
        self.edges
            .iter()
            .filter(|(from, _)| *from == node_id)
            .filter_map(|(_, to)| self.nodes.get(to))
            .collect()
    }
}

--- file: src/main.rs ---
mod node;
mod graph;

use node::Node;
use graph::Graph;

fn main() {
    let mut g = Graph::new();
    g.add_node(Node::new(1, "A".to_string()));
    g.add_node(Node::new(2, "B".to_string()));
    g.add_node(Node::new(3, "C".to_string()));

    g.add_edge(1, 2);
    g.add_edge(1, 3);

    if let Some(node) = g.get_node(1) {
        let neighbors = node.neighbors(&g);
        println!("Node {} has {} neighbors", node.value, neighbors.len());
    }
}

--- expect:symbols ---
u0:1  | Primitive | i32           | i32                                      | [global]
u0:2  | Primitive | i64           | i64                                      | [global]
u0:3  | Primitive | i16           | i16                                      | [global]
u0:4  | Primitive | i8            | i8                                       | [global]
u0:5  | Primitive | i128          | i128                                     | [global]
u0:6  | Primitive | isize         | isize                                    | [global]
u0:7  | Primitive | u32           | u32                                      | [global]
u0:8  | Primitive | u64           | u64                                      | [global]
u0:9  | Primitive | u16           | u16                                      | [global]
u0:10 | Primitive | u8            | u8                                       | [global]
u0:11 | Primitive | u128          | u128                                     | [global]
u0:12 | Primitive | usize         | usize                                    | [global]
u0:13 | Primitive | f32           | f32                                      | [global]
u0:14 | Primitive | f64           | f64                                      | [global]
u0:15 | Primitive | bool          | bool                                     | [global]
u0:16 | Primitive | char          | char                                     | [global]
u0:17 | Primitive | str           | str                                      | [global]
u0:18 | Primitive | String        | String                                   | [global]
u0:19 | Crate     | _c            | _c                                       | [global]
u0:20 | Crate     | crate         | _c::crate                                |         
u0:21 | File      | lib           | _c::lib                                  |         
u1:22 | Crate     | crate         | _c::crate                                |         
u1:23 | File      | node          | _c::node                                 |         
u1:24 | Struct    | Node          | _c::node::Node                           | [global]
u1:25 | Field     | id            | _c::node::Node::id                       |         
u1:26 | Field     | value         | _c::node::Node::value                    |         
u1:27 | Function  | new           | _c::node::Node::new                      | [global]
u1:28 | Variable  | id            | _c::node::Node::new::id                  |         
u1:29 | Variable  | value         | _c::node::Node::new::value               |         
u1:30 | Function  | neighbors     | _c::node::Node::neighbors                | [global]
u1:31 | Variable  | graph         | _c::node::Node::neighbors::graph         |         
u2:32 | Crate     | crate         | _c::crate                                |         
u2:33 | File      | graph         | _c::graph                                |         
u2:34 | Struct    | Graph         | _c::graph::Graph                         | [global]
u2:35 | Field     | nodes         | _c::graph::Graph::nodes                  |         
u2:36 | Field     | edges         | _c::graph::Graph::edges                  |         
u2:37 | Function  | new           | _c::graph::Graph::new                    | [global]
u2:38 | Function  | add_node      | _c::graph::Graph::add_node               | [global]
u2:39 | Variable  | node          | _c::graph::Graph::add_node::node         |         
u2:40 | Function  | add_edge      | _c::graph::Graph::add_edge               | [global]
u2:41 | Variable  | from          | _c::graph::Graph::add_edge::from         |         
u2:42 | Variable  | to            | _c::graph::Graph::add_edge::to           |         
u2:43 | Function  | get_node      | _c::graph::Graph::get_node               | [global]
u2:44 | Variable  | id            | _c::graph::Graph::get_node::id           |         
u2:45 | Function  | get_neighbors | _c::graph::Graph::get_neighbors          | [global]
u2:46 | Variable  | node_id       | _c::graph::Graph::get_neighbors::node_id |         
u2:47 | Variable  | from          | _c::graph::Graph::get_neighbors::from    |         
u2:48 | Variable  | to            | _c::graph::Graph::get_neighbors::to      |         
u3:49 | Crate     | crate         | _c::crate                                |         
u3:50 | File      | main          | _c::main                                 |         
u3:51 | Function  | main          | _c::main::main                           |         
u3:52 | Variable  | g             | _c::main::main::g                        |         
u3:53 | Variable  | neighbors     | _c::main::main::neighbors                |         

--- expect:symbol-deps ---
u0:18 <- [u1:24, u1:26, u1:27, u1:29]
u0:8 <- [u1:24, u1:25, u1:27, u1:28, u2:34, u2:40, u2:41, u2:42, u2:43, u2:44, u2:45, u2:46]
u1:24 -> [u0:18, u0:8, u1:30]
u1:24 <- [u1:27, u2:34, u2:35, u2:38, u2:39]
u1:25 -> [u0:8]
u1:26 -> [u0:18]
u1:27 -> [u0:18, u0:8, u1:24]
u1:27 <- [u2:38, u3:51]
u1:28 -> [u0:8]
u1:29 -> [u0:18]
u1:30 -> [u2:34, u2:45]
u1:30 <- [u1:24, u3:51]
u1:31 -> [u2:34]
u2:34 -> [u0:8, u1:24, u2:38, u2:40, u2:43, u2:45]
u2:34 <- [u1:30, u1:31, u2:37, u3:51, u3:52]
u2:35 -> [u1:24]
u2:37 -> [u2:34]
u2:37 <- [u3:51]
u2:38 -> [u1:24, u1:27]
u2:38 <- [u2:34, u3:51]
u2:39 -> [u1:24]
u2:40 -> [u0:8]
u2:40 <- [u2:34, u3:51]
u2:41 -> [u0:8]
u2:42 -> [u0:8]
u2:43 -> [u0:8]
u2:43 <- [u2:34, u3:51]
u2:44 -> [u0:8]
u2:45 -> [u0:8]
u2:45 <- [u1:30, u2:34]
u2:46 -> [u0:8]
u3:51 -> [u1:27, u1:30, u2:34, u2:37, u2:38, u2:40, u2:43]
u3:52 -> [u2:34]


===============================================================================
module-private-public-boundary
===============================================================================
Tests visibility boundaries: internal module is private, api module exposes Client using internal types.

--- file: src/lib.rs ---
mod internal;  // Private module
pub mod api;   // Public module

pub use api::Client;

--- file: src/internal/mod.rs ---
mod connection;
mod protocol;

pub use connection::Connection;
pub use protocol::Protocol;

--- file: src/internal/connection.rs ---
pub struct Connection {
    host: String,
    port: u16,
    connected: bool,
}

impl Connection {
    pub fn new(host: &str, port: u16) -> Self {
        Connection {
            host: host.to_string(),
            port,
            connected: false,
        }
    }

    pub fn connect(&mut self) -> bool {
        self.connected = true;
        true
    }

    pub fn disconnect(&mut self) {
        self.connected = false;
    }

    pub fn is_connected(&self) -> bool {
        self.connected
    }
}

--- file: src/internal/protocol.rs ---
pub enum Protocol {
    Http,
    Https,
    Ws,
    Wss,
}

impl Protocol {
    pub fn default_port(&self) -> u16 {
        match self {
            Protocol::Http => 80,
            Protocol::Https => 443,
            Protocol::Ws => 80,
            Protocol::Wss => 443,
        }
    }
}

--- file: src/api/mod.rs ---
use crate::internal::{Connection, Protocol};

pub struct Client {
    conn: Connection,
    protocol: Protocol,
}

impl Client {
    pub fn new(host: &str, protocol: Protocol) -> Self {
        let port = protocol.default_port();
        Client {
            conn: Connection::new(host, port),
            protocol,
        }
    }

    pub fn connect(&mut self) -> bool {
        self.conn.connect()
    }

    pub fn disconnect(&mut self) {
        self.conn.disconnect()
    }

    pub fn is_connected(&self) -> bool {
        self.conn.is_connected()
    }
}

// Re-export Protocol for users
pub use crate::internal::Protocol;

--- file: src/main.rs ---
mod internal;
mod api;

use api::{Client, Protocol};

fn main() {
    let mut client = Client::new("example.com", Protocol::Https);

    if client.connect() {
        println!("Connected!");
        client.disconnect();
    }
}

--- expect:symbols ---
u0:1  | Primitive   | i32          | i32                                                | [global]
u0:2  | Primitive   | i64          | i64                                                | [global]
u0:3  | Primitive   | i16          | i16                                                | [global]
u0:4  | Primitive   | i8           | i8                                                 | [global]
u0:5  | Primitive   | i128         | i128                                               | [global]
u0:6  | Primitive   | isize        | isize                                              | [global]
u0:7  | Primitive   | u32          | u32                                                | [global]
u0:8  | Primitive   | u64          | u64                                                | [global]
u0:9  | Primitive   | u16          | u16                                                | [global]
u0:10 | Primitive   | u8           | u8                                                 | [global]
u0:11 | Primitive   | u128         | u128                                               | [global]
u0:12 | Primitive   | usize        | usize                                              | [global]
u0:13 | Primitive   | f32          | f32                                                | [global]
u0:14 | Primitive   | f64          | f64                                                | [global]
u0:15 | Primitive   | bool         | bool                                               | [global]
u0:16 | Primitive   | char         | char                                               | [global]
u0:17 | Primitive   | str          | str                                                | [global]
u0:18 | Primitive   | String       | String                                             | [global]
u0:19 | Crate       | _c           | _c                                                 | [global]
u0:20 | Crate       | crate        | _c::crate                                          |         
u0:21 | File        | lib          | _c::lib                                            |         
u1:22 | Crate       | crate        | _c::crate                                          |         
u1:23 | Module      | internal     | _c::internal                                       |         
u1:24 | File        | mod          | _c::internal::mod                                  |         
u2:25 | Crate       | crate        | _c::crate                                          |         
u2:26 | Module      | internal     | _c::internal                                       |         
u2:27 | File        | connection   | _c::internal::connection                           |         
u2:28 | Struct      | Connection   | _c::internal::connection::Connection               | [global]
u2:29 | Field       | host         | _c::internal::connection::Connection::host         |         
u2:30 | Field       | port         | _c::internal::connection::Connection::port         |         
u2:31 | Field       | connected    | _c::internal::connection::Connection::connected    |         
u2:32 | Function    | new          | _c::internal::connection::Connection::new          | [global]
u2:33 | Variable    | host         | _c::internal::connection::Connection::new::host    |         
u2:34 | Variable    | port         | _c::internal::connection::Connection::new::port    |         
u2:35 | Function    | connect      | _c::internal::connection::Connection::connect      | [global]
u2:36 | Function    | disconnect   | _c::internal::connection::Connection::disconnect   | [global]
u2:37 | Function    | is_connected | _c::internal::connection::Connection::is_connected | [global]
u3:38 | Crate       | crate        | _c::crate                                          |         
u3:39 | Module      | internal     | _c::internal                                       |         
u3:40 | File        | protocol     | _c::internal::protocol                             |         
u3:41 | Enum        | Protocol     | _c::internal::protocol::Protocol                   | [global]
u3:42 | EnumVariant | Http         | _c::internal::protocol::Protocol::Http             |         
u3:43 | EnumVariant | Https        | _c::internal::protocol::Protocol::Https            |         
u3:44 | EnumVariant | Ws           | _c::internal::protocol::Protocol::Ws               |         
u3:45 | EnumVariant | Wss          | _c::internal::protocol::Protocol::Wss              |         
u3:46 | Function    | default_port | _c::internal::protocol::Protocol::default_port     | [global]
u4:47 | Crate       | crate        | _c::crate                                          |         
u4:48 | Module      | api          | _c::api                                            |         
u4:49 | File        | mod          | _c::api::mod                                       |         
u4:50 | Struct      | Client       | _c::api::mod::Client                               | [global]
u4:51 | Field       | conn         | _c::api::mod::Client::conn                         |         
u4:52 | Field       | protocol     | _c::api::mod::Client::protocol                     |         
u4:53 | Function    | new          | _c::api::mod::Client::new                          | [global]
u4:54 | Variable    | host         | _c::api::mod::Client::new::host                    |         
u4:55 | Variable    | protocol     | _c::api::mod::Client::new::protocol                |         
u4:56 | Variable    | port         | _c::api::mod::Client::new::port                    |         
u4:57 | Function    | connect      | _c::api::mod::Client::connect                      | [global]
u4:58 | Function    | disconnect   | _c::api::mod::Client::disconnect                   | [global]
u4:59 | Function    | is_connected | _c::api::mod::Client::is_connected                 | [global]
u5:60 | Crate       | crate        | _c::crate                                          |         
u5:61 | File        | main         | _c::main                                           |         
u5:62 | Function    | main         | _c::main::main                                     |         
u5:63 | Variable    | client       | _c::main::main::client                             |         

--- expect:symbol-deps ---
u0:15 <- [u2:28, u2:31, u2:35, u2:37, u4:57, u4:59]
u0:17 <- [u2:32, u2:33, u4:53, u4:54]
u0:18 <- [u2:28, u2:29]
u0:9 <- [u2:28, u2:30, u2:32, u2:34, u3:46]
u2:28 -> [u0:15, u0:18, u0:9, u2:35, u2:36, u2:37]
u2:28 <- [u2:32, u4:50, u4:51]
u2:29 -> [u0:18]
u2:30 -> [u0:9]
u2:31 -> [u0:15]
u2:32 -> [u0:17, u0:9, u2:28]
u2:32 <- [u4:53]
u2:33 -> [u0:17]
u2:34 -> [u0:9]
u2:35 -> [u0:15]
u2:35 <- [u2:28]
u2:36 <- [u2:28]
u2:37 -> [u0:15]
u2:37 <- [u2:28]
u3:41 -> [u3:42, u3:43, u3:44, u3:45]
u3:41 <- [u3:46, u4:50, u4:52, u4:53, u4:55, u4:56, u5:62]
u3:42 <- [u3:41, u3:46]
u3:43 <- [u3:41, u3:46, u5:62]
u3:44 <- [u3:41, u3:46]
u3:45 <- [u3:41, u3:46]
u3:46 -> [u0:9, u3:41, u3:42, u3:43, u3:44, u3:45]
u3:46 <- [u4:53]
u4:50 -> [u2:28, u3:41, u4:57, u4:58, u4:59]
u4:50 <- [u4:53, u5:62, u5:63]
u4:51 -> [u2:28]
u4:52 -> [u3:41]
u4:53 -> [u0:17, u2:32, u3:41, u3:46, u4:50]
u4:53 <- [u5:62]
u4:54 -> [u0:17]
u4:55 -> [u3:41]
u4:56 -> [u3:41]
u4:57 -> [u0:15]
u4:57 <- [u4:50, u5:62]
u4:58 <- [u4:50, u5:62]
u4:59 -> [u0:15]
u4:59 <- [u4:50]
u5:62 -> [u3:41, u3:43, u4:50, u4:53, u4:57, u4:58]
u5:63 -> [u4:50]
