===============================================================================
cross-file-struct-usage
===============================================================================
Tests struct defined in lib.rs being used in main.rs via crate import.

--- file: src/lib.rs ---
pub struct User {
    pub name: String,
    pub age: u32,
}

impl User {
    pub fn new(name: String, age: u32) -> Self {
        Self { name, age }
    }
}

--- file: src/main.rs ---
use crate::User;

fn main() {
    let user = User::new("Alice".to_string(), 30);
    println!("{}", user.name);
}

--- expect:symbols ---
u0:1  | Primitive | i32    | i32                      | [global]
u0:2  | Primitive | i64    | i64                      | [global]
u0:3  | Primitive | i16    | i16                      | [global]
u0:4  | Primitive | i8     | i8                       | [global]
u0:5  | Primitive | i128   | i128                     | [global]
u0:6  | Primitive | isize  | isize                    | [global]
u0:7  | Primitive | u32    | u32                      | [global]
u0:8  | Primitive | u64    | u64                      | [global]
u0:9  | Primitive | u16    | u16                      | [global]
u0:10 | Primitive | u8     | u8                       | [global]
u0:11 | Primitive | u128   | u128                     | [global]
u0:12 | Primitive | usize  | usize                    | [global]
u0:13 | Primitive | f32    | f32                      | [global]
u0:14 | Primitive | f64    | f64                      | [global]
u0:15 | Primitive | bool   | bool                     | [global]
u0:16 | Primitive | char   | char                     | [global]
u0:17 | Primitive | str    | str                      | [global]
u0:18 | Primitive | String | String                   | [global]
u0:19 | Crate     | _c     | _c                       | [global]
u0:20 | Crate     | crate  | _c::crate                |         
u0:21 | File      | lib    | _c::lib                  |         
u0:22 | Struct    | User   | _c::lib::User            | [global]
u0:23 | Field     | name   | _c::lib::User::name      |         
u0:24 | Field     | age    | _c::lib::User::age       |         
u0:25 | Function  | new    | _c::lib::User::new       | [global]
u0:26 | Variable  | name   | _c::lib::User::new::name |         
u0:27 | Variable  | age    | _c::lib::User::new::age  |         
u1:28 | Crate     | crate  | _c::crate                |         
u1:29 | File      | main   | _c::main                 |         
u1:30 | Function  | main   | _c::main::main           |         
u1:31 | Variable  | user   | _c::main::main::user     |         

--- expect:symbol-deps ---
u0:18 <- [u0:22, u0:23, u0:25, u0:26]
u0:22 -> [u0:18, u0:25, u0:7]
u0:22 <- [u1:30, u1:31]
u0:23 -> [u0:18]
u0:24 -> [u0:7]
u0:25 -> [u0:18, u0:7]
u0:25 <- [u0:22, u1:30]
u0:26 -> [u0:18]
u0:27 -> [u0:7]
u0:7 <- [u0:22, u0:24, u0:25, u0:27]
u1:30 -> [u0:22, u0:25]
u1:31 -> [u0:22]


===============================================================================
cross-file-trait-implementation
===============================================================================
Tests trait defined in traits.rs, implemented for Config in impl.rs, used in main.rs.

--- file: src/traits.rs ---
pub trait Serializable {
    fn serialize(&self) -> String;
    fn deserialize(data: &str) -> Self where Self: Sized;
}

pub trait Validator {
    fn validate(&self) -> bool;
}

--- file: src/models.rs ---
use crate::traits::{Serializable, Validator};

pub struct Config {
    pub name: String,
    pub enabled: bool,
}

impl Serializable for Config {
    fn serialize(&self) -> String {
        format!("{}:{}", self.name, self.enabled)
    }

    fn deserialize(data: &str) -> Self {
        Config { name: data.to_string(), enabled: true }
    }
}

impl Validator for Config {
    fn validate(&self) -> bool {
        !self.name.is_empty()
    }
}

--- file: src/main.rs ---
mod traits;
mod models;

use models::Config;
use traits::{Serializable, Validator};

fn main() {
    let config = Config { name: "app".to_string(), enabled: true };
    if config.validate() {
        println!("{}", config.serialize());
    }
}

--- expect:symbols ---
u0:1  | Primitive      | i32          | i32                                         | [global]
u0:2  | Primitive      | i64          | i64                                         | [global]
u0:3  | Primitive      | i16          | i16                                         | [global]
u0:4  | Primitive      | i8           | i8                                          | [global]
u0:5  | Primitive      | i128         | i128                                        | [global]
u0:6  | Primitive      | isize        | isize                                       | [global]
u0:7  | Primitive      | u32          | u32                                         | [global]
u0:8  | Primitive      | u64          | u64                                         | [global]
u0:9  | Primitive      | u16          | u16                                         | [global]
u0:10 | Primitive      | u8           | u8                                          | [global]
u0:11 | Primitive      | u128         | u128                                        | [global]
u0:12 | Primitive      | usize        | usize                                       | [global]
u0:13 | Primitive      | f32          | f32                                         | [global]
u0:14 | Primitive      | f64          | f64                                         | [global]
u0:15 | Primitive      | bool         | bool                                        | [global]
u0:16 | Primitive      | char         | char                                        | [global]
u0:17 | Primitive      | str          | str                                         | [global]
u0:18 | Primitive      | String       | String                                      | [global]
u0:19 | Crate          | _c           | _c                                          | [global]
u0:20 | Crate          | crate        | _c::crate                                   |         
u0:21 | File           | traits       | _c::traits                                  |         
u0:22 | Trait          | Serializable | _c::traits::Serializable                    | [global]
u0:23 | Function       | serialize    | _c::traits::Serializable::serialize         |         
u0:24 | Function       | deserialize  | _c::traits::Serializable::deserialize       |         
u0:25 | Variable       | data         | _c::traits::Serializable::deserialize::data |         
u0:26 | Trait          | Validator    | _c::traits::Validator                       | [global]
u0:27 | Function       | validate     | _c::traits::Validator::validate             |         
u1:28 | Crate          | crate        | _c::crate                                   |         
u1:29 | File           | models       | _c::models                                  |         
u1:30 | Struct         | Config       | _c::models::Config                          | [global]
u1:31 | Field          | name         | _c::models::Config::name                    |         
u1:32 | Field          | enabled      | _c::models::Config::enabled                 |         
u1:33 | UnresolvedType | Serializable | _c::models::Serializable                    |         
u1:34 | Function       | serialize    | _c::models::Config::serialize               |         
u1:35 | Function       | deserialize  | _c::models::Config::deserialize             |         
u1:36 | Variable       | data         | _c::models::Config::deserialize::data       |         
u1:37 | UnresolvedType | Validator    | _c::models::Validator                       |         
u1:38 | Function       | validate     | _c::models::Config::validate                |         
u2:39 | Crate          | crate        | _c::crate                                   |         
u2:40 | File           | main         | _c::main                                    |         
u2:41 | Function       | main         | _c::main::main                              |         
u2:42 | Variable       | config       | _c::main::main::config                      |         

--- expect:symbol-deps ---
u0:15 <- [u0:27, u1:30, u1:32, u1:38]
u0:17 <- [u0:24, u0:25, u1:35, u1:36]
u0:18 <- [u1:30, u1:31]
u0:22 -> [u0:23, u0:24]
u0:23 <- [u0:22]
u0:24 -> [u0:17]
u0:24 <- [u0:22]
u0:25 -> [u0:17]
u0:26 -> [u0:27]
u0:27 -> [u0:15]
u0:27 <- [u0:26]
u1:30 -> [u0:15, u0:18, u1:34, u1:38]
u1:30 <- [u1:35, u2:41, u2:42]
u1:31 -> [u0:18]
u1:32 -> [u0:15]
u1:34 <- [u1:30]
u1:35 -> [u0:17, u1:30]
u1:36 -> [u0:17]
u1:38 -> [u0:15]
u1:38 <- [u1:30, u2:41]
u2:41 -> [u1:30, u1:38]
u2:42 -> [u1:30]


===============================================================================
cross-file-error-propagation
===============================================================================
Tests custom error type defined in error.rs propagated via Result across file_handler.rs and main.rs.

--- file: src/error.rs ---
#[derive(Debug)]
pub enum AppError {
    NotFound(String),
    InvalidInput(String),
    IoError(std::io::Error),
}

impl std::fmt::Display for AppError {
    fn fmt(&self, f: &mut std::fmt::Formatter<'_>) -> std::fmt::Result {
        match self {
            AppError::NotFound(msg) => write!(f, "Not found: {}", msg),
            AppError::InvalidInput(msg) => write!(f, "Invalid input: {}", msg),
            AppError::IoError(e) => write!(f, "IO error: {}", e),
        }
    }
}

pub type Result<T> = std::result::Result<T, AppError>;

--- file: src/service.rs ---
use crate::error::{AppError, Result};

pub struct Service {
    data: Vec<String>,
}

impl Service {
    pub fn new() -> Self {
        Service { data: Vec::new() }
    }

    pub fn get(&self, id: usize) -> Result<&String> {
        self.data.get(id).ok_or_else(|| AppError::NotFound(id.to_string()))
    }

    pub fn add(&mut self, item: String) -> Result<usize> {
        if item.is_empty() {
            return Err(AppError::InvalidInput("empty item".to_string()));
        }
        self.data.push(item);
        Ok(self.data.len() - 1)
    }
}

--- file: src/main.rs ---
mod error;
mod service;

use service::Service;

fn main() -> error::Result<()> {
    let mut svc = Service::new();
    let id = svc.add("hello".to_string())?;
    let item = svc.get(id)?;
    println!("{}", item);
    Ok(())
}

--- expect:symbols ---
u0:1  | Primitive      | i32          | i32                               | [global]
u0:2  | Primitive      | i64          | i64                               | [global]
u0:3  | Primitive      | i16          | i16                               | [global]
u0:4  | Primitive      | i8           | i8                                | [global]
u0:5  | Primitive      | i128         | i128                              | [global]
u0:6  | Primitive      | isize        | isize                             | [global]
u0:7  | Primitive      | u32          | u32                               | [global]
u0:8  | Primitive      | u64          | u64                               | [global]
u0:9  | Primitive      | u16          | u16                               | [global]
u0:10 | Primitive      | u8           | u8                                | [global]
u0:11 | Primitive      | u128         | u128                              | [global]
u0:12 | Primitive      | usize        | usize                             | [global]
u0:13 | Primitive      | f32          | f32                               | [global]
u0:14 | Primitive      | f64          | f64                               | [global]
u0:15 | Primitive      | bool         | bool                              | [global]
u0:16 | Primitive      | char         | char                              | [global]
u0:17 | Primitive      | str          | str                               | [global]
u0:18 | Primitive      | String       | String                            | [global]
u0:19 | Crate          | _c           | _c                                | [global]
u0:20 | Crate          | crate        | _c::crate                         |         
u0:21 | File           | error        | _c::error                         |         
u0:22 | Enum           | AppError     | _c::error::AppError               | [global]
u0:23 | EnumVariant    | NotFound     | _c::error::AppError::NotFound     |         
u0:24 | EnumVariant    | InvalidInput | _c::error::AppError::InvalidInput |         
u0:25 | EnumVariant    | IoError      | _c::error::AppError::IoError      |         
u0:26 | UnresolvedType | Display      | _c::error::Display                |         
u0:27 | Function       | fmt          | _c::error::AppError::fmt          |         
u0:28 | Variable       | f            | _c::error::AppError::fmt::f       |         
u0:29 | TypeAlias      | Result       | _c::error::Result                 |         
u0:30 | TypeParameter  | T            | _c::error::T                      |         
u1:31 | Crate          | crate        | _c::crate                         |         
u1:32 | File           | service      | _c::service                       |         
u1:33 | Struct         | Service      | _c::service::Service              | [global]
u1:34 | Field          | data         | _c::service::Service::data        |         
u1:35 | Function       | new          | _c::service::Service::new         | [global]
u1:36 | Function       | get          | _c::service::Service::get         | [global]
u1:37 | Variable       | id           | _c::service::Service::get::id     |         
u1:38 | Function       | add          | _c::service::Service::add         | [global]
u1:39 | Variable       | item         | _c::service::Service::add::item   |         
u2:40 | Crate          | crate        | _c::crate                         |         
u2:41 | File           | main         | _c::main                          |         
u2:42 | Function       | main         | _c::main::main                    |         
u2:43 | Variable       | svc          | _c::main::main::svc               |         
u2:44 | Variable       | id           | _c::main::main::id                |         
u2:45 | Variable       | item         | _c::main::main::item              |         

--- expect:symbol-deps ---
u0:12 <- [u1:36, u1:37, u1:38]
u0:18 <- [u0:22, u1:33, u1:34, u1:38, u1:39]
u0:22 -> [u0:18, u0:23, u0:24, u0:25]
u0:22 <- [u0:27, u0:29, u1:36, u1:38]
u0:23 <- [u0:22, u0:27, u1:36]
u0:24 <- [u0:22, u0:27, u1:38]
u0:25 <- [u0:22, u0:27]
u0:27 -> [u0:22, u0:23, u0:24, u0:25]
u0:29 -> [u0:22]
u1:33 -> [u0:18, u1:36, u1:38]
u1:33 <- [u1:35, u2:42, u2:43, u2:44, u2:45]
u1:34 -> [u0:18]
u1:35 -> [u1:33]
u1:35 <- [u2:42]
u1:36 -> [u0:12, u0:22, u0:23]
u1:36 <- [u1:33, u2:42]
u1:37 -> [u0:12]
u1:38 -> [u0:12, u0:18, u0:22, u0:24]
u1:38 <- [u1:33, u2:42]
u1:39 -> [u0:18]
u2:42 -> [u1:33, u1:35, u1:36, u1:38]
u2:43 -> [u1:33]
u2:44 -> [u1:33]
u2:45 -> [u1:33]


===============================================================================
cross-file-builder-pattern
===============================================================================
Tests builder pattern: DatabaseConfig in config.rs, DatabaseConfigBuilder in builder.rs, used in main.rs.

--- file: src/config.rs ---
pub struct DatabaseConfig {
    pub host: String,
    pub port: u16,
    pub database: String,
    pub max_connections: u32,
}

--- file: src/builder.rs ---
use crate::config::DatabaseConfig;

pub struct DatabaseConfigBuilder {
    host: Option<String>,
    port: Option<u16>,
    database: Option<String>,
    max_connections: Option<u32>,
}

impl DatabaseConfigBuilder {
    pub fn new() -> Self {
        DatabaseConfigBuilder {
            host: None,
            port: None,
            database: None,
            max_connections: None,
        }
    }

    pub fn host(mut self, host: &str) -> Self {
        self.host = Some(host.to_string());
        self
    }

    pub fn port(mut self, port: u16) -> Self {
        self.port = Some(port);
        self
    }

    pub fn database(mut self, db: &str) -> Self {
        self.database = Some(db.to_string());
        self
    }

    pub fn max_connections(mut self, max: u32) -> Self {
        self.max_connections = Some(max);
        self
    }

    pub fn build(self) -> DatabaseConfig {
        DatabaseConfig {
            host: self.host.unwrap_or_else(|| "localhost".to_string()),
            port: self.port.unwrap_or(5432),
            database: self.database.unwrap_or_else(|| "default".to_string()),
            max_connections: self.max_connections.unwrap_or(10),
        }
    }
}

--- file: src/main.rs ---
mod config;
mod builder;

use builder::DatabaseConfigBuilder;

fn main() {
    let config = DatabaseConfigBuilder::new()
        .host("db.example.com")
        .port(5432)
        .database("myapp")
        .max_connections(100)
        .build();

    println!("Connecting to {}:{}", config.host, config.port);
}

--- expect:symbols ---
u0:1  | Primitive | i32                   | i32                                                      | [global]
u0:2  | Primitive | i64                   | i64                                                      | [global]
u0:3  | Primitive | i16                   | i16                                                      | [global]
u0:4  | Primitive | i8                    | i8                                                       | [global]
u0:5  | Primitive | i128                  | i128                                                     | [global]
u0:6  | Primitive | isize                 | isize                                                    | [global]
u0:7  | Primitive | u32                   | u32                                                      | [global]
u0:8  | Primitive | u64                   | u64                                                      | [global]
u0:9  | Primitive | u16                   | u16                                                      | [global]
u0:10 | Primitive | u8                    | u8                                                       | [global]
u0:11 | Primitive | u128                  | u128                                                     | [global]
u0:12 | Primitive | usize                 | usize                                                    | [global]
u0:13 | Primitive | f32                   | f32                                                      | [global]
u0:14 | Primitive | f64                   | f64                                                      | [global]
u0:15 | Primitive | bool                  | bool                                                     | [global]
u0:16 | Primitive | char                  | char                                                     | [global]
u0:17 | Primitive | str                   | str                                                      | [global]
u0:18 | Primitive | String                | String                                                   | [global]
u0:19 | Crate     | _c                    | _c                                                       | [global]
u0:20 | Crate     | crate                 | _c::crate                                                |         
u0:21 | File      | config                | _c::config                                               |         
u0:22 | Struct    | DatabaseConfig        | _c::config::DatabaseConfig                               | [global]
u0:23 | Field     | host                  | _c::config::DatabaseConfig::host                         |         
u0:24 | Field     | port                  | _c::config::DatabaseConfig::port                         |         
u0:25 | Field     | database              | _c::config::DatabaseConfig::database                     |         
u0:26 | Field     | max_connections       | _c::config::DatabaseConfig::max_connections              |         
u1:27 | Crate     | crate                 | _c::crate                                                |         
u1:28 | File      | builder               | _c::builder                                              |         
u1:29 | Struct    | DatabaseConfigBuilder | _c::builder::DatabaseConfigBuilder                       | [global]
u1:30 | Field     | host                  | _c::builder::DatabaseConfigBuilder::host                 | [global]
u1:31 | Field     | port                  | _c::builder::DatabaseConfigBuilder::port                 | [global]
u1:32 | Field     | database              | _c::builder::DatabaseConfigBuilder::database             | [global]
u1:33 | Field     | max_connections       | _c::builder::DatabaseConfigBuilder::max_connections      | [global]
u1:34 | Function  | new                   | _c::builder::DatabaseConfigBuilder::new                  | [global]
u1:35 | Variable  | host                  | _c::builder::DatabaseConfigBuilder::host::host           |         
u1:36 | Variable  | port                  | _c::builder::DatabaseConfigBuilder::port::port           |         
u1:37 | Variable  | db                    | _c::builder::DatabaseConfigBuilder::database::db         |         
u1:38 | Variable  | max                   | _c::builder::DatabaseConfigBuilder::max_connections::max |         
u1:39 | Function  | build                 | _c::builder::DatabaseConfigBuilder::build                | [global]
u2:40 | Crate     | crate                 | _c::crate                                                |         
u2:41 | File      | main                  | _c::main                                                 |         
u2:42 | Function  | main                  | _c::main::main                                           |         
u2:43 | Variable  | config                | _c::main::main::config                                   |         

--- expect:symbol-deps ---
u0:17 <- [u1:30, u1:32, u1:35, u1:37]
u0:18 <- [u0:22, u0:23, u0:25, u1:29, u1:30, u1:32]
u0:22 -> [u0:18, u0:7, u0:9]
u0:22 <- [u1:39]
u0:23 -> [u0:18]
u0:24 -> [u0:9]
u0:25 -> [u0:18]
u0:26 -> [u0:7]
u0:7 <- [u0:22, u0:26, u1:29, u1:33, u1:38]
u0:9 <- [u0:22, u0:24, u1:29, u1:31, u1:36]
u1:29 -> [u0:18, u0:7, u0:9, u1:30, u1:31, u1:32, u1:33, u1:39]
u1:29 <- [u1:34, u2:42, u2:43]
u1:30 -> [u0:17, u0:18]
u1:30 <- [u1:29]
u1:31 -> [u0:9]
u1:31 <- [u1:29]
u1:32 -> [u0:17, u0:18]
u1:32 <- [u1:29]
u1:33 -> [u0:7]
u1:33 <- [u1:29]
u1:34 -> [u1:29]
u1:34 <- [u2:42]
u1:35 -> [u0:17]
u1:36 -> [u0:9]
u1:37 -> [u0:17]
u1:38 -> [u0:7]
u1:39 -> [u0:22]
u1:39 <- [u1:29, u2:42]
u2:42 -> [u1:29, u1:34, u1:39]
u2:43 -> [u1:29]


===============================================================================
cross-file-factory-pattern
===============================================================================
Tests factory pattern: Transport trait with TCP/UDP implementations, TransportFactory creates them.

--- file: src/transport.rs ---
pub trait Transport {
    fn send(&self, data: &[u8]) -> bool;
    fn recv(&self) -> Vec<u8>;
}

pub struct TcpTransport {
    pub address: String,
}

pub struct UdpTransport {
    pub address: String,
}

impl Transport for TcpTransport {
    fn send(&self, data: &[u8]) -> bool {
        println!("TCP send to {}: {} bytes", self.address, data.len());
        true
    }
    fn recv(&self) -> Vec<u8> {
        vec![]
    }
}

impl Transport for UdpTransport {
    fn send(&self, data: &[u8]) -> bool {
        println!("UDP send to {}: {} bytes", self.address, data.len());
        true
    }
    fn recv(&self) -> Vec<u8> {
        vec![]
    }
}

--- file: src/factory.rs ---
use crate::transport::{Transport, TcpTransport, UdpTransport};

pub enum TransportType {
    Tcp,
    Udp,
}

pub struct TransportFactory;

impl TransportFactory {
    pub fn create(kind: TransportType, address: &str) -> Box<dyn Transport> {
        match kind {
            TransportType::Tcp => Box::new(TcpTransport { address: address.to_string() }),
            TransportType::Udp => Box::new(UdpTransport { address: address.to_string() }),
        }
    }
}

--- file: src/main.rs ---
mod transport;
mod factory;

use factory::{TransportFactory, TransportType};

fn main() {
    let tcp = TransportFactory::create(TransportType::Tcp, "127.0.0.1:8080");
    let udp = TransportFactory::create(TransportType::Udp, "127.0.0.1:9090");

    tcp.send(b"hello tcp");
    udp.send(b"hello udp");
}

--- expect:symbols ---
u0:1 | Primitive | i32 | i32 | [global]
u0:2 | Primitive | i64 | i64 | [global]
u0:3 | Primitive | i16 | i16 | [global]
u0:4 | Primitive | i8 | i8 | [global]
u0:5 | Primitive | i128 | i128 | [global]
u0:6 | Primitive | isize | isize | [global]
u0:7 | Primitive | u32 | u32 | [global]
u0:8 | Primitive | u64 | u64 | [global]
u0:9 | Primitive | u16 | u16 | [global]
u0:10 | Primitive | u8 | u8 | [global]
u0:11 | Primitive | u128 | u128 | [global]
u0:12 | Primitive | usize | usize | [global]
u0:13 | Primitive | f32 | f32 | [global]
u0:14 | Primitive | f64 | f64 | [global]
u0:15 | Primitive | bool | bool | [global]
u0:16 | Primitive | char | char | [global]
u0:17 | Primitive | str | str | [global]
u0:18 | Primitive | String | String | [global]
u0:19 | Crate | _c | _c | [global]
u0:20 | Crate | crate | _c::crate | 
u0:21 | File | transport | _c::transport | 
u0:22 | Trait | Transport | _c::transport::Transport | [global]
u0:23 | Function | send | _c::transport::Transport::send | 
u0:24 | Variable | data | _c::transport::Transport::send::data | 
u0:25 | Function | recv | _c::transport::Transport::recv | 
u0:26 | Struct | TcpTransport | _c::transport::TcpTransport | [global]
u0:27 | Field | address | _c::transport::TcpTransport::address | 
u0:28 | Struct | UdpTransport | _c::transport::UdpTransport | [global]
u0:29 | Field | address | _c::transport::UdpTransport::address | 
u0:30 | Function | send | _c::transport::TcpTransport::send | 
u0:31 | Variable | data | _c::transport::TcpTransport::send::data | 
u0:32 | Function | recv | _c::transport::TcpTransport::recv | 
u0:33 | Function | send | _c::transport::UdpTransport::send | 
u0:34 | Variable | data | _c::transport::UdpTransport::send::data | 
u0:35 | Function | recv | _c::transport::UdpTransport::recv | 
u1:36 | Crate | crate | _c::crate | 
u1:37 | File | factory | _c::factory | 
u1:38 | Enum | TransportType | _c::factory::TransportType | [global]
u1:39 | EnumVariant | Tcp | _c::factory::TransportType::Tcp | 
u1:40 | EnumVariant | Udp | _c::factory::TransportType::Udp | 
u1:41 | Struct | TransportFactory | _c::factory::TransportFactory | [global]
u1:42 | Function | create | _c::factory::TransportFactory::create | [global]
u1:43 | Variable | kind | _c::factory::TransportFactory::create::kind | 
u1:44 | Variable | address | _c::factory::TransportFactory::create::address | 
u2:45 | Crate | crate | _c::crate | 
u2:46 | File | main | _c::main | 
u2:47 | Function | main | _c::main::main | 
u2:48 | Variable | tcp | _c::main::main::tcp | 
u2:49 | Variable | udp | _c::main::main::udp | 

--- expect:symbol-deps ---
u0:10 <- [u0:23, u0:24, u0:25, u0:30, u0:31, u0:32, u0:33, u0:34, u0:35]
u0:15 <- [u0:23, u0:30, u0:33]
u0:17 <- [u1:42, u1:44]
u0:18 <- [u0:26, u0:27, u0:28, u0:29]
u0:22 -> [u0:23, u0:25]
u0:22 <- [u0:26, u0:28]
u0:23 -> [u0:10, u0:15]
u0:23 <- [u0:22]
u0:24 -> [u0:10]
u0:25 -> [u0:10]
u0:25 <- [u0:22]
u0:26 -> [u0:18, u0:22, u0:30, u0:32]
u0:26 <- [u1:42]
u0:27 -> [u0:18]
u0:28 -> [u0:18, u0:22, u0:33, u0:35]
u0:28 <- [u1:42]
u0:29 -> [u0:18]
u0:30 -> [u0:10, u0:15]
u0:30 <- [u0:26]
u0:31 -> [u0:10]
u0:32 -> [u0:10]
u0:32 <- [u0:26]
u0:33 -> [u0:10, u0:15]
u0:33 <- [u0:28, u2:47]
u0:34 -> [u0:10]
u0:35 -> [u0:10]
u0:35 <- [u0:28]
u1:38 -> [u1:39, u1:40]
u1:38 <- [u1:42, u1:43, u2:47, u2:48, u2:49]
u1:39 <- [u1:38, u1:42, u2:47]
u1:40 <- [u1:38, u1:42, u2:47]
u1:41 -> [u1:42]
u1:42 -> [u0:17, u0:26, u0:28, u1:38, u1:39, u1:40]
u1:42 <- [u1:41, u2:47]
u1:43 -> [u1:38]
u1:44 -> [u0:17]
u2:47 -> [u0:33, u1:38, u1:39, u1:40, u1:42]
u2:48 -> [u1:38]
u2:49 -> [u1:38]


===============================================================================
cross-file-visitor-pattern
===============================================================================
Tests visitor pattern: AST in ast.rs, Visitor trait in visitor.rs, Evaluator/Printer in evaluators.rs.

--- file: src/ast.rs ---
pub enum Expr {
    Number(i64),
    Binary { op: BinOp, left: Box<Expr>, right: Box<Expr> },
    Unary { op: UnaryOp, expr: Box<Expr> },
}

pub enum BinOp {
    Add,
    Sub,
    Mul,
    Div,
}

pub enum UnaryOp {
    Neg,
    Not,
}

--- file: src/visitor.rs ---
use crate::ast::{Expr, BinOp, UnaryOp};

pub trait ExprVisitor {
    type Output;

    fn visit_number(&mut self, n: i64) -> Self::Output;
    fn visit_binary(&mut self, op: &BinOp, left: &Expr, right: &Expr) -> Self::Output;
    fn visit_unary(&mut self, op: &UnaryOp, expr: &Expr) -> Self::Output;

    fn visit(&mut self, expr: &Expr) -> Self::Output {
        match expr {
            Expr::Number(n) => self.visit_number(*n),
            Expr::Binary { op, left, right } => self.visit_binary(op, left, right),
            Expr::Unary { op, expr } => self.visit_unary(op, expr),
        }
    }
}

--- file: src/eval.rs ---
use crate::ast::{Expr, BinOp, UnaryOp};
use crate::visitor::ExprVisitor;

pub struct Evaluator;

impl ExprVisitor for Evaluator {
    type Output = i64;

    fn visit_number(&mut self, n: i64) -> i64 {
        n
    }

    fn visit_binary(&mut self, op: &BinOp, left: &Expr, right: &Expr) -> i64 {
        let l = self.visit(left);
        let r = self.visit(right);
        match op {
            BinOp::Add => l + r,
            BinOp::Sub => l - r,
            BinOp::Mul => l * r,
            BinOp::Div => l / r,
        }
    }

    fn visit_unary(&mut self, op: &UnaryOp, expr: &Expr) -> i64 {
        let v = self.visit(expr);
        match op {
            UnaryOp::Neg => -v,
            UnaryOp::Not => if v == 0 { 1 } else { 0 },
        }
    }
}

--- file: src/main.rs ---
mod ast;
mod visitor;
mod eval;

use ast::{Expr, BinOp};
use visitor::ExprVisitor;
use eval::Evaluator;

fn main() {
    // (1 + 2) * 3
    let expr = Expr::Binary {
        op: BinOp::Mul,
        left: Box::new(Expr::Binary {
            op: BinOp::Add,
            left: Box::new(Expr::Number(1)),
            right: Box::new(Expr::Number(2)),
        }),
        right: Box::new(Expr::Number(3)),
    };

    let mut eval = Evaluator;
    println!("Result: {}", eval.visit(&expr));
}

--- expect:symbols ---
u0:1  | Primitive      | i32          | i32                                           | [global]
u0:2  | Primitive      | i64          | i64                                           | [global]
u0:3  | Primitive      | i16          | i16                                           | [global]
u0:4  | Primitive      | i8           | i8                                            | [global]
u0:5  | Primitive      | i128         | i128                                          | [global]
u0:6  | Primitive      | isize        | isize                                         | [global]
u0:7  | Primitive      | u32          | u32                                           | [global]
u0:8  | Primitive      | u64          | u64                                           | [global]
u0:9  | Primitive      | u16          | u16                                           | [global]
u0:10 | Primitive      | u8           | u8                                            | [global]
u0:11 | Primitive      | u128         | u128                                          | [global]
u0:12 | Primitive      | usize        | usize                                         | [global]
u0:13 | Primitive      | f32          | f32                                           | [global]
u0:14 | Primitive      | f64          | f64                                           | [global]
u0:15 | Primitive      | bool         | bool                                          | [global]
u0:16 | Primitive      | char         | char                                          | [global]
u0:17 | Primitive      | str          | str                                           | [global]
u0:18 | Primitive      | String       | String                                        | [global]
u0:19 | Crate          | _c           | _c                                            | [global]
u0:20 | Crate          | crate        | _c::crate                                     |         
u0:21 | File           | ast          | _c::ast                                       |         
u0:22 | Enum           | Expr         | _c::ast::Expr                                 | [global]
u0:23 | EnumVariant    | Number       | _c::ast::Expr::Number                         |         
u0:24 | EnumVariant    | Binary       | _c::ast::Expr::Binary                         |         
u0:25 | Field          | op           | _c::ast::Expr::Binary::op                     |         
u0:26 | Field          | left         | _c::ast::Expr::Binary::left                   |         
u0:27 | Field          | right        | _c::ast::Expr::Binary::right                  |         
u0:28 | EnumVariant    | Unary        | _c::ast::Expr::Unary                          |         
u0:29 | Field          | op           | _c::ast::Expr::Unary::op                      |         
u0:30 | Field          | expr         | _c::ast::Expr::Unary::expr                    |         
u0:31 | Enum           | BinOp        | _c::ast::BinOp                                | [global]
u0:32 | EnumVariant    | Add          | _c::ast::BinOp::Add                           |         
u0:33 | EnumVariant    | Sub          | _c::ast::BinOp::Sub                           |         
u0:34 | EnumVariant    | Mul          | _c::ast::BinOp::Mul                           |         
u0:35 | EnumVariant    | Div          | _c::ast::BinOp::Div                           |         
u0:36 | Enum           | UnaryOp      | _c::ast::UnaryOp                              | [global]
u0:37 | EnumVariant    | Neg          | _c::ast::UnaryOp::Neg                         |         
u0:38 | EnumVariant    | Not          | _c::ast::UnaryOp::Not                         |         
u1:39 | Crate          | crate        | _c::crate                                     |         
u1:40 | File           | visitor      | _c::visitor                                   |         
u1:41 | Trait          | ExprVisitor  | _c::visitor::ExprVisitor                      | [global]
u1:42 | TypeAlias      | Output       | _c::visitor::ExprVisitor::Output              |         
u1:43 | Function       | visit_number | _c::visitor::ExprVisitor::visit_number        |         
u1:44 | Variable       | n            | _c::visitor::ExprVisitor::visit_number::n     |         
u1:45 | Function       | visit_binary | _c::visitor::ExprVisitor::visit_binary        |         
u1:46 | Variable       | op           | _c::visitor::ExprVisitor::visit_binary::op    |         
u1:47 | Variable       | left         | _c::visitor::ExprVisitor::visit_binary::left  |         
u1:48 | Variable       | right        | _c::visitor::ExprVisitor::visit_binary::right |         
u1:49 | Function       | visit_unary  | _c::visitor::ExprVisitor::visit_unary         |         
u1:50 | Variable       | op           | _c::visitor::ExprVisitor::visit_unary::op     |         
u1:51 | Variable       | expr         | _c::visitor::ExprVisitor::visit_unary::expr   |         
u1:52 | Function       | visit        | _c::visitor::ExprVisitor::visit               |         
u1:53 | Variable       | expr         | _c::visitor::ExprVisitor::visit::expr         |         
u2:54 | Crate          | crate        | _c::crate                                     |         
u2:55 | File           | eval         | _c::eval                                      |         
u2:56 | Struct         | Evaluator    | _c::eval::Evaluator                           | [global]
u2:57 | UnresolvedType | ExprVisitor  | _c::eval::ExprVisitor                         |         
u2:58 | TypeAlias      | Output       | _c::eval::Evaluator::Output                   |         
u2:59 | Function       | visit_number | _c::eval::Evaluator::visit_number             |         
u2:60 | Variable       | n            | _c::eval::Evaluator::visit_number::n          |         
u2:61 | Function       | visit_binary | _c::eval::Evaluator::visit_binary             |         
u2:62 | Variable       | op           | _c::eval::Evaluator::visit_binary::op         |         
u2:63 | Variable       | left         | _c::eval::Evaluator::visit_binary::left       |         
u2:64 | Variable       | right        | _c::eval::Evaluator::visit_binary::right      |         
u2:65 | Variable       | l            | _c::eval::Evaluator::visit_binary::l          |         
u2:66 | Variable       | r            | _c::eval::Evaluator::visit_binary::r          |         
u2:67 | Function       | visit_unary  | _c::eval::Evaluator::visit_unary              |         
u2:68 | Variable       | op           | _c::eval::Evaluator::visit_unary::op          |         
u2:69 | Variable       | expr         | _c::eval::Evaluator::visit_unary::expr        |         
u2:70 | Variable       | v            | _c::eval::Evaluator::visit_unary::v           |         
u3:71 | Crate          | crate        | _c::crate                                     |         
u3:72 | File           | main         | _c::main                                      |         
u3:73 | Function       | main         | _c::main::main                                |         
u3:74 | Variable       | expr         | _c::main::main::expr                          |         
u3:75 | Variable       | eval         | _c::main::main::eval                          |         

--- expect:symbol-deps ---
u0:2 <- [u0:22, u1:43, u1:44, u2:56, u2:58, u2:59, u2:60, u2:61, u2:67]
u0:22 -> [u0:2, u0:23, u0:24, u0:28, u0:31, u0:36]
u0:22 <- [u1:45, u1:47, u1:48, u1:49, u1:51, u1:52, u1:53, u2:61, u2:63, u2:64, u2:67, u2:69, u3:73]
u0:23 <- [u0:22, u1:52, u3:73]
u0:24 <- [u0:22, u3:73, u3:74]
u0:28 <- [u0:22]
u0:31 -> [u0:32, u0:33, u0:34, u0:35]
u0:31 <- [u0:22, u1:45, u1:46, u2:61, u2:62, u3:73]
u0:32 <- [u0:31, u2:61, u3:73]
u0:33 <- [u0:31, u2:61]
u0:34 <- [u0:31, u2:61, u3:73]
u0:35 <- [u0:31, u2:61]
u0:36 -> [u0:37, u0:38]
u0:36 <- [u0:22, u1:49, u1:50, u2:67, u2:68]
u0:37 <- [u0:36, u2:67]
u0:38 <- [u0:36, u2:67]
u1:41 -> [u1:42, u1:43, u1:45, u1:49, u1:52]
u1:42 <- [u1:41]
u1:43 -> [u0:2]
u1:43 <- [u1:41, u1:52]
u1:44 -> [u0:2]
u1:45 -> [u0:22, u0:31]
u1:45 <- [u1:41, u1:52]
u1:46 -> [u0:31]
u1:47 -> [u0:22]
u1:48 -> [u0:22]
u1:49 -> [u0:22, u0:36]
u1:49 <- [u1:41, u1:52]
u1:50 -> [u0:36]
u1:51 -> [u0:22]
u1:52 -> [u0:22, u0:23, u1:43, u1:45, u1:49]
u1:52 <- [u1:41, u2:61, u2:65, u2:66, u2:67, u2:70]
u1:53 -> [u0:22]
u2:56 -> [u0:2, u2:58, u2:59, u2:61, u2:67]
u2:56 <- [u3:73, u3:75]
u2:58 -> [u0:2]
u2:58 <- [u2:56]
u2:59 -> [u0:2]
u2:59 <- [u2:56]
u2:60 -> [u0:2]
u2:61 -> [u0:2, u0:22, u0:31, u0:32, u0:33, u0:34, u0:35, u1:52]
u2:61 <- [u2:56]
u2:62 -> [u0:31]
u2:63 -> [u0:22]
u2:64 -> [u0:22]
u2:65 -> [u1:52]
u2:66 -> [u1:52]
u2:67 -> [u0:2, u0:22, u0:36, u0:37, u0:38, u1:52]
u2:67 <- [u2:56]
u2:68 -> [u0:36]
u2:69 -> [u0:22]
u2:70 -> [u1:52]
u3:73 -> [u0:22, u0:23, u0:24, u0:31, u0:32, u0:34, u2:56]
u3:74 -> [u0:24]
u3:75 -> [u2:56]


===============================================================================
cross-file-repository-pattern
===============================================================================
Tests repository pattern: User entity in entity.rs, Repository trait in repository.rs, InMemoryRepo implementation.

--- file: src/entity.rs ---
#[derive(Clone, Debug)]
pub struct User {
    pub id: u64,
    pub name: String,
    pub email: String,
}

#[derive(Clone, Debug)]
pub struct Post {
    pub id: u64,
    pub user_id: u64,
    pub title: String,
    pub content: String,
}

--- file: src/repository.rs ---
use crate::entity::{User, Post};

pub trait Repository<T> {
    fn find_by_id(&self, id: u64) -> Option<T>;
    fn find_all(&self) -> Vec<T>;
    fn save(&mut self, item: T) -> u64;
    fn delete(&mut self, id: u64) -> bool;
}

pub trait UserRepository: Repository<User> {
    fn find_by_email(&self, email: &str) -> Option<User>;
}

pub trait PostRepository: Repository<Post> {
    fn find_by_user(&self, user_id: u64) -> Vec<Post>;
}

--- file: src/memory_repo.rs ---
use crate::entity::{User, Post};
use crate::repository::{Repository, UserRepository, PostRepository};
use std::collections::HashMap;

pub struct InMemoryUserRepo {
    users: HashMap<u64, User>,
    next_id: u64,
}

impl InMemoryUserRepo {
    pub fn new() -> Self {
        InMemoryUserRepo { users: HashMap::new(), next_id: 1 }
    }
}

impl Repository<User> for InMemoryUserRepo {
    fn find_by_id(&self, id: u64) -> Option<User> {
        self.users.get(&id).cloned()
    }

    fn find_all(&self) -> Vec<User> {
        self.users.values().cloned().collect()
    }

    fn save(&mut self, mut user: User) -> u64 {
        if user.id == 0 {
            user.id = self.next_id;
            self.next_id += 1;
        }
        let id = user.id;
        self.users.insert(id, user);
        id
    }

    fn delete(&mut self, id: u64) -> bool {
        self.users.remove(&id).is_some()
    }
}

impl UserRepository for InMemoryUserRepo {
    fn find_by_email(&self, email: &str) -> Option<User> {
        self.users.values().find(|u| u.email == email).cloned()
    }
}

--- file: src/main.rs ---
mod entity;
mod repository;
mod memory_repo;

use entity::User;
use repository::{Repository, UserRepository};
use memory_repo::InMemoryUserRepo;

fn main() {
    let mut repo = InMemoryUserRepo::new();

    let user = User { id: 0, name: "Alice".to_string(), email: "alice@example.com".to_string() };
    let id = repo.save(user);

    if let Some(found) = repo.find_by_id(id) {
        println!("Found: {:?}", found);
    }

    if let Some(by_email) = repo.find_by_email("alice@example.com") {
        println!("By email: {:?}", by_email);
    }
}

--- expect:symbols ---
u0:1  | Primitive      | i32              | i32                                                     | [global]
u0:2  | Primitive      | i64              | i64                                                     | [global]
u0:3  | Primitive      | i16              | i16                                                     | [global]
u0:4  | Primitive      | i8               | i8                                                      | [global]
u0:5  | Primitive      | i128             | i128                                                    | [global]
u0:6  | Primitive      | isize            | isize                                                   | [global]
u0:7  | Primitive      | u32              | u32                                                     | [global]
u0:8  | Primitive      | u64              | u64                                                     | [global]
u0:9  | Primitive      | u16              | u16                                                     | [global]
u0:10 | Primitive      | u8               | u8                                                      | [global]
u0:11 | Primitive      | u128             | u128                                                    | [global]
u0:12 | Primitive      | usize            | usize                                                   | [global]
u0:13 | Primitive      | f32              | f32                                                     | [global]
u0:14 | Primitive      | f64              | f64                                                     | [global]
u0:15 | Primitive      | bool             | bool                                                    | [global]
u0:16 | Primitive      | char             | char                                                    | [global]
u0:17 | Primitive      | str              | str                                                     | [global]
u0:18 | Primitive      | String           | String                                                  | [global]
u0:19 | Crate          | _c               | _c                                                      | [global]
u0:20 | Crate          | crate            | _c::crate                                               |         
u0:21 | File           | entity           | _c::entity                                              |         
u0:22 | Struct         | User             | _c::entity::User                                        | [global]
u0:23 | Field          | id               | _c::entity::User::id                                    |         
u0:24 | Field          | name             | _c::entity::User::name                                  |         
u0:25 | Field          | email            | _c::entity::User::email                                 |         
u0:26 | Struct         | Post             | _c::entity::Post                                        | [global]
u0:27 | Field          | id               | _c::entity::Post::id                                    |         
u0:28 | Field          | user_id          | _c::entity::Post::user_id                               |         
u0:29 | Field          | title            | _c::entity::Post::title                                 |         
u0:30 | Field          | content          | _c::entity::Post::content                               |         
u1:31 | Crate          | crate            | _c::crate                                               |         
u1:32 | File           | repository       | _c::repository                                          |         
u1:33 | Trait          | Repository       | _c::repository::Repository                              | [global]
u1:34 | TypeParameter  | T                | _c::repository::Repository::T                           |         
u1:35 | Function       | find_by_id       | _c::repository::Repository::find_by_id                  |         
u1:36 | Variable       | id               | _c::repository::Repository::find_by_id::id              |         
u1:37 | Function       | find_all         | _c::repository::Repository::find_all                    |         
u1:38 | Function       | save             | _c::repository::Repository::save                        |         
u1:39 | Variable       | item             | _c::repository::Repository::save::item                  |         
u1:40 | Function       | delete           | _c::repository::Repository::delete                      |         
u1:41 | Variable       | id               | _c::repository::Repository::delete::id                  |         
u1:42 | Trait          | UserRepository   | _c::repository::UserRepository                          | [global]
u1:43 | Function       | find_by_email    | _c::repository::UserRepository::find_by_email           |         
u1:44 | Variable       | email            | _c::repository::UserRepository::find_by_email::email    |         
u1:45 | Trait          | PostRepository   | _c::repository::PostRepository                          | [global]
u1:46 | Function       | find_by_user     | _c::repository::PostRepository::find_by_user            |         
u1:47 | Variable       | user_id          | _c::repository::PostRepository::find_by_user::user_id   |         
u2:48 | Crate          | crate            | _c::crate                                               |         
u2:49 | File           | memory_repo      | _c::memory_repo                                         |         
u2:50 | Struct         | InMemoryUserRepo | _c::memory_repo::InMemoryUserRepo                       | [global]
u2:51 | Field          | users            | _c::memory_repo::InMemoryUserRepo::users                |         
u2:52 | Field          | next_id          | _c::memory_repo::InMemoryUserRepo::next_id              |         
u2:53 | Function       | new              | _c::memory_repo::InMemoryUserRepo::new                  | [global]
u2:54 | UnresolvedType | Repository       | _c::memory_repo::Repository                             |         
u2:55 | Function       | find_by_id       | _c::memory_repo::InMemoryUserRepo::find_by_id           |         
u2:56 | Variable       | id               | _c::memory_repo::InMemoryUserRepo::find_by_id::id       |         
u2:57 | Function       | find_all         | _c::memory_repo::InMemoryUserRepo::find_all             |         
u2:58 | Function       | save             | _c::memory_repo::InMemoryUserRepo::save                 |         
u2:59 | Variable       | user             | _c::memory_repo::InMemoryUserRepo::save::user           |         
u2:60 | Variable       | id               | _c::memory_repo::InMemoryUserRepo::save::id             |         
u2:61 | Function       | delete           | _c::memory_repo::InMemoryUserRepo::delete               |         
u2:62 | Variable       | id               | _c::memory_repo::InMemoryUserRepo::delete::id           |         
u2:63 | UnresolvedType | UserRepository   | _c::memory_repo::UserRepository                         |         
u2:64 | Function       | find_by_email    | _c::memory_repo::InMemoryUserRepo::find_by_email        |         
u2:65 | Variable       | email            | _c::memory_repo::InMemoryUserRepo::find_by_email::email |         
u2:66 | Variable       | u                | _c::memory_repo::InMemoryUserRepo::find_by_email::u     |         
u3:67 | Crate          | crate            | _c::crate                                               |         
u3:68 | File           | main             | _c::main                                                |         
u3:69 | Function       | main             | _c::main::main                                          |         
u3:70 | Variable       | repo             | _c::main::main::repo                                    |         
u3:71 | Variable       | user             | _c::main::main::user                                    |         
u3:72 | Variable       | id               | _c::main::main::id                                      |         

--- expect:symbol-deps ---
u0:15 <- [u1:40, u2:61]
u0:17 <- [u1:43, u1:44, u2:64, u2:65]
u0:18 <- [u0:22, u0:24, u0:25, u0:26, u0:29, u0:30]
u0:22 -> [u0:18, u0:8]
u0:22 <- [u1:42, u2:50, u2:51, u2:58, u2:59, u3:69, u3:71]
u0:23 -> [u0:8]
u0:24 -> [u0:18]
u0:25 -> [u0:18]
u0:26 -> [u0:18, u0:8]
u0:26 <- [u1:45]
u0:27 -> [u0:8]
u0:28 -> [u0:8]
u0:29 -> [u0:18]
u0:30 -> [u0:18]
u0:8 <- [u0:22, u0:23, u0:26, u0:27, u0:28, u1:35, u1:36, u1:38, u1:40, u1:41, u1:46, u1:47, u2:50, u2:52, u2:55, u2:56, u2:58, u2:60, u2:61, u2:62]
u1:33 -> [u1:35, u1:37, u1:38, u1:40]
u1:33 <- [u1:42, u1:45]
u1:35 -> [u0:8]
u1:35 <- [u1:33]
u1:36 -> [u0:8]
u1:37 <- [u1:33]
u1:38 -> [u0:8]
u1:38 <- [u1:33]
u1:40 -> [u0:15, u0:8]
u1:40 <- [u1:33]
u1:41 -> [u0:8]
u1:42 -> [u0:22, u1:33, u1:43]
u1:43 -> [u0:17]
u1:43 <- [u1:42]
u1:44 -> [u0:17]
u1:45 -> [u0:26, u1:33, u1:46]
u1:46 -> [u0:8]
u1:46 <- [u1:45]
u1:47 -> [u0:8]
u2:50 -> [u0:22, u0:8, u2:55, u2:57, u2:58, u2:61, u2:64]
u2:50 <- [u2:53, u3:69, u3:70, u3:72]
u2:51 -> [u0:22]
u2:52 -> [u0:8]
u2:53 -> [u2:50]
u2:53 <- [u3:69]
u2:55 -> [u0:8]
u2:55 <- [u2:50, u3:69]
u2:56 -> [u0:8]
u2:57 <- [u2:50]
u2:58 -> [u0:22, u0:8]
u2:58 <- [u2:50, u3:69]
u2:59 -> [u0:22]
u2:60 -> [u0:8]
u2:61 -> [u0:15, u0:8]
u2:61 <- [u2:50]
u2:62 -> [u0:8]
u2:64 -> [u0:17]
u2:64 <- [u2:50, u3:69]
u2:65 -> [u0:17]
u3:69 -> [u0:22, u2:50, u2:53, u2:55, u2:58, u2:64]
u3:70 -> [u2:50]
u3:71 -> [u0:22]
u3:72 -> [u2:50]


===============================================================================
cross-file-event-driven
===============================================================================
Tests event-driven architecture: Event enum in events.rs, EventHandler trait with multiple handler implementations.

--- file: src/events.rs ---
pub enum Event {
    UserCreated { id: u64, name: String },
    UserUpdated { id: u64, name: String },
    UserDeleted { id: u64 },
    OrderPlaced { id: u64, user_id: u64, total: f64 },
}

--- file: src/handler.rs ---
use crate::events::Event;

pub trait EventHandler {
    fn handle(&self, event: &Event);
}

pub struct LoggingHandler;

impl EventHandler for LoggingHandler {
    fn handle(&self, event: &Event) {
        match event {
            Event::UserCreated { id, name } => println!("User {} created: {}", id, name),
            Event::UserUpdated { id, name } => println!("User {} updated: {}", id, name),
            Event::UserDeleted { id } => println!("User {} deleted", id),
            Event::OrderPlaced { id, user_id, total } => {
                println!("Order {} placed by user {}: ${}", id, user_id, total)
            }
        }
    }
}

pub struct MetricsHandler {
    pub event_count: std::cell::Cell<u64>,
}

impl EventHandler for MetricsHandler {
    fn handle(&self, _event: &Event) {
        self.event_count.set(self.event_count.get() + 1);
    }
}

--- file: src/bus.rs ---
use crate::events::Event;
use crate::handler::EventHandler;

pub struct EventBus {
    handlers: Vec<Box<dyn EventHandler>>,
}

impl EventBus {
    pub fn new() -> Self {
        EventBus { handlers: Vec::new() }
    }

    pub fn register(&mut self, handler: Box<dyn EventHandler>) {
        self.handlers.push(handler);
    }

    pub fn publish(&self, event: Event) {
        for handler in &self.handlers {
            handler.handle(&event);
        }
    }
}

--- file: src/main.rs ---
mod events;
mod handler;
mod bus;

use events::Event;
use handler::{LoggingHandler, MetricsHandler};
use bus::EventBus;

fn main() {
    let mut bus = EventBus::new();
    bus.register(Box::new(LoggingHandler));
    bus.register(Box::new(MetricsHandler { event_count: std::cell::Cell::new(0) }));

    bus.publish(Event::UserCreated { id: 1, name: "Alice".to_string() });
    bus.publish(Event::OrderPlaced { id: 100, user_id: 1, total: 99.99 });
}

--- expect:symbols ---
u0:1 | Primitive | i32 | i32 | [global]
u0:2 | Primitive | i64 | i64 | [global]
u0:3 | Primitive | i16 | i16 | [global]
u0:4 | Primitive | i8 | i8 | [global]
u0:5 | Primitive | i128 | i128 | [global]
u0:6 | Primitive | isize | isize | [global]
u0:7 | Primitive | u32 | u32 | [global]
u0:8 | Primitive | u64 | u64 | [global]
u0:9 | Primitive | u16 | u16 | [global]
u0:10 | Primitive | u8 | u8 | [global]
u0:11 | Primitive | u128 | u128 | [global]
u0:12 | Primitive | usize | usize | [global]
u0:13 | Primitive | f32 | f32 | [global]
u0:14 | Primitive | f64 | f64 | [global]
u0:15 | Primitive | bool | bool | [global]
u0:16 | Primitive | char | char | [global]
u0:17 | Primitive | str | str | [global]
u0:18 | Primitive | String | String | [global]
u0:19 | Crate | _c | _c | [global]
u0:20 | Crate | crate | _c::crate | 
u0:21 | File | events | _c::events | 
u0:22 | Enum | Event | _c::events::Event | [global]
u0:23 | EnumVariant | UserCreated | _c::events::Event::UserCreated | 
u0:24 | Field | id | _c::events::Event::UserCreated::id | 
u0:25 | Field | name | _c::events::Event::UserCreated::name | 
u0:26 | EnumVariant | UserUpdated | _c::events::Event::UserUpdated | 
u0:27 | Field | id | _c::events::Event::UserUpdated::id | 
u0:28 | Field | name | _c::events::Event::UserUpdated::name | 
u0:29 | EnumVariant | UserDeleted | _c::events::Event::UserDeleted | 
u0:30 | Field | id | _c::events::Event::UserDeleted::id | 
u0:31 | EnumVariant | OrderPlaced | _c::events::Event::OrderPlaced | 
u0:32 | Field | id | _c::events::Event::OrderPlaced::id | 
u0:33 | Field | user_id | _c::events::Event::OrderPlaced::user_id | 
u0:34 | Field | total | _c::events::Event::OrderPlaced::total | 
u1:35 | Crate | crate | _c::crate | 
u1:36 | File | handler | _c::handler | 
u1:37 | Trait | EventHandler | _c::handler::EventHandler | [global]
u1:38 | Function | handle | _c::handler::EventHandler::handle | 
u1:39 | Variable | event | _c::handler::EventHandler::handle::event | 
u1:40 | Struct | LoggingHandler | _c::handler::LoggingHandler | [global]
u1:41 | Function | handle | _c::handler::LoggingHandler::handle | 
u1:42 | Variable | event | _c::handler::LoggingHandler::handle::event | 
u1:43 | Struct | MetricsHandler | _c::handler::MetricsHandler | [global]
u1:44 | Field | event_count | _c::handler::MetricsHandler::event_count | 
u1:45 | Function | handle | _c::handler::MetricsHandler::handle | 
u1:46 | Variable | _event | _c::handler::MetricsHandler::handle::_event | 
u2:47 | Crate | crate | _c::crate | 
u2:48 | File | bus | _c::bus | 
u2:49 | Struct | EventBus | _c::bus::EventBus | [global]
u2:50 | Field | handlers | _c::bus::EventBus::handlers | 
u2:51 | Function | new | _c::bus::EventBus::new | [global]
u2:52 | Function | register | _c::bus::EventBus::register | [global]
u2:53 | Variable | handler | _c::bus::EventBus::register::handler | 
u2:54 | Function | publish | _c::bus::EventBus::publish | [global]
u2:55 | Variable | event | _c::bus::EventBus::publish::event | 
u3:56 | Crate | crate | _c::crate | 
u3:57 | File | main | _c::main | 
u3:58 | Function | main | _c::main::main | 
u3:59 | Variable | bus | _c::main::main::bus | 

--- expect:symbol-deps ---
u0:14 <- [u0:22]
u0:18 <- [u0:22]
u0:22 -> [u0:14, u0:18, u0:23, u0:26, u0:29, u0:31, u0:8]
u0:22 <- [u1:38, u1:39, u1:41, u1:42, u1:45, u1:46, u2:54, u2:55]
u0:23 <- [u0:22]
u0:26 <- [u0:22]
u0:29 <- [u0:22]
u0:31 <- [u0:22]
u0:8 <- [u0:22, u1:43]
u1:37 -> [u1:38]
u1:37 <- [u1:40, u1:43, u2:49, u2:50, u2:52, u2:53]
u1:38 -> [u0:22]
u1:38 <- [u1:37]
u1:39 -> [u0:22]
u1:40 -> [u1:37, u1:41]
u1:41 -> [u0:22]
u1:41 <- [u1:40]
u1:42 -> [u0:22]
u1:43 -> [u0:8, u1:37, u1:45]
u1:43 <- [u3:58]
u1:45 -> [u0:22]
u1:45 <- [u1:43, u2:54]
u1:46 -> [u0:22]
u2:49 -> [u1:37, u2:52, u2:54]
u2:49 <- [u2:51, u3:58, u3:59]
u2:50 -> [u1:37]
u2:51 -> [u2:49]
u2:51 <- [u3:58]
u2:52 -> [u1:37]
u2:52 <- [u2:49, u3:58]
u2:53 -> [u1:37]
u2:54 -> [u0:22, u1:45]
u2:54 <- [u2:49, u3:58]
u2:55 -> [u0:22]
u3:58 -> [u1:43, u2:49, u2:51, u2:52, u2:54]
u3:59 -> [u2:49]
