===============================================================================
struct-binding
===============================================================================


--- file: app/src/main.rs ---
struct Foo;

struct Bar {
    a: i32,
    b: Vec<Foo>,
}

--- expect:symbols ---
u0:1 | Module | main | main | [global]
u0:2 | File   | main | main |         
u0:3 | Struct | Foo  | Foo  |         
u0:4 | Struct | Bar  | Bar  |         
u0:5 | Field  | a    | a    |         
u0:6 | Field  | b    | b    |         

--- expect:symbol-deps ---


--- expect:blocks ---
u0:135 | root  | main     
u0:136 | class | Foo      
u0:137 | class | Bar      
u0:138 | field | block#138
u0:139 | field | block#139

--- expect:block-deps ---


--- expect:graph ---
digraph project {
}




===============================================================================
struct-binding-multiple-files
===============================================================================


--- file: app/src/foo.rs ---
pub struct Foo;

--- file: app/src/main.rs ---
struct Bar {
    a: i32,
    b: Vec<Foo>,
}

--- expect:symbols ---
u0:2 | Module | foo  | foo  | [global]
u0:4 | File   | foo  | foo  |         
u0:6 | Struct | Foo  | Foo  |         
u1:1 | Module | main | main | [global]
u1:3 | File   | main | main |         
u1:5 | Struct | Bar  | Bar  |         
u1:7 | Field  | a    | a    |         
u1:8 | Field  | b    | b    |         

--- expect:symbol-deps ---


--- expect:blocks ---
u0:140 | root  | foo      
u0:141 | class | Foo      
u1:142 | root  | main     
u1:143 | class | Bar      
u1:144 | field | block#144
u1:145 | field | block#145

--- expect:block-deps ---


--- expect:block-graph ---
(root:140 foo
    (class:141 Foo)
)

(root:142 main
    (class:143 Bar
        (field:144)
        (field:145)
    )
)

--- expect:graph ---
digraph project {
}




===============================================================================
function-resolve
===============================================================================


--- file: src/main.rs ---
struct Bar;
struct Foo;

struct Slice;

impl Slice {
    fn binary_search(&self, x: &i32) -> Option<Foo> {
      Some(Foo)
    }

    fn fake_method() {}
}

fn func() {
  let slice = Slice::new();
  let f = slice.binary_search(&x);
}

--- expect:symbols ---
u0:1  | Module   | main          | main          | [global]
u0:2  | File     | main          | main          |         
u0:3  | Struct   | Bar           | Bar           |         
u0:4  | Struct   | Foo           | Foo           |         
u0:5  | Struct   | Slice         | Slice         |         
u0:6  | Impl     | impl Slice    | impl Slice    |         
u0:7  | Function | binary_search | binary_search |         
u0:8  | Variable | x             | x             |         
u0:9  | Function | fake_method   | fake_method   |         
u0:10 | Function | func          | func          |         
u0:11 | Variable | slice         | slice         |         
u0:12 | Variable | f             | f             |         

--- expect:symbol-deps ---
u0:5 <- [u0:6]
u0:6 -> [u0:5]




===============================================================================
call-target-method
===============================================================================


--- file: src/main.rs ---
struct Buffer;

impl Buffer {
    fn push(&mut self, value: u8) -> &mut Self {
        let _ = value;
        self
    }

    fn finish(&self) {}
}

fn method_demo(mut buffer: Buffer) {
    buffer.push(1);
}

--- expect:symbols ---
u0:1 | Module   | main        | main        | [global]
u0:2 | File     | main        | main        |         
u0:3 | Struct   | Buffer      | Buffer      |         
u0:4 | Impl     | impl Buffer | impl Buffer |         
u0:5 | Function | push        | push        |         
u0:6 | Variable | value       | value       |         
u0:7 | Function | finish      | finish      |         
u0:8 | Function | method_demo | method_demo |         
u0:9 | Variable | buffer      | buffer      |         

--- expect:symbol-deps ---
u0:3 <- [u0:4, u0:9]
u0:4 -> [u0:3]
u0:9 -> [u0:3]




===============================================================================
call-target-chain-invocation
===============================================================================


--- file: src/main.rs ---
struct Builder;

impl Builder {
    fn new() -> Self {
        Builder
    }

    fn step(self) -> Self {
        self
    }

    fn finish(self) {}
}

fn chain_invocation_demo() {
    Builder::new().step().finish();
}

--- expect:symbols ---
u0:1 | Module   | main                  | main                  | [global]
u0:2 | File     | main                  | main                  |         
u0:3 | Struct   | Builder               | Builder               |         
u0:4 | Impl     | impl Builder          | impl Builder          |         
u0:5 | Function | new                   | new                   |         
u0:6 | Function | step                  | step                  |         
u0:7 | Function | finish                | finish                |         
u0:8 | Function | chain_invocation_demo | chain_invocation_demo |         

--- expect:symbol-deps ---
u0:3 <- [u0:4]
u0:4 -> [u0:3]




===============================================================================
call-target-chain-variable
===============================================================================


--- file: src/main.rs ---
struct Stream;

impl Stream {
    fn advance(&mut self) -> &mut Self {
        self
    }

    fn flush(&self) {}
}

fn chain_variable_demo(mut stream: Stream) {
    let cursor = stream.advance();
    cursor.flush();
}

--- expect:symbols ---
u0:1 | Module   | main                | main                | [global]
u0:2 | File     | main                | main                |         
u0:3 | Struct   | Stream              | Stream              |         
u0:4 | Impl     | impl Stream         | impl Stream         |         
u0:5 | Function | advance             | advance             |         
u0:6 | Function | flush               | flush               |         
u0:7 | Function | chain_variable_demo | chain_variable_demo |         
u0:8 | Variable | stream              | stream              |         
u0:9 | Variable | cursor              | cursor              |         

--- expect:symbol-deps ---
u0:3 <- [u0:4, u0:8]
u0:4 -> [u0:3]
u0:8 -> [u0:3]




===============================================================================
call-target-qualified-function
===============================================================================


--- file: src/main.rs ---
struct Foo;
struct SessionBuilder;

impl SessionBuilder {
    fn new() -> Self {
        SessionBuilder
    }

    fn static_func() -> Foo {
        Foo
    }
}

fn qualified_call() {
    SessionBuilder::new();
    let x = SessionBuilder::static_func();
}

--- expect:symbols ---
u0:1 | Module   | main                | main                | [global]
u0:2 | File     | main                | main                |         
u0:3 | Struct   | Foo                 | Foo                 |         
u0:4 | Struct   | SessionBuilder      | SessionBuilder      |         
u0:5 | Impl     | impl SessionBuilder | impl SessionBuilder |         
u0:6 | Function | new                 | new                 |         
u0:7 | Function | static_func         | static_func         |         
u0:8 | Function | qualified_call      | qualified_call      |         
u0:9 | Variable | x                   | x                   |         

--- expect:symbol-deps ---
u0:4 <- [u0:5]
u0:5 -> [u0:4]

--- expect:blocks ---
u0:146 | root   | main               
u0:147 | class  | Foo                
u0:148 | class  | SessionBuilder     
u0:149 | impl   | impl SessionBuilder
u0:150 | method | new                
u0:151 | method | static_func        
u0:152 | func   | qualified_call     
u0:153 | call   | block#153          
u0:154 | call   | block#154          

--- expect:block-deps ---
u0:148 <- [u0:149]
u0:149 -> [u0:148]

--- expect:graph ---
digraph project {
}

