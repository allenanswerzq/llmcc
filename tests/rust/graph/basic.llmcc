===============================================================================
struct-binding
===============================================================================


--- file: app/src/main.rs ---
struct Foo;

struct Bar {
    a: i32,
    b: Vec<Foo>,
}

--- expect:symbols ---
u0:1 | Module | main | main | [global]
u0:2 | File   | main | main |         
u0:3 | Struct | Foo  | Foo  |         
u0:4 | Struct | Bar  | Bar  |         
u0:5 | Field  | a    | a    |         
u0:6 | Field  | b    | b    |         

--- expect:symbol-deps ---
u0:3 <- [u0:4, u0:6]
u0:4 -> [u0:3]
u0:6 -> [u0:3]

--- expect:blocks ---
u0:1 | root  | main   
u0:2 | class | Foo    
u0:3 | class | Bar    
u0:4 | field | block#4
u0:5 | field | block#5

--- expect:block-deps ---
u0:2 <- [u0:3]
u0:3 -> [u0:2]

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Foo", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpIn3nuJ/app/src/main.rs:1"];
    n3 [label="Bar", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpIn3nuJ/app/src/main.rs:3"];
  }
  n3 -> n2;
}


===============================================================================
struct-binding-multiple-files
===============================================================================


--- file: app/src/foo.rs ---
pub struct Foo;

--- file: app/src/main.rs ---
struct Bar {
    a: i32,
    b: Vec<Foo>,
}

--- expect:symbols ---
u0:1 | Module | foo  | foo  | [global]
u0:2 | File   | foo  | foo  |         
u0:3 | Struct | Foo  | Foo  |         
u1:4 | Module | main | main | [global]
u1:5 | File   | main | main |         
u1:6 | Struct | Bar  | Bar  |         
u1:7 | Field  | a    | a    |         
u1:8 | Field  | b    | b    |         

--- expect:symbol-deps ---


--- expect:blocks ---
u0:1 | root  | foo    
u0:2 | class | Foo    
u1:3 | root  | main   
u1:4 | class | Bar    
u1:5 | field | block#5
u1:6 | field | block#6

--- expect:block-deps ---


--- expect:block-graph ---
(root:1 foo
    (class:2 Foo)
)

(root:3 main
    (class:4 Bar
        (field:5)
        (field:6)
    )
)

--- expect:graph ---
digraph project {
}


===============================================================================
function-resolve
===============================================================================


--- file: src/main.rs ---
struct Bar;
struct Foo;

struct Slice;

impl Slice {
    fn binary_search(&self, x: &i32) -> Option<Foo> {
      Some(Foo)
    }

    fn fake_method() {}
}

fn func() {
  let slice = Slice::new();
  let f = slice.binary_search(&x);
}

--- expect:symbols ---
u0:1  | Module   | main          | main          | [global]
u0:2  | File     | main          | main          |         
u0:3  | Struct   | Bar           | Bar           |         
u0:4  | Struct   | Foo           | Foo           |         
u0:5  | Struct   | Slice         | Slice         |         
u0:6  | Impl     | impl Slice    | impl Slice    |         
u0:7  | Function | binary_search | binary_search |         
u0:8  | Variable | x             | x             |         
u0:9  | Function | fake_method   | fake_method   |         
u0:10 | Function | func          | func          |         
u0:11 | Variable | slice         | slice         |         
u0:12 | Variable | f             | f             |         

--- expect:symbol-deps ---
u0:10 -> [u0:7]
u0:4 <- [u0:7]
u0:5 <- [u0:6]
u0:6 -> [u0:5]
u0:7 -> [u0:4]
u0:7 <- [u0:10]


===============================================================================
call-target-method
===============================================================================


--- file: src/main.rs ---
struct Buffer;

impl Buffer {
    fn push(&mut self, value: u8) -> &mut Self {
        let _ = value;
        self
    }

    fn finish(&self) {}
}

fn method_demo(mut buffer: Buffer) {
    buffer.push(1);
}

--- expect:symbols ---
u0:1 | Module   | main        | main        | [global]
u0:2 | File     | main        | main        |         
u0:3 | Struct   | Buffer      | Buffer      |         
u0:4 | Impl     | impl Buffer | impl Buffer |         
u0:5 | Function | push        | push        |         
u0:6 | Variable | value       | value       |         
u0:7 | Function | finish      | finish      |         
u0:8 | Function | method_demo | method_demo |         
u0:9 | Variable | buffer      | buffer      |         

--- expect:symbol-deps ---
u0:3 <- [u0:4, u0:8, u0:9]
u0:4 -> [u0:3]
u0:5 <- [u0:8]
u0:8 -> [u0:3, u0:5]
u0:9 -> [u0:3]


===============================================================================
call-target-chain-invocation
===============================================================================


--- file: src/main.rs ---
struct Builder;

impl Builder {
    fn new() -> Self {
        Builder
    }

    fn step(self) -> Self {
        self
    }

    fn finish(self) {}
}

fn chain_invocation_demo() {
    Builder::new().step().finish();
}

--- expect:symbols ---
u0:1 | Module   | main                  | main                  | [global]
u0:2 | File     | main                  | main                  |         
u0:3 | Struct   | Builder               | Builder               |         
u0:4 | Impl     | impl Builder          | impl Builder          |         
u0:5 | Function | new                   | new                   |         
u0:6 | Function | step                  | step                  |         
u0:7 | Function | finish                | finish                |         
u0:8 | Function | chain_invocation_demo | chain_invocation_demo |         

--- expect:symbol-deps ---
u0:3 <- [u0:4]
u0:4 -> [u0:3]
u0:5 <- [u0:8]
u0:6 <- [u0:8]
u0:7 <- [u0:8]
u0:8 -> [u0:5, u0:6, u0:7]


===============================================================================
call-target-chain-variable
===============================================================================


--- file: src/main.rs ---
struct Stream;

impl Stream {
    fn advance(&mut self) -> &mut Self {
        self
    }

    fn flush(&self) {}
}

fn chain_variable_demo(mut stream: Stream) {
    let cursor = stream.advance();
    cursor.flush();
}

--- expect:symbols ---
u0:1 | Module   | main                | main                | [global]
u0:2 | File     | main                | main                |         
u0:3 | Struct   | Stream              | Stream              |         
u0:4 | Impl     | impl Stream         | impl Stream         |         
u0:5 | Function | advance             | advance             |         
u0:6 | Function | flush               | flush               |         
u0:7 | Function | chain_variable_demo | chain_variable_demo |         
u0:8 | Variable | stream              | stream              |         
u0:9 | Variable | cursor              | cursor              |         

--- expect:symbol-deps ---
u0:3 <- [u0:4, u0:7, u0:8]
u0:4 -> [u0:3]
u0:5 <- [u0:7]
u0:6 <- [u0:7]
u0:7 -> [u0:3, u0:5, u0:6]
u0:8 -> [u0:3]


===============================================================================
call-target-qualified-function
===============================================================================


--- file: src/main.rs ---
struct Foo;
struct SessionBuilder;

impl SessionBuilder {
    fn new() -> Self {
        SessionBuilder
    }

    fn static_func() -> Foo {
        Foo
    }
}

fn qualified_call() {
    SessionBuilder::new();
    let x = SessionBuilder::static_func();
}

--- expect:symbols ---
u0:1 | Module   | main                | main                | [global]
u0:2 | File     | main                | main                |         
u0:3 | Struct   | Foo                 | Foo                 |         
u0:4 | Struct   | SessionBuilder      | SessionBuilder      |         
u0:5 | Impl     | impl SessionBuilder | impl SessionBuilder |         
u0:6 | Function | new                 | new                 |         
u0:7 | Function | static_func         | static_func         |         
u0:8 | Function | qualified_call      | qualified_call      |         
u0:9 | Variable | x                   | x                   |         

--- expect:symbol-deps ---
u0:3 <- [u0:7]
u0:4 <- [u0:5]
u0:5 -> [u0:4]
u0:6 <- [u0:8]
u0:7 -> [u0:3]
u0:7 <- [u0:8]
u0:8 -> [u0:6, u0:7]

--- expect:blocks ---
u0:1 | root   | main               
u0:2 | class  | Foo                
u0:3 | class  | SessionBuilder     
u0:4 | impl   | impl SessionBuilder
u0:5 | method | new                
u0:6 | method | static_func        
u0:7 | func   | qualified_call     
u0:8 | call   | block#8            
u0:9 | call   | block#9            

--- expect:block-deps ---
u0:2 <- [u0:6]
u0:3 <- [u0:4]
u0:4 -> [u0:3]
u0:5 <- [u0:7]
u0:6 -> [u0:2]
u0:6 <- [u0:7]
u0:7 -> [u0:5, u0:6]

--- expect:graph ---
digraph project {
}
