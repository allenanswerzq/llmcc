===============================================================================
struct-binding
===============================================================================


--- file: app/src/main.rs ---
struct Foo;

struct Bar {
    a: i32,
    b: Vec<Foo>,
}

--- expect:symbols ---
u0:1 | Module | main | main               | [global]
u0:2 | File   | main | main::main         |         
u0:3 | Struct | Foo  | main::main::Foo    |         
u0:4 | Struct | Bar  | main::main::Bar    |         
u0:5 | Field  | a    | main::main::Bar::a |         
u0:6 | Field  | b    | main::main::Bar::b |         

--- expect:symbol-deps ---
u0:3 <- [u0:4, u0:6]
u0:4 -> [u0:3]
u0:6 -> [u0:3]

--- expect:blocks ---
u0:1 | root  | main   
u0:2 | class | Foo    
u0:3 | class | Bar    
u0:4 | field | block#4
u0:5 | field | block#5

--- expect:block-deps ---
u0:2 <- [u0:3]
u0:3 -> [u0:2]

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Foo", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpIn3nuJ/app/src/main.rs:1"];
    n3 [label="Bar", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpIn3nuJ/app/src/main.rs:3"];
  }
  n3 -> n2;
}


===============================================================================
struct-binding-multiple-files
===============================================================================


--- file: app/src/foo.rs ---
pub struct Foo;

--- file: app/src/main.rs ---
struct Bar {
    a: i32,
    b: Vec<Foo>,
}

--- expect:symbols ---
u0:1 | Module | foo  | foo                | [global]
u0:2 | File   | foo  | foo::foo           |         
u0:3 | Struct | Foo  | foo::foo::Foo      |         
u1:4 | Module | main | main               | [global]
u1:5 | File   | main | main::main         |         
u1:6 | Struct | Bar  | main::main::Bar    |         
u1:7 | Field  | a    | main::main::Bar::a |         
u1:8 | Field  | b    | main::main::Bar::b |         

--- expect:symbol-deps ---


--- expect:blocks ---
u0:1 | root  | foo    
u0:2 | class | Foo    
u1:3 | root  | main   
u1:4 | class | Bar    
u1:5 | field | block#5
u1:6 | field | block#6

--- expect:block-deps ---


--- expect:block-graph ---
(root:1 foo
    (class:2 Foo)
)

(root:3 main
    (class:4 Bar
        (field:5)
        (field:6)
    )
)

--- expect:graph ---
digraph project {
}


===============================================================================
function-resolve
===============================================================================


--- file: src/main.rs ---
struct Bar;
struct Foo;

struct Slice;

impl Slice {
    fn binary_search(&self, x: &i32) -> Option<Foo> {
      Some(Foo)
    }

    fn fake_method() {}
}

fn func() {
  let slice = Slice::new();
  let f = slice.binary_search(&x);
}

--- expect:symbols ---
u0:1  | Module   | main          | main                                | [global]
u0:2  | File     | main          | main::main                          |         
u0:3  | Struct   | Bar           | main::main::Bar                     |         
u0:4  | Struct   | Foo           | main::main::Foo                     |         
u0:5  | Impl     | Slice         | main::main::Slice                   |         
u0:6  | Function | binary_search | main::main::Slice::binary_search    |         
u0:7  | Variable | x             | main::main::Slice::binary_search::x |         
u0:8  | Function | fake_method   | main::main::Slice::fake_method      |         
u0:9  | Function | func          | main::main::func                    |         
u0:10 | Variable | slice         | main::main::func::slice             |         
u0:11 | Variable | f             | main::main::func::f                 |         

--- expect:symbol-deps ---
u0:4 <- [u0:6]
u0:6 -> [u0:4]
u0:6 <- [u0:9]
u0:9 -> [u0:6]


===============================================================================
call-target-method
===============================================================================


--- file: src/main.rs ---
struct Buffer;

impl Buffer {
    fn push(&mut self, value: u8) -> &mut Self {
        let _ = value;
        self
    }

    fn finish(&self) {}
}

fn method_demo(mut buffer: Buffer) {
    buffer.push(1);
}

--- expect:symbols ---
u0:1 | Module   | main        | main                            | [global]
u0:2 | File     | main        | main::main                      |         
u0:3 | Impl     | Buffer      | main::main::Buffer              |         
u0:4 | Function | push        | main::main::Buffer::push        |         
u0:5 | Variable | value       | main::main::Buffer::push::value |         
u0:6 | Function | finish      | main::main::Buffer::finish      |         
u0:7 | Function | method_demo | main::main::method_demo         |         
u0:8 | Variable | buffer      | main::main::method_demo::buffer |         

--- expect:symbol-deps ---
u0:3 <- [u0:7, u0:8]
u0:4 <- [u0:7]
u0:7 -> [u0:3, u0:4]
u0:8 -> [u0:3]


===============================================================================
call-target-chain-invocation
===============================================================================


--- file: src/main.rs ---
struct Builder;

impl Builder {
    fn new() -> Self {
        Builder
    }

    fn step(self) -> Self {
        self
    }

    fn finish(self) {}
}

fn chain_invocation_demo() {
    Builder::new().step().finish();
}

--- expect:symbols ---
u0:1 | Module   | main                  | main                              | [global]
u0:2 | File     | main                  | main::main                        |         
u0:3 | Impl     | Builder               | main::main::Builder               |         
u0:4 | Function | new                   | main::main::Builder::new          |         
u0:5 | Function | step                  | main::main::Builder::step         |         
u0:6 | Function | finish                | main::main::Builder::finish       |         
u0:7 | Function | chain_invocation_demo | main::main::chain_invocation_demo |         

--- expect:symbol-deps ---
u0:4 <- [u0:7]
u0:5 <- [u0:7]
u0:6 <- [u0:7]
u0:7 -> [u0:4, u0:5, u0:6]


===============================================================================
call-target-chain-variable
===============================================================================


--- file: src/main.rs ---
struct Stream;

impl Stream {
    fn advance(&mut self) -> &mut Self {
        self
    }

    fn flush(&self) {}
}

fn chain_variable_demo(mut stream: Stream) {
    let cursor = stream.advance();
    cursor.flush();
}

--- expect:symbols ---
u0:1 | Module   | main                | main                                    | [global]
u0:2 | File     | main                | main::main                              |         
u0:3 | Impl     | Stream              | main::main::Stream                      |         
u0:4 | Function | advance             | main::main::Stream::advance             |         
u0:5 | Function | flush               | main::main::Stream::flush               |         
u0:6 | Function | chain_variable_demo | main::main::chain_variable_demo         |         
u0:7 | Variable | stream              | main::main::chain_variable_demo::stream |         
u0:8 | Variable | cursor              | main::main::chain_variable_demo::cursor |         

--- expect:symbol-deps ---
u0:3 <- [u0:6, u0:7]
u0:4 <- [u0:6]
u0:5 <- [u0:6]
u0:6 -> [u0:3, u0:4, u0:5]
u0:7 -> [u0:3]


===============================================================================
call-target-qualified-function
===============================================================================


--- file: src/main.rs ---
struct Foo;
struct SessionBuilder;

impl SessionBuilder {
    fn new() -> Self {
        SessionBuilder
    }

    fn static_func() -> Foo {
        Foo
    }
}

fn qualified_call() {
    SessionBuilder::new();
    let x = SessionBuilder::static_func();
}

--- expect:symbols ---
u0:1 | Module   | main           | main                                    | [global]
u0:2 | File     | main           | main::main                              |         
u0:3 | Struct   | Foo            | main::main::Foo                         |         
u0:4 | Impl     | SessionBuilder | main::main::SessionBuilder              |         
u0:5 | Function | new            | main::main::SessionBuilder::new         |         
u0:6 | Function | static_func    | main::main::SessionBuilder::static_func |         
u0:7 | Function | qualified_call | main::main::qualified_call              |         
u0:8 | Variable | x              | main::main::qualified_call::x           |         

--- expect:symbol-deps ---
u0:3 <- [u0:6]
u0:5 <- [u0:7]
u0:6 -> [u0:3]
u0:6 <- [u0:7]
u0:7 -> [u0:5, u0:6]

--- expect:blocks ---
u0:1 | root   | main          
u0:2 | class  | Foo           
u0:3 | class  | SessionBuilder
u0:4 | impl   | SessionBuilder
u0:5 | method | new           
u0:6 | method | static_func   
u0:7 | func   | qualified_call
u0:8 | call   | block#8       
u0:9 | call   | block#9       

--- expect:block-deps ---
u0:2 <- [u0:6]
u0:5 <- [u0:7]
u0:6 -> [u0:2]
u0:6 <- [u0:7]
u0:7 -> [u0:5, u0:6]

--- expect:graph ---
digraph project {
}
