===============================================================================
prefer-same-module
===============================================================================
Test that symbol resolution prefers types defined in the same module
over types with the same name in other modules.

--- file: sample/Cargo.toml ---
[package]
name = "sample"

--- file: sample/src/lib.rs ---
mod data;
mod services;

--- file: sample/src/data/mod.rs ---
mod models;
mod helpers;
pub use models::*;
pub use helpers::*;

--- file: sample/src/data/models.rs ---

// Entity defined in data module
pub struct Entity {
    pub id: u64,
}

--- file: sample/src/data/helpers.rs ---

use super::Entity;

// Helper in same module uses Entity from same module
pub struct EntityWrapper {
    pub inner: Entity,
}

--- file: sample/src/services/mod.rs ---
mod handlers;
pub use handlers::*;

--- file: sample/src/services/handlers.rs ---

// Different Entity in services module
pub struct Entity {
    pub name: String,
}

pub struct Handler {
    // Should resolve to local Entity (services module), not data::Entity
    pub entity: Entity,
}

--- expect:block-graph ---
(root:1 lib ($TMP/sample/src/lib.rs)
  (module:2 data)
  (module:3 services)
)

(root:4 mod ($TMP/sample/src/data/mod.rs)
  (module:5 models)
  (module:6 helpers)
)

(root:7 models ($TMP/sample/src/data/models.rs)
  (class:8 Entity
    (field:9 id @type u64)
  )
)

(root:10 helpers ($TMP/sample/src/data/helpers.rs)
  (class:11 EntityWrapper
    (field:12 inner @type:8 Entity)
    (@tdep:8 Entity)
  )
)

(root:13 mod ($TMP/sample/src/services/mod.rs)
  (module:14 handlers)
)

(root:15 handlers ($TMP/sample/src/services/handlers.rs)
  (class:16 Entity
    (field:17 name @type String)
  )
  (class:18 Handler
    (field:19 entity @type:16 Entity)
    (@tdep:16 Entity)
  )
)

--- expect:arch-graph ---
digraph architecture {
  rankdir=TB;
  ranksep=0.6;
  nodesep=0.3;
  splines=ortho;
  compound=true;

  node [shape=box, style=rounded];
  edge [arrowsize=0.7];

  subgraph cluster_sample {
    label="sample";
    bgcolor="#f8f8f8";

    subgraph cluster_data {
      label="data";
      bgcolor="#f5f5f5";

      subgraph cluster_helpers_rs {
        label="helpers.rs";
        bgcolor="#fafafa";

        n11[label="EntityWrapper", full_path="$TMP/sample/src/data/helpers.rs:5", sym_ty="Struct", shape=box];
      }

      subgraph cluster_models_rs {
        label="models.rs";
        bgcolor="#fafafa";

        n8[label="Entity", full_path="$TMP/sample/src/data/models.rs:3", sym_ty="Struct", shape=box];
      }

    }

    subgraph cluster_services {
      label="services";
      bgcolor="#f5f5f5";

      subgraph cluster_handlers_rs {
        label="handlers.rs";
        bgcolor="#fafafa";

        n16[label="Entity", full_path="$TMP/sample/src/services/handlers.rs:3", sym_ty="Struct", shape=box];
        n18[label="Handler", full_path="$TMP/sample/src/services/handlers.rs:7", sym_ty="Struct", shape=box];
      }

    }

  }


  n8 -> n11 [from="field_type", to="struct"];
  n16 -> n18 [from="field_type", to="struct"];
}
