===============================================================================
edge-combined-no-cycle
===============================================================================
Test that combining all edge types still produces correct unidirectional
dependency at crate level. This is a comprehensive test that uses all edge
types and verifies no false reverse edges are created.
The dependency chain is: app -> service -> types
NO reverse edges should exist.

--- file: types/Cargo.toml ---
[package]
name = "types"

--- file: types/src/lib.rs ---
pub struct Request {
    pub id: u64,
}

pub struct Response {
    pub data: String,
}

pub trait Processor {
    fn process(&self, req: &Request) -> Response;
}

pub fn validate(req: &Request) -> bool {
    req.id > 0
}

--- file: service/Cargo.toml ---
[package]
name = "service"

[dependencies]
types = { path = "../types" }

--- file: service/src/lib.rs ---
use types::{Request, Response, Processor, validate};

/// Service struct has field of types::Request
pub struct Service {
    pub last_request: Option<Request>,
}

/// Service implements types::Processor trait
impl Processor for Service {
    fn process(&self, req: &Request) -> Response {
        if validate(req) {
            Response { data: "ok".to_string() }
        } else {
            Response { data: "error".to_string() }
        }
    }
}

/// Function takes types::Request as input
pub fn handle_request(req: &Request) -> Response {
    Response { data: format!("handled {}", req.id) }
}

--- file: app/Cargo.toml ---
[package]
name = "app"

[dependencies]
service = { path = "../service" }
types = { path = "../types" }

--- file: app/src/lib.rs ---
use service::{Service, handle_request};
use types::{Request, Processor};

/// App function calls service functions
pub fn run() {
    let req = Request { id: 1 };
    let svc = Service { last_request: None };
    let _ = svc.process(&req);
    let _ = handle_request(&req);
}

--- expect:arch-graph-depth-3 ---
digraph architecture {
  rankdir=TB;
  ranksep=0.6;
  nodesep=0.3;
  splines=ortho;
  compound=true;

  node [shape=box, style=rounded];
  edge [arrowsize=0.7];

  subgraph cluster_app {
    label="app";
    bgcolor="#f8f8f8";

    subgraph cluster_lib_rs {
      label="lib.rs";
      bgcolor="#fafafa";

      n30[label="run", full_path="$TMP/app/src/lib.rs:5", sym_ty="Function", shape=ellipse];
    }

  }

  subgraph cluster_service {
    label="service";
    bgcolor="#f8f8f8";

    subgraph cluster_lib_rs {
      label="lib.rs";
      bgcolor="#fafafa";

      n25[label="handle_request", full_path="$TMP/service/src/lib.rs:20", sym_ty="Function", shape=ellipse];
      n15[label="Service", full_path="$TMP/service/src/lib.rs:4", sym_ty="Struct", shape=box];
    }

  }

  subgraph cluster_types {
    label="types";
    bgcolor="#f8f8f8";

    subgraph cluster_lib_rs {
      label="lib.rs";
      bgcolor="#fafafa";

      n2[label="Request", full_path="$TMP/types/src/lib.rs:1", sym_ty="Struct", shape=box];
      n11[label="validate", full_path="$TMP/types/src/lib.rs:13", sym_ty="Function", shape=ellipse];
      n4[label="Response", full_path="$TMP/types/src/lib.rs:5", sym_ty="Struct", shape=box];
      n6[label="Processor", full_path="$TMP/types/src/lib.rs:9", sym_ty="Trait", shape=box];
    }

  }


  n2 -> n11 [from="input", to="func"];
  n2 -> n15 [from="type_dep", to="struct"];
  n2 -> n25 [from="input", to="func"];
  n6 -> n15 [from="trait", to="impl"];
  n25 -> n4 [from="func", to="output"];
  n30 -> n25 [from="caller", to="callee"];
}

--- expect:arch-graph-depth-2 ---
digraph architecture {
  rankdir=TB;
  ranksep=0.8;
  nodesep=0.4;
  splines=ortho;
  concentrate=true;

  node [shape=box, style="rounded,filled", fillcolor="#f0f0f0", fontname="Helvetica"];
  edge [color="#666666", arrowsize=0.7];

  labelloc=t;
  fontsize=16;

  mod_app_lib[label="app::lib", folder="$TMP/app/src"];
  mod_service_lib[label="service::lib", folder="$TMP/service/src"];
  mod_types_lib[label="types::lib", folder="$TMP/types/src"];

  mod_app_lib -> mod_service_lib;
  mod_service_lib -> mod_types_lib;
}

--- expect:arch-graph-depth-1 ---
digraph architecture {
  rankdir=TB;
  ranksep=0.8;
  nodesep=0.4;
  splines=ortho;
  concentrate=true;

  node [shape=box, style="rounded,filled", fillcolor="#f0f0f0", fontname="Helvetica"];
  edge [color="#666666", arrowsize=0.7];

  labelloc=t;
  fontsize=16;

  crate_app[label="app", folder="$TMP/app"];
  crate_service[label="service", folder="$TMP/service"];
  crate_types[label="types", folder="$TMP/types"];

  crate_app -> crate_service;
  crate_service -> crate_types;
}
