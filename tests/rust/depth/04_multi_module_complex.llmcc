===============================================================================
multi-module-complex
===============================================================================
Test module-level aggregation with multiple modules and complex dependencies.

--- file: sample/Cargo.toml ---
[package]
name = "sample"

--- file: sample/src/lib.rs ---
mod models;
mod repository;
mod services;
mod handlers;

pub use handlers::handle_request;

--- file: sample/src/models.rs ---
pub struct User {
    pub id: u64,
    pub name: String,
}

pub struct Order {
    pub id: u64,
    pub user_id: u64,
}

--- file: sample/src/repository.rs ---
use crate::models::{User, Order};

pub trait UserRepo {
    fn find(&self, id: u64) -> Option<User>;
}

pub trait OrderRepo {
    fn find_by_user(&self, user_id: u64) -> Vec<Order>;
}

--- file: sample/src/services.rs ---
use crate::models::{User, Order};
use crate::repository::{UserRepo, OrderRepo};

pub struct UserService<R: UserRepo> {
    repo: R,
}

pub struct OrderService<R: OrderRepo> {
    repo: R,
}

--- file: sample/src/handlers.rs ---
use crate::models::User;
use crate::services::UserService;
use crate::repository::UserRepo;

pub fn handle_request<R: UserRepo>(service: &UserService<R>) -> Option<User> {
    None
}

--- expect:arch-graph-depth-3 ---
digraph architecture {
  rankdir=TB;
  ranksep=0.6;
  nodesep=0.3;
  splines=ortho;
  compound=true;

  node [shape=box, style=rounded];
  edge [arrowsize=0.7];

  subgraph cluster_sample {
    label="sample";
    style=rounded;
        bgcolor="#f8f8f8";

    subgraph cluster_handlers_rs {
      label="handlers.rs";
      style=rounded;
            bgcolor="#fafafa";

      n30[label="handle_request", path="$TMP/sample/src/handlers.rs:5", sym_ty="Function", shape=ellipse];
    }

    subgraph cluster_models_rs {
      label="models.rs";
      style=rounded;
            bgcolor="#fafafa";

      n7[label="User", path="$TMP/sample/src/models.rs:1", sym_ty="Struct", shape=box];
    }

    subgraph cluster_repository_rs {
      label="repository.rs";
      style=rounded;
            bgcolor="#fafafa";

      n14[label="UserRepo", path="$TMP/sample/src/repository.rs:3", sym_ty="Trait", shape=box];
      n19[label="OrderRepo", path="$TMP/sample/src/repository.rs:7", sym_ty="Trait", shape=box];
    }

    subgraph cluster_services_rs {
      label="services.rs";
      style=rounded;
            bgcolor="#fafafa";

      n25[label="UserService", path="$TMP/sample/src/services.rs:4", sym_ty="Struct", shape=box];
      n27[label="OrderService", path="$TMP/sample/src/services.rs:8", sym_ty="Struct", shape=box];
    }

  }


  n14 -> n25 [from="field_type", to="struct"];
  n19 -> n27 [from="field_type", to="struct"];
  n25 -> n30 [from="input", to="func"];
  n30 -> n7 [from="func", to="type_dep"];
}

--- expect:arch-graph-depth-2 ---
digraph architecture {
  rankdir=TB;
  ranksep=0.8;
  nodesep=0.4;
  splines=ortho;
  concentrate=true;

  node [shape=box, style="rounded,filled", fillcolor="#f0f0f0", fontname="Helvetica"];
  edge [color="#888888", arrowsize=0.7];

  labelloc=t;
  fontsize=16;

  mod_sample_handlers[label="sample::handlers", path="$TMP/sample/src"];
  mod_sample_models[label="sample::models", path="$TMP/sample/src"];
  mod_sample_repository[label="sample::repository", path="$TMP/sample/src"];
  mod_sample_services[label="sample::services", path="$TMP/sample/src"];

  mod_sample_handlers -> mod_sample_models;
  mod_sample_handlers -> mod_sample_services;
  mod_sample_services -> mod_sample_repository;
}

--- expect:arch-graph-depth-1 ---
digraph architecture {
  rankdir=TB;
  ranksep=0.8;
  nodesep=0.4;
  splines=ortho;
  concentrate=true;

  node [shape=box, style="rounded,filled", fillcolor="#f0f0f0", fontname="Helvetica"];
  edge [color="#666666", arrowsize=0.7];

  labelloc=t;
  fontsize=16;


}
