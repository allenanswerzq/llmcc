===============================================================================
cross-file-function-call-basic
===============================================================================
Test that function calls across files are resolved correctly.

--- file: src/lib.rs ---
mod utils;

use utils::helper;

fn main() {
    helper();
}

--- file: src/utils.rs ---
pub fn helper() {
    println!("helper called");
}

--- expect:block-graph ---
(root:1 lib ($TMP/src/lib.rs)
  (module:2 utils)
  (func:3 main
    (@fdep:6 helper)
  )
)

(root:5 utils ($TMP/src/utils.rs)
  (func:6 helper
  )
)


===============================================================================
cross-file-function-call-with-args
===============================================================================
Test function calls with arguments across files.

--- file: src/lib.rs ---
mod math;

use math::add;

fn compute() -> i32 {
    add(1, 2)
}

--- file: src/math.rs ---
pub fn add(a: i32, b: i32) -> i32 {
    a + b
}

--- expect:block-graph ---
(root:1 lib ($TMP/src/lib.rs)
  (module:2 math)
  (func:3 compute
    (return:4 @type i32)
    (@fdep:7 add)
  )
)

(root:6 math ($TMP/src/math.rs)
  (func:7 add
    (parameter:8 a @type i32)
    (parameter:9 b @type i32)
    (return:10 @type i32)
  )
)


===============================================================================
cross-file-type-usage
===============================================================================
Test that types from other files are resolved correctly.

--- file: src/lib.rs ---
mod types;

use types::Point;

fn make_point() -> Point {
    Point { x: 0, y: 0 }
}

--- file: src/types.rs ---
pub struct Point {
    pub x: i32,
    pub y: i32,
}

--- expect:block-graph ---
(root:1 lib ($TMP/src/lib.rs)
  (module:2 types)
  (func:3 make_point
    (return:4 @type:6 Point)
    (@tdep:6 Point)
  )
)

(root:5 types ($TMP/src/types.rs)
  (class:6 Point
    (field:7 x @type i32)
    (field:8 y @type i32)
  )
)


===============================================================================
cross-file-method-call
===============================================================================
Test that method calls on types from other files are resolved.

--- file: src/lib.rs ---
mod models;

use models::Counter;

fn use_counter() {
    let c = Counter::new();
    c.increment();
}

--- file: src/models.rs ---
pub struct Counter {
    value: i32,
}

impl Counter {
    pub fn new() -> Self {
        Counter { value: 0 }
    }

    pub fn increment(&mut self) {
        self.value += 1;
    }
}

--- expect:block-graph ---
(root:1 lib ($TMP/src/lib.rs)
  (module:2 models)
  (func:3 use_counter
  )
)

(root:6 models ($TMP/src/models.rs)
  (class:7 Counter
    (field:8 value @type i32)
  )
  (impl:9 Counter @type:7
    (method:10 new
      (return:11 @type:7 Counter)
    )
    (method:12 increment
      (parameter:13 self @type:7 Counter)
    )
  )
)
