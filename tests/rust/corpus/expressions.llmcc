===============================================================================
basic-identifiers
===============================================================================


--- file: src/main.rs ---
abc;

--- expect:symbol-deps ---


===============================================================================
raw-identifiers
===============================================================================


--- file: src/main.rs ---
(r#abc as r#Def).r#ghi;

--- expect:symbol-deps ---


===============================================================================
unary-operator-expressions
===============================================================================


--- file: src/main.rs ---
-num;
!bits;
*boxed_thing;

--- expect:symbol-deps ---


===============================================================================
reference-expressions
===============================================================================


--- file: src/main.rs ---
&a;
&mut self.name;
&raw const b;
&raw mut self.age;

--- expect:symbol-deps ---


===============================================================================
try-expressions
===============================================================================


--- file: src/main.rs ---
a.unwrap()?;
&a?;

--- expect:symbol-deps ---


===============================================================================
binary-operator-expressions
===============================================================================


--- file: src/main.rs ---
a * b;
a / b;
a % b;
a + b;
a - b;
a >> b;
a << b;
a == b;
a && b;
a || b;

--- expect:symbol-deps ---


===============================================================================
grouped-expressions
===============================================================================


--- file: src/main.rs ---
(0);
(2 * (3 + 4));

--- expect:symbol-deps ---


===============================================================================
range-expressions
===============================================================================


--- file: src/main.rs ---
1..2;
3..;
..4;
..;
1..b;
a..b;
1..(1);
(1)..1;
(1)..(1);
1..{1};
for i in 1.. {
}

--- expect:symbol-deps ---


===============================================================================
assignment-expressions
===============================================================================


--- file: src/main.rs ---
x = y;

--- expect:symbol-deps ---


===============================================================================
compound-assignment-expressions
===============================================================================


--- file: src/main.rs ---
x += 1;
x += y;

--- expect:symbol-deps ---


===============================================================================
type-cast-expressions
===============================================================================


--- file: src/main.rs ---
struct Foo;
1000 as u8;
let character = integer as Foo;
let size: f64 = 1.0 + -len(values) as f64 + 1.0;

--- expect:symbol-deps ---
u0:14 <- [u0:24]
u0:22 <- [u0:23]
u0:23 -> [u0:22]
u0:24 -> [u0:14]


===============================================================================
call-expressions-basic
===============================================================================


--- file: src/main.rs ---
struct Foo;
struct Bar;

fn func() {
  let f = Foo::new();
  let b: Bar = Bar::new(42);
  foo();
  add(f, b);
}

--- expect:symbols ---
u0:1  | Primitive | i32   | i32                | [global]
u0:2  | Primitive | i64   | i64                | [global]
u0:3  | Primitive | i16   | i16                | [global]
u0:4  | Primitive | i8    | i8                 | [global]
u0:5  | Primitive | i128  | i128               | [global]
u0:6  | Primitive | isize | isize              | [global]
u0:7  | Primitive | u32   | u32                | [global]
u0:8  | Primitive | u64   | u64                | [global]
u0:9  | Primitive | u16   | u16                | [global]
u0:10 | Primitive | u8    | u8                 | [global]
u0:11 | Primitive | u128  | u128               | [global]
u0:12 | Primitive | usize | usize              | [global]
u0:13 | Primitive | f32   | f32                | [global]
u0:14 | Primitive | f64   | f64                | [global]
u0:15 | Primitive | bool  | bool               | [global]
u0:16 | Primitive | char  | char               | [global]
u0:17 | Primitive | str   | str                | [global]
u0:18 | Crate     | _c    | _c                 | [global]
u0:19 | Crate     | crate | _c::crate          |         
u0:20 | Module    | _m    | _c::_m             |         
u0:21 | File      | main  | _c::_m::main       |         
u0:22 | Struct    | Foo   | _c::_m::main::Foo  |         
u0:23 | Struct    | Bar   | _c::_m::main::Bar  |         
u0:24 | Function  | func  | _c::_m::main::func |         
u0:25 | Variable  | f     | f                  |         
u0:26 | Variable  | b     | b                  |         

--- expect:symbol-deps ---
u0:22 <- [u0:24]
u0:23 <- [u0:24, u0:26]
u0:24 -> [u0:22, u0:23]
u0:26 -> [u0:23]


===============================================================================
call-expressions-chained
===============================================================================


--- file: app/src/main.rs ---
struct Foo;
struct Bar;

fn func() {
  let f = Foo::new();
  let b: Bar = Bar::new(42);
  foo();
  add(f).compute(b).finalize();
}

--- expect:symbols ---
u0:1  | Primitive | i32   | i32                | [global]
u0:2  | Primitive | i64   | i64                | [global]
u0:3  | Primitive | i16   | i16                | [global]
u0:4  | Primitive | i8    | i8                 | [global]
u0:5  | Primitive | i128  | i128               | [global]
u0:6  | Primitive | isize | isize              | [global]
u0:7  | Primitive | u32   | u32                | [global]
u0:8  | Primitive | u64   | u64                | [global]
u0:9  | Primitive | u16   | u16                | [global]
u0:10 | Primitive | u8    | u8                 | [global]
u0:11 | Primitive | u128  | u128               | [global]
u0:12 | Primitive | usize | usize              | [global]
u0:13 | Primitive | f32   | f32                | [global]
u0:14 | Primitive | f64   | f64                | [global]
u0:15 | Primitive | bool  | bool               | [global]
u0:16 | Primitive | char  | char               | [global]
u0:17 | Primitive | str   | str                | [global]
u0:18 | Crate     | _c    | _c                 | [global]
u0:19 | Crate     | crate | _c::crate          |         
u0:20 | Module    | _m    | _c::_m             |         
u0:21 | File      | main  | _c::_m::main       |         
u0:22 | Struct    | Foo   | _c::_m::main::Foo  |         
u0:23 | Struct    | Bar   | _c::_m::main::Bar  |         
u0:24 | Function  | func  | _c::_m::main::func |         
u0:25 | Variable  | f     | f                  |         
u0:26 | Variable  | b     | b                  |         

--- expect:symbol-deps ---
u0:22 <- [u0:24]
u0:23 <- [u0:24, u0:26]
u0:24 -> [u0:22, u0:23]
u0:26 -> [u0:23]

--- expect:blocks ---
u0:1 | root  | main   
u0:2 | class | Foo    
u0:3 | class | Bar    
u0:4 | func  | func   
u0:5 | call  | block#5
u0:6 | call  | block#6
u0:7 | call  | block#7
u0:8 | call  | block#8

--- expect:block-deps ---
u0:2 <- [u0:4]
u0:3 <- [u0:4]
u0:4 -> [u0:2, u0:3]

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Foo", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmp2hXmsy/app/src/main.rs:1"];
    n3 [label="Bar", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmp2hXmsy/app/src/main.rs:2"];
    n4 [label="func", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmp2hXmsy/app/src/main.rs:4"];
  }
  n4 -> n2;
  n4 -> n3;
}


===============================================================================
call-expressions-nested
===============================================================================


--- file: app/src/main.rs ---
struct Foo;
struct Bar;

fn func() {
  let f = Foo::new();
  let b: Bar = Bar::new(42);
  foo();
  add(f, compute(b));
}

--- expect:symbols ---
u0:1  | Primitive | i32   | i32                | [global]
u0:2  | Primitive | i64   | i64                | [global]
u0:3  | Primitive | i16   | i16                | [global]
u0:4  | Primitive | i8    | i8                 | [global]
u0:5  | Primitive | i128  | i128               | [global]
u0:6  | Primitive | isize | isize              | [global]
u0:7  | Primitive | u32   | u32                | [global]
u0:8  | Primitive | u64   | u64                | [global]
u0:9  | Primitive | u16   | u16                | [global]
u0:10 | Primitive | u8    | u8                 | [global]
u0:11 | Primitive | u128  | u128               | [global]
u0:12 | Primitive | usize | usize              | [global]
u0:13 | Primitive | f32   | f32                | [global]
u0:14 | Primitive | f64   | f64                | [global]
u0:15 | Primitive | bool  | bool               | [global]
u0:16 | Primitive | char  | char               | [global]
u0:17 | Primitive | str   | str                | [global]
u0:18 | Crate     | _c    | _c                 | [global]
u0:19 | Crate     | crate | _c::crate          |         
u0:20 | Module    | _m    | _c::_m             |         
u0:21 | File      | main  | _c::_m::main       |         
u0:22 | Struct    | Foo   | _c::_m::main::Foo  |         
u0:23 | Struct    | Bar   | _c::_m::main::Bar  |         
u0:24 | Function  | func  | _c::_m::main::func |         
u0:25 | Variable  | f     | f                  |         
u0:26 | Variable  | b     | b                  |         

--- expect:symbol-deps ---
u0:22 <- [u0:24]
u0:23 <- [u0:24, u0:26]
u0:24 -> [u0:22, u0:23]
u0:26 -> [u0:23]

--- expect:blocks ---
u0:1 | root  | main   
u0:2 | class | Foo    
u0:3 | class | Bar    
u0:4 | func  | func   
u0:5 | call  | block#5
u0:6 | call  | block#6
u0:7 | call  | block#7
u0:8 | call  | block#8

--- expect:block-deps ---
u0:2 <- [u0:4]
u0:3 <- [u0:4]
u0:4 -> [u0:2, u0:3]

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Foo", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpGK2Qv9/app/src/main.rs:1"];
    n3 [label="Bar", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpGK2Qv9/app/src/main.rs:2"];
    n4 [label="func", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpGK2Qv9/app/src/main.rs:4"];
  }
  n4 -> n2;
  n4 -> n3;
}


===============================================================================
array-expressions
===============================================================================


--- file: app/src/main.rs ---
struct Foo;

fn foo() {
  let a = Foo::new();
  [];
  let b = [1, a, 3];
  ["a", "b", "c"];
  [0; 128];
  [
      #[cfg(foo)]
      "foo",
      #[cfg(bar)]
      "bar",
  ];
}

--- expect:symbols ---
u0:1  | Primitive | i32   | i32               | [global]
u0:2  | Primitive | i64   | i64               | [global]
u0:3  | Primitive | i16   | i16               | [global]
u0:4  | Primitive | i8    | i8                | [global]
u0:5  | Primitive | i128  | i128              | [global]
u0:6  | Primitive | isize | isize             | [global]
u0:7  | Primitive | u32   | u32               | [global]
u0:8  | Primitive | u64   | u64               | [global]
u0:9  | Primitive | u16   | u16               | [global]
u0:10 | Primitive | u8    | u8                | [global]
u0:11 | Primitive | u128  | u128              | [global]
u0:12 | Primitive | usize | usize             | [global]
u0:13 | Primitive | f32   | f32               | [global]
u0:14 | Primitive | f64   | f64               | [global]
u0:15 | Primitive | bool  | bool              | [global]
u0:16 | Primitive | char  | char              | [global]
u0:17 | Primitive | str   | str               | [global]
u0:18 | Crate     | _c    | _c                | [global]
u0:19 | Crate     | crate | _c::crate         |         
u0:20 | Module    | _m    | _c::_m            |         
u0:21 | File      | main  | _c::_m::main      |         
u0:22 | Struct    | Foo   | _c::_m::main::Foo |         
u0:23 | Function  | foo   | _c::_m::main::foo |         
u0:24 | Variable  | a     | a                 |         
u0:25 | Variable  | b     | b                 |         

--- expect:symbol-deps ---
u0:1 <- [u0:23, u0:25]
u0:22 <- [u0:23]
u0:23 -> [u0:1, u0:22]
u0:25 -> [u0:1]

--- expect:blocks ---
u0:1 | root  | main   
u0:2 | class | Foo    
u0:3 | func  | foo    
u0:4 | call  | block#4

--- expect:block-deps ---
u0:2 <- [u0:3]
u0:3 -> [u0:2]

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Foo", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpSdLCrk/app/src/main.rs:1"];
    n3 [label="foo", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpSdLCrk/app/src/main.rs:3"];
  }
  n3 -> n2;
}


===============================================================================
tuple-expressions
===============================================================================


--- file: app/src/main.rs ---
struct TupleThing;

fn make_tuples() {
  let empty = ();
  let single = (TupleThing,);
  let triple = (TupleThing, 2, 3);
  let nested = ((1, 2), (3, 4));
  let destructured = match triple {
    (a, b, c) => (a, b, c),
  };
  let _all = (empty, single, nested, destructured);
}

--- expect:symbols ---
u0:1  | Primitive | i32          | i32                       | [global]
u0:2  | Primitive | i64          | i64                       | [global]
u0:3  | Primitive | i16          | i16                       | [global]
u0:4  | Primitive | i8           | i8                        | [global]
u0:5  | Primitive | i128         | i128                      | [global]
u0:6  | Primitive | isize        | isize                     | [global]
u0:7  | Primitive | u32          | u32                       | [global]
u0:8  | Primitive | u64          | u64                       | [global]
u0:9  | Primitive | u16          | u16                       | [global]
u0:10 | Primitive | u8           | u8                        | [global]
u0:11 | Primitive | u128         | u128                      | [global]
u0:12 | Primitive | usize        | usize                     | [global]
u0:13 | Primitive | f32          | f32                       | [global]
u0:14 | Primitive | f64          | f64                       | [global]
u0:15 | Primitive | bool         | bool                      | [global]
u0:16 | Primitive | char         | char                      | [global]
u0:17 | Primitive | str          | str                       | [global]
u0:18 | Crate     | _c           | _c                        | [global]
u0:19 | Crate     | crate        | _c::crate                 |         
u0:20 | Module    | _m           | _c::_m                    |         
u0:21 | File      | main         | _c::_m::main              |         
u0:22 | Struct    | TupleThing   | _c::_m::main::TupleThing  |         
u0:23 | Function  | make_tuples  | _c::_m::main::make_tuples |         
u0:24 | Variable  | empty        | empty                     |         
u0:25 | Variable  | single       | single                    |         
u0:26 | Variable  | triple       | triple                    |         
u0:27 | Variable  | nested       | nested                    |         
u0:28 | Variable  | destructured | destructured              |         
u0:29 | Variable  | _all         | _all                      |         

--- expect:symbol-deps ---
u0:1 <- [u0:23, u0:27]
u0:22 <- [u0:23, u0:25, u0:26, u0:28]
u0:23 -> [u0:1, u0:22, u0:24]
u0:24 <- [u0:23, u0:29]
u0:25 -> [u0:22]
u0:26 -> [u0:22]
u0:27 -> [u0:1]
u0:28 -> [u0:22]
u0:29 -> [u0:24]

--- expect:blocks ---
u0:1 | root  | main       
u0:2 | class | TupleThing 
u0:3 | func  | make_tuples

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="TupleThing", full_path="/tmp/.tmpMDZQxg/app/src/main.rs:1"];
    n3 [label="make_tuples", full_path="/tmp/.tmpMDZQxg/app/src/main.rs:3"];
  }
  n3 -> n2;
}


===============================================================================
struct-expressions
===============================================================================


--- file: app/src/main.rs ---
struct SomeStruct {
    field1: i32,
    field2: String,
    field3: f64,
}

fn func() {
  NothingInMe {};
  Point {x: 10.0, y: 20.0};
  let a = SomeStruct { field1, field2: expression, field3, };
  let u = game::User {name: "Joe", age: 35, score: 100_000};
  let i = Instant { 0: Duration::from_millis(0) };
}

--- expect:symbols ---
u0:1  | Primitive | i32        | i32                              | [global]
u0:2  | Primitive | i64        | i64                              | [global]
u0:3  | Primitive | i16        | i16                              | [global]
u0:4  | Primitive | i8         | i8                               | [global]
u0:5  | Primitive | i128       | i128                             | [global]
u0:6  | Primitive | isize      | isize                            | [global]
u0:7  | Primitive | u32        | u32                              | [global]
u0:8  | Primitive | u64        | u64                              | [global]
u0:9  | Primitive | u16        | u16                              | [global]
u0:10 | Primitive | u8         | u8                               | [global]
u0:11 | Primitive | u128       | u128                             | [global]
u0:12 | Primitive | usize      | usize                            | [global]
u0:13 | Primitive | f32        | f32                              | [global]
u0:14 | Primitive | f64        | f64                              | [global]
u0:15 | Primitive | bool       | bool                             | [global]
u0:16 | Primitive | char       | char                             | [global]
u0:17 | Primitive | str        | str                              | [global]
u0:18 | Crate     | _c         | _c                               | [global]
u0:19 | Crate     | crate      | _c::crate                        |         
u0:20 | Module    | _m         | _c::_m                           |         
u0:21 | File      | main       | _c::_m::main                     |         
u0:22 | Struct    | SomeStruct | _c::_m::main::SomeStruct         |         
u0:23 | Field     | field1     | _c::_m::main::SomeStruct::field1 |         
u0:24 | Field     | field2     | _c::_m::main::SomeStruct::field2 |         
u0:25 | Field     | field3     | _c::_m::main::SomeStruct::field3 |         
u0:26 | Function  | func       | _c::_m::main::func               |         
u0:27 | Variable  | a          | a                                |         
u0:28 | Variable  | u          | u                                |         
u0:29 | Variable  | i          | i                                |         

--- expect:symbol-deps ---
u0:1 <- [u0:22, u0:23]
u0:14 <- [u0:22, u0:25]
u0:22 -> [u0:1, u0:14]
u0:22 <- [u0:26, u0:27]
u0:23 -> [u0:1]
u0:25 -> [u0:14]
u0:26 -> [u0:22]
u0:27 -> [u0:22]

--- expect:blocks ---
u0:1 | root  | main      
u0:2 | class | SomeStruct
u0:3 | field | block#3   
u0:4 | field | block#4   
u0:5 | field | block#5   
u0:6 | func  | func      
u0:7 | call  | block#7   

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="SomeStruct", full_path="/tmp/.tmp2lIE7d/app/src/main.rs:1"];
    n6 [label="func", full_path="/tmp/.tmp2lIE7d/app/src/main.rs:7"];
  }
  n6 -> n2;
}


===============================================================================
struct-expressions-with-update-initializers
===============================================================================


--- file: app/src/main.rs ---
struct User {
    id: u32,
    score: u32,
}

fn build_user(score: u32) -> User {
  let base = User { id: 1, score: 10 };
  User {
    score,
    ..base
  }
}

--- expect:symbols ---
u0:1  | Primitive | i32        | i32                             | [global]
u0:2  | Primitive | i64        | i64                             | [global]
u0:3  | Primitive | i16        | i16                             | [global]
u0:4  | Primitive | i8         | i8                              | [global]
u0:5  | Primitive | i128       | i128                            | [global]
u0:6  | Primitive | isize      | isize                           | [global]
u0:7  | Primitive | u32        | u32                             | [global]
u0:8  | Primitive | u64        | u64                             | [global]
u0:9  | Primitive | u16        | u16                             | [global]
u0:10 | Primitive | u8         | u8                              | [global]
u0:11 | Primitive | u128       | u128                            | [global]
u0:12 | Primitive | usize      | usize                           | [global]
u0:13 | Primitive | f32        | f32                             | [global]
u0:14 | Primitive | f64        | f64                             | [global]
u0:15 | Primitive | bool       | bool                            | [global]
u0:16 | Primitive | char       | char                            | [global]
u0:17 | Primitive | str        | str                             | [global]
u0:18 | Crate     | _c         | _c                              | [global]
u0:19 | Crate     | crate      | _c::crate                       |         
u0:20 | Module    | _m         | _c::_m                          |         
u0:21 | File      | main       | _c::_m::main                    |         
u0:22 | Struct    | User       | _c::_m::main::User              |         
u0:23 | Field     | id         | _c::_m::main::User::id          |         
u0:24 | Field     | score      | _c::_m::main::User::score       |         
u0:25 | Function  | build_user | _c::_m::main::build_user        |         
u0:26 | Variable  | score      | _c::_m::main::build_user::score |         
u0:27 | Variable  | base       | base                            |         

--- expect:symbol-deps ---
u0:22 -> [u0:7]
u0:22 <- [u0:25, u0:27]
u0:23 -> [u0:7]
u0:24 -> [u0:7]
u0:25 -> [u0:22, u0:7]
u0:26 -> [u0:7]
u0:27 -> [u0:22]
u0:7 <- [u0:22, u0:23, u0:24, u0:25, u0:26]

--- expect:blocks ---
u0:1 | root  | main      
u0:2 | class | User      
u0:3 | field | block#3   
u0:4 | field | block#4   
u0:5 | func  | build_user

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="User", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpyjY5oa/app/src/main.rs:1"];
    n5 [label="build_user", full_path="/private/var/folders/rk/clc9y9hn0m32mr3ls_j801kw0000gn/T/.tmpyjY5oa/app/src/main.rs:6"];
  }
  n5 -> n2;
}


===============================================================================
if-expressions
===============================================================================


--- file: app/src/main.rs ---
struct Config {
  n: i32,
  x: i32,
}

fn main() {
  let cfg = Config { n: 1, x: 5 };
  if cfg.n == 1 {
  } else if cfg.n == 2 {
  } else {
  }

  let y = if cfg.x == 5 { 10 } else { 15 };

  if cfg.x > 0 && cfg.n > 0 {}

  if cfg.x > 0 || cfg.n > 0 {}
}

--- expect:symbols ---
u0:1  | Primitive | i32    | i32                     | [global]
u0:2  | Primitive | i64    | i64                     | [global]
u0:3  | Primitive | i16    | i16                     | [global]
u0:4  | Primitive | i8     | i8                      | [global]
u0:5  | Primitive | i128   | i128                    | [global]
u0:6  | Primitive | isize  | isize                   | [global]
u0:7  | Primitive | u32    | u32                     | [global]
u0:8  | Primitive | u64    | u64                     | [global]
u0:9  | Primitive | u16    | u16                     | [global]
u0:10 | Primitive | u8     | u8                      | [global]
u0:11 | Primitive | u128   | u128                    | [global]
u0:12 | Primitive | usize  | usize                   | [global]
u0:13 | Primitive | f32    | f32                     | [global]
u0:14 | Primitive | f64    | f64                     | [global]
u0:15 | Primitive | bool   | bool                    | [global]
u0:16 | Primitive | char   | char                    | [global]
u0:17 | Primitive | str    | str                     | [global]
u0:18 | Crate     | _c     | _c                      | [global]
u0:19 | Crate     | crate  | _c::crate               |         
u0:20 | Module    | _m     | _c::_m                  |         
u0:21 | File      | main   | _c::_m::main            |         
u0:22 | Struct    | Config | _c::_m::main::Config    |         
u0:23 | Field     | n      | _c::_m::main::Config::n |         
u0:24 | Field     | x      | _c::_m::main::Config::x |         
u0:25 | Function  | main   | _c::_m::main::main      |         
u0:26 | Variable  | cfg    | cfg                     |         
u0:27 | Variable  | y      | y                       |         

--- expect:symbol-deps ---
u0:1 <- [u0:22, u0:23, u0:24, u0:25, u0:27]
u0:22 -> [u0:1]
u0:22 <- [u0:25, u0:26]
u0:23 -> [u0:1]
u0:24 -> [u0:1]
u0:25 -> [u0:1, u0:22]
u0:26 -> [u0:22]
u0:27 -> [u0:1]

--- expect:blocks ---
u0:1 | root  | main   
u0:2 | class | Config 
u0:3 | field | block#3
u0:4 | field | block#4
u0:5 | func  | main   

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Config", full_path="/tmp/.tmp2dthjA/app/src/main.rs:1"];
    n5 [label="main", full_path="/tmp/.tmp2dthjA/app/src/main.rs:6"];
  }
  n5 -> n2;
}


===============================================================================
basic-if-let-expressions
===============================================================================


--- file: app/src/main.rs ---
struct Guard {
  val: Option<i32>,
}

fn check() {
  let guard = Guard { val: Some(42) };
  if let Some(a) = guard.val
    && a > 0
  {
  }
}

--- expect:symbols ---
u0:1  | Primitive | i32   | i32                      | [global]
u0:2  | Primitive | i64   | i64                      | [global]
u0:3  | Primitive | i16   | i16                      | [global]
u0:4  | Primitive | i8    | i8                       | [global]
u0:5  | Primitive | i128  | i128                     | [global]
u0:6  | Primitive | isize | isize                    | [global]
u0:7  | Primitive | u32   | u32                      | [global]
u0:8  | Primitive | u64   | u64                      | [global]
u0:9  | Primitive | u16   | u16                      | [global]
u0:10 | Primitive | u8    | u8                       | [global]
u0:11 | Primitive | u128  | u128                     | [global]
u0:12 | Primitive | usize | usize                    | [global]
u0:13 | Primitive | f32   | f32                      | [global]
u0:14 | Primitive | f64   | f64                      | [global]
u0:15 | Primitive | bool  | bool                     | [global]
u0:16 | Primitive | char  | char                     | [global]
u0:17 | Primitive | str   | str                      | [global]
u0:18 | Crate     | _c    | _c                       | [global]
u0:19 | Crate     | crate | _c::crate                |         
u0:20 | Module    | _m    | _c::_m                   |         
u0:21 | File      | main  | _c::_m::main             |         
u0:22 | Struct    | Guard | _c::_m::main::Guard      |         
u0:23 | Field     | val   | _c::_m::main::Guard::val |         
u0:24 | Function  | check | _c::_m::main::check      |         
u0:25 | Variable  | guard | guard                    |         

--- expect:symbol-deps ---
u0:1 <- [u0:22, u0:23]
u0:22 -> [u0:1]
u0:22 <- [u0:24, u0:25]
u0:23 -> [u0:1]
u0:24 -> [u0:22]
u0:25 -> [u0:22]

--- expect:blocks ---
u0:1 | root  | main   
u0:2 | class | Guard  
u0:3 | field | block#3
u0:4 | func  | check  
u0:5 | call  | block#5

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Guard", full_path="/tmp/.tmpgoPVL2/app/src/main.rs:1"];
    n4 [label="check", full_path="/tmp/.tmpgoPVL2/app/src/main.rs:5"];
  }
  n4 -> n2;
}


===============================================================================
if-let-expressions
===============================================================================


--- file: app/src/main.rs ---
struct Dish;
fn parse() {
  let dish_opt = Some(Dish);
  if let Some(dish) = dish_opt {
  }

  if let Some("chained") = a && b && let (C, D) = e {
  }

  if foo && let bar = || baz && quux {}
  if a && let b = || c || d && e {}
}

--- expect:symbols ---
u0:1  | Primitive | i32      | i32                 | [global]
u0:2  | Primitive | i64      | i64                 | [global]
u0:3  | Primitive | i16      | i16                 | [global]
u0:4  | Primitive | i8       | i8                  | [global]
u0:5  | Primitive | i128     | i128                | [global]
u0:6  | Primitive | isize    | isize               | [global]
u0:7  | Primitive | u32      | u32                 | [global]
u0:8  | Primitive | u64      | u64                 | [global]
u0:9  | Primitive | u16      | u16                 | [global]
u0:10 | Primitive | u8       | u8                  | [global]
u0:11 | Primitive | u128     | u128                | [global]
u0:12 | Primitive | usize    | usize               | [global]
u0:13 | Primitive | f32      | f32                 | [global]
u0:14 | Primitive | f64      | f64                 | [global]
u0:15 | Primitive | bool     | bool                | [global]
u0:16 | Primitive | char     | char                | [global]
u0:17 | Primitive | str      | str                 | [global]
u0:18 | Crate     | _c       | _c                  | [global]
u0:19 | Crate     | crate    | _c::crate           |         
u0:20 | Module    | _m       | _c::_m              |         
u0:21 | File      | main     | _c::_m::main        |         
u0:22 | Struct    | Dish     | _c::_m::main::Dish  |         
u0:23 | Function  | parse    | _c::_m::main::parse |         
u0:24 | Variable  | dish_opt | dish_opt            |         

--- expect:symbol-deps ---
u0:22 <- [u0:23, u0:24]
u0:23 -> [u0:22]
u0:24 -> [u0:22]

--- expect:blocks ---
u0:1 | root  | main   
u0:2 | class | Dish   
u0:3 | func  | parse  
u0:4 | call  | block#4

--- expect:block-deps ---
u0:2 <- [u0:3]
u0:3 -> [u0:2]

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Dish", full_path="/tmp/.tmpXpJ50B/app/src/main.rs:1"];
    n3 [label="parse", full_path="/tmp/.tmpXpJ50B/app/src/main.rs:2"];
  }
  n3 -> n2;
}


===============================================================================
while-let-expressions
===============================================================================


--- file: app/src/main.rs ---
struct Queue {
  items: Option<Vec<i32>>,
}

fn process() {
  let queue = Queue { items: Some(vec![]) };
  while let Some(items) = queue.items {
    let _ = items;
  }
}

--- expect:symbols ---
u0:1  | Primitive | i32     | i32                        | [global]
u0:2  | Primitive | i64     | i64                        | [global]
u0:3  | Primitive | i16     | i16                        | [global]
u0:4  | Primitive | i8      | i8                         | [global]
u0:5  | Primitive | i128    | i128                       | [global]
u0:6  | Primitive | isize   | isize                      | [global]
u0:7  | Primitive | u32     | u32                        | [global]
u0:8  | Primitive | u64     | u64                        | [global]
u0:9  | Primitive | u16     | u16                        | [global]
u0:10 | Primitive | u8      | u8                         | [global]
u0:11 | Primitive | u128    | u128                       | [global]
u0:12 | Primitive | usize   | usize                      | [global]
u0:13 | Primitive | f32     | f32                        | [global]
u0:14 | Primitive | f64     | f64                        | [global]
u0:15 | Primitive | bool    | bool                       | [global]
u0:16 | Primitive | char    | char                       | [global]
u0:17 | Primitive | str     | str                        | [global]
u0:18 | Crate     | _c      | _c                         | [global]
u0:19 | Crate     | crate   | _c::crate                  |         
u0:20 | Module    | _m      | _c::_m                     |         
u0:21 | File      | main    | _c::_m::main               |         
u0:22 | Struct    | Queue   | _c::_m::main::Queue        |         
u0:23 | Field     | items   | _c::_m::main::Queue::items |         
u0:24 | Function  | process | _c::_m::main::process      |         
u0:25 | Variable  | queue   | queue                      |         

--- expect:symbol-deps ---
u0:1 <- [u0:22, u0:23]
u0:22 -> [u0:1]
u0:22 <- [u0:24, u0:25]
u0:23 -> [u0:1]
u0:24 -> [u0:22]
u0:25 -> [u0:22]

--- expect:blocks ---
u0:1 | root  | main   
u0:2 | class | Queue  
u0:3 | field | block#3
u0:4 | func  | process
u0:5 | call  | block#5

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Queue", full_path="/tmp/.tmp6uPGMH/app/src/main.rs:1"];
    n4 [label="process", full_path="/tmp/.tmp6uPGMH/app/src/main.rs:5"];
  }
  n4 -> n2;
}


===============================================================================
match-expressions
===============================================================================


--- file: app/src/main.rs ---
struct Value;

fn process_value() {
  let val = Value;
  match val {
    _ => {},
  }
}

--- expect:symbols ---
u0:1  | Primitive | i32           | i32                         | [global]
u0:2  | Primitive | i64           | i64                         | [global]
u0:3  | Primitive | i16           | i16                         | [global]
u0:4  | Primitive | i8            | i8                          | [global]
u0:5  | Primitive | i128          | i128                        | [global]
u0:6  | Primitive | isize         | isize                       | [global]
u0:7  | Primitive | u32           | u32                         | [global]
u0:8  | Primitive | u64           | u64                         | [global]
u0:9  | Primitive | u16           | u16                         | [global]
u0:10 | Primitive | u8            | u8                          | [global]
u0:11 | Primitive | u128          | u128                        | [global]
u0:12 | Primitive | usize         | usize                       | [global]
u0:13 | Primitive | f32           | f32                         | [global]
u0:14 | Primitive | f64           | f64                         | [global]
u0:15 | Primitive | bool          | bool                        | [global]
u0:16 | Primitive | char          | char                        | [global]
u0:17 | Primitive | str           | str                         | [global]
u0:18 | Crate     | _c            | _c                          | [global]
u0:19 | Crate     | crate         | _c::crate                   |         
u0:20 | Module    | _m            | _c::_m                      |         
u0:21 | File      | main          | _c::_m::main                |         
u0:22 | Struct    | Value         | _c::_m::main::Value         |         
u0:23 | Function  | process_value | _c::_m::main::process_value |         
u0:24 | Variable  | val           | val                         |         

--- expect:symbol-deps ---
u0:22 <- [u0:23, u0:24]
u0:23 -> [u0:22]
u0:24 -> [u0:22]

--- expect:blocks ---
u0:1 | root  | main         
u0:2 | class | Value        
u0:3 | func  | process_value

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Value", full_path="/tmp/.tmpwhqF30/app/src/main.rs:1"];
    n3 [label="process_value", full_path="/tmp/.tmpwhqF30/app/src/main.rs:3"];
  }
  n3 -> n2;
}


===============================================================================
while-expressions
===============================================================================


--- file: app/src/main.rs ---
struct State {
  done: bool,
}

fn loop_until() {
  let state = State { done: false };
  while !state.done {
    let _ = state.done;
  }
}

--- expect:symbols ---
u0:1  | Primitive | i32        | i32                       | [global]
u0:2  | Primitive | i64        | i64                       | [global]
u0:3  | Primitive | i16        | i16                       | [global]
u0:4  | Primitive | i8         | i8                        | [global]
u0:5  | Primitive | i128       | i128                      | [global]
u0:6  | Primitive | isize      | isize                     | [global]
u0:7  | Primitive | u32        | u32                       | [global]
u0:8  | Primitive | u64        | u64                       | [global]
u0:9  | Primitive | u16        | u16                       | [global]
u0:10 | Primitive | u8         | u8                        | [global]
u0:11 | Primitive | u128       | u128                      | [global]
u0:12 | Primitive | usize      | usize                     | [global]
u0:13 | Primitive | f32        | f32                       | [global]
u0:14 | Primitive | f64        | f64                       | [global]
u0:15 | Primitive | bool       | bool                      | [global]
u0:16 | Primitive | char       | char                      | [global]
u0:17 | Primitive | str        | str                       | [global]
u0:18 | Crate     | _c         | _c                        | [global]
u0:19 | Crate     | crate      | _c::crate                 |         
u0:20 | Module    | _m         | _c::_m                    |         
u0:21 | File      | main       | _c::_m::main              |         
u0:22 | Struct    | State      | _c::_m::main::State       |         
u0:23 | Field     | done       | _c::_m::main::State::done |         
u0:24 | Function  | loop_until | _c::_m::main::loop_until  |         
u0:25 | Variable  | state      | state                     |         

--- expect:symbol-deps ---
u0:15 <- [u0:22, u0:23, u0:24]
u0:22 -> [u0:15]
u0:22 <- [u0:24, u0:25]
u0:23 -> [u0:15]
u0:24 -> [u0:15, u0:22]
u0:25 -> [u0:22]

--- expect:blocks ---
u0:1 | root  | main      
u0:2 | class | State     
u0:3 | field | block#3   
u0:4 | func  | loop_until

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="State", full_path="/tmp/.tmpnh2XxL/app/src/main.rs:1"];
    n4 [label="loop_until", full_path="/tmp/.tmpnh2XxL/app/src/main.rs:5"];
  }
  n4 -> n2;
}


===============================================================================
loop-expressions
===============================================================================


--- file: app/src/main.rs ---
struct Counter {
  limit: i32,
}

fn count() {
  let counter = Counter { limit: 10 };
  'outer: loop {
    'inner: loop {
      break 'outer;
    }
  }
}

--- expect:symbols ---
u0:1  | Primitive | i32     | i32                          | [global]
u0:2  | Primitive | i64     | i64                          | [global]
u0:3  | Primitive | i16     | i16                          | [global]
u0:4  | Primitive | i8      | i8                           | [global]
u0:5  | Primitive | i128    | i128                         | [global]
u0:6  | Primitive | isize   | isize                        | [global]
u0:7  | Primitive | u32     | u32                          | [global]
u0:8  | Primitive | u64     | u64                          | [global]
u0:9  | Primitive | u16     | u16                          | [global]
u0:10 | Primitive | u8      | u8                           | [global]
u0:11 | Primitive | u128    | u128                         | [global]
u0:12 | Primitive | usize   | usize                        | [global]
u0:13 | Primitive | f32     | f32                          | [global]
u0:14 | Primitive | f64     | f64                          | [global]
u0:15 | Primitive | bool    | bool                         | [global]
u0:16 | Primitive | char    | char                         | [global]
u0:17 | Primitive | str     | str                          | [global]
u0:18 | Crate     | _c      | _c                           | [global]
u0:19 | Crate     | crate   | _c::crate                    |         
u0:20 | Module    | _m      | _c::_m                       |         
u0:21 | File      | main    | _c::_m::main                 |         
u0:22 | Struct    | Counter | _c::_m::main::Counter        |         
u0:23 | Field     | limit   | _c::_m::main::Counter::limit |         
u0:24 | Function  | count   | _c::_m::main::count          |         
u0:25 | Variable  | counter | counter                      |         

--- expect:symbol-deps ---
u0:1 <- [u0:22, u0:23]
u0:22 -> [u0:1]
u0:22 <- [u0:24, u0:25]
u0:23 -> [u0:1]
u0:24 -> [u0:22]
u0:25 -> [u0:22]

--- expect:blocks ---
u0:1 | root  | main   
u0:2 | class | Counter
u0:3 | field | block#3
u0:4 | func  | count  

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Counter", full_path="/tmp/.tmp6VlSJI/app/src/main.rs:1"];
    n4 [label="count", full_path="/tmp/.tmp6VlSJI/app/src/main.rs:5"];
  }
  n4 -> n2;
}


===============================================================================
for-expressions
===============================================================================


--- file: app/src/main.rs ---
struct Container;

fn iterate() {
  let container = Container;
  for i in 0..10 {
    let _ = i;
  }
}

--- expect:symbols ---
u0:1  | Primitive | i32       | i32                     | [global]
u0:2  | Primitive | i64       | i64                     | [global]
u0:3  | Primitive | i16       | i16                     | [global]
u0:4  | Primitive | i8        | i8                      | [global]
u0:5  | Primitive | i128      | i128                    | [global]
u0:6  | Primitive | isize     | isize                   | [global]
u0:7  | Primitive | u32       | u32                     | [global]
u0:8  | Primitive | u64       | u64                     | [global]
u0:9  | Primitive | u16       | u16                     | [global]
u0:10 | Primitive | u8        | u8                      | [global]
u0:11 | Primitive | u128      | u128                    | [global]
u0:12 | Primitive | usize     | usize                   | [global]
u0:13 | Primitive | f32       | f32                     | [global]
u0:14 | Primitive | f64       | f64                     | [global]
u0:15 | Primitive | bool      | bool                    | [global]
u0:16 | Primitive | char      | char                    | [global]
u0:17 | Primitive | str       | str                     | [global]
u0:18 | Crate     | _c        | _c                      | [global]
u0:19 | Crate     | crate     | _c::crate               |         
u0:20 | Module    | _m        | _c::_m                  |         
u0:21 | File      | main      | _c::_m::main            |         
u0:22 | Struct    | Container | _c::_m::main::Container |         
u0:23 | Function  | iterate   | _c::_m::main::iterate   |         
u0:24 | Variable  | container | container               |         

--- expect:symbol-deps ---
u0:22 <- [u0:23, u0:24]
u0:23 -> [u0:22]
u0:24 -> [u0:22]

--- expect:blocks ---
u0:1 | root  | main     
u0:2 | class | Container
u0:3 | func  | iterate  

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Container", full_path="/tmp/.tmp2ELXZY/app/src/main.rs:1"];
    n3 [label="iterate", full_path="/tmp/.tmp2ELXZY/app/src/main.rs:3"];
  }
  n3 -> n2;
}


===============================================================================
field-expressions
===============================================================================


--- file: app/src/main.rs ---
struct Foo;
struct Far;
struct Baz {
  x: Far,
}

struct MyStruct {
  myfield: Foo,
}

fn foo() -> Baz {
  Baz
}

fn bar() {
  let mystruct = MyStruct { myfield: Foo };
  let x = mystruct.myfield;
  let y = foo().x;
  value.0.1.iter();
  1.max(2);
}

--- expect:symbols ---
u0:1  | Primitive | i32      | i32                             | [global]
u0:2  | Primitive | i64      | i64                             | [global]
u0:3  | Primitive | i16      | i16                             | [global]
u0:4  | Primitive | i8       | i8                              | [global]
u0:5  | Primitive | i128     | i128                            | [global]
u0:6  | Primitive | isize    | isize                           | [global]
u0:7  | Primitive | u32      | u32                             | [global]
u0:8  | Primitive | u64      | u64                             | [global]
u0:9  | Primitive | u16      | u16                             | [global]
u0:10 | Primitive | u8       | u8                              | [global]
u0:11 | Primitive | u128     | u128                            | [global]
u0:12 | Primitive | usize    | usize                           | [global]
u0:13 | Primitive | f32      | f32                             | [global]
u0:14 | Primitive | f64      | f64                             | [global]
u0:15 | Primitive | bool     | bool                            | [global]
u0:16 | Primitive | char     | char                            | [global]
u0:17 | Primitive | str      | str                             | [global]
u0:18 | Crate     | _c       | _c                              | [global]
u0:19 | Crate     | crate    | _c::crate                       |         
u0:20 | Module    | _m       | _c::_m                          |         
u0:21 | File      | main     | _c::_m::main                    |         
u0:22 | Struct    | Foo      | _c::_m::main::Foo               |         
u0:23 | Struct    | Far      | _c::_m::main::Far               |         
u0:24 | Struct    | Baz      | _c::_m::main::Baz               |         
u0:25 | Field     | x        | _c::_m::main::Baz::x            |         
u0:26 | Struct    | MyStruct | _c::_m::main::MyStruct          |         
u0:27 | Field     | myfield  | _c::_m::main::MyStruct::myfield |         
u0:28 | Function  | foo      | _c::_m::main::foo               |         
u0:29 | Function  | bar      | _c::_m::main::bar               |         
u0:30 | Variable  | mystruct | mystruct                        |         
u0:31 | Variable  | x        | x                               |         
u0:32 | Variable  | y        | y                               |         

--- expect:symbol-deps ---
u0:22 <- [u0:26, u0:27, u0:29, u0:31]
u0:23 <- [u0:24, u0:25, u0:29, u0:32]
u0:24 -> [u0:23]
u0:24 <- [u0:28]
u0:25 -> [u0:23]
u0:26 -> [u0:22]
u0:26 <- [u0:29, u0:30]
u0:27 -> [u0:22]
u0:28 -> [u0:24]
u0:28 <- [u0:29]
u0:29 -> [u0:22, u0:23, u0:26, u0:28]
u0:30 -> [u0:26]
u0:31 -> [u0:22]
u0:32 -> [u0:23]

--- expect:blocks ---
u0:1  | root  | main    
u0:2  | class | Foo     
u0:3  | class | Far     
u0:4  | class | Baz     
u0:5  | field | block#5 
u0:6  | class | MyStruct
u0:7  | field | block#7 
u0:8  | func  | foo     
u0:9  | func  | bar     
u0:10 | call  | block#10
u0:11 | call  | block#11
u0:12 | call  | block#12

--- expect:block-deps ---
u0:2 <- [u0:6, u0:9]
u0:3 <- [u0:4, u0:9]
u0:4 -> [u0:3]
u0:4 <- [u0:8]
u0:6 -> [u0:2]
u0:6 <- [u0:9]
u0:8 -> [u0:4]
u0:8 <- [u0:9]
u0:9 -> [u0:2, u0:3, u0:6, u0:8]

--- expect:graph ---
digraph project {
  subgraph cluster_0 {
    label="todo";
    style=filled;
    color=lightgrey;
    n2 [label="Foo", full_path="/tmp/.tmpYYZqgu/app/src/main.rs:1"];
    n8 [label="foo", full_path="/tmp/.tmpYYZqgu/app/src/main.rs:11"];
    n9 [label="bar", full_path="/tmp/.tmpYYZqgu/app/src/main.rs:15"];
    n3 [label="Far", full_path="/tmp/.tmpYYZqgu/app/src/main.rs:2"];
    n4 [label="Baz", full_path="/tmp/.tmpYYZqgu/app/src/main.rs:3"];
    n6 [label="MyStruct", full_path="/tmp/.tmpYYZqgu/app/src/main.rs:7"];
  }
  n8 -> n4;
  n9 -> n8;
  n9 -> n6;
  n4 -> n3;
  n6 -> n2;
}


===============================================================================
method-call-expressions
===============================================================================


--- file: src/main.rs ---
struct Foo;

struct MyStruct;

impl MyStruct {
  fn foo(&self) -> Foo {}
}

fn func() {
    let mystruct = MyStruct::new();
    let x = mystruct.foo();
}

--- expect:symbols ---
u0:1  | Primitive | i32      | i32                         | [global]
u0:2  | Primitive | i64      | i64                         | [global]
u0:3  | Primitive | i16      | i16                         | [global]
u0:4  | Primitive | i8       | i8                          | [global]
u0:5  | Primitive | i128     | i128                        | [global]
u0:6  | Primitive | isize    | isize                       | [global]
u0:7  | Primitive | u32      | u32                         | [global]
u0:8  | Primitive | u64      | u64                         | [global]
u0:9  | Primitive | u16      | u16                         | [global]
u0:10 | Primitive | u8       | u8                          | [global]
u0:11 | Primitive | u128     | u128                        | [global]
u0:12 | Primitive | usize    | usize                       | [global]
u0:13 | Primitive | f32      | f32                         | [global]
u0:14 | Primitive | f64      | f64                         | [global]
u0:15 | Primitive | bool     | bool                        | [global]
u0:16 | Primitive | char     | char                        | [global]
u0:17 | Primitive | str      | str                         | [global]
u0:18 | Crate     | _c       | _c                          | [global]
u0:19 | Crate     | crate    | _c::crate                   |         
u0:20 | Module    | _m       | _c::_m                      |         
u0:21 | File      | main     | _c::_m::main                |         
u0:22 | Struct    | Foo      | _c::_m::main::Foo           |         
u0:23 | Struct    | MyStruct | _c::_m::main::MyStruct      |         
u0:24 | Method    | foo      | _c::_m::main::MyStruct::foo |         
u0:25 | Function  | func     | _c::_m::main::func          |         
u0:26 | Variable  | mystruct | mystruct                    |         
u0:27 | Variable  | x        | x                           |         

--- expect:symbol-deps ---
u0:22 <- [u0:24]
u0:23 <- [u0:25]
u0:24 -> [u0:22]
u0:25 -> [u0:23, u0:26]
u0:26 <- [u0:25, u0:27]
u0:27 -> [u0:26]


===============================================================================
index-expressions
===============================================================================


--- file: src/main.rs ---
([1, 2, 3, 4])[0];
arr[10];
arr[n];

--- expect:symbols ---
u0:1  | Primitive | i32   | i32          | [global]
u0:2  | Primitive | i64   | i64          | [global]
u0:3  | Primitive | i16   | i16          | [global]
u0:4  | Primitive | i8    | i8           | [global]
u0:5  | Primitive | i128  | i128         | [global]
u0:6  | Primitive | isize | isize        | [global]
u0:7  | Primitive | u32   | u32          | [global]
u0:8  | Primitive | u64   | u64          | [global]
u0:9  | Primitive | u16   | u16          | [global]
u0:10 | Primitive | u8    | u8           | [global]
u0:11 | Primitive | u128  | u128         | [global]
u0:12 | Primitive | usize | usize        | [global]
u0:13 | Primitive | f32   | f32          | [global]
u0:14 | Primitive | f64   | f64          | [global]
u0:15 | Primitive | bool  | bool         | [global]
u0:16 | Primitive | char  | char         | [global]
u0:17 | Primitive | str   | str          | [global]
u0:18 | Crate     | _c    | _c           | [global]
u0:19 | Crate     | crate | _c::crate    |         
u0:20 | Module    | _m    | _c::_m       |         
u0:21 | File      | main  | _c::_m::main |         

--- expect:symbol-deps ---


===============================================================================
scoped-functions
===============================================================================


--- file: app/src/foo.rs ---
pub fn f() {}

pub mod g {
  pub fn h() {}
}

--- file: app/src/main.rs ---
struct a;
impl a {
  fn b() {}
}

struct C;
impl C {
  fn e() {}
}

fn foo() {
  a::b();
  C::<D>::e();
  ::f();
  ::g::h();
}

--- expect:symbols ---
u0:1  | Primitive | i32   | i32                | [global]
u0:2  | Primitive | i64   | i64                | [global]
u0:3  | Primitive | i16   | i16                | [global]
u0:4  | Primitive | i8    | i8                 | [global]
u0:5  | Primitive | i128  | i128               | [global]
u0:6  | Primitive | isize | isize              | [global]
u0:7  | Primitive | u32   | u32                | [global]
u0:8  | Primitive | u64   | u64                | [global]
u0:9  | Primitive | u16   | u16                | [global]
u0:10 | Primitive | u8    | u8                 | [global]
u0:11 | Primitive | u128  | u128               | [global]
u0:12 | Primitive | usize | usize              | [global]
u0:13 | Primitive | f32   | f32                | [global]
u0:14 | Primitive | f64   | f64                | [global]
u0:15 | Primitive | bool  | bool               | [global]
u0:16 | Primitive | char  | char               | [global]
u0:17 | Primitive | str   | str                | [global]
u0:18 | Crate     | _c    | _c                 | [global]
u0:19 | Crate     | crate | _c::crate          |         
u0:20 | Module    | _m    | _c::_m             |         
u0:21 | File      | foo   | _c::_m::foo        |         
u0:22 | Function  | f     | _c::_m::foo::f     |         
u0:23 | Namespace | g     | _c::_m::foo::g     |         
u0:24 | Function  | h     | _c::_m::foo::g::h  |         
u1:25 | Primitive | i32   | i32                | [global]
u1:26 | Primitive | i64   | i64                | [global]
u1:27 | Primitive | i16   | i16                | [global]
u1:28 | Primitive | i8    | i8                 | [global]
u1:29 | Primitive | i128  | i128               | [global]
u1:30 | Primitive | isize | isize              | [global]
u1:31 | Primitive | u32   | u32                | [global]
u1:32 | Primitive | u64   | u64                | [global]
u1:33 | Primitive | u16   | u16                | [global]
u1:34 | Primitive | u8    | u8                 | [global]
u1:35 | Primitive | u128  | u128               | [global]
u1:36 | Primitive | usize | usize              | [global]
u1:37 | Primitive | f32   | f32                | [global]
u1:38 | Primitive | f64   | f64                | [global]
u1:39 | Primitive | bool  | bool               | [global]
u1:40 | Primitive | char  | char               | [global]
u1:41 | Primitive | str   | str                | [global]
u1:42 | Crate     | _c    | _c                 | [global]
u1:43 | Crate     | crate | _c::crate          |         
u1:44 | Module    | _m    | _c::_m             |         
u1:45 | File      | main  | _c::_m::main       |         
u1:46 | Struct    | a     | _c::_m::main::a    |         
u1:47 | Method    | b     | _c::_m::main::a::b |         
u1:48 | Struct    | C     | _c::_m::main::C    |         
u1:49 | Method    | e     | _c::_m::main::C::e |         
u1:50 | Function  | foo   | _c::_m::main::foo  |         

--- expect:symbol-deps ---
u1:46 <- [u1:50]
u1:47 <- [u1:50]
u1:48 <- [u1:50]
u1:49 <- [u1:50]
u1:50 -> [u1:46, u1:47, u1:48, u1:49]

--- expect:block-graph ---
(root:1 foo
    (func:2 f)
    (func:3 h)
)

(root:4 main
    (class:5 a)
    (impl:6 a
        (method:7 b)
    )
    (class:8 C)
    (impl:9 C
        (method:10 e)
    )
    (func:11 foo
        (call:12)
        (call:13)
        (call:14)
        (call:15)
    )
)

--- expect:block-deps ---
u1:10 <- [u1:11]
u1:11 -> [u1:10, u1:5, u1:7, u1:8]
u1:5 <- [u1:11]
u1:7 <- [u1:11]
u1:8 <- [u1:11]


===============================================================================
scoped-functions-with-fully-qualified-syntax
===============================================================================


--- file: src/main.rs ---
<Dog as Animal>::eat(d);

--- expect:symbols ---
u0:1  | Primitive | i32   | i32          | [global]
u0:2  | Primitive | i64   | i64          | [global]
u0:3  | Primitive | i16   | i16          | [global]
u0:4  | Primitive | i8    | i8           | [global]
u0:5  | Primitive | i128  | i128         | [global]
u0:6  | Primitive | isize | isize        | [global]
u0:7  | Primitive | u32   | u32          | [global]
u0:8  | Primitive | u64   | u64          | [global]
u0:9  | Primitive | u16   | u16          | [global]
u0:10 | Primitive | u8    | u8           | [global]
u0:11 | Primitive | u128  | u128         | [global]
u0:12 | Primitive | usize | usize        | [global]
u0:13 | Primitive | f32   | f32          | [global]
u0:14 | Primitive | f64   | f64          | [global]
u0:15 | Primitive | bool  | bool         | [global]
u0:16 | Primitive | char  | char         | [global]
u0:17 | Primitive | str   | str          | [global]
u0:18 | Crate     | _c    | _c           | [global]
u0:19 | Crate     | crate | _c::crate    |         
u0:20 | Module    | _m    | _c::_m       |         
u0:21 | File      | main  | _c::_m::main |         

--- expect:symbol-deps ---


===============================================================================
scoped-functions-with-macros-as-types
===============================================================================


--- file: src/main.rs ---
<Token![]>::foo();

--- expect:symbols ---
u0:1  | Primitive | i32   | i32          | [global]
u0:2  | Primitive | i64   | i64          | [global]
u0:3  | Primitive | i16   | i16          | [global]
u0:4  | Primitive | i8    | i8           | [global]
u0:5  | Primitive | i128  | i128         | [global]
u0:6  | Primitive | isize | isize        | [global]
u0:7  | Primitive | u32   | u32          | [global]
u0:8  | Primitive | u64   | u64          | [global]
u0:9  | Primitive | u16   | u16          | [global]
u0:10 | Primitive | u8    | u8           | [global]
u0:11 | Primitive | u128  | u128         | [global]
u0:12 | Primitive | usize | usize        | [global]
u0:13 | Primitive | f32   | f32          | [global]
u0:14 | Primitive | f64   | f64          | [global]
u0:15 | Primitive | bool  | bool         | [global]
u0:16 | Primitive | char  | char         | [global]
u0:17 | Primitive | str   | str          | [global]
u0:18 | Crate     | _c    | _c           | [global]
u0:19 | Crate     | crate | _c::crate    |         
u0:20 | Module    | _m    | _c::_m       |         
u0:21 | File      | main  | _c::_m::main |         

--- expect:symbol-deps ---


===============================================================================
scoped-identifier-with-nested-super
===============================================================================


--- file: src/main.rs ---
pub fn foo() {}
pub mod m1 {
  mod m2 {
    fn bar() {
      super::super::foo();
    }
}


--- expect:symbols ---
u0:1  | Primitive | i32   | i32                       | [global]
u0:2  | Primitive | i64   | i64                       | [global]
u0:3  | Primitive | i16   | i16                       | [global]
u0:4  | Primitive | i8    | i8                        | [global]
u0:5  | Primitive | i128  | i128                      | [global]
u0:6  | Primitive | isize | isize                     | [global]
u0:7  | Primitive | u32   | u32                       | [global]
u0:8  | Primitive | u64   | u64                       | [global]
u0:9  | Primitive | u16   | u16                       | [global]
u0:10 | Primitive | u8    | u8                        | [global]
u0:11 | Primitive | u128  | u128                      | [global]
u0:12 | Primitive | usize | usize                     | [global]
u0:13 | Primitive | f32   | f32                       | [global]
u0:14 | Primitive | f64   | f64                       | [global]
u0:15 | Primitive | bool  | bool                      | [global]
u0:16 | Primitive | char  | char                      | [global]
u0:17 | Primitive | str   | str                       | [global]
u0:18 | Crate     | _c    | _c                        | [global]
u0:19 | Crate     | crate | _c::crate                 |         
u0:20 | Module    | _m    | _c::_m                    |         
u0:21 | File      | main  | _c::_m::main              |         
u0:22 | Function  | foo   | _c::_m::main::foo         |         
u0:23 | Namespace | m1    | _c::_m::main::m1          |         
u0:24 | Namespace | m2    | _c::_m::main::m1::m2      |         
u0:25 | Function  | bar   | _c::_m::main::m1::m2::bar |         

--- expect:symbol-deps ---
u0:22 <- [u0:25]
u0:25 -> [u0:22]

--- expect:blocks ---
u0:1 | root | main   
u0:2 | func | foo    
u0:3 | func | bar    
u0:4 | call | block#4


===============================================================================
generic-functions
===============================================================================


--- file: src/main.rs ---
std::sizeof::<u32>();
foo::<8>();

--- expect:symbols ---
u0:1  | Primitive | i32   | i32          | [global]
u0:2  | Primitive | i64   | i64          | [global]
u0:3  | Primitive | i16   | i16          | [global]
u0:4  | Primitive | i8    | i8           | [global]
u0:5  | Primitive | i128  | i128         | [global]
u0:6  | Primitive | isize | isize        | [global]
u0:7  | Primitive | u32   | u32          | [global]
u0:8  | Primitive | u64   | u64          | [global]
u0:9  | Primitive | u16   | u16          | [global]
u0:10 | Primitive | u8    | u8           | [global]
u0:11 | Primitive | u128  | u128         | [global]
u0:12 | Primitive | usize | usize        | [global]
u0:13 | Primitive | f32   | f32          | [global]
u0:14 | Primitive | f64   | f64          | [global]
u0:15 | Primitive | bool  | bool         | [global]
u0:16 | Primitive | char  | char         | [global]
u0:17 | Primitive | str   | str          | [global]
u0:18 | Crate     | _c    | _c           | [global]
u0:19 | Crate     | crate | _c::crate    |         
u0:20 | Module    | _m    | _c::_m       |         
u0:21 | File      | main  | _c::_m::main |         

--- expect:symbol-deps ---


===============================================================================
closures
===============================================================================


--- file: src/main.rs ---
a.map(|(b, c)| b.push(c));
d.map(move |mut e| {
    f(e);
    g(e)
});
h(|| -> i { j });

--- expect:symbols ---
u0:1  | Primitive | i32   | i32          | [global]
u0:2  | Primitive | i64   | i64          | [global]
u0:3  | Primitive | i16   | i16          | [global]
u0:4  | Primitive | i8    | i8           | [global]
u0:5  | Primitive | i128  | i128         | [global]
u0:6  | Primitive | isize | isize        | [global]
u0:7  | Primitive | u32   | u32          | [global]
u0:8  | Primitive | u64   | u64          | [global]
u0:9  | Primitive | u16   | u16          | [global]
u0:10 | Primitive | u8    | u8           | [global]
u0:11 | Primitive | u128  | u128         | [global]
u0:12 | Primitive | usize | usize        | [global]
u0:13 | Primitive | f32   | f32          | [global]
u0:14 | Primitive | f64   | f64          | [global]
u0:15 | Primitive | bool  | bool         | [global]
u0:16 | Primitive | char  | char         | [global]
u0:17 | Primitive | str   | str          | [global]
u0:18 | Crate     | _c    | _c           | [global]
u0:19 | Crate     | crate | _c::crate    |         
u0:20 | Module    | _m    | _c::_m       |         
u0:21 | File      | main  | _c::_m::main |         

--- expect:symbol-deps ---


===============================================================================
closures-with-typed-parameteres
===============================================================================


--- file: src/main.rs ---
a.map(|b: usize| b.push(c));

--- expect:symbols ---
u0:1  | Primitive | i32   | i32             | [global]
u0:2  | Primitive | i64   | i64             | [global]
u0:3  | Primitive | i16   | i16             | [global]
u0:4  | Primitive | i8    | i8              | [global]
u0:5  | Primitive | i128  | i128            | [global]
u0:6  | Primitive | isize | isize           | [global]
u0:7  | Primitive | u32   | u32             | [global]
u0:8  | Primitive | u64   | u64             | [global]
u0:9  | Primitive | u16   | u16             | [global]
u0:10 | Primitive | u8    | u8              | [global]
u0:11 | Primitive | u128  | u128            | [global]
u0:12 | Primitive | usize | usize           | [global]
u0:13 | Primitive | f32   | f32             | [global]
u0:14 | Primitive | f64   | f64             | [global]
u0:15 | Primitive | bool  | bool            | [global]
u0:16 | Primitive | char  | char            | [global]
u0:17 | Primitive | str   | str             | [global]
u0:18 | Crate     | _c    | _c              | [global]
u0:19 | Crate     | crate | _c::crate       |         
u0:20 | Module    | _m    | _c::_m          |         
u0:21 | File      | main  | _c::_m::main    |         
u0:22 | Variable  | b     | _c::_m::main::b |         

--- expect:symbol-deps ---
u0:12 <- [u0:22]
u0:22 -> [u0:12]


===============================================================================
generators
===============================================================================


--- file: src/main.rs ---
move || {
    while i <= n {
        yield i;
        i += 1;
    }
    return;
};

--- expect:symbols ---
u0:1  | Primitive | i32   | i32          | [global]
u0:2  | Primitive | i64   | i64          | [global]
u0:3  | Primitive | i16   | i16          | [global]
u0:4  | Primitive | i8    | i8           | [global]
u0:5  | Primitive | i128  | i128         | [global]
u0:6  | Primitive | isize | isize        | [global]
u0:7  | Primitive | u32   | u32          | [global]
u0:8  | Primitive | u64   | u64          | [global]
u0:9  | Primitive | u16   | u16          | [global]
u0:10 | Primitive | u8    | u8           | [global]
u0:11 | Primitive | u128  | u128         | [global]
u0:12 | Primitive | usize | usize        | [global]
u0:13 | Primitive | f32   | f32          | [global]
u0:14 | Primitive | f64   | f64          | [global]
u0:15 | Primitive | bool  | bool         | [global]
u0:16 | Primitive | char  | char         | [global]
u0:17 | Primitive | str   | str          | [global]
u0:18 | Crate     | _c    | _c           | [global]
u0:19 | Crate     | crate | _c::crate    |         
u0:20 | Module    | _m    | _c::_m       |         
u0:21 | File      | main  | _c::_m::main |         

--- expect:symbol-deps ---


===============================================================================
unsafe-blocks
===============================================================================


--- file: src/main.rs ---
fn foo() {}
const a : A = unsafe { foo() };

--- expect:symbols ---
u0:1  | Primitive | i32   | i32               | [global]
u0:2  | Primitive | i64   | i64               | [global]
u0:3  | Primitive | i16   | i16               | [global]
u0:4  | Primitive | i8    | i8                | [global]
u0:5  | Primitive | i128  | i128              | [global]
u0:6  | Primitive | isize | isize             | [global]
u0:7  | Primitive | u32   | u32               | [global]
u0:8  | Primitive | u64   | u64               | [global]
u0:9  | Primitive | u16   | u16               | [global]
u0:10 | Primitive | u8    | u8                | [global]
u0:11 | Primitive | u128  | u128              | [global]
u0:12 | Primitive | usize | usize             | [global]
u0:13 | Primitive | f32   | f32               | [global]
u0:14 | Primitive | f64   | f64               | [global]
u0:15 | Primitive | bool  | bool              | [global]
u0:16 | Primitive | char  | char              | [global]
u0:17 | Primitive | str   | str               | [global]
u0:18 | Crate     | _c    | _c                | [global]
u0:19 | Crate     | crate | _c::crate         |         
u0:20 | Module    | _m    | _c::_m            |         
u0:21 | File      | main  | _c::_m::main      |         
u0:22 | Function  | foo   | _c::_m::main::foo |         
u0:23 | Const     | a     | _c::_m::main::a   |         

--- expect:symbol-deps ---


===============================================================================
inline-const-or-const-blocks-as-expression
===============================================================================


--- file: src/main.rs ---
const { 1 + 3 };
if *x < 0 { const { &4i32.pow(4) } } else { x }
let three_ranges = [const { (0..=5).into_inner() }; 3];

--- expect:symbols ---
u0:1  | Primitive | i32          | i32                        | [global]
u0:2  | Primitive | i64          | i64                        | [global]
u0:3  | Primitive | i16          | i16                        | [global]
u0:4  | Primitive | i8           | i8                         | [global]
u0:5  | Primitive | i128         | i128                       | [global]
u0:6  | Primitive | isize        | isize                      | [global]
u0:7  | Primitive | u32          | u32                        | [global]
u0:8  | Primitive | u64          | u64                        | [global]
u0:9  | Primitive | u16          | u16                        | [global]
u0:10 | Primitive | u8           | u8                         | [global]
u0:11 | Primitive | u128         | u128                       | [global]
u0:12 | Primitive | usize        | usize                      | [global]
u0:13 | Primitive | f32          | f32                        | [global]
u0:14 | Primitive | f64          | f64                        | [global]
u0:15 | Primitive | bool         | bool                       | [global]
u0:16 | Primitive | char         | char                       | [global]
u0:17 | Primitive | str          | str                        | [global]
u0:18 | Crate     | _c           | _c                         | [global]
u0:19 | Crate     | crate        | _c::crate                  |         
u0:20 | Module    | _m           | _c::_m                     |         
u0:21 | File      | main         | _c::_m::main               |         
u0:22 | Variable  | three_ranges | _c::_m::main::three_ranges |         

--- expect:symbol-deps ---
u0:1 <- [u0:22]
u0:22 -> [u0:1]


===============================================================================
raw-reference-expression-conflicts
===============================================================================


--- file: src/main.rs ---
some_call(&raw);
let a = &raw const b;

--- expect:symbols ---
u0:1  | Primitive | i32   | i32             | [global]
u0:2  | Primitive | i64   | i64             | [global]
u0:3  | Primitive | i16   | i16             | [global]
u0:4  | Primitive | i8    | i8              | [global]
u0:5  | Primitive | i128  | i128            | [global]
u0:6  | Primitive | isize | isize           | [global]
u0:7  | Primitive | u32   | u32             | [global]
u0:8  | Primitive | u64   | u64             | [global]
u0:9  | Primitive | u16   | u16             | [global]
u0:10 | Primitive | u8    | u8              | [global]
u0:11 | Primitive | u128  | u128            | [global]
u0:12 | Primitive | usize | usize           | [global]
u0:13 | Primitive | f32   | f32             | [global]
u0:14 | Primitive | f64   | f64             | [global]
u0:15 | Primitive | bool  | bool            | [global]
u0:16 | Primitive | char  | char            | [global]
u0:17 | Primitive | str   | str             | [global]
u0:18 | Crate     | _c    | _c              | [global]
u0:19 | Crate     | crate | _c::crate       |         
u0:20 | Module    | _m    | _c::_m          |         
u0:21 | File      | main  | _c::_m::main    |         
u0:22 | Variable  | a     | _c::_m::main::a |         

--- expect:symbol-deps ---
